{"meta":{"version":1,"warehouse":"2.2.0"},"models":{"Asset":[{"_id":"source/git","path":"git","modified":1,"renderable":0},{"_id":"source/README.md","path":"README.md","modified":1,"renderable":0},{"_id":"source/CNAME","path":"CNAME","modified":1,"renderable":0},{"_id":"source/sitemap.xml","path":"sitemap.xml","modified":1,"renderable":0},{"_id":"source/resume/index.html","path":"resume/index.html","modified":1,"renderable":0},{"_id":"source/resume/app.js","path":"resume/app.js","modified":1,"renderable":0},{"_id":"source/favicon.png","path":"favicon.png","modified":1,"renderable":0},{"_id":"source/demo/code-printer/index.html","path":"demo/code-printer/index.html","modified":1,"renderable":0},{"_id":"source/demo/transform/index.html","path":"demo/transform/index.html","modified":1,"renderable":0},{"_id":"source/demo/transform/style.css","path":"demo/transform/style.css","modified":1,"renderable":0},{"_id":"source/demo/zEditor/index.html","path":"demo/zEditor/index.html","modified":1,"renderable":0},{"_id":"source/demo/transform/script.js","path":"demo/transform/script.js","modified":1,"renderable":0},{"_id":"source/resume/resume/index.html","path":"resume/resume/index.html","modified":1,"renderable":0},{"_id":"source/resume/resume/lndex.html","path":"resume/resume/lndex.html","modified":1,"renderable":0},{"_id":"source/resume/resume/style.css","path":"resume/resume/style.css","modified":1,"renderable":0},{"_id":"themes/huno/source/css/animate.css","path":"css/animate.css","modified":1,"renderable":1},{"_id":"themes/huno/source/css/archive.css","path":"css/archive.css","modified":1,"renderable":1},{"_id":"themes/huno/source/css/china-social-icon.css","path":"css/china-social-icon.css","modified":1,"renderable":1},{"_id":"themes/huno/source/css/uno.css","path":"css/uno.css","modified":1,"renderable":1},{"_id":"themes/huno/source/css/highlight.styl","path":"css/highlight.styl","modified":1,"renderable":1},{"_id":"themes/huno/source/js/jquery.githubRepoWidget.min.js","path":"js/jquery.githubRepoWidget.min.js","modified":1,"renderable":1},{"_id":"themes/huno/source/images/totop.png","path":"images/totop.png","modified":1,"renderable":1},{"_id":"themes/huno/source/js/main.js","path":"js/main.js","modified":1,"renderable":1},{"_id":"themes/huno/source/js/awesome-toc.min.js","path":"js/awesome-toc.min.js","modified":1,"renderable":1},{"_id":"themes/huno/source/js/scale.fix.js","path":"js/scale.fix.js","modified":1,"renderable":1},{"_id":"themes/huno/source/js/jquery.min.js","path":"js/jquery.min.js","modified":1,"renderable":1},{"_id":"source/demo/code-printer/resume/lndex.html","path":"demo/code-printer/resume/lndex.html","modified":1,"renderable":0},{"_id":"source/demo/code-printer/resume/index.html","path":"demo/code-printer/resume/index.html","modified":1,"renderable":0},{"_id":"source/demo/code-printer/resume/style.css","path":"demo/code-printer/resume/style.css","modified":1,"renderable":0},{"_id":"source/demo/code-printer/public/bundle.js","path":"demo/code-printer/public/bundle.js","modified":1,"renderable":0},{"_id":"source/demo/code-printer/public/index.html","path":"demo/code-printer/public/index.html","modified":1,"renderable":0},{"_id":"source/demo/zEditor/css/zEditor.css","path":"demo/zEditor/css/zEditor.css","modified":1,"renderable":0},{"_id":"source/demo/zEditor/js/zEditor.js","path":"demo/zEditor/js/zEditor.js","modified":1,"renderable":0},{"_id":"themes/huno/source/fonts/china-social/china-social.eot","path":"fonts/china-social/china-social.eot","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/china-social/readme.html","path":"fonts/china-social/readme.html","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/china-social/china-social.svg","path":"fonts/china-social/china-social.svg","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.css","path":"fonts/foundation-icons/foundation-icons.css","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/china-social/china-social.ttf","path":"fonts/china-social/china-social.ttf","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/china-social/china-social.woff","path":"fonts/china-social/china-social.woff","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.eot","path":"fonts/foundation-icons/foundation-icons.eot","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.woff","path":"fonts/foundation-icons/foundation-icons.woff","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.ttf","path":"fonts/foundation-icons/foundation-icons.ttf","modified":1,"renderable":1},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.svg","path":"fonts/foundation-icons/foundation-icons.svg","modified":1,"renderable":1},{"_id":"themes/huno/source/images/background-cover.jpg","path":"images/background-cover.jpg","modified":1,"renderable":1},{"_id":"source/resume/resume/life_photo.jpg","path":"resume/resume/life_photo.jpg","modified":1,"renderable":0},{"_id":"source/resume/resume/profile_photo.png","path":"resume/resume/profile_photo.png","modified":1,"renderable":0},{"_id":"source/resume/resume/resume.pdf","path":"resume/resume/resume.pdf","modified":1,"renderable":0}],"Cache":[{"_id":"source/git","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1520176092830},{"_id":"source/404.html","hash":"beaa3b900852350734de5bde0646d6a2f927fec4","modified":1520176092762},{"_id":"source/README.md","hash":"373ca4ae1191bc16780464e6027dedc8fba80068","modified":1520176092762},{"_id":"source/CNAME","hash":"f6bd0338d2dcccdee136bb43233c790a65f4ade4","modified":1520176092762},{"_id":"source/.DS_Store","hash":"e70530f1f00f04509f47d30dc414b649e9f6fbb2","modified":1528034804330},{"_id":"source/sitemap.xml","hash":"75669f3454427f0c2e962d1ad6cbf14cada120b2","modified":1520176092861},{"_id":"themes/huno/README.en.md","hash":"0878f26ed7fd9d4cbfeb0ddab5e1e14c93be793a","modified":1520259114821},{"_id":"themes/huno/README.md","hash":"f477895b3b089272faf903623d87783725867189","modified":1520259114821},{"_id":"themes/huno/_config.yml","hash":"f7b169a98ae6bf3588115e61fe4c54c20ee3c1c8","modified":1520259114822},{"_id":"source/_posts/3分钟搞懂CSS3-transform属性.md","hash":"6ef0e789659bba6b4f976b182e46e151e1dfc999","modified":1520176092766},{"_id":"source/_posts/Nginx 配置指南.md","hash":"b7d02af7e3ba31b08ca16904cb98ea662afc8599","modified":1520176092778},{"_id":"source/_posts/web超时配置总结.md","hash":"63294e384758f0caca1c5b0f6002cae239da7b63","modified":1520176092778},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面.md","hash":"de6fa9c47821686cd4b7d0d3110a07ec912e4510","modified":1532139801112},{"_id":"source/_posts/使用code-printer生成一份炫酷的简历.md","hash":"90b2fdab50719b643b5fec15eaa5221e4f8a5e0b","modified":1520176092820},{"_id":"source/_posts/一个简单的promise实现.md","hash":"e4d0ab46120fca2eb2f0f38b4348e6412afaf1de","modified":1520176092818},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握.md","hash":"e8fda575e98928bc05da4834921ec9e1478bdb34","modified":1524239089473},{"_id":"source/_posts/仅用1行核心JS代码实现一个轻量级富文本编辑器.md","hash":"c97d617d244784856e5675d274d43e88755c82ac","modified":1532570508471},{"_id":"source/_posts/坚持这件事儿.md","hash":"6d097ec40f6d0b8a4cbab80ea0c0987b02a2f588","modified":1520176092821},{"_id":"source/_posts/开发环境备份.md","hash":"7e4a93ec2b5bd18eecfd247d9035d40307c26c25","modified":1520176092823},{"_id":"source/_posts/基于RBAC的分权分域用户权限系统数据库设计.md","hash":"9a2b6d82c5fb8bc41c6462080d1d4e6b884a06b0","modified":1520176092823},{"_id":"source/_posts/深入探讨正斜杠和反斜杠.md","hash":"ada0f2a6ada6d457790caef2e758d202a16b288b","modified":1520176092824},{"_id":"source/_posts/谈一谈大文件上传——前台分片和后台合并.md","hash":"bb0ee1e30b570ac3e47abd9c7fbb2537ac72e031","modified":1520176092826},{"_id":"source/about/index.md","hash":"dc4cfb8d056c7215abfe403a30e998e94b1c6ce8","modified":1532832954826},{"_id":"source/_posts/通过microtasks和macrotasks看JavaScript异步任务执行顺序.md","hash":"058616acb878135bd312b684794ad092bf0b0930","modified":1520176092827},{"_id":"source/css/gitment.css","hash":"b4699de926f1f4ac30796fba0b059d778cdbbe81","modified":1520176092829},{"_id":"source/_posts/那些优雅灵性的JS代码片段.md","hash":"e65f6e2e8fb866e47a7339eba68c3b68189124d4","modified":1524239089644},{"_id":"source/archive/index.md","hash":"5470e5e74b1f79da2d2eebdecb57a503514aa2c4","modified":1520176092828},{"_id":"source/resume/index.html","hash":"4bb7cea80a4d85b9f29cda603f5d2c4b0a5a8cfc","modified":1524239089645},{"_id":"source/resume/app.js","hash":"864845b13917bfd3e7e20e40b9efe6322886fe06","modified":1524239089645},{"_id":"source/resume/.DS_Store","hash":"3222dc4d968cdbe091154ce52407f036fd984ce5","modified":1528034810519},{"_id":"themes/huno/.git/HEAD","hash":"acbaef275e46a7f14c1ef456fff2c8bbe8c84724","modified":1520259114786},{"_id":"themes/huno/.git/config","hash":"f49813c7fb9402c19b34b9fc16949c1eace91f6a","modified":1520259114787},{"_id":"themes/huno/.git/COMMIT_EDITMSG","hash":"094e894d9897903b07280def715171dde037eea1","modified":1532771371225},{"_id":"themes/huno/.git/FETCH_HEAD","hash":"dc18742bbc3bd3d97f14bc98a02f23bc81ea6864","modified":1532140957076},{"_id":"themes/huno/.git/description","hash":"9635f1b7e12c045212819dd934d809ef07efa2f4","modified":1520259114788},{"_id":"themes/huno/.git/ORIG_HEAD","hash":"b9be34c0157710a1ec7713c59009538f72a21a3d","modified":1532140957092},{"_id":"themes/huno/.git/index","hash":"1cc4b69c3441f4f6571777b5064c3e3da021d65c","modified":1532771355748},{"_id":"themes/huno/.git/packed-refs","hash":"0c2431f10d8430fabd6020d94bb7e3c39a111850","modified":1520259114817},{"_id":"themes/huno/languages/default.yml","hash":"bddd7fd79412849a52b9a36aae36af111b2db619","modified":1520259114829},{"_id":"themes/huno/languages/zh-CN.yml","hash":"fc0fcc3819c03baeecf2aa51cec08257973288cf","modified":1520259114831},{"_id":"themes/huno/languages/zh-TW.yml","hash":"d865666c14c58c70738d9aef04ae14e38e750c14","modified":1520259114832},{"_id":"themes/huno/layout/category.ejs","hash":"2b412d1b52b9da8ad19f6a66b1c18ab0b7546214","modified":1520259114843},{"_id":"themes/huno/layout/archive.ejs","hash":"23aff325ab97b2c7dde6e757fa3add5226a88b4f","modified":1520259114842},{"_id":"themes/huno/layout/index.ejs","hash":"12c817a875f353c03d8795c2a7b653e4da22c17e","modified":1520259114845},{"_id":"themes/huno/layout/layout.ejs","hash":"4977031185ae4687c0ba0ec1f7aec5050b203726","modified":1520259114846},{"_id":"themes/huno/layout/page-archive.ejs","hash":"ce5523d829c0fdd6a79984fcf15e33572a220df9","modified":1520259114847},{"_id":"themes/huno/layout/page.ejs","hash":"70a50ecf7e1aa9c658212f1e77783dcb287d56a6","modified":1520259114848},{"_id":"themes/huno/layout/post.ejs","hash":"86c9d13e8abdcff4d368e34595e2d2f11f37e9d4","modified":1520259114849},{"_id":"themes/huno/layout/tag.ejs","hash":"fefa03bed577cae2e1aac19bd5d30c5034f453a0","modified":1520259114850},{"_id":"source/favicon.png","hash":"fa92bbba6d23d631aa07ff8caa34bb75cebeffc1","modified":1520176092830},{"_id":"themes/huno/layout/_partials/list-posts.ejs","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1520259114835},{"_id":"themes/huno/layout/_scripts/site-analytics.ejs","hash":"da39a3ee5e6b4b0d3255bfef95601890afd80709","modified":1520259114841},{"_id":"themes/huno/cs-icon.png","hash":"4ba5bfbacb1a533f3561112406c305e9510aa8dd","modified":1520259114823},{"_id":"source/_posts/3分钟搞懂CSS3-transform属性/transform转换.mm","hash":"ca06e70075522b6f575111e1a301d543b023e7f0","modified":1520176092767},{"_id":"source/_posts/3分钟搞懂CSS3-transform属性/transform.png","hash":"4db1e1590dc40787e77893afa0ebdfc4c2170838","modified":1520176092767},{"_id":"source/_posts/Nginx 配置指南/nginx.png","hash":"77552569f50ea0a22a66a3dc267dfb91ebce3259","modified":1520176092778},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step2.png","hash":"17e83939e814c498e0e2f5d77f63159a0a8343a5","modified":1520176092814},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step4.png","hash":"296217c32f949044cd71963de06872f912e6b9d6","modified":1520176092815},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step5.png","hash":"52dc58d246899b0faf3dfe830c493937048cd89a","modified":1520176092815},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step6-1.png","hash":"cd8277f2d4b665cc4ff257e2214d20502cb314a5","modified":1520176092815},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step6-2.png","hash":"6d9e84b9c39c48d1165575a23488c36496c2c8b5","modified":1520176092816},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/4.2.png","hash":"fe7535cfa76aa552810a1c3f51b922702040615f","modified":1524239089541},{"_id":"source/_posts/一个简单的promise实现/Promise.prototype.then.png","hash":"797ab2eb233597a75ed5f2a56b17ed2e8b2b1b38","modified":1520176092819},{"_id":"source/_posts/一个简单的promise实现/promise.png","hash":"de56f0e57659a951efad2aedaf874dbc35329ec2","modified":1520176092819},{"_id":"source/_posts/仅用1行核心JS代码实现一个轻量级富文本编辑器/execCommand.png","hash":"b99c34f703247915e929791e85802b658a6d613d","modified":1520176092819},{"_id":"source/_posts/基于RBAC的分权分域用户权限系统数据库设计/分权分域数据库设计.png","hash":"ee0a86cc0980a98800b48b4b6d7791dba1591614","modified":1520176092823},{"_id":"source/_posts/深入探讨正斜杠和反斜杠/Unix.png","hash":"cc580516580c12b6fe34418ee9e229ad85659bcb","modified":1520176092824},{"_id":"source/_posts/深入探讨正斜杠和反斜杠/windows.png","hash":"5a0cbe914976aa0de5f0f9524bd923b57009a158","modified":1520176092826},{"_id":"source/_posts/那些优雅灵性的JS代码片段/codewars.png","hash":"220ae435f3fee5990dba7afc585b16a5fd1ab70a","modified":1524239089644},{"_id":"source/demo/code-printer/index.html","hash":"7e80e31c04d18752bf9fe680718455ec7f4fd813","modified":1520176092762},{"_id":"source/demo/transform/index.html","hash":"a4b47c7a96937b7cfbcf482435e65a05925e5804","modified":1524239089473},{"_id":"source/demo/transform/style.css","hash":"79da274acf25777d4f478e5105002f28907b8577","modified":1520176092765},{"_id":"source/demo/zEditor/index.html","hash":"22284022530adecf09347228f9e9bcda1e5c1fc9","modified":1520176092765},{"_id":"source/demo/transform/script.js","hash":"e67283bbdbc2f41602c9f0c7f9636b3ee6de2d74","modified":1520176092764},{"_id":"source/resume/resume/index.html","hash":"df1c71e0409f6b1770940e8099b0a1f86deea33e","modified":1529855018994},{"_id":"source/resume/resume/lndex.html","hash":"d562d6620126bc1359ce9b20efaa31731a24dd1e","modified":1525873273117},{"_id":"source/resume/resume/style.css","hash":"fb13afe69b974abb0ecbd5d1fba702d89a18c775","modified":1529855187560},{"_id":"source/js/gitment.browser.js","hash":"b15998a45d5f386d30905cfbfbb1658336acbb5b","modified":1520176092842},{"_id":"themes/huno/.git/hooks/applypatch-msg.sample","hash":"4de88eb95a5e93fd27e78b5fb3b5231a8d8917dd","modified":1520259114789},{"_id":"themes/huno/.git/hooks/post-update.sample","hash":"b614c2f63da7dca9f1db2e7ade61ef30448fc96c","modified":1520259114791},{"_id":"themes/huno/.git/hooks/commit-msg.sample","hash":"ee1ed5aad98a435f2020b6de35c173b75d9affac","modified":1520259114790},{"_id":"themes/huno/.git/hooks/pre-applypatch.sample","hash":"f208287c1a92525de9f5462e905a9d31de1e2d75","modified":1520259114791},{"_id":"themes/huno/.git/hooks/pre-commit.sample","hash":"36aed8976dcc08b5076844f0ec645b18bc37758f","modified":1520259114792},{"_id":"themes/huno/.git/hooks/pre-rebase.sample","hash":"18be3eb275c1decd3614e139f5a311b75f1b0ab8","modified":1520259114793},{"_id":"themes/huno/.git/hooks/pre-push.sample","hash":"5c8518bfd1d1d3d2c1a7194994c0a16d8a313a41","modified":1520259114793},{"_id":"themes/huno/.git/hooks/pre-receive.sample","hash":"705a17d259e7896f0082fe2e9f2c0c3b127be5ac","modified":1520259114794},{"_id":"themes/huno/.git/info/exclude","hash":"c879df015d97615050afa7b9641e3352a1e701ac","modified":1520259114797},{"_id":"themes/huno/.git/hooks/update.sample","hash":"e729cd61b27c128951d139de8e7c63d1a3758dde","modified":1520259114795},{"_id":"themes/huno/.git/hooks/prepare-commit-msg.sample","hash":"2b6275eda365cad50d167fe3a387c9bc9fedd54f","modified":1520259114795},{"_id":"themes/huno/.git/logs/HEAD","hash":"36d08280c52180a37aa43a157d2034d37f7a58df","modified":1532771371338},{"_id":"themes/huno/layout/_partials/archive.ejs","hash":"8ec577b65f67ac1a301cfffb3bf1b153d9c678e8","modified":1520259114833},{"_id":"themes/huno/layout/_partials/article.ejs","hash":"b9e335704d30feedd26a99662ff75f2f80808036","modified":1520259114833},{"_id":"themes/huno/layout/_partials/comment.ejs","hash":"bed65159ff31c9a50d3633914afe97596e640884","modified":1520259114834},{"_id":"themes/huno/layout/_partials/disqus.ejs","hash":"30c043cc683c78f345a658cf64b37e55e6521685","modified":1520259114834},{"_id":"themes/huno/layout/_partials/duoshuo.ejs","hash":"7cfe423c088a3bf0565e27a1c17d1b99a260786b","modified":1520259114835},{"_id":"themes/huno/layout/_partials/pagination.ejs","hash":"1240c019aa4df269777c54c0d2124b534ec1f380","modified":1520259114836},{"_id":"themes/huno/layout/_partials/footer.ejs","hash":"4a34870d7068fb279668e943e8398ae2b3f87785","modified":1520259114835},{"_id":"themes/huno/layout/_partials/side-panel.ejs","hash":"8d38cb60200b157d24866417686b0479def918de","modified":1520259114837},{"_id":"themes/huno/layout/_scripts/awesome-toc.ejs","hash":"b39df57929c246726ca45723ca9ad1a4104738c4","modified":1520259114839},{"_id":"themes/huno/layout/_scripts/github-repo-widget.ejs","hash":"ee64a8e431318cb8fb25f59cfeec0def95b58912","modified":1520259114840},{"_id":"themes/huno/layout/_scripts/killie6.ejs","hash":"2d5db8a53962ac704b8bfc40688319bed2e84ac9","modified":1520259114840},{"_id":"themes/huno/layout/_scripts/mathjax.ejs","hash":"83e38bcddf5851b8246e1d4c7558495096d96e37","modified":1520259114841},{"_id":"themes/huno/layout/_partials/social.ejs","hash":"69bd07117e5ed657866ac5f6b87963eb7c5053e9","modified":1532140957094},{"_id":"themes/huno/source/css/animate.css","hash":"651fcf046b1bd2bff3ab4cb8947ff7fe058de373","modified":1520259114854},{"_id":"themes/huno/source/css/archive.css","hash":"7238ea5f6bda859e3bae7aaa546caf27fe1fb0cc","modified":1520259114857},{"_id":"themes/huno/source/css/china-social-icon.css","hash":"2f90442f6d0d289e49c07a85c2dae32cab8b2063","modified":1520259114858},{"_id":"themes/huno/source/css/uno.css","hash":"784527296d8858b0ff9802e2a0ec265881ffdcd9","modified":1532771308101},{"_id":"themes/huno/source/css/highlight.styl","hash":"92eabbf94e7a06e968c356bedf4adb04700f1c2e","modified":1520259114860},{"_id":"themes/huno/source/js/jquery.githubRepoWidget.min.js","hash":"94a141fa474ec5022f7c397b4fd3ff92405ab755","modified":1520259114880},{"_id":"themes/huno/source/images/totop.png","hash":"4f6cb11941e5a72b03cb00cf9d9d55671b4310eb","modified":1520259114878},{"_id":"themes/huno/source/js/main.js","hash":"4a477bf23afa10929c4be55ab90c59ce0d9b9842","modified":1520259114882},{"_id":"themes/huno/source/js/awesome-toc.min.js","hash":"b4d0f2a33f8340eb2543e8b2cee0dfd745cfb54a","modified":1520259114879},{"_id":"themes/huno/source/js/scale.fix.js","hash":"ce593f56728cc1cedf2e513cb20b926de3b05e07","modified":1520259114882},{"_id":"source/_posts/3分钟搞懂CSS3-transform属性/skew.png","hash":"3c6d1ab1380a8d43b5c56163eed905ef1d84ae8c","modified":1520176092766},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step3.png","hash":"e8f79d3c64aa9a1ae7942bbcb73b2c593dbefc0d","modified":1520176092814},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/xhr.png","hash":"616c60f6905589897b26cb96969783c016ab6680","modified":1520176092818},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/11.png","hash":"46469a729b7f11979d5c1951189e125b25f63ed6","modified":1524239089501},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/12.png","hash":"64649c314fd2b08df9c4e4871b4b52f353432b28","modified":1524239089502},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/9.png","hash":"268b12920ab88665baabc90ff51faf93cab0be6a","modified":1524239089643},{"_id":"source/_posts/仅用1行核心JS代码实现一个轻量级富文本编辑器/zEditor.png","hash":"f68363c9c38044a8d4aebdc258b3cb9c97e8764c","modified":1520176092820},{"_id":"source/_posts/使用code-printer生成一份炫酷的简历/code-printer.png","hash":"a17294adf6497da6c9e841a64c17f754776bdb2c","modified":1520176092821},{"_id":"source/_posts/开发环境备份/hello2018.jpg","hash":"7c9580c39e0a773cbef97af94b75fcd23ec5adf8","modified":1520176092824},{"_id":"source/_posts/深入探讨正斜杠和反斜杠/slash.png","hash":"54eb58e49b3f824b230d60ca3a5b865405417439","modified":1520176092826},{"_id":"source/_posts/谈一谈大文件上传——前台分片和后台合并/upload.png","hash":"fa71dab305546fddb3f4f180f6fd8263903ac3e8","modified":1520176092827},{"_id":"themes/huno/source/js/jquery.min.js","hash":"8b6babff47b8a9793f37036fd1b1a3ad41d38423","modified":1520259114881},{"_id":"source/_posts/坚持这件事儿/930753.jpg","hash":"097590f30e6ae0b6b9acc3b481ac335f052a2829","modified":1520176092823},{"_id":"source/_posts/通过microtasks和macrotasks看JavaScript异步任务执行顺序/tasks.png","hash":"f899a6960e918fd48c4bdbed43316477db5e6bf4","modified":1520176092828},{"_id":"source/demo/code-printer/resume/lndex.html","hash":"fcf589effc2b6a5e9dad282148845cf9a2965931","modified":1520176092764},{"_id":"source/demo/code-printer/resume/index.html","hash":"18e9fbc9caf3850a848564776c929b3a794a443c","modified":1520176092764},{"_id":"source/demo/code-printer/resume/style.css","hash":"7d5367477dc268a6136a2a5fe705aebb1996161d","modified":1520176092764},{"_id":"source/demo/code-printer/public/bundle.js","hash":"60073e88c0ebf332a762d48081a6b0c34b9ccf51","modified":1520176092763},{"_id":"source/demo/code-printer/public/index.html","hash":"6c749debdf990e8126a7570c2cf89f18127ce75f","modified":1520176092763},{"_id":"source/demo/zEditor/css/zEditor.css","hash":"0e7c5a329ad326883f002a8e3ffe83fef19ac00b","modified":1520176092765},{"_id":"source/demo/zEditor/js/zEditor.js","hash":"28ee0a048f3c84ece85d03c0736ebeaf64bf0b93","modified":1520176092765},{"_id":"themes/huno/.git/objects/1b/b8a1036e4ff56cda6b4905159c75c45a571292","hash":"9ec811a1fa4401a673a3b47926281f599a84018d","modified":1532771371337},{"_id":"themes/huno/.git/objects/04/07ff46448a4f95604f03b1070730580a7561ed","hash":"74f3fe904ba0a62b5844bf9b59966b1b18a69b9d","modified":1532748744238},{"_id":"themes/huno/.git/objects/00/767820296274eb7f44449c77d06f45ee3fe431","hash":"89ac3007398ef94068000c4cf46ab7ff53509d91","modified":1532141149000},{"_id":"themes/huno/.git/objects/04/93fea55bbb7ee84472b0c691f8c36c8b635f9d","hash":"80d6d6a34fbb9361ea1c9d10baa0e1afff740eed","modified":1532141149147},{"_id":"themes/huno/.git/objects/19/135da2dfc411f30144cd9bcae5fee27ce545ff","hash":"0858c81e45f2720db81a969b7296d13667f26464","modified":1532141139769},{"_id":"themes/huno/.git/objects/35/474272838dd88c62c72033dd3765d624b06374","hash":"dd9cb420f8c96827424d2ce69db01ab42b1696da","modified":1532140957063},{"_id":"themes/huno/.git/objects/53/aaa5128e07593e5050e80cef77f504127a28e2","hash":"656c23a4b0721e0f4380570a6293485bed14a084","modified":1532140957065},{"_id":"themes/huno/.git/objects/23/4abbb4868c759845ca836203fc491b7aff9789","hash":"fa426663ae1434e4b65fd92951711aa459a333d0","modified":1532140957058},{"_id":"themes/huno/.git/objects/22/726cce26a436d52e4e8e919e0ce7e2fea7c605","hash":"eaaab979afde0ce0ecb4fbc203b382d1f7ccb95f","modified":1532140957067},{"_id":"themes/huno/.git/objects/5b/5a8ec47444d932d1ff81e152fba1a495ea23cd","hash":"7c965a016afd797ee63c484a612aa6cac5fa0873","modified":1532744554000},{"_id":"themes/huno/.git/objects/67/949fbc30b21ed1761de68541995a964095ac27","hash":"e01f7f94c400d5d9435457daeeaaa86c1d48699d","modified":1532748744239},{"_id":"themes/huno/.git/objects/62/29aa28fc2e9a3aa8d8a2f4ba9a66b2424ef8e7","hash":"3d7acb8d1dd794fdf631fac48789abad028505e6","modified":1532748744239},{"_id":"themes/huno/.git/objects/4a/bb39bc0447175d750b4ac573cbc6a601438e5f","hash":"044e476d2a028d7c6479d3c03c9b8f37b9850292","modified":1532748727526},{"_id":"themes/huno/.git/objects/66/ffb80cac23839ce1ff678a7ad27c84b2995dcc","hash":"7b5a8fb30577f962db5ca64116a85c2868b11440","modified":1532141149148},{"_id":"themes/huno/.git/objects/5f/ca569ea2e9ef92a0ea3add0734958079a73913","hash":"0a38dc767e76cc4292b3ee7f00911b0e562afbf0","modified":1532570792510},{"_id":"themes/huno/.git/objects/6d/289c940ad0b59252f546d7ad03f0cb8d91687a","hash":"544f4d14da66800b1ab8904cf9946a7ea6e06115","modified":1532140957062},{"_id":"themes/huno/.git/objects/7f/fbc4ea30ef95e45c7fbc3a4faae61218ff7a18","hash":"30ac21e3be5175362acf2bf9874942b8c45dd68b","modified":1532141149147},{"_id":"themes/huno/.git/objects/93/067c9b5f95fe89df5b89b2215c703c09a9f99e","hash":"d51fa98185f22e9c580274e7f7772d4d3250edad","modified":1532140957102},{"_id":"themes/huno/.git/objects/65/9699785cad622dd69aec3292583ab7a11644b5","hash":"064375066933f5d6b667fe76cef1bea2fcdf9798","modified":1532140957065},{"_id":"themes/huno/.git/objects/85/366a56f471bdf5b1a1caa4bbe2696b6bc57ff9","hash":"2c75cffa60620148a57c515d5cb57d4bd626cc75","modified":1532570792511},{"_id":"themes/huno/.git/objects/86/ae12e350c199b874d09ee50e0c8b74974aa829","hash":"56e86df558c1ac89489c57e94283d645541881b2","modified":1532140957057},{"_id":"themes/huno/.git/objects/82/48da48302b320d694c9e107fbaf70b067b7c25","hash":"fbb5b256b8c496b339b1eebc066f57b74b7f9cd5","modified":1532748744244},{"_id":"themes/huno/.git/objects/87/0ff9d0ef45e8f99ab9b2ce6e53837f9a3273ba","hash":"ed8fb63ed995288470132e6cd8272729a95911fa","modified":1532141149152},{"_id":"themes/huno/.git/objects/a0/b56e3c7617962e71bae2ef763ae6d63b0f41ae","hash":"80ba6f77c4fbaf44d61fa33f4b619d01b11e0359","modified":1520259114802},{"_id":"themes/huno/.git/objects/96/5cd2d6bde6ce546fa323c5558e260cad1f53ed","hash":"1da9aa6801e352b6ba6be693742e05e800081790","modified":1532744550000},{"_id":"themes/huno/.git/objects/a9/328a6f590002e16ed20093ef28c193de49dfd5","hash":"1bf61e519dd00f0bcca39dcdd2cade943ea4ed09","modified":1532744554000},{"_id":"themes/huno/.git/objects/ad/5f8fb2bb85f099248b1e5d6113244d4507432b","hash":"f177dd30a64e4aa185b66ad426bd8606d2c55905","modified":1520259114803},{"_id":"themes/huno/.git/objects/ad/339bfb793dcaff5e0e70ee0574cb563d2023c5","hash":"b52cc54152442d21ff71b18e9ae193f8296c209c","modified":1532140957057},{"_id":"themes/huno/.git/objects/8b/c5ccaec912bc3b37c99e1d9e04888c93616816","hash":"78fc466a72822b7e58d4a54b7dd0fd59e50a8908","modified":1532744554000},{"_id":"themes/huno/.git/objects/b1/5a57270da983747e3e64934d7256f490ee7b12","hash":"330a47aa63e5c39713b660ed5df155e59c229cf3","modified":1532141149000},{"_id":"themes/huno/.git/objects/c6/cb15cfffa73d98c9fcdfb4714994249581d4ae","hash":"768d0f20e48a763676beed4fc3e2809af09bdcf6","modified":1520259114804},{"_id":"themes/huno/.git/objects/b2/d81510bab70c952824c3072fa0167f8981ea4c","hash":"eb896ec0c4fda8ae283f9a5cbfb9c51f1d4c0a45","modified":1532570786904},{"_id":"themes/huno/.git/objects/ba/f13fb3f52b9b53805db4457432693e10c1d3dc","hash":"7306a58415ee99beb087e9b50e0c55cae495b163","modified":1532140941876},{"_id":"themes/huno/.git/objects/c9/07ff69380def88a55eaf15f55c6c01b4b6986a","hash":"6b2dea05a1d8d2c7f8f0a63368b2933deeea8953","modified":1520259114805},{"_id":"themes/huno/.git/objects/c8/0226668c18fda0aaa248f8f9c817d9cf0a0200","hash":"9feffc62ec5e41b0d9d21d5b22669f11546078ea","modified":1532771355746},{"_id":"themes/huno/.git/objects/cb/fcade562c56d86c833caebe8e54c70ea06a864","hash":"5f6349569c9b1297ccb61a38d216cd275892da75","modified":1520259114806},{"_id":"themes/huno/.git/objects/dd/182a5c4e23941a5a0825ef688cf0663ea3b5a3","hash":"0bf4ad10fa0ac63c21f2ac9e34426d3dab405cc7","modified":1532771349105},{"_id":"themes/huno/.git/objects/9b/e92367f1a8d03351e1081bea73fb60969c825c","hash":"83c4466fc3e3803760249e5554a67465db1faace","modified":1532771355747},{"_id":"themes/huno/.git/objects/fc/3606a92c5719ba4a3cb6861ac3215aa22966d4","hash":"58f0e866192548ee8659d1b32c8f428b8972eaf7","modified":1532140941875},{"_id":"themes/huno/.git/objects/eb/6843e16b75a499cc14dde4e80f94ece159990c","hash":"95f24e85cdf00fd11c7b8508c6967e7d52407fed","modified":1532744554696},{"_id":"themes/huno/.git/objects/f9/5038c73526e709915589457d45cec25c248919","hash":"58c2ec505b3e5db7903b81e31aaa243b58632794","modified":1532140941876},{"_id":"themes/huno/.git/objects/f1/12ea38d0b492cdd4a5a657026e1714b82f72cd","hash":"984d8a195999ec7464e7b66cd33cefbceb9bc3ae","modified":1532140912245},{"_id":"themes/huno/.git/objects/d7/28c38d2ce7ac374fd3c9cd2323e72d280b0cfb","hash":"574f10e15b3865a58a4662e0cf89d799eaf64740","modified":1532570792510},{"_id":"themes/huno/.git/objects/ee/7e81dc6e185cb81c7495647934a44dc7ad358c","hash":"ba1121aabc3065a81e7013aaa9831adf7b471bb7","modified":1532771355747},{"_id":"themes/huno/.git/objects/f1/02e5d70fb771201c3f9bd1aee2982c430efc32","hash":"4a12e2f049cd3cd767b7449ac86cad9f4be3842a","modified":1532140941881},{"_id":"themes/huno/.git/objects/pack/pack-fd402197b1f0efcc8fa92714b62184174e3d7737.idx","hash":"0b6332914ddeeb4706e1673cce2bb144d1ba70c2","modified":1520259114807},{"_id":"themes/huno/.git/refs/heads/master","hash":"bccda69395a99ba90b18cf58773eb22ab46bdc09","modified":1532771371338},{"_id":"themes/huno/.git/objects/d7/7fa0dc54347ff6cdcf6bcafd95b8c45608cd92","hash":"af373035f04dc538391f4016d573bd2dd66fe692","modified":1532228651072},{"_id":"themes/huno/.git/objects/ee/555dd1834b0d7c44a8d292ba3680fcbe1e9c41","hash":"f43fa09552a5e68b6d816c6dcc26f13aa984065a","modified":1532570792515},{"_id":"themes/huno/source/fonts/china-social/china-social.eot","hash":"a43a5c3d66f0d38639a595ebd02857e152ada475","modified":1520259114862},{"_id":"themes/huno/source/fonts/china-social/readme.html","hash":"ca335751de11d6ef7721dc907571de39cef6e361","modified":1520259114865},{"_id":"themes/huno/source/fonts/china-social/china-social.svg","hash":"4bad780e6a31f4fa9fef037a3d9ecb8623042a6e","modified":1520259114863},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.css","hash":"426036f1d554b9dffae8b38acc36cade40d9521a","modified":1520259114868},{"_id":"themes/huno/source/fonts/china-social/china-social.ttf","hash":"2f94360528097df7dcfb39baf8df5393a0d47ca3","modified":1520259114864},{"_id":"themes/huno/source/fonts/china-social/china-social.woff","hash":"74c0ac5268cf7ffe270faaf7c960b74d483d2df1","modified":1520259114865},{"_id":"themes/huno/source/fonts/foundation-icons/.fontcustom-data","hash":"3b0cfb3ba2ee7ccae391bc66b3acaa6895932e5f","modified":1520259114867},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.eot","hash":"d584172686583fd510d8f04cf21e6e77fce51435","modified":1520259114868},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.woff","hash":"112fb0e498037f2fea036adb8105e47638159eaa","modified":1520259114873},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.ttf","hash":"4b2bce6c792493a4a5716b6fec2dbefe89492c3f","modified":1520259114872},{"_id":"source/_posts/web超时配置总结/timeout.jpg","hash":"bcb9b0b70aea2dd51ae13a143dbd0416a8bb9be6","modified":1520176092780},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/13.gif","hash":"2e004309ab05ae39cf1f22fbb2bf52b50a323d3a","modified":1524239089503},{"_id":"source/_posts/深入探讨正斜杠和反斜杠/slash.jpg","hash":"a823381ada0e232db6c814fe9c1bc4e911c86ebc","modified":1520176092825},{"_id":"themes/huno/.git/logs/refs/heads/master","hash":"36d08280c52180a37aa43a157d2034d37f7a58df","modified":1532771371339},{"_id":"themes/huno/.git/refs/remotes/origin/master","hash":"bccda69395a99ba90b18cf58773eb22ab46bdc09","modified":1532771391963},{"_id":"themes/huno/.git/refs/remotes/origin/HEAD","hash":"d9427cda09aba1cdde5c69c2b13c905bddb0bc51","modified":1520259114819},{"_id":"themes/huno/source/fonts/foundation-icons/foundation-icons.svg","hash":"bdca38f453f9935203fe8cd071e97d7f8576e0be","modified":1520259114871},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/wallpaper.jpg","hash":"05a5621415a1ac2a19d09bc2e0deefd121cacb92","modified":1520176092817},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/3.gif","hash":"d27b866cf3d40f98808a3cabb834be80381db3e8","modified":1524239089541},{"_id":"themes/huno/.git/logs/refs/remotes/origin/HEAD","hash":"b2d0b3b1aa6ad0e10c4f3882121590d14b8d81ad","modified":1520259114801},{"_id":"themes/huno/.git/logs/refs/remotes/origin/master","hash":"169c0469da310a0dff2e834c48c6792a78524111","modified":1532771391964},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/background-cover.jpg","hash":"08162d5ddd6c081f2713bfd10261e62f0752a600","modified":1520176092790},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/8.gif","hash":"9a52921396db2341d7c21254534e5046eb5e3210","modified":1524239089642},{"_id":"themes/huno/source/images/background-cover.jpg","hash":"08162d5ddd6c081f2713bfd10261e62f0752a600","modified":1520259114877},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/10.gif","hash":"778d6c1a74839d31193c74d903839f0bca26d9e4","modified":1524239089500},{"_id":"source/_posts/3分钟搞懂CSS3-transform属性/transform转换.png","hash":"a37cbe511a65050ec9d3e2aa9e96a609eab2e7a8","modified":1520176092778},{"_id":"themes/huno/demo.gif","hash":"cf6121b4aa0f3b07a2f919099942d97206202aa8","modified":1520259114828},{"_id":"source/resume/resume/life_photo.jpg","hash":"fb983f2f3d21d87ab93ae6f46edab9d92eaed5c6","modified":1525873273115},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/before.png","hash":"3139763dfdb1f8a2c6ffbc9e72a0cf6b26526d5b","modified":1520176092795},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/after.png","hash":"c477b84e1a2be82d894b8fefe53bcc0962b685c8","modified":1520176092787},{"_id":"source/resume/resume/profile_photo.png","hash":"d64645fb084eda1dd015e01185042ad7cd2a68c3","modified":1525873273225},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/bingcn.png","hash":"fd5b18f6e132dda2d1091d973d776af041da35f4","modified":1520176092802},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/4.gif","hash":"2019c3a93e33bff48c91304b64a97824854765d5","modified":1524239089557},{"_id":"source/resume/resume/resume.pdf","hash":"8141e8fe83c46faf1e5e1ecf6132f0085fa1a28a","modified":1529855124961},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/bingen.png","hash":"cb356b646846d7b9d09612dd98753cdc0d390cfe","modified":1520176092813},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/7.gif","hash":"21381589b22d52f6623f9d772dfb81a01e2e83fd","modified":1524239089636},{"_id":"themes/huno/.git/objects/pack/pack-fd402197b1f0efcc8fa92714b62184174e3d7737.pack","hash":"05f2472efb5e181bfaf9d41ef97b91d346cf8b77","modified":1532141149000},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/6.gif","hash":"99af677da5a2ccdba8e6e51398619d1cf7ead149","modified":1524239089615},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/1.gif","hash":"8c4b1e37bb6e158750f969f9314ced235f362758","modified":1524239089494},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/2.gif","hash":"3e8dda115f6c93c0dd57ae8e0c1b4fd351b81524","modified":1524239089539},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/5.gif","hash":"d407ff65d7897a7058326e2c62da6cd508e91330","modified":1524239089593}],"Category":[],"Data":[],"Page":[{"layout":"false","title":"404","_content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>404咯~您可能打开了错误的页面</title>\n    <style>\n        body {\n            background: #000;\n            color: #fff;\n            font-family: \"Lucida Console\", Monaco, monospace;\n            line-height: 1.5;\n        }\n\n        a {\n            color: #fff;\n            text-decoration: none;\n            border-bottom: solid 2px;\n        }\n\n        @media (min-width: 640px) {\n            body {\n                background-image: url(/images/desk.jpg);\n                background-size: cover;\n                background-repeat: no-repeat;\n                background-position: center;\n                min-height: 100vh;\n            }\n\n            .content {\n                width: 500px;\n                height: 300px;\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                -webkit-transform: translate(-50%, -50%);\n                -ms-transform: translate(-50%, -50%);\n                background-color: #333;\n                padding: 45px 20px 20px;\n                box-sizing: border-box;\n                box-shadow: 0 0 25px rgba(0, 0, 0, .5);\n                border-radius: 5px 5px 0 0;\n            }\n\n            .browser-bar {\n                background: #f9f9f3;\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                padding: 5px;\n                overflow: hidden;\n                border-radius: 5px 5px 0 0;\n            }\n\n            .button {\n                display: inline-block;\n                float: left;\n                border-radius: 50%;\n                width: 15px;\n                height: 15px;\n                margin-right: 5px;\n            }\n\n            .close {\n                background: #fc635d;\n            }\n\n            .min {\n                background: #fdbc40;\n            }\n\n            .max {\n                background: #34c84a;\n            }\n        }\n    </style>\n</head>\n<body>\n<div class=\"content\">\n    <div class=\"browser-bar\">\n        <span class=\"close button\"></span>\n        <span class=\"min button\"></span>\n        <span class=\"max button\"></span>\n    </div>\n    <div class=\"text\"></div>\n</div>\n</body>\n<script src=\"/js/jquery.min.js\"></script>\n<script>\n    !function(t){\"use strict\";var s=function(s,e){this.el=t(s),this.options=t.extend({},t.fn.typed.defaults,e),this.isInput=this.el.is(\"input\"),this.attr=this.options.attr,this.showCursor=this.isInput?!1:this.options.showCursor,this.elContent=this.attr?this.el.attr(this.attr):this.el.text(),this.contentType=this.options.contentType,this.typeSpeed=this.options.typeSpeed,this.startDelay=this.options.startDelay,this.backSpeed=this.options.backSpeed,this.backDelay=this.options.backDelay,this.stringsElement=this.options.stringsElement,this.strings=this.options.strings,this.strPos=0,this.arrayPos=0,this.stopNum=0,this.loop=this.options.loop,this.loopCount=this.options.loopCount,this.curLoop=0,this.stop=!1,this.cursorChar=this.options.cursorChar,this.shuffle=this.options.shuffle,this.sequence=[],this.build()};s.prototype={constructor:s,init:function(){var t=this;t.timeout=setTimeout(function(){for(var s=0;s<t.strings.length;++s)t.sequence[s]=s;t.shuffle&&(t.sequence=t.shuffleArray(t.sequence)),t.typewrite(t.strings[t.sequence[t.arrayPos]],t.strPos)},t.startDelay)},build:function(){var s=this;if(this.showCursor===!0&&(this.cursor=t('<span class=\"typed-cursor\">'+this.cursorChar+\"</span>\"),this.el.after(this.cursor)),this.stringsElement){s.strings=[],this.stringsElement.hide();var e=this.stringsElement.find(\"p\");t.each(e,function(e,i){s.strings.push(t(i).html())})}this.init()},typewrite:function(t,s){if(this.stop!==!0){var e=Math.round(70*Math.random())+this.typeSpeed,i=this;i.timeout=setTimeout(function(){var e=0,r=t.substr(s);if(\"^\"===r.charAt(0)){var o=1;/^\\^\\d+/.test(r)&&(r=/\\d+/.exec(r)[0],o+=r.length,e=parseInt(r)),t=t.substring(0,s)+t.substring(s+o)}if(\"html\"===i.contentType){var n=t.substr(s).charAt(0);if(\"<\"===n||\"&\"===n){var a=\"\",h=\"\";for(h=\"<\"===n?\">\":\";\";t.substr(s).charAt(0)!==h;)a+=t.substr(s).charAt(0),s++;s++,a+=h}}i.timeout=setTimeout(function(){if(s===t.length){if(i.options.onStringTyped(i.arrayPos),i.arrayPos===i.strings.length-1&&(i.options.callback(),i.curLoop++,i.loop===!1||i.curLoop===i.loopCount))return;i.timeout=setTimeout(function(){i.backspace(t,s)},i.backDelay)}else{0===s&&i.options.preStringTyped(i.arrayPos);var e=t.substr(0,s+1);i.attr?i.el.attr(i.attr,e):i.isInput?i.el.val(e):\"html\"===i.contentType?i.el.html(e):i.el.text(e),s++,i.typewrite(t,s)}},e)},e)}},backspace:function(t,s){if(this.stop!==!0){var e=Math.round(70*Math.random())+this.backSpeed,i=this;i.timeout=setTimeout(function(){if(\"html\"===i.contentType&&\">\"===t.substr(s).charAt(0)){for(var e=\"\";\"<\"!==t.substr(s).charAt(0);)e-=t.substr(s).charAt(0),s--;s--,e+=\"<\"}var r=t.substr(0,s);i.attr?i.el.attr(i.attr,r):i.isInput?i.el.val(r):\"html\"===i.contentType?i.el.html(r):i.el.text(r),s>i.stopNum?(s--,i.backspace(t,s)):s<=i.stopNum&&(i.arrayPos++,i.arrayPos===i.strings.length?(i.arrayPos=0,i.shuffle&&(i.sequence=i.shuffleArray(i.sequence)),i.init()):i.typewrite(i.strings[i.sequence[i.arrayPos]],s))},e)}},shuffleArray:function(t){var s,e,i=t.length;if(i)for(;--i;)e=Math.floor(Math.random()*(i+1)),s=t[e],t[e]=t[i],t[i]=s;return t},reset:function(){var t=this;clearInterval(t.timeout);var s=this.el.attr(\"id\");this.el.after('<span id=\"'+s+'\"/>'),this.el.remove(),\"undefined\"!=typeof this.cursor&&this.cursor.remove(),t.options.resetCallback()}},t.fn.typed=function(e){return this.each(function(){var i=t(this),r=i.data(\"typed\"),o=\"object\"==typeof e&&e;r||i.data(\"typed\",r=new s(this,o)),\"string\"==typeof e&&r[e]()})},t.fn.typed.defaults={strings:[\"These are the default values...\",\"You know what you should do?\",\"Use your own!\",\"Have a great day!\"],stringsElement:null,typeSpeed:0,startDelay:0,backSpeed:0,shuffle:!1,backDelay:500,loop:!1,loopCount:!1,showCursor:!0,cursorChar:\"|\",attr:null,contentType:\"html\",callback:function(){},preStringTyped:function(){},onStringTyped:function(){},resetCallback:function(){}}}(window.jQuery);\n\n    $(function(){\n        $('.text').typed({\n            strings: [\n                \"Oops! It looks like you're lost. <br /> ^1000\" +\n                \"Sorry about that. <br /> ^1000\" +\n                \"Let me try and help. <br /> ^1000\" +\n                \"Go back <a href='/'>home</a> and start over.\"\n            ],\n            typeSpeed: 0,\n            showCursor: false\n        });\n    });\n</script>\n</html>","source":"404.html","raw":"layout: false\ntitle: \"404\"\n---\n<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>404咯~您可能打开了错误的页面</title>\n    <style>\n        body {\n            background: #000;\n            color: #fff;\n            font-family: \"Lucida Console\", Monaco, monospace;\n            line-height: 1.5;\n        }\n\n        a {\n            color: #fff;\n            text-decoration: none;\n            border-bottom: solid 2px;\n        }\n\n        @media (min-width: 640px) {\n            body {\n                background-image: url(/images/desk.jpg);\n                background-size: cover;\n                background-repeat: no-repeat;\n                background-position: center;\n                min-height: 100vh;\n            }\n\n            .content {\n                width: 500px;\n                height: 300px;\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                -webkit-transform: translate(-50%, -50%);\n                -ms-transform: translate(-50%, -50%);\n                background-color: #333;\n                padding: 45px 20px 20px;\n                box-sizing: border-box;\n                box-shadow: 0 0 25px rgba(0, 0, 0, .5);\n                border-radius: 5px 5px 0 0;\n            }\n\n            .browser-bar {\n                background: #f9f9f3;\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                padding: 5px;\n                overflow: hidden;\n                border-radius: 5px 5px 0 0;\n            }\n\n            .button {\n                display: inline-block;\n                float: left;\n                border-radius: 50%;\n                width: 15px;\n                height: 15px;\n                margin-right: 5px;\n            }\n\n            .close {\n                background: #fc635d;\n            }\n\n            .min {\n                background: #fdbc40;\n            }\n\n            .max {\n                background: #34c84a;\n            }\n        }\n    </style>\n</head>\n<body>\n<div class=\"content\">\n    <div class=\"browser-bar\">\n        <span class=\"close button\"></span>\n        <span class=\"min button\"></span>\n        <span class=\"max button\"></span>\n    </div>\n    <div class=\"text\"></div>\n</div>\n</body>\n<script src=\"/js/jquery.min.js\"></script>\n<script>\n    !function(t){\"use strict\";var s=function(s,e){this.el=t(s),this.options=t.extend({},t.fn.typed.defaults,e),this.isInput=this.el.is(\"input\"),this.attr=this.options.attr,this.showCursor=this.isInput?!1:this.options.showCursor,this.elContent=this.attr?this.el.attr(this.attr):this.el.text(),this.contentType=this.options.contentType,this.typeSpeed=this.options.typeSpeed,this.startDelay=this.options.startDelay,this.backSpeed=this.options.backSpeed,this.backDelay=this.options.backDelay,this.stringsElement=this.options.stringsElement,this.strings=this.options.strings,this.strPos=0,this.arrayPos=0,this.stopNum=0,this.loop=this.options.loop,this.loopCount=this.options.loopCount,this.curLoop=0,this.stop=!1,this.cursorChar=this.options.cursorChar,this.shuffle=this.options.shuffle,this.sequence=[],this.build()};s.prototype={constructor:s,init:function(){var t=this;t.timeout=setTimeout(function(){for(var s=0;s<t.strings.length;++s)t.sequence[s]=s;t.shuffle&&(t.sequence=t.shuffleArray(t.sequence)),t.typewrite(t.strings[t.sequence[t.arrayPos]],t.strPos)},t.startDelay)},build:function(){var s=this;if(this.showCursor===!0&&(this.cursor=t('<span class=\"typed-cursor\">'+this.cursorChar+\"</span>\"),this.el.after(this.cursor)),this.stringsElement){s.strings=[],this.stringsElement.hide();var e=this.stringsElement.find(\"p\");t.each(e,function(e,i){s.strings.push(t(i).html())})}this.init()},typewrite:function(t,s){if(this.stop!==!0){var e=Math.round(70*Math.random())+this.typeSpeed,i=this;i.timeout=setTimeout(function(){var e=0,r=t.substr(s);if(\"^\"===r.charAt(0)){var o=1;/^\\^\\d+/.test(r)&&(r=/\\d+/.exec(r)[0],o+=r.length,e=parseInt(r)),t=t.substring(0,s)+t.substring(s+o)}if(\"html\"===i.contentType){var n=t.substr(s).charAt(0);if(\"<\"===n||\"&\"===n){var a=\"\",h=\"\";for(h=\"<\"===n?\">\":\";\";t.substr(s).charAt(0)!==h;)a+=t.substr(s).charAt(0),s++;s++,a+=h}}i.timeout=setTimeout(function(){if(s===t.length){if(i.options.onStringTyped(i.arrayPos),i.arrayPos===i.strings.length-1&&(i.options.callback(),i.curLoop++,i.loop===!1||i.curLoop===i.loopCount))return;i.timeout=setTimeout(function(){i.backspace(t,s)},i.backDelay)}else{0===s&&i.options.preStringTyped(i.arrayPos);var e=t.substr(0,s+1);i.attr?i.el.attr(i.attr,e):i.isInput?i.el.val(e):\"html\"===i.contentType?i.el.html(e):i.el.text(e),s++,i.typewrite(t,s)}},e)},e)}},backspace:function(t,s){if(this.stop!==!0){var e=Math.round(70*Math.random())+this.backSpeed,i=this;i.timeout=setTimeout(function(){if(\"html\"===i.contentType&&\">\"===t.substr(s).charAt(0)){for(var e=\"\";\"<\"!==t.substr(s).charAt(0);)e-=t.substr(s).charAt(0),s--;s--,e+=\"<\"}var r=t.substr(0,s);i.attr?i.el.attr(i.attr,r):i.isInput?i.el.val(r):\"html\"===i.contentType?i.el.html(r):i.el.text(r),s>i.stopNum?(s--,i.backspace(t,s)):s<=i.stopNum&&(i.arrayPos++,i.arrayPos===i.strings.length?(i.arrayPos=0,i.shuffle&&(i.sequence=i.shuffleArray(i.sequence)),i.init()):i.typewrite(i.strings[i.sequence[i.arrayPos]],s))},e)}},shuffleArray:function(t){var s,e,i=t.length;if(i)for(;--i;)e=Math.floor(Math.random()*(i+1)),s=t[e],t[e]=t[i],t[i]=s;return t},reset:function(){var t=this;clearInterval(t.timeout);var s=this.el.attr(\"id\");this.el.after('<span id=\"'+s+'\"/>'),this.el.remove(),\"undefined\"!=typeof this.cursor&&this.cursor.remove(),t.options.resetCallback()}},t.fn.typed=function(e){return this.each(function(){var i=t(this),r=i.data(\"typed\"),o=\"object\"==typeof e&&e;r||i.data(\"typed\",r=new s(this,o)),\"string\"==typeof e&&r[e]()})},t.fn.typed.defaults={strings:[\"These are the default values...\",\"You know what you should do?\",\"Use your own!\",\"Have a great day!\"],stringsElement:null,typeSpeed:0,startDelay:0,backSpeed:0,shuffle:!1,backDelay:500,loop:!1,loopCount:!1,showCursor:!0,cursorChar:\"|\",attr:null,contentType:\"html\",callback:function(){},preStringTyped:function(){},onStringTyped:function(){},resetCallback:function(){}}}(window.jQuery);\n\n    $(function(){\n        $('.text').typed({\n            strings: [\n                \"Oops! It looks like you're lost. <br /> ^1000\" +\n                \"Sorry about that. <br /> ^1000\" +\n                \"Let me try and help. <br /> ^1000\" +\n                \"Go back <a href='/'>home</a> and start over.\"\n            ],\n            typeSpeed: 0,\n            showCursor: false\n        });\n    });\n</script>\n</html>","date":"2018-03-04T15:08:12.762Z","updated":"2018-03-04T15:08:12.762Z","path":"404.html","comments":1,"_id":"cjk698hvl0000znzwsmj1lyy6","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>404咯~您可能打开了错误的页面</title>\n    <style>\n        body {\n            background: #000;\n            color: #fff;\n            font-family: \"Lucida Console\", Monaco, monospace;\n            line-height: 1.5;\n        }\n\n        a {\n            color: #fff;\n            text-decoration: none;\n            border-bottom: solid 2px;\n        }\n\n        @media (min-width: 640px) {\n            body {\n                background-image: url(/images/desk.jpg);\n                background-size: cover;\n                background-repeat: no-repeat;\n                background-position: center;\n                min-height: 100vh;\n            }\n\n            .content {\n                width: 500px;\n                height: 300px;\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                -webkit-transform: translate(-50%, -50%);\n                -ms-transform: translate(-50%, -50%);\n                background-color: #333;\n                padding: 45px 20px 20px;\n                box-sizing: border-box;\n                box-shadow: 0 0 25px rgba(0, 0, 0, .5);\n                border-radius: 5px 5px 0 0;\n            }\n\n            .browser-bar {\n                background: #f9f9f3;\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                padding: 5px;\n                overflow: hidden;\n                border-radius: 5px 5px 0 0;\n            }\n\n            .button {\n                display: inline-block;\n                float: left;\n                border-radius: 50%;\n                width: 15px;\n                height: 15px;\n                margin-right: 5px;\n            }\n\n            .close {\n                background: #fc635d;\n            }\n\n            .min {\n                background: #fdbc40;\n            }\n\n            .max {\n                background: #34c84a;\n            }\n        }\n    </style>\n</head>\n<body>\n<div class=\"content\">\n    <div class=\"browser-bar\">\n        <span class=\"close button\"></span>\n        <span class=\"min button\"></span>\n        <span class=\"max button\"></span>\n    </div>\n    <div class=\"text\"></div>\n</div>\n</body>\n<script src=\"/js/jquery.min.js\"></script>\n<script>\n    !function(t){\"use strict\";var s=function(s,e){this.el=t(s),this.options=t.extend({},t.fn.typed.defaults,e),this.isInput=this.el.is(\"input\"),this.attr=this.options.attr,this.showCursor=this.isInput?!1:this.options.showCursor,this.elContent=this.attr?this.el.attr(this.attr):this.el.text(),this.contentType=this.options.contentType,this.typeSpeed=this.options.typeSpeed,this.startDelay=this.options.startDelay,this.backSpeed=this.options.backSpeed,this.backDelay=this.options.backDelay,this.stringsElement=this.options.stringsElement,this.strings=this.options.strings,this.strPos=0,this.arrayPos=0,this.stopNum=0,this.loop=this.options.loop,this.loopCount=this.options.loopCount,this.curLoop=0,this.stop=!1,this.cursorChar=this.options.cursorChar,this.shuffle=this.options.shuffle,this.sequence=[],this.build()};s.prototype={constructor:s,init:function(){var t=this;t.timeout=setTimeout(function(){for(var s=0;s<t.strings.length;++s)t.sequence[s]=s;t.shuffle&&(t.sequence=t.shuffleArray(t.sequence)),t.typewrite(t.strings[t.sequence[t.arrayPos]],t.strPos)},t.startDelay)},build:function(){var s=this;if(this.showCursor===!0&&(this.cursor=t('<span class=\"typed-cursor\">'+this.cursorChar+\"</span>\"),this.el.after(this.cursor)),this.stringsElement){s.strings=[],this.stringsElement.hide();var e=this.stringsElement.find(\"p\");t.each(e,function(e,i){s.strings.push(t(i).html())})}this.init()},typewrite:function(t,s){if(this.stop!==!0){var e=Math.round(70*Math.random())+this.typeSpeed,i=this;i.timeout=setTimeout(function(){var e=0,r=t.substr(s);if(\"^\"===r.charAt(0)){var o=1;/^\\^\\d+/.test(r)&&(r=/\\d+/.exec(r)[0],o+=r.length,e=parseInt(r)),t=t.substring(0,s)+t.substring(s+o)}if(\"html\"===i.contentType){var n=t.substr(s).charAt(0);if(\"<\"===n||\"&\"===n){var a=\"\",h=\"\";for(h=\"<\"===n?\">\":\";\";t.substr(s).charAt(0)!==h;)a+=t.substr(s).charAt(0),s++;s++,a+=h}}i.timeout=setTimeout(function(){if(s===t.length){if(i.options.onStringTyped(i.arrayPos),i.arrayPos===i.strings.length-1&&(i.options.callback(),i.curLoop++,i.loop===!1||i.curLoop===i.loopCount))return;i.timeout=setTimeout(function(){i.backspace(t,s)},i.backDelay)}else{0===s&&i.options.preStringTyped(i.arrayPos);var e=t.substr(0,s+1);i.attr?i.el.attr(i.attr,e):i.isInput?i.el.val(e):\"html\"===i.contentType?i.el.html(e):i.el.text(e),s++,i.typewrite(t,s)}},e)},e)}},backspace:function(t,s){if(this.stop!==!0){var e=Math.round(70*Math.random())+this.backSpeed,i=this;i.timeout=setTimeout(function(){if(\"html\"===i.contentType&&\">\"===t.substr(s).charAt(0)){for(var e=\"\";\"<\"!==t.substr(s).charAt(0);)e-=t.substr(s).charAt(0),s--;s--,e+=\"<\"}var r=t.substr(0,s);i.attr?i.el.attr(i.attr,r):i.isInput?i.el.val(r):\"html\"===i.contentType?i.el.html(r):i.el.text(r),s>i.stopNum?(s--,i.backspace(t,s)):s<=i.stopNum&&(i.arrayPos++,i.arrayPos===i.strings.length?(i.arrayPos=0,i.shuffle&&(i.sequence=i.shuffleArray(i.sequence)),i.init()):i.typewrite(i.strings[i.sequence[i.arrayPos]],s))},e)}},shuffleArray:function(t){var s,e,i=t.length;if(i)for(;--i;)e=Math.floor(Math.random()*(i+1)),s=t[e],t[e]=t[i],t[i]=s;return t},reset:function(){var t=this;clearInterval(t.timeout);var s=this.el.attr(\"id\");this.el.after('<span id=\"'+s+'\"/>'),this.el.remove(),\"undefined\"!=typeof this.cursor&&this.cursor.remove(),t.options.resetCallback()}},t.fn.typed=function(e){return this.each(function(){var i=t(this),r=i.data(\"typed\"),o=\"object\"==typeof e&&e;r||i.data(\"typed\",r=new s(this,o)),\"string\"==typeof e&&r[e]()})},t.fn.typed.defaults={strings:[\"These are the default values...\",\"You know what you should do?\",\"Use your own!\",\"Have a great day!\"],stringsElement:null,typeSpeed:0,startDelay:0,backSpeed:0,shuffle:!1,backDelay:500,loop:!1,loopCount:!1,showCursor:!0,cursorChar:\"|\",attr:null,contentType:\"html\",callback:function(){},preStringTyped:function(){},onStringTyped:function(){},resetCallback:function(){}}}(window.jQuery);\n\n    $(function(){\n        $('.text').typed({\n            strings: [\n                \"Oops! It looks like you're lost. <br /> ^1000\" +\n                \"Sorry about that. <br /> ^1000\" +\n                \"Let me try and help. <br /> ^1000\" +\n                \"Go back <a href='/'>home</a> and start over.\"\n            ],\n            typeSpeed: 0,\n            showCursor: false\n        });\n    });\n</script>\n</html>","site":{"data":{}},"excerpt":"","more":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <title>404咯~您可能打开了错误的页面</title>\n    <style>\n        body {\n            background: #000;\n            color: #fff;\n            font-family: \"Lucida Console\", Monaco, monospace;\n            line-height: 1.5;\n        }\n\n        a {\n            color: #fff;\n            text-decoration: none;\n            border-bottom: solid 2px;\n        }\n\n        @media (min-width: 640px) {\n            body {\n                background-image: url(/images/desk.jpg);\n                background-size: cover;\n                background-repeat: no-repeat;\n                background-position: center;\n                min-height: 100vh;\n            }\n\n            .content {\n                width: 500px;\n                height: 300px;\n                position: absolute;\n                top: 50%;\n                left: 50%;\n                transform: translate(-50%, -50%);\n                -webkit-transform: translate(-50%, -50%);\n                -ms-transform: translate(-50%, -50%);\n                background-color: #333;\n                padding: 45px 20px 20px;\n                box-sizing: border-box;\n                box-shadow: 0 0 25px rgba(0, 0, 0, .5);\n                border-radius: 5px 5px 0 0;\n            }\n\n            .browser-bar {\n                background: #f9f9f3;\n                position: absolute;\n                top: 0;\n                left: 0;\n                right: 0;\n                padding: 5px;\n                overflow: hidden;\n                border-radius: 5px 5px 0 0;\n            }\n\n            .button {\n                display: inline-block;\n                float: left;\n                border-radius: 50%;\n                width: 15px;\n                height: 15px;\n                margin-right: 5px;\n            }\n\n            .close {\n                background: #fc635d;\n            }\n\n            .min {\n                background: #fdbc40;\n            }\n\n            .max {\n                background: #34c84a;\n            }\n        }\n    </style>\n</head>\n<body>\n<div class=\"content\">\n    <div class=\"browser-bar\">\n        <span class=\"close button\"></span>\n        <span class=\"min button\"></span>\n        <span class=\"max button\"></span>\n    </div>\n    <div class=\"text\"></div>\n</div>\n</body>\n<script src=\"/js/jquery.min.js\"></script>\n<script>\n    !function(t){\"use strict\";var s=function(s,e){this.el=t(s),this.options=t.extend({},t.fn.typed.defaults,e),this.isInput=this.el.is(\"input\"),this.attr=this.options.attr,this.showCursor=this.isInput?!1:this.options.showCursor,this.elContent=this.attr?this.el.attr(this.attr):this.el.text(),this.contentType=this.options.contentType,this.typeSpeed=this.options.typeSpeed,this.startDelay=this.options.startDelay,this.backSpeed=this.options.backSpeed,this.backDelay=this.options.backDelay,this.stringsElement=this.options.stringsElement,this.strings=this.options.strings,this.strPos=0,this.arrayPos=0,this.stopNum=0,this.loop=this.options.loop,this.loopCount=this.options.loopCount,this.curLoop=0,this.stop=!1,this.cursorChar=this.options.cursorChar,this.shuffle=this.options.shuffle,this.sequence=[],this.build()};s.prototype={constructor:s,init:function(){var t=this;t.timeout=setTimeout(function(){for(var s=0;s<t.strings.length;++s)t.sequence[s]=s;t.shuffle&&(t.sequence=t.shuffleArray(t.sequence)),t.typewrite(t.strings[t.sequence[t.arrayPos]],t.strPos)},t.startDelay)},build:function(){var s=this;if(this.showCursor===!0&&(this.cursor=t('<span class=\"typed-cursor\">'+this.cursorChar+\"</span>\"),this.el.after(this.cursor)),this.stringsElement){s.strings=[],this.stringsElement.hide();var e=this.stringsElement.find(\"p\");t.each(e,function(e,i){s.strings.push(t(i).html())})}this.init()},typewrite:function(t,s){if(this.stop!==!0){var e=Math.round(70*Math.random())+this.typeSpeed,i=this;i.timeout=setTimeout(function(){var e=0,r=t.substr(s);if(\"^\"===r.charAt(0)){var o=1;/^\\^\\d+/.test(r)&&(r=/\\d+/.exec(r)[0],o+=r.length,e=parseInt(r)),t=t.substring(0,s)+t.substring(s+o)}if(\"html\"===i.contentType){var n=t.substr(s).charAt(0);if(\"<\"===n||\"&\"===n){var a=\"\",h=\"\";for(h=\"<\"===n?\">\":\";\";t.substr(s).charAt(0)!==h;)a+=t.substr(s).charAt(0),s++;s++,a+=h}}i.timeout=setTimeout(function(){if(s===t.length){if(i.options.onStringTyped(i.arrayPos),i.arrayPos===i.strings.length-1&&(i.options.callback(),i.curLoop++,i.loop===!1||i.curLoop===i.loopCount))return;i.timeout=setTimeout(function(){i.backspace(t,s)},i.backDelay)}else{0===s&&i.options.preStringTyped(i.arrayPos);var e=t.substr(0,s+1);i.attr?i.el.attr(i.attr,e):i.isInput?i.el.val(e):\"html\"===i.contentType?i.el.html(e):i.el.text(e),s++,i.typewrite(t,s)}},e)},e)}},backspace:function(t,s){if(this.stop!==!0){var e=Math.round(70*Math.random())+this.backSpeed,i=this;i.timeout=setTimeout(function(){if(\"html\"===i.contentType&&\">\"===t.substr(s).charAt(0)){for(var e=\"\";\"<\"!==t.substr(s).charAt(0);)e-=t.substr(s).charAt(0),s--;s--,e+=\"<\"}var r=t.substr(0,s);i.attr?i.el.attr(i.attr,r):i.isInput?i.el.val(r):\"html\"===i.contentType?i.el.html(r):i.el.text(r),s>i.stopNum?(s--,i.backspace(t,s)):s<=i.stopNum&&(i.arrayPos++,i.arrayPos===i.strings.length?(i.arrayPos=0,i.shuffle&&(i.sequence=i.shuffleArray(i.sequence)),i.init()):i.typewrite(i.strings[i.sequence[i.arrayPos]],s))},e)}},shuffleArray:function(t){var s,e,i=t.length;if(i)for(;--i;)e=Math.floor(Math.random()*(i+1)),s=t[e],t[e]=t[i],t[i]=s;return t},reset:function(){var t=this;clearInterval(t.timeout);var s=this.el.attr(\"id\");this.el.after('<span id=\"'+s+'\"/>'),this.el.remove(),\"undefined\"!=typeof this.cursor&&this.cursor.remove(),t.options.resetCallback()}},t.fn.typed=function(e){return this.each(function(){var i=t(this),r=i.data(\"typed\"),o=\"object\"==typeof e&&e;r||i.data(\"typed\",r=new s(this,o)),\"string\"==typeof e&&r[e]()})},t.fn.typed.defaults={strings:[\"These are the default values...\",\"You know what you should do?\",\"Use your own!\",\"Have a great day!\"],stringsElement:null,typeSpeed:0,startDelay:0,backSpeed:0,shuffle:!1,backDelay:500,loop:!1,loopCount:!1,showCursor:!0,cursorChar:\"|\",attr:null,contentType:\"html\",callback:function(){},preStringTyped:function(){},onStringTyped:function(){},resetCallback:function(){}}}(window.jQuery);\n\n    $(function(){\n        $('.text').typed({\n            strings: [\n                \"Oops! It looks like you're lost. <br /> ^1000\" +\n                \"Sorry about that. <br /> ^1000\" +\n                \"Let me try and help. <br /> ^1000\" +\n                \"Go back <a href='/'>home</a> and start over.\"\n            ],\n            typeSpeed: 0,\n            showCursor: false\n        });\n    });\n</script>\n</html>"},{"title":"关于我...","date":"2017-10-16T07:06:21.000Z","_content":"### 刹那芳华\n\n***\n\n朝露昙花，咫尺天涯，\n人道是黄河十曲，毕竟东流去。\n八千年玉老，一夜枯荣，问苍天此生何必？\n昨夜风吹处，落英听谁细数？\n九万里苍穹，御风弄影，谁人与共？\n千秋北斗，瑶宫寒苦，不若神仙眷侣，百年江湖。\n\n***\n\n欢迎来到拓跋的前端客栈，如果想看我的个人简介，请移步[这里](http://tuobaye.com/resume) 。\n\n我的邮箱是 [tuobaye0711@163.com](mailto:tuobaye0711@163.com) ，如果有任何事情，可以直接邮件联系我。\n","source":"about/index.md","raw":"---\ntitle: 关于我...\ndate: 2017-10-16 15:06:21\n---\n### 刹那芳华\n\n***\n\n朝露昙花，咫尺天涯，\n人道是黄河十曲，毕竟东流去。\n八千年玉老，一夜枯荣，问苍天此生何必？\n昨夜风吹处，落英听谁细数？\n九万里苍穹，御风弄影，谁人与共？\n千秋北斗，瑶宫寒苦，不若神仙眷侣，百年江湖。\n\n***\n\n欢迎来到拓跋的前端客栈，如果想看我的个人简介，请移步[这里](http://tuobaye.com/resume) 。\n\n我的邮箱是 [tuobaye0711@163.com](mailto:tuobaye0711@163.com) ，如果有任何事情，可以直接邮件联系我。\n","updated":"2018-07-29T02:55:54.826Z","path":"about/index.html","comments":1,"layout":"page","_id":"cjk698hxa0002znzwq6cuuus3","content":"<h3 id=\"刹那芳华\"><a href=\"#刹那芳华\" class=\"headerlink\" title=\"刹那芳华\"></a>刹那芳华</h3><hr>\n<p>朝露昙花，咫尺天涯，<br>人道是黄河十曲，毕竟东流去。<br>八千年玉老，一夜枯荣，问苍天此生何必？<br>昨夜风吹处，落英听谁细数？<br>九万里苍穹，御风弄影，谁人与共？<br>千秋北斗，瑶宫寒苦，不若神仙眷侣，百年江湖。</p>\n<hr>\n<p>欢迎来到拓跋的前端客栈，如果想看我的个人简介，请移步<a href=\"http://tuobaye.com/resume\" target=\"_blank\" rel=\"noopener\">这里</a> 。</p>\n<p>我的邮箱是 <a href=\"mailto:tuobaye0711@163.com\" target=\"_blank\" rel=\"noopener\">tuobaye0711@163.com</a> ，如果有任何事情，可以直接邮件联系我。</p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"刹那芳华\"><a href=\"#刹那芳华\" class=\"headerlink\" title=\"刹那芳华\"></a>刹那芳华</h3><hr>\n<p>朝露昙花，咫尺天涯，<br>人道是黄河十曲，毕竟东流去。<br>八千年玉老，一夜枯荣，问苍天此生何必？<br>昨夜风吹处，落英听谁细数？<br>九万里苍穹，御风弄影，谁人与共？<br>千秋北斗，瑶宫寒苦，不若神仙眷侣，百年江湖。</p>\n<hr>\n<p>欢迎来到拓跋的前端客栈，如果想看我的个人简介，请移步<a href=\"http://tuobaye.com/resume\" target=\"_blank\" rel=\"noopener\">这里</a> 。</p>\n<p>我的邮箱是 <a href=\"mailto:tuobaye0711@163.com\" target=\"_blank\" rel=\"noopener\">tuobaye0711@163.com</a> ，如果有任何事情，可以直接邮件联系我。</p>\n"},{"_content":".gitment-container {\n  font-family: sans-serif;\n  font-size: 14px;\n  line-height: 1.5;\n  color: #333;\n  word-wrap: break-word;\n}\n\n.gitment-container * {\n  box-sizing: border-box;\n}\n\n.gitment-container *:disabled {\n  cursor: not-allowed;\n}\n\n.gitment-container a,\n.gitment-container a:visited {\n  cursor: pointer;\n  text-decoration: none;\n}\n\n.gitment-container a:hover {\n  text-decoration: underline;\n}\n\n.gitment-container .gitment-hidden {\n  display: none;\n}\n\n.gitment-container .gitment-spinner-icon {\n  fill: #333;\n\n  -webkit-animation: gitment-spin 1s steps(12) infinite;\n  animation: gitment-spin 1s steps(12) infinite;\n}\n\n@-webkit-keyframes gitment-spin {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg)\n  }\n}\n\n@keyframes gitment-spin {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg)\n  }\n}\n\n.gitment-root-container {\n  margin: 19px 0;\n}\n\n.gitment-header-container {\n  margin: 19px 0;\n}\n\n.gitment-header-like-btn,\n.gitment-comment-like-btn {\n  cursor: pointer;\n}\n\n.gitment-comment-like-btn {\n  float: right;\n}\n\n.gitment-comment-like-btn.liked {\n  color: #F44336;\n}\n\n.gitment-header-like-btn svg {\n  vertical-align: middle;\n  height: 30px;\n}\n\n.gitment-comment-like-btn svg {\n  vertical-align: middle;\n  height: 20px;\n}\n\n.gitment-header-like-btn.liked svg,\n.gitment-comment-like-btn.liked svg {\n  fill: #F44336;\n}\n\na.gitment-header-issue-link,\na.gitment-header-issue-link:visited {\n  float: right;\n  line-height: 30px;\n  color: #666;\n}\n\na.gitment-header-issue-link:hover {\n  color: #666;\n}\n\n.gitment-comments-loading,\n.gitment-comments-error,\n.gitment-comments-empty {\n  text-align: center;\n  margin: 50px 0;\n}\n\n.gitment-comments-list {\n  list-style: none;\n  padding-left: 0;\n  margin: 0 0 38px;\n}\n\n.gitment-comment,\n.gitment-editor-container {\n  position: relative;\n  min-height: 60px;\n  padding-left: 60px;\n  margin: 19px 0;\n}\n\n.gitment-comment-avatar,\n.gitment-editor-avatar {\n  float: left;\n  margin-left: -60px;\n}\n\n.gitment-comment-avatar,\n.gitment-comment-avatar-img,\n.gitment-comment-avatar,\n.gitment-editor-avatar-img,\n.gitment-editor-avatar svg {\n  width: 44px;\n  height: 44px;\n  border-radius: 3px;\n}\n\n.gitment-editor-avatar .gitment-github-icon {\n  fill: #fff;\n  background-color: #333;\n}\n\n.gitment-comment-main,\n.gitment-editor-main {\n  position: relative;\n  border: 1px solid #CFD8DC;\n  border-radius: 0;\n}\n\n.gitment-editor-main::before,\n.gitment-editor-main::after,\n.gitment-comment-main::before,\n.gitment-comment-main::after {\n  position: absolute;\n  top: 11px;\n  left: -16px;\n  display: block;\n  width: 0;\n  height: 0;\n  pointer-events: none;\n  content: \"\";\n  border-color: transparent;\n  border-style: solid solid outset;\n}\n\n.gitment-editor-main::before,\n.gitment-comment-main::before {\n  border-width: 8px;\n  border-right-color: #CFD8DC;\n}\n\n.gitment-editor-main::after,\n.gitment-comment-main::after {\n  margin-top: 1px;\n  margin-left: 2px;\n  border-width: 7px;\n  border-right-color: #fff;\n}\n\n.gitment-comment-header {\n  margin: 12px 15px;\n  color: #666;\n  background-color: #fff;\n  border-radius: 3px;\n}\n\n.gitment-editor-header {\n  padding: 0;\n  margin: 0;\n  border-bottom: 1px solid #CFD8DC;\n}\n\na.gitment-comment-name,\na.gitment-comment-name:visited {\n  font-weight: 600;\n  color: #666;\n}\n\n.gitment-editor-tabs {\n  margin-bottom: -1px;\n  margin-left: -1px;\n}\n\n.gitment-editor-tab {\n  display: inline-block;\n  padding: 11px 12px;\n  font-size: 14px;\n  line-height: 20px;\n  color: #666;\n  text-decoration: none;\n  background-color: transparent;\n  border-width: 0 1px;\n  border-style: solid;\n  border-color: transparent;\n  border-radius: 0;\n\n  white-space: nowrap;\n  cursor: pointer;\n  user-select: none;\n\n  outline: none;\n}\n\n.gitment-editor-tab.gitment-selected {\n  color: #333;\n  background-color: #fff;\n  border-color: #CFD8DC;\n}\n\n.gitment-editor-login {\n  float: right;\n  margin-top: -30px;\n  margin-right: 15px;\n}\n\na.gitment-footer-project-link,\na.gitment-footer-project-link:visited,\na.gitment-editor-login-link,\na.gitment-editor-login-link:visited {\n  color: #2196F3;\n}\n\na.gitment-editor-logout-link,\na.gitment-editor-logout-link:visited {\n  color: #666;\n}\n\na.gitment-editor-logout-link:hover {\n  color: #2196F3;\n  text-decoration: none;\n}\n\n.gitment-comment-body {\n  position: relative;\n  margin: 12px 15px;\n  overflow: hidden;\n  border-radius: 3px;\n}\n\n.gitment-comment-body-folded {\n  cursor: pointer;\n}\n\n.gitment-comment-body-folded::before {\n  display: block !important;\n  content: \"\";\n  position: absolute;\n  width: 100%;\n  left: 0;\n  top: 0;\n  bottom: 50px;\n  pointer-events: none;\n  background: -webkit-linear-gradient(top, rgba(255, 255, 255, 0), rgba(255, 255, 255, .9));\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, .9));\n}\n\n.gitment-comment-body-folded::after {\n  display: block !important;\n  content: \"Click to Expand\" !important;\n  text-align: center;\n  color: #666;\n  position: absolute;\n  width: 100%;\n  height: 50px;\n  line-height: 50px;\n  left: 0;\n  bottom: 0;\n  pointer-events: none;\n  background: rgba(255, 255, 255, .9);\n}\n\n.gitment-editor-body {\n  margin: 0;\n}\n\n.gitment-comment-body > *:first-child,\n.gitment-editor-preview > *:first-child {\n  margin-top: 0 !important;\n}\n\n.gitment-comment-body > *:last-child,\n.gitment-editor-preview > *:last-child {\n  margin-bottom: 0 !important;\n}\n\n.gitment-editor-body textarea {\n  display: block;\n  width: 100%;\n  min-height: 150px;\n  max-height: 500px;\n  padding: 16px;\n  resize: vertical;\n\n  max-width: 100%;\n  margin: 0;\n  font-size: 14px;\n  line-height: 1.6;\n\n  background-color: #fff;\n\n  color: #333;\n  vertical-align: middle;\n  border: none;\n  border-radius: 0;\n  outline: none;\n  box-shadow: none;\n\n  overflow: visible;\n}\n\n.gitment-editor-body textarea:focus {\n  background-color: #fff;\n}\n\n.gitment-editor-preview {\n  min-height: 150px;\n\n  padding: 16px;\n  background-color: transparent;\n\n  width: 100%;\n  font-size: 14px;\n\n  line-height: 1.5;\n  word-wrap: break-word;\n}\n\n.gitment-editor-footer {\n  padding: 0;\n  margin-top: 10px;\n}\n\n.gitment-editor-footer::after {\n  display: table;\n  clear: both;\n  content: \"\";\n}\n\na.gitment-editor-footer-tip {\n  display: inline-block;\n  padding-top: 10px;\n  font-size: 12px;\n  color: #666;\n}\n\na.gitment-editor-footer-tip:hover {\n  color: #2196F3;\n  text-decoration: none;\n}\n\n.gitment-comments-pagination {\n  list-style: none;\n  text-align: right;\n  border-radius: 0;\n  margin: -19px 0 19px 0;\n}\n\n.gitment-comments-page-item {\n  display: inline-block;\n  cursor: pointer;\n  border: 1px solid #CFD8DC;\n  margin-left: -1px;\n  padding: .25rem .5rem;\n}\n\n.gitment-comments-page-item:hover {\n  background-color: #f5f5f5;\n}\n\n.gitment-comments-page-item.gitment-selected {\n  background-color: #f5f5f5;\n}\n\n.gitment-editor-submit,\n.gitment-comments-init-btn {\n  color: #fff;\n  background-color: #00BCD4;\n\n  position: relative;\n  display: inline-block;\n  padding: 7px 13px;\n  font-size: 14px;\n  font-weight: 600;\n  line-height: 20px;\n  white-space: nowrap;\n  vertical-align: middle;\n  cursor: pointer;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  background-size: 110% 110%;\n  border: none;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  appearance: none;\n}\n\n.gitment-editor-submit:hover,\n.gitment-comments-init-btn:hover {\n  background-color: #00ACC1;\n}\n\n.gitment-comments-init-btn:disabled,\n.gitment-editor-submit:disabled {\n  color: rgba(255,255,255,0.75);\n  background-color: #4DD0E1;\n  box-shadow: none;\n}\n\n.gitment-editor-submit {\n  float: right;\n}\n\n.gitment-footer-container {\n  margin-top: 30px;\n  margin-bottom: 20px;\n  text-align: right;\n  font-size: 12px;\n}\n\n/*\n * Markdown CSS\n * Copied from https://github.com/sindresorhus/github-markdown-css\n */\n.gitment-markdown {\n  -ms-text-size-adjust: 100%;\n  -webkit-text-size-adjust: 100%;\n  line-height: 1.5;\n  color: #333;\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Helvetica, Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\";\n  font-size: 16px;\n  line-height: 1.5;\n  word-wrap: break-word;\n}\n\n.gitment-markdown .pl-c {\n  color: #969896;\n}\n\n.gitment-markdown .pl-c1,\n.gitment-markdown .pl-s .pl-v {\n  color: #0086b3;\n}\n\n.gitment-markdown .pl-e,\n.gitment-markdown .pl-en {\n  color: #795da3;\n}\n\n.gitment-markdown .pl-smi,\n.gitment-markdown .pl-s .pl-s1 {\n  color: #333;\n}\n\n.gitment-markdown .pl-ent {\n  color: #63a35c;\n}\n\n.gitment-markdown .pl-k {\n  color: #a71d5d;\n}\n\n.gitment-markdown .pl-s,\n.gitment-markdown .pl-pds,\n.gitment-markdown .pl-s .pl-pse .pl-s1,\n.gitment-markdown .pl-sr,\n.gitment-markdown .pl-sr .pl-cce,\n.gitment-markdown .pl-sr .pl-sre,\n.gitment-markdown .pl-sr .pl-sra {\n  color: #183691;\n}\n\n.gitment-markdown .pl-v,\n.gitment-markdown .pl-smw {\n  color: #ed6a43;\n}\n\n.gitment-markdown .pl-bu {\n  color: #b52a1d;\n}\n\n.gitment-markdown .pl-ii {\n  color: #f8f8f8;\n  background-color: #b52a1d;\n}\n\n.gitment-markdown .pl-c2 {\n  color: #f8f8f8;\n  background-color: #b52a1d;\n}\n\n.gitment-markdown .pl-c2::before {\n  content: \"^M\";\n}\n\n.gitment-markdown .pl-sr .pl-cce {\n  font-weight: bold;\n  color: #63a35c;\n}\n\n.gitment-markdown .pl-ml {\n  color: #693a17;\n}\n\n.gitment-markdown .pl-mh,\n.gitment-markdown .pl-mh .pl-en,\n.gitment-markdown .pl-ms {\n  font-weight: bold;\n  color: #1d3e81;\n}\n\n.gitment-markdown .pl-mq {\n  color: #008080;\n}\n\n.gitment-markdown .pl-mi {\n  font-style: italic;\n  color: #333;\n}\n\n.gitment-markdown .pl-mb {\n  font-weight: bold;\n  color: #333;\n}\n\n.gitment-markdown .pl-md {\n  color: #bd2c00;\n  background-color: #ffecec;\n}\n\n.gitment-markdown .pl-mi1 {\n  color: #55a532;\n  background-color: #eaffea;\n}\n\n.gitment-markdown .pl-mc {\n  color: #ef9700;\n  background-color: #ffe3b4;\n}\n\n.gitment-markdown .pl-mi2 {\n  color: #d8d8d8;\n  background-color: #808080;\n}\n\n.gitment-markdown .pl-mdr {\n  font-weight: bold;\n  color: #795da3;\n}\n\n.gitment-markdown .pl-mo {\n  color: #1d3e81;\n}\n\n.gitment-markdown .pl-ba {\n  color: #595e62;\n}\n\n.gitment-markdown .pl-sg {\n  color: #c0c0c0;\n}\n\n.gitment-markdown .pl-corl {\n  text-decoration: underline;\n  color: #183691;\n}\n\n.gitment-markdown .octicon {\n  display: inline-block;\n  vertical-align: text-top;\n  fill: currentColor;\n}\n\n.gitment-markdown a {\n  background-color: transparent;\n  -webkit-text-decoration-skip: objects;\n}\n\n.gitment-markdown a:active,\n.gitment-markdown a:hover {\n  outline-width: 0;\n}\n\n.gitment-markdown strong {\n  font-weight: inherit;\n}\n\n.gitment-markdown strong {\n  font-weight: bolder;\n}\n\n.gitment-markdown h1 {\n  font-size: 2em;\n  margin: 0.67em 0;\n}\n\n.gitment-markdown img {\n  border-style: none;\n}\n\n.gitment-markdown svg:not(:root) {\n  overflow: hidden;\n}\n\n.gitment-markdown code,\n.gitment-markdown kbd,\n.gitment-markdown pre {\n  font-family: monospace, monospace;\n  font-size: 1em;\n}\n\n.gitment-markdown hr {\n  box-sizing: content-box;\n  height: 0;\n  overflow: visible;\n}\n\n.gitment-markdown input {\n  font: inherit;\n  margin: 0;\n}\n\n.gitment-markdown input {\n  overflow: visible;\n}\n\n.gitment-markdown [type=\"checkbox\"] {\n  box-sizing: border-box;\n  padding: 0;\n}\n\n.gitment-markdown * {\n  box-sizing: border-box;\n}\n\n.gitment-markdown input {\n  font-family: inherit;\n  font-size: inherit;\n  line-height: inherit;\n}\n\n.gitment-markdown a {\n  color: #0366d6;\n  text-decoration: none;\n}\n\n.gitment-markdown a:hover {\n  text-decoration: underline;\n}\n\n.gitment-markdown strong {\n  font-weight: 600;\n}\n\n.gitment-markdown hr {\n  height: 0;\n  margin: 15px 0;\n  overflow: hidden;\n  background: transparent;\n  border: 0;\n  border-bottom: 1px solid #dfe2e5;\n}\n\n.gitment-markdown hr::before {\n  display: table;\n  content: \"\";\n}\n\n.gitment-markdown hr::after {\n  display: table;\n  clear: both;\n  content: \"\";\n}\n\n.gitment-markdown table {\n  border-spacing: 0;\n  border-collapse: collapse;\n}\n\n.gitment-markdown td,\n.gitment-markdown th {\n  padding: 0;\n}\n\n.gitment-markdown h1,\n.gitment-markdown h2,\n.gitment-markdown h3,\n.gitment-markdown h4,\n.gitment-markdown h5,\n.gitment-markdown h6 {\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.gitment-markdown h1 {\n  font-size: 32px;\n  font-weight: 600;\n}\n\n.gitment-markdown h2 {\n  font-size: 24px;\n  font-weight: 600;\n}\n\n.gitment-markdown h3 {\n  font-size: 20px;\n  font-weight: 600;\n}\n\n.gitment-markdown h4 {\n  font-size: 16px;\n  font-weight: 600;\n}\n\n.gitment-markdown h5 {\n  font-size: 14px;\n  font-weight: 600;\n}\n\n.gitment-markdown h6 {\n  font-size: 12px;\n  font-weight: 600;\n}\n\n.gitment-markdown p {\n  margin-top: 0;\n  margin-bottom: 10px;\n}\n\n.gitment-markdown blockquote {\n  margin: 0;\n}\n\n.gitment-markdown ul,\n.gitment-markdown ol {\n  padding-left: 0;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.gitment-markdown ol ol,\n.gitment-markdown ul ol {\n  list-style-type: lower-roman;\n}\n\n.gitment-markdown ul ul ol,\n.gitment-markdown ul ol ol,\n.gitment-markdown ol ul ol,\n.gitment-markdown ol ol ol {\n  list-style-type: lower-alpha;\n}\n\n.gitment-markdown dd {\n  margin-left: 0;\n}\n\n.gitment-markdown code {\n  font-family: \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n  font-size: 12px;\n}\n\n.gitment-markdown pre {\n  margin-top: 0;\n  margin-bottom: 0;\n  font: 12px \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n}\n\n.gitment-markdown .octicon {\n  vertical-align: text-bottom;\n}\n\n.gitment-markdown .pl-0 {\n  padding-left: 0 !important;\n}\n\n.gitment-markdown .pl-1 {\n  padding-left: 4px !important;\n}\n\n.gitment-markdown .pl-2 {\n  padding-left: 8px !important;\n}\n\n.gitment-markdown .pl-3 {\n  padding-left: 16px !important;\n}\n\n.gitment-markdown .pl-4 {\n  padding-left: 24px !important;\n}\n\n.gitment-markdown .pl-5 {\n  padding-left: 32px !important;\n}\n\n.gitment-markdown .pl-6 {\n  padding-left: 40px !important;\n}\n\n.gitment-markdown::before {\n  display: table;\n  content: \"\";\n}\n\n.gitment-markdown::after {\n  display: table;\n  clear: both;\n  content: \"\";\n}\n\n.gitment-markdown>*:first-child {\n  margin-top: 0 !important;\n}\n\n.gitment-markdown>*:last-child {\n  margin-bottom: 0 !important;\n}\n\n.gitment-markdown a:not([href]) {\n  color: inherit;\n  text-decoration: none;\n}\n\n.gitment-markdown .anchor {\n  float: left;\n  padding-right: 4px;\n  margin-left: -20px;\n  line-height: 1;\n}\n\n.gitment-markdown .anchor:focus {\n  outline: none;\n}\n\n.gitment-markdown p,\n.gitment-markdown blockquote,\n.gitment-markdown ul,\n.gitment-markdown ol,\n.gitment-markdown dl,\n.gitment-markdown table,\n.gitment-markdown pre {\n  margin-top: 0;\n  margin-bottom: 16px;\n}\n\n.gitment-markdown hr {\n  height: 0.25em;\n  padding: 0;\n  margin: 24px 0;\n  background-color: #e1e4e8;\n  border: 0;\n}\n\n.gitment-markdown blockquote {\n  padding: 0 1em;\n  color: #6a737d;\n  border-left: 0.25em solid #dfe2e5;\n}\n\n.gitment-markdown blockquote>:first-child {\n  margin-top: 0;\n}\n\n.gitment-markdown blockquote>:last-child {\n  margin-bottom: 0;\n}\n\n.gitment-markdown kbd {\n  display: inline-block;\n  padding: 3px 5px;\n  font-size: 11px;\n  line-height: 10px;\n  color: #444d56;\n  vertical-align: middle;\n  background-color: #fafbfc;\n  border: solid 1px #c6cbd1;\n  border-bottom-color: #959da5;\n  border-radius: 0;\n  box-shadow: inset 0 -1px 0 #959da5;\n}\n\n.gitment-markdown h1,\n.gitment-markdown h2,\n.gitment-markdown h3,\n.gitment-markdown h4,\n.gitment-markdown h5,\n.gitment-markdown h6 {\n  margin-top: 24px;\n  margin-bottom: 16px;\n  font-weight: 600;\n  line-height: 1.25;\n}\n\n.gitment-markdown h1 .octicon-link,\n.gitment-markdown h2 .octicon-link,\n.gitment-markdown h3 .octicon-link,\n.gitment-markdown h4 .octicon-link,\n.gitment-markdown h5 .octicon-link,\n.gitment-markdown h6 .octicon-link {\n  color: #1b1f23;\n  vertical-align: middle;\n  visibility: hidden;\n}\n\n.gitment-markdown h1:hover .anchor,\n.gitment-markdown h2:hover .anchor,\n.gitment-markdown h3:hover .anchor,\n.gitment-markdown h4:hover .anchor,\n.gitment-markdown h5:hover .anchor,\n.gitment-markdown h6:hover .anchor {\n  text-decoration: none;\n}\n\n.gitment-markdown h1:hover .anchor .octicon-link,\n.gitment-markdown h2:hover .anchor .octicon-link,\n.gitment-markdown h3:hover .anchor .octicon-link,\n.gitment-markdown h4:hover .anchor .octicon-link,\n.gitment-markdown h5:hover .anchor .octicon-link,\n.gitment-markdown h6:hover .anchor .octicon-link {\n  visibility: visible;\n}\n\n.gitment-markdown h1 {\n  padding-bottom: 0.3em;\n  font-size: 2em;\n  border-bottom: 1px solid #eaecef;\n}\n\n.gitment-markdown h2 {\n  padding-bottom: 0.3em;\n  font-size: 1.5em;\n  border-bottom: 1px solid #eaecef;\n}\n\n.gitment-markdown h3 {\n  font-size: 1.25em;\n}\n\n.gitment-markdown h4 {\n  font-size: 1em;\n}\n\n.gitment-markdown h5 {\n  font-size: 0.875em;\n}\n\n.gitment-markdown h6 {\n  font-size: 0.85em;\n  color: #6a737d;\n}\n\n.gitment-markdown ul,\n.gitment-markdown ol {\n  padding-left: 2em;\n}\n\n.gitment-markdown ul ul,\n.gitment-markdown ul ol,\n.gitment-markdown ol ol,\n.gitment-markdown ol ul {\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.gitment-markdown li>p {\n  margin-top: 16px;\n}\n\n.gitment-markdown li+li {\n  margin-top: 0.25em;\n}\n\n.gitment-markdown dl {\n  padding: 0;\n}\n\n.gitment-markdown dl dt {\n  padding: 0;\n  margin-top: 16px;\n  font-size: 1em;\n  font-style: italic;\n  font-weight: 600;\n}\n\n.gitment-markdown dl dd {\n  padding: 0 16px;\n  margin-bottom: 16px;\n}\n\n.gitment-markdown table {\n  display: block;\n  width: 100%;\n  overflow: auto;\n}\n\n.gitment-markdown table th {\n  font-weight: 600;\n}\n\n.gitment-markdown table th,\n.gitment-markdown table td {\n  padding: 6px 13px;\n  border: 1px solid #dfe2e5;\n}\n\n.gitment-markdown table tr {\n  background-color: #fff;\n  border-top: 1px solid #c6cbd1;\n}\n\n.gitment-markdown table tr:nth-child(2n) {\n  background-color: #f5f5f5;\n}\n\n.gitment-markdown img {\n  max-width: 100%;\n  box-sizing: content-box;\n  background-color: #fff;\n}\n\n.gitment-markdown code {\n  padding: 0;\n  padding-top: 0.2em;\n  padding-bottom: 0.2em;\n  margin: 0;\n  font-size: 85%;\n  background-color: rgba(27,31,35,0.05);\n  border-radius: 0;\n}\n\n.gitment-markdown code::before,\n.gitment-markdown code::after {\n  letter-spacing: -0.2em;\n  content: \"\\00a0\";\n}\n\n.gitment-markdown pre {\n  word-wrap: normal;\n}\n\n.gitment-markdown pre>code {\n  padding: 0;\n  margin: 0;\n  font-size: 100%;\n  word-break: normal;\n  white-space: pre;\n  background: transparent;\n  border: 0;\n}\n\n.gitment-markdown .highlight {\n  margin-bottom: 16px;\n}\n\n.gitment-markdown .highlight pre {\n  margin-bottom: 0;\n  word-break: normal;\n}\n\n.gitment-markdown .highlight pre,\n.gitment-markdown pre {\n  padding: 16px;\n  overflow: auto;\n  font-size: 85%;\n  line-height: 1.45;\n  background-color: #f5f5f5;\n  border-radius: 0;\n}\n\n.gitment-markdown pre code {\n  display: inline;\n  max-width: auto;\n  padding: 0;\n  margin: 0;\n  overflow: visible;\n  line-height: inherit;\n  word-wrap: normal;\n  background-color: transparent;\n  border: 0;\n}\n\n.gitment-markdown pre code::before,\n.gitment-markdown pre code::after {\n  content: normal;\n}\n\n.gitment-markdown .full-commit .btn-outline:not(:disabled):hover {\n  color: #005cc5;\n  border-color: #005cc5;\n}\n\n.gitment-markdown kbd {\n  display: inline-block;\n  padding: 3px 5px;\n  font: 11px \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n  line-height: 10px;\n  color: #444d56;\n  vertical-align: middle;\n  background-color: #fcfcfc;\n  border: solid 1px #c6cbd1;\n  border-bottom-color: #959da5;\n  border-radius: 0;\n  box-shadow: inset 0 -1px 0 #959da5;\n}\n\n.gitment-markdown :checked+.radio-label {\n  position: relative;\n  z-index: 1;\n  border-color: #0366d6;\n}\n\n.gitment-markdown .task-list-item {\n  list-style-type: none;\n}\n\n.gitment-markdown .task-list-item+.task-list-item {\n  margin-top: 3px;\n}\n\n.gitment-markdown .task-list-item input {\n  margin: 0 0.2em 0.25em -1.6em;\n  vertical-align: middle;\n}\n\n.gitment-markdown hr {\n  border-bottom-color: #eee;\n}","source":"css/gitment.css","raw":".gitment-container {\n  font-family: sans-serif;\n  font-size: 14px;\n  line-height: 1.5;\n  color: #333;\n  word-wrap: break-word;\n}\n\n.gitment-container * {\n  box-sizing: border-box;\n}\n\n.gitment-container *:disabled {\n  cursor: not-allowed;\n}\n\n.gitment-container a,\n.gitment-container a:visited {\n  cursor: pointer;\n  text-decoration: none;\n}\n\n.gitment-container a:hover {\n  text-decoration: underline;\n}\n\n.gitment-container .gitment-hidden {\n  display: none;\n}\n\n.gitment-container .gitment-spinner-icon {\n  fill: #333;\n\n  -webkit-animation: gitment-spin 1s steps(12) infinite;\n  animation: gitment-spin 1s steps(12) infinite;\n}\n\n@-webkit-keyframes gitment-spin {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg)\n  }\n}\n\n@keyframes gitment-spin {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg)\n  }\n}\n\n.gitment-root-container {\n  margin: 19px 0;\n}\n\n.gitment-header-container {\n  margin: 19px 0;\n}\n\n.gitment-header-like-btn,\n.gitment-comment-like-btn {\n  cursor: pointer;\n}\n\n.gitment-comment-like-btn {\n  float: right;\n}\n\n.gitment-comment-like-btn.liked {\n  color: #F44336;\n}\n\n.gitment-header-like-btn svg {\n  vertical-align: middle;\n  height: 30px;\n}\n\n.gitment-comment-like-btn svg {\n  vertical-align: middle;\n  height: 20px;\n}\n\n.gitment-header-like-btn.liked svg,\n.gitment-comment-like-btn.liked svg {\n  fill: #F44336;\n}\n\na.gitment-header-issue-link,\na.gitment-header-issue-link:visited {\n  float: right;\n  line-height: 30px;\n  color: #666;\n}\n\na.gitment-header-issue-link:hover {\n  color: #666;\n}\n\n.gitment-comments-loading,\n.gitment-comments-error,\n.gitment-comments-empty {\n  text-align: center;\n  margin: 50px 0;\n}\n\n.gitment-comments-list {\n  list-style: none;\n  padding-left: 0;\n  margin: 0 0 38px;\n}\n\n.gitment-comment,\n.gitment-editor-container {\n  position: relative;\n  min-height: 60px;\n  padding-left: 60px;\n  margin: 19px 0;\n}\n\n.gitment-comment-avatar,\n.gitment-editor-avatar {\n  float: left;\n  margin-left: -60px;\n}\n\n.gitment-comment-avatar,\n.gitment-comment-avatar-img,\n.gitment-comment-avatar,\n.gitment-editor-avatar-img,\n.gitment-editor-avatar svg {\n  width: 44px;\n  height: 44px;\n  border-radius: 3px;\n}\n\n.gitment-editor-avatar .gitment-github-icon {\n  fill: #fff;\n  background-color: #333;\n}\n\n.gitment-comment-main,\n.gitment-editor-main {\n  position: relative;\n  border: 1px solid #CFD8DC;\n  border-radius: 0;\n}\n\n.gitment-editor-main::before,\n.gitment-editor-main::after,\n.gitment-comment-main::before,\n.gitment-comment-main::after {\n  position: absolute;\n  top: 11px;\n  left: -16px;\n  display: block;\n  width: 0;\n  height: 0;\n  pointer-events: none;\n  content: \"\";\n  border-color: transparent;\n  border-style: solid solid outset;\n}\n\n.gitment-editor-main::before,\n.gitment-comment-main::before {\n  border-width: 8px;\n  border-right-color: #CFD8DC;\n}\n\n.gitment-editor-main::after,\n.gitment-comment-main::after {\n  margin-top: 1px;\n  margin-left: 2px;\n  border-width: 7px;\n  border-right-color: #fff;\n}\n\n.gitment-comment-header {\n  margin: 12px 15px;\n  color: #666;\n  background-color: #fff;\n  border-radius: 3px;\n}\n\n.gitment-editor-header {\n  padding: 0;\n  margin: 0;\n  border-bottom: 1px solid #CFD8DC;\n}\n\na.gitment-comment-name,\na.gitment-comment-name:visited {\n  font-weight: 600;\n  color: #666;\n}\n\n.gitment-editor-tabs {\n  margin-bottom: -1px;\n  margin-left: -1px;\n}\n\n.gitment-editor-tab {\n  display: inline-block;\n  padding: 11px 12px;\n  font-size: 14px;\n  line-height: 20px;\n  color: #666;\n  text-decoration: none;\n  background-color: transparent;\n  border-width: 0 1px;\n  border-style: solid;\n  border-color: transparent;\n  border-radius: 0;\n\n  white-space: nowrap;\n  cursor: pointer;\n  user-select: none;\n\n  outline: none;\n}\n\n.gitment-editor-tab.gitment-selected {\n  color: #333;\n  background-color: #fff;\n  border-color: #CFD8DC;\n}\n\n.gitment-editor-login {\n  float: right;\n  margin-top: -30px;\n  margin-right: 15px;\n}\n\na.gitment-footer-project-link,\na.gitment-footer-project-link:visited,\na.gitment-editor-login-link,\na.gitment-editor-login-link:visited {\n  color: #2196F3;\n}\n\na.gitment-editor-logout-link,\na.gitment-editor-logout-link:visited {\n  color: #666;\n}\n\na.gitment-editor-logout-link:hover {\n  color: #2196F3;\n  text-decoration: none;\n}\n\n.gitment-comment-body {\n  position: relative;\n  margin: 12px 15px;\n  overflow: hidden;\n  border-radius: 3px;\n}\n\n.gitment-comment-body-folded {\n  cursor: pointer;\n}\n\n.gitment-comment-body-folded::before {\n  display: block !important;\n  content: \"\";\n  position: absolute;\n  width: 100%;\n  left: 0;\n  top: 0;\n  bottom: 50px;\n  pointer-events: none;\n  background: -webkit-linear-gradient(top, rgba(255, 255, 255, 0), rgba(255, 255, 255, .9));\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, .9));\n}\n\n.gitment-comment-body-folded::after {\n  display: block !important;\n  content: \"Click to Expand\" !important;\n  text-align: center;\n  color: #666;\n  position: absolute;\n  width: 100%;\n  height: 50px;\n  line-height: 50px;\n  left: 0;\n  bottom: 0;\n  pointer-events: none;\n  background: rgba(255, 255, 255, .9);\n}\n\n.gitment-editor-body {\n  margin: 0;\n}\n\n.gitment-comment-body > *:first-child,\n.gitment-editor-preview > *:first-child {\n  margin-top: 0 !important;\n}\n\n.gitment-comment-body > *:last-child,\n.gitment-editor-preview > *:last-child {\n  margin-bottom: 0 !important;\n}\n\n.gitment-editor-body textarea {\n  display: block;\n  width: 100%;\n  min-height: 150px;\n  max-height: 500px;\n  padding: 16px;\n  resize: vertical;\n\n  max-width: 100%;\n  margin: 0;\n  font-size: 14px;\n  line-height: 1.6;\n\n  background-color: #fff;\n\n  color: #333;\n  vertical-align: middle;\n  border: none;\n  border-radius: 0;\n  outline: none;\n  box-shadow: none;\n\n  overflow: visible;\n}\n\n.gitment-editor-body textarea:focus {\n  background-color: #fff;\n}\n\n.gitment-editor-preview {\n  min-height: 150px;\n\n  padding: 16px;\n  background-color: transparent;\n\n  width: 100%;\n  font-size: 14px;\n\n  line-height: 1.5;\n  word-wrap: break-word;\n}\n\n.gitment-editor-footer {\n  padding: 0;\n  margin-top: 10px;\n}\n\n.gitment-editor-footer::after {\n  display: table;\n  clear: both;\n  content: \"\";\n}\n\na.gitment-editor-footer-tip {\n  display: inline-block;\n  padding-top: 10px;\n  font-size: 12px;\n  color: #666;\n}\n\na.gitment-editor-footer-tip:hover {\n  color: #2196F3;\n  text-decoration: none;\n}\n\n.gitment-comments-pagination {\n  list-style: none;\n  text-align: right;\n  border-radius: 0;\n  margin: -19px 0 19px 0;\n}\n\n.gitment-comments-page-item {\n  display: inline-block;\n  cursor: pointer;\n  border: 1px solid #CFD8DC;\n  margin-left: -1px;\n  padding: .25rem .5rem;\n}\n\n.gitment-comments-page-item:hover {\n  background-color: #f5f5f5;\n}\n\n.gitment-comments-page-item.gitment-selected {\n  background-color: #f5f5f5;\n}\n\n.gitment-editor-submit,\n.gitment-comments-init-btn {\n  color: #fff;\n  background-color: #00BCD4;\n\n  position: relative;\n  display: inline-block;\n  padding: 7px 13px;\n  font-size: 14px;\n  font-weight: 600;\n  line-height: 20px;\n  white-space: nowrap;\n  vertical-align: middle;\n  cursor: pointer;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  background-size: 110% 110%;\n  border: none;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  appearance: none;\n}\n\n.gitment-editor-submit:hover,\n.gitment-comments-init-btn:hover {\n  background-color: #00ACC1;\n}\n\n.gitment-comments-init-btn:disabled,\n.gitment-editor-submit:disabled {\n  color: rgba(255,255,255,0.75);\n  background-color: #4DD0E1;\n  box-shadow: none;\n}\n\n.gitment-editor-submit {\n  float: right;\n}\n\n.gitment-footer-container {\n  margin-top: 30px;\n  margin-bottom: 20px;\n  text-align: right;\n  font-size: 12px;\n}\n\n/*\n * Markdown CSS\n * Copied from https://github.com/sindresorhus/github-markdown-css\n */\n.gitment-markdown {\n  -ms-text-size-adjust: 100%;\n  -webkit-text-size-adjust: 100%;\n  line-height: 1.5;\n  color: #333;\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Helvetica, Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\";\n  font-size: 16px;\n  line-height: 1.5;\n  word-wrap: break-word;\n}\n\n.gitment-markdown .pl-c {\n  color: #969896;\n}\n\n.gitment-markdown .pl-c1,\n.gitment-markdown .pl-s .pl-v {\n  color: #0086b3;\n}\n\n.gitment-markdown .pl-e,\n.gitment-markdown .pl-en {\n  color: #795da3;\n}\n\n.gitment-markdown .pl-smi,\n.gitment-markdown .pl-s .pl-s1 {\n  color: #333;\n}\n\n.gitment-markdown .pl-ent {\n  color: #63a35c;\n}\n\n.gitment-markdown .pl-k {\n  color: #a71d5d;\n}\n\n.gitment-markdown .pl-s,\n.gitment-markdown .pl-pds,\n.gitment-markdown .pl-s .pl-pse .pl-s1,\n.gitment-markdown .pl-sr,\n.gitment-markdown .pl-sr .pl-cce,\n.gitment-markdown .pl-sr .pl-sre,\n.gitment-markdown .pl-sr .pl-sra {\n  color: #183691;\n}\n\n.gitment-markdown .pl-v,\n.gitment-markdown .pl-smw {\n  color: #ed6a43;\n}\n\n.gitment-markdown .pl-bu {\n  color: #b52a1d;\n}\n\n.gitment-markdown .pl-ii {\n  color: #f8f8f8;\n  background-color: #b52a1d;\n}\n\n.gitment-markdown .pl-c2 {\n  color: #f8f8f8;\n  background-color: #b52a1d;\n}\n\n.gitment-markdown .pl-c2::before {\n  content: \"^M\";\n}\n\n.gitment-markdown .pl-sr .pl-cce {\n  font-weight: bold;\n  color: #63a35c;\n}\n\n.gitment-markdown .pl-ml {\n  color: #693a17;\n}\n\n.gitment-markdown .pl-mh,\n.gitment-markdown .pl-mh .pl-en,\n.gitment-markdown .pl-ms {\n  font-weight: bold;\n  color: #1d3e81;\n}\n\n.gitment-markdown .pl-mq {\n  color: #008080;\n}\n\n.gitment-markdown .pl-mi {\n  font-style: italic;\n  color: #333;\n}\n\n.gitment-markdown .pl-mb {\n  font-weight: bold;\n  color: #333;\n}\n\n.gitment-markdown .pl-md {\n  color: #bd2c00;\n  background-color: #ffecec;\n}\n\n.gitment-markdown .pl-mi1 {\n  color: #55a532;\n  background-color: #eaffea;\n}\n\n.gitment-markdown .pl-mc {\n  color: #ef9700;\n  background-color: #ffe3b4;\n}\n\n.gitment-markdown .pl-mi2 {\n  color: #d8d8d8;\n  background-color: #808080;\n}\n\n.gitment-markdown .pl-mdr {\n  font-weight: bold;\n  color: #795da3;\n}\n\n.gitment-markdown .pl-mo {\n  color: #1d3e81;\n}\n\n.gitment-markdown .pl-ba {\n  color: #595e62;\n}\n\n.gitment-markdown .pl-sg {\n  color: #c0c0c0;\n}\n\n.gitment-markdown .pl-corl {\n  text-decoration: underline;\n  color: #183691;\n}\n\n.gitment-markdown .octicon {\n  display: inline-block;\n  vertical-align: text-top;\n  fill: currentColor;\n}\n\n.gitment-markdown a {\n  background-color: transparent;\n  -webkit-text-decoration-skip: objects;\n}\n\n.gitment-markdown a:active,\n.gitment-markdown a:hover {\n  outline-width: 0;\n}\n\n.gitment-markdown strong {\n  font-weight: inherit;\n}\n\n.gitment-markdown strong {\n  font-weight: bolder;\n}\n\n.gitment-markdown h1 {\n  font-size: 2em;\n  margin: 0.67em 0;\n}\n\n.gitment-markdown img {\n  border-style: none;\n}\n\n.gitment-markdown svg:not(:root) {\n  overflow: hidden;\n}\n\n.gitment-markdown code,\n.gitment-markdown kbd,\n.gitment-markdown pre {\n  font-family: monospace, monospace;\n  font-size: 1em;\n}\n\n.gitment-markdown hr {\n  box-sizing: content-box;\n  height: 0;\n  overflow: visible;\n}\n\n.gitment-markdown input {\n  font: inherit;\n  margin: 0;\n}\n\n.gitment-markdown input {\n  overflow: visible;\n}\n\n.gitment-markdown [type=\"checkbox\"] {\n  box-sizing: border-box;\n  padding: 0;\n}\n\n.gitment-markdown * {\n  box-sizing: border-box;\n}\n\n.gitment-markdown input {\n  font-family: inherit;\n  font-size: inherit;\n  line-height: inherit;\n}\n\n.gitment-markdown a {\n  color: #0366d6;\n  text-decoration: none;\n}\n\n.gitment-markdown a:hover {\n  text-decoration: underline;\n}\n\n.gitment-markdown strong {\n  font-weight: 600;\n}\n\n.gitment-markdown hr {\n  height: 0;\n  margin: 15px 0;\n  overflow: hidden;\n  background: transparent;\n  border: 0;\n  border-bottom: 1px solid #dfe2e5;\n}\n\n.gitment-markdown hr::before {\n  display: table;\n  content: \"\";\n}\n\n.gitment-markdown hr::after {\n  display: table;\n  clear: both;\n  content: \"\";\n}\n\n.gitment-markdown table {\n  border-spacing: 0;\n  border-collapse: collapse;\n}\n\n.gitment-markdown td,\n.gitment-markdown th {\n  padding: 0;\n}\n\n.gitment-markdown h1,\n.gitment-markdown h2,\n.gitment-markdown h3,\n.gitment-markdown h4,\n.gitment-markdown h5,\n.gitment-markdown h6 {\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.gitment-markdown h1 {\n  font-size: 32px;\n  font-weight: 600;\n}\n\n.gitment-markdown h2 {\n  font-size: 24px;\n  font-weight: 600;\n}\n\n.gitment-markdown h3 {\n  font-size: 20px;\n  font-weight: 600;\n}\n\n.gitment-markdown h4 {\n  font-size: 16px;\n  font-weight: 600;\n}\n\n.gitment-markdown h5 {\n  font-size: 14px;\n  font-weight: 600;\n}\n\n.gitment-markdown h6 {\n  font-size: 12px;\n  font-weight: 600;\n}\n\n.gitment-markdown p {\n  margin-top: 0;\n  margin-bottom: 10px;\n}\n\n.gitment-markdown blockquote {\n  margin: 0;\n}\n\n.gitment-markdown ul,\n.gitment-markdown ol {\n  padding-left: 0;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.gitment-markdown ol ol,\n.gitment-markdown ul ol {\n  list-style-type: lower-roman;\n}\n\n.gitment-markdown ul ul ol,\n.gitment-markdown ul ol ol,\n.gitment-markdown ol ul ol,\n.gitment-markdown ol ol ol {\n  list-style-type: lower-alpha;\n}\n\n.gitment-markdown dd {\n  margin-left: 0;\n}\n\n.gitment-markdown code {\n  font-family: \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n  font-size: 12px;\n}\n\n.gitment-markdown pre {\n  margin-top: 0;\n  margin-bottom: 0;\n  font: 12px \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n}\n\n.gitment-markdown .octicon {\n  vertical-align: text-bottom;\n}\n\n.gitment-markdown .pl-0 {\n  padding-left: 0 !important;\n}\n\n.gitment-markdown .pl-1 {\n  padding-left: 4px !important;\n}\n\n.gitment-markdown .pl-2 {\n  padding-left: 8px !important;\n}\n\n.gitment-markdown .pl-3 {\n  padding-left: 16px !important;\n}\n\n.gitment-markdown .pl-4 {\n  padding-left: 24px !important;\n}\n\n.gitment-markdown .pl-5 {\n  padding-left: 32px !important;\n}\n\n.gitment-markdown .pl-6 {\n  padding-left: 40px !important;\n}\n\n.gitment-markdown::before {\n  display: table;\n  content: \"\";\n}\n\n.gitment-markdown::after {\n  display: table;\n  clear: both;\n  content: \"\";\n}\n\n.gitment-markdown>*:first-child {\n  margin-top: 0 !important;\n}\n\n.gitment-markdown>*:last-child {\n  margin-bottom: 0 !important;\n}\n\n.gitment-markdown a:not([href]) {\n  color: inherit;\n  text-decoration: none;\n}\n\n.gitment-markdown .anchor {\n  float: left;\n  padding-right: 4px;\n  margin-left: -20px;\n  line-height: 1;\n}\n\n.gitment-markdown .anchor:focus {\n  outline: none;\n}\n\n.gitment-markdown p,\n.gitment-markdown blockquote,\n.gitment-markdown ul,\n.gitment-markdown ol,\n.gitment-markdown dl,\n.gitment-markdown table,\n.gitment-markdown pre {\n  margin-top: 0;\n  margin-bottom: 16px;\n}\n\n.gitment-markdown hr {\n  height: 0.25em;\n  padding: 0;\n  margin: 24px 0;\n  background-color: #e1e4e8;\n  border: 0;\n}\n\n.gitment-markdown blockquote {\n  padding: 0 1em;\n  color: #6a737d;\n  border-left: 0.25em solid #dfe2e5;\n}\n\n.gitment-markdown blockquote>:first-child {\n  margin-top: 0;\n}\n\n.gitment-markdown blockquote>:last-child {\n  margin-bottom: 0;\n}\n\n.gitment-markdown kbd {\n  display: inline-block;\n  padding: 3px 5px;\n  font-size: 11px;\n  line-height: 10px;\n  color: #444d56;\n  vertical-align: middle;\n  background-color: #fafbfc;\n  border: solid 1px #c6cbd1;\n  border-bottom-color: #959da5;\n  border-radius: 0;\n  box-shadow: inset 0 -1px 0 #959da5;\n}\n\n.gitment-markdown h1,\n.gitment-markdown h2,\n.gitment-markdown h3,\n.gitment-markdown h4,\n.gitment-markdown h5,\n.gitment-markdown h6 {\n  margin-top: 24px;\n  margin-bottom: 16px;\n  font-weight: 600;\n  line-height: 1.25;\n}\n\n.gitment-markdown h1 .octicon-link,\n.gitment-markdown h2 .octicon-link,\n.gitment-markdown h3 .octicon-link,\n.gitment-markdown h4 .octicon-link,\n.gitment-markdown h5 .octicon-link,\n.gitment-markdown h6 .octicon-link {\n  color: #1b1f23;\n  vertical-align: middle;\n  visibility: hidden;\n}\n\n.gitment-markdown h1:hover .anchor,\n.gitment-markdown h2:hover .anchor,\n.gitment-markdown h3:hover .anchor,\n.gitment-markdown h4:hover .anchor,\n.gitment-markdown h5:hover .anchor,\n.gitment-markdown h6:hover .anchor {\n  text-decoration: none;\n}\n\n.gitment-markdown h1:hover .anchor .octicon-link,\n.gitment-markdown h2:hover .anchor .octicon-link,\n.gitment-markdown h3:hover .anchor .octicon-link,\n.gitment-markdown h4:hover .anchor .octicon-link,\n.gitment-markdown h5:hover .anchor .octicon-link,\n.gitment-markdown h6:hover .anchor .octicon-link {\n  visibility: visible;\n}\n\n.gitment-markdown h1 {\n  padding-bottom: 0.3em;\n  font-size: 2em;\n  border-bottom: 1px solid #eaecef;\n}\n\n.gitment-markdown h2 {\n  padding-bottom: 0.3em;\n  font-size: 1.5em;\n  border-bottom: 1px solid #eaecef;\n}\n\n.gitment-markdown h3 {\n  font-size: 1.25em;\n}\n\n.gitment-markdown h4 {\n  font-size: 1em;\n}\n\n.gitment-markdown h5 {\n  font-size: 0.875em;\n}\n\n.gitment-markdown h6 {\n  font-size: 0.85em;\n  color: #6a737d;\n}\n\n.gitment-markdown ul,\n.gitment-markdown ol {\n  padding-left: 2em;\n}\n\n.gitment-markdown ul ul,\n.gitment-markdown ul ol,\n.gitment-markdown ol ol,\n.gitment-markdown ol ul {\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.gitment-markdown li>p {\n  margin-top: 16px;\n}\n\n.gitment-markdown li+li {\n  margin-top: 0.25em;\n}\n\n.gitment-markdown dl {\n  padding: 0;\n}\n\n.gitment-markdown dl dt {\n  padding: 0;\n  margin-top: 16px;\n  font-size: 1em;\n  font-style: italic;\n  font-weight: 600;\n}\n\n.gitment-markdown dl dd {\n  padding: 0 16px;\n  margin-bottom: 16px;\n}\n\n.gitment-markdown table {\n  display: block;\n  width: 100%;\n  overflow: auto;\n}\n\n.gitment-markdown table th {\n  font-weight: 600;\n}\n\n.gitment-markdown table th,\n.gitment-markdown table td {\n  padding: 6px 13px;\n  border: 1px solid #dfe2e5;\n}\n\n.gitment-markdown table tr {\n  background-color: #fff;\n  border-top: 1px solid #c6cbd1;\n}\n\n.gitment-markdown table tr:nth-child(2n) {\n  background-color: #f5f5f5;\n}\n\n.gitment-markdown img {\n  max-width: 100%;\n  box-sizing: content-box;\n  background-color: #fff;\n}\n\n.gitment-markdown code {\n  padding: 0;\n  padding-top: 0.2em;\n  padding-bottom: 0.2em;\n  margin: 0;\n  font-size: 85%;\n  background-color: rgba(27,31,35,0.05);\n  border-radius: 0;\n}\n\n.gitment-markdown code::before,\n.gitment-markdown code::after {\n  letter-spacing: -0.2em;\n  content: \"\\00a0\";\n}\n\n.gitment-markdown pre {\n  word-wrap: normal;\n}\n\n.gitment-markdown pre>code {\n  padding: 0;\n  margin: 0;\n  font-size: 100%;\n  word-break: normal;\n  white-space: pre;\n  background: transparent;\n  border: 0;\n}\n\n.gitment-markdown .highlight {\n  margin-bottom: 16px;\n}\n\n.gitment-markdown .highlight pre {\n  margin-bottom: 0;\n  word-break: normal;\n}\n\n.gitment-markdown .highlight pre,\n.gitment-markdown pre {\n  padding: 16px;\n  overflow: auto;\n  font-size: 85%;\n  line-height: 1.45;\n  background-color: #f5f5f5;\n  border-radius: 0;\n}\n\n.gitment-markdown pre code {\n  display: inline;\n  max-width: auto;\n  padding: 0;\n  margin: 0;\n  overflow: visible;\n  line-height: inherit;\n  word-wrap: normal;\n  background-color: transparent;\n  border: 0;\n}\n\n.gitment-markdown pre code::before,\n.gitment-markdown pre code::after {\n  content: normal;\n}\n\n.gitment-markdown .full-commit .btn-outline:not(:disabled):hover {\n  color: #005cc5;\n  border-color: #005cc5;\n}\n\n.gitment-markdown kbd {\n  display: inline-block;\n  padding: 3px 5px;\n  font: 11px \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n  line-height: 10px;\n  color: #444d56;\n  vertical-align: middle;\n  background-color: #fcfcfc;\n  border: solid 1px #c6cbd1;\n  border-bottom-color: #959da5;\n  border-radius: 0;\n  box-shadow: inset 0 -1px 0 #959da5;\n}\n\n.gitment-markdown :checked+.radio-label {\n  position: relative;\n  z-index: 1;\n  border-color: #0366d6;\n}\n\n.gitment-markdown .task-list-item {\n  list-style-type: none;\n}\n\n.gitment-markdown .task-list-item+.task-list-item {\n  margin-top: 3px;\n}\n\n.gitment-markdown .task-list-item input {\n  margin: 0 0.2em 0.25em -1.6em;\n  vertical-align: middle;\n}\n\n.gitment-markdown hr {\n  border-bottom-color: #eee;\n}","date":"2018-03-04T15:08:12.829Z","updated":"2018-03-04T15:08:12.829Z","path":"css/gitment.css","layout":"false","title":"","comments":1,"_id":"cjk698hxd0004znzwoznnyn7c","content":".gitment-container {\n  font-family: sans-serif;\n  font-size: 14px;\n  line-height: 1.5;\n  color: #333;\n  word-wrap: break-word;\n}\n\n.gitment-container * {\n  box-sizing: border-box;\n}\n\n.gitment-container *:disabled {\n  cursor: not-allowed;\n}\n\n.gitment-container a,\n.gitment-container a:visited {\n  cursor: pointer;\n  text-decoration: none;\n}\n\n.gitment-container a:hover {\n  text-decoration: underline;\n}\n\n.gitment-container .gitment-hidden {\n  display: none;\n}\n\n.gitment-container .gitment-spinner-icon {\n  fill: #333;\n\n  -webkit-animation: gitment-spin 1s steps(12) infinite;\n  animation: gitment-spin 1s steps(12) infinite;\n}\n\n@-webkit-keyframes gitment-spin {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg)\n  }\n}\n\n@keyframes gitment-spin {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg)\n  }\n}\n\n.gitment-root-container {\n  margin: 19px 0;\n}\n\n.gitment-header-container {\n  margin: 19px 0;\n}\n\n.gitment-header-like-btn,\n.gitment-comment-like-btn {\n  cursor: pointer;\n}\n\n.gitment-comment-like-btn {\n  float: right;\n}\n\n.gitment-comment-like-btn.liked {\n  color: #F44336;\n}\n\n.gitment-header-like-btn svg {\n  vertical-align: middle;\n  height: 30px;\n}\n\n.gitment-comment-like-btn svg {\n  vertical-align: middle;\n  height: 20px;\n}\n\n.gitment-header-like-btn.liked svg,\n.gitment-comment-like-btn.liked svg {\n  fill: #F44336;\n}\n\na.gitment-header-issue-link,\na.gitment-header-issue-link:visited {\n  float: right;\n  line-height: 30px;\n  color: #666;\n}\n\na.gitment-header-issue-link:hover {\n  color: #666;\n}\n\n.gitment-comments-loading,\n.gitment-comments-error,\n.gitment-comments-empty {\n  text-align: center;\n  margin: 50px 0;\n}\n\n.gitment-comments-list {\n  list-style: none;\n  padding-left: 0;\n  margin: 0 0 38px;\n}\n\n.gitment-comment,\n.gitment-editor-container {\n  position: relative;\n  min-height: 60px;\n  padding-left: 60px;\n  margin: 19px 0;\n}\n\n.gitment-comment-avatar,\n.gitment-editor-avatar {\n  float: left;\n  margin-left: -60px;\n}\n\n.gitment-comment-avatar,\n.gitment-comment-avatar-img,\n.gitment-comment-avatar,\n.gitment-editor-avatar-img,\n.gitment-editor-avatar svg {\n  width: 44px;\n  height: 44px;\n  border-radius: 3px;\n}\n\n.gitment-editor-avatar .gitment-github-icon {\n  fill: #fff;\n  background-color: #333;\n}\n\n.gitment-comment-main,\n.gitment-editor-main {\n  position: relative;\n  border: 1px solid #CFD8DC;\n  border-radius: 0;\n}\n\n.gitment-editor-main::before,\n.gitment-editor-main::after,\n.gitment-comment-main::before,\n.gitment-comment-main::after {\n  position: absolute;\n  top: 11px;\n  left: -16px;\n  display: block;\n  width: 0;\n  height: 0;\n  pointer-events: none;\n  content: \"\";\n  border-color: transparent;\n  border-style: solid solid outset;\n}\n\n.gitment-editor-main::before,\n.gitment-comment-main::before {\n  border-width: 8px;\n  border-right-color: #CFD8DC;\n}\n\n.gitment-editor-main::after,\n.gitment-comment-main::after {\n  margin-top: 1px;\n  margin-left: 2px;\n  border-width: 7px;\n  border-right-color: #fff;\n}\n\n.gitment-comment-header {\n  margin: 12px 15px;\n  color: #666;\n  background-color: #fff;\n  border-radius: 3px;\n}\n\n.gitment-editor-header {\n  padding: 0;\n  margin: 0;\n  border-bottom: 1px solid #CFD8DC;\n}\n\na.gitment-comment-name,\na.gitment-comment-name:visited {\n  font-weight: 600;\n  color: #666;\n}\n\n.gitment-editor-tabs {\n  margin-bottom: -1px;\n  margin-left: -1px;\n}\n\n.gitment-editor-tab {\n  display: inline-block;\n  padding: 11px 12px;\n  font-size: 14px;\n  line-height: 20px;\n  color: #666;\n  text-decoration: none;\n  background-color: transparent;\n  border-width: 0 1px;\n  border-style: solid;\n  border-color: transparent;\n  border-radius: 0;\n\n  white-space: nowrap;\n  cursor: pointer;\n  user-select: none;\n\n  outline: none;\n}\n\n.gitment-editor-tab.gitment-selected {\n  color: #333;\n  background-color: #fff;\n  border-color: #CFD8DC;\n}\n\n.gitment-editor-login {\n  float: right;\n  margin-top: -30px;\n  margin-right: 15px;\n}\n\na.gitment-footer-project-link,\na.gitment-footer-project-link:visited,\na.gitment-editor-login-link,\na.gitment-editor-login-link:visited {\n  color: #2196F3;\n}\n\na.gitment-editor-logout-link,\na.gitment-editor-logout-link:visited {\n  color: #666;\n}\n\na.gitment-editor-logout-link:hover {\n  color: #2196F3;\n  text-decoration: none;\n}\n\n.gitment-comment-body {\n  position: relative;\n  margin: 12px 15px;\n  overflow: hidden;\n  border-radius: 3px;\n}\n\n.gitment-comment-body-folded {\n  cursor: pointer;\n}\n\n.gitment-comment-body-folded::before {\n  display: block !important;\n  content: \"\";\n  position: absolute;\n  width: 100%;\n  left: 0;\n  top: 0;\n  bottom: 50px;\n  pointer-events: none;\n  background: -webkit-linear-gradient(top, rgba(255, 255, 255, 0), rgba(255, 255, 255, .9));\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, .9));\n}\n\n.gitment-comment-body-folded::after {\n  display: block !important;\n  content: \"Click to Expand\" !important;\n  text-align: center;\n  color: #666;\n  position: absolute;\n  width: 100%;\n  height: 50px;\n  line-height: 50px;\n  left: 0;\n  bottom: 0;\n  pointer-events: none;\n  background: rgba(255, 255, 255, .9);\n}\n\n.gitment-editor-body {\n  margin: 0;\n}\n\n.gitment-comment-body > *:first-child,\n.gitment-editor-preview > *:first-child {\n  margin-top: 0 !important;\n}\n\n.gitment-comment-body > *:last-child,\n.gitment-editor-preview > *:last-child {\n  margin-bottom: 0 !important;\n}\n\n.gitment-editor-body textarea {\n  display: block;\n  width: 100%;\n  min-height: 150px;\n  max-height: 500px;\n  padding: 16px;\n  resize: vertical;\n\n  max-width: 100%;\n  margin: 0;\n  font-size: 14px;\n  line-height: 1.6;\n\n  background-color: #fff;\n\n  color: #333;\n  vertical-align: middle;\n  border: none;\n  border-radius: 0;\n  outline: none;\n  box-shadow: none;\n\n  overflow: visible;\n}\n\n.gitment-editor-body textarea:focus {\n  background-color: #fff;\n}\n\n.gitment-editor-preview {\n  min-height: 150px;\n\n  padding: 16px;\n  background-color: transparent;\n\n  width: 100%;\n  font-size: 14px;\n\n  line-height: 1.5;\n  word-wrap: break-word;\n}\n\n.gitment-editor-footer {\n  padding: 0;\n  margin-top: 10px;\n}\n\n.gitment-editor-footer::after {\n  display: table;\n  clear: both;\n  content: \"\";\n}\n\na.gitment-editor-footer-tip {\n  display: inline-block;\n  padding-top: 10px;\n  font-size: 12px;\n  color: #666;\n}\n\na.gitment-editor-footer-tip:hover {\n  color: #2196F3;\n  text-decoration: none;\n}\n\n.gitment-comments-pagination {\n  list-style: none;\n  text-align: right;\n  border-radius: 0;\n  margin: -19px 0 19px 0;\n}\n\n.gitment-comments-page-item {\n  display: inline-block;\n  cursor: pointer;\n  border: 1px solid #CFD8DC;\n  margin-left: -1px;\n  padding: .25rem .5rem;\n}\n\n.gitment-comments-page-item:hover {\n  background-color: #f5f5f5;\n}\n\n.gitment-comments-page-item.gitment-selected {\n  background-color: #f5f5f5;\n}\n\n.gitment-editor-submit,\n.gitment-comments-init-btn {\n  color: #fff;\n  background-color: #00BCD4;\n\n  position: relative;\n  display: inline-block;\n  padding: 7px 13px;\n  font-size: 14px;\n  font-weight: 600;\n  line-height: 20px;\n  white-space: nowrap;\n  vertical-align: middle;\n  cursor: pointer;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  background-size: 110% 110%;\n  border: none;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  appearance: none;\n}\n\n.gitment-editor-submit:hover,\n.gitment-comments-init-btn:hover {\n  background-color: #00ACC1;\n}\n\n.gitment-comments-init-btn:disabled,\n.gitment-editor-submit:disabled {\n  color: rgba(255,255,255,0.75);\n  background-color: #4DD0E1;\n  box-shadow: none;\n}\n\n.gitment-editor-submit {\n  float: right;\n}\n\n.gitment-footer-container {\n  margin-top: 30px;\n  margin-bottom: 20px;\n  text-align: right;\n  font-size: 12px;\n}\n\n/*\n * Markdown CSS\n * Copied from https://github.com/sindresorhus/github-markdown-css\n */\n.gitment-markdown {\n  -ms-text-size-adjust: 100%;\n  -webkit-text-size-adjust: 100%;\n  line-height: 1.5;\n  color: #333;\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Helvetica, Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\";\n  font-size: 16px;\n  line-height: 1.5;\n  word-wrap: break-word;\n}\n\n.gitment-markdown .pl-c {\n  color: #969896;\n}\n\n.gitment-markdown .pl-c1,\n.gitment-markdown .pl-s .pl-v {\n  color: #0086b3;\n}\n\n.gitment-markdown .pl-e,\n.gitment-markdown .pl-en {\n  color: #795da3;\n}\n\n.gitment-markdown .pl-smi,\n.gitment-markdown .pl-s .pl-s1 {\n  color: #333;\n}\n\n.gitment-markdown .pl-ent {\n  color: #63a35c;\n}\n\n.gitment-markdown .pl-k {\n  color: #a71d5d;\n}\n\n.gitment-markdown .pl-s,\n.gitment-markdown .pl-pds,\n.gitment-markdown .pl-s .pl-pse .pl-s1,\n.gitment-markdown .pl-sr,\n.gitment-markdown .pl-sr .pl-cce,\n.gitment-markdown .pl-sr .pl-sre,\n.gitment-markdown .pl-sr .pl-sra {\n  color: #183691;\n}\n\n.gitment-markdown .pl-v,\n.gitment-markdown .pl-smw {\n  color: #ed6a43;\n}\n\n.gitment-markdown .pl-bu {\n  color: #b52a1d;\n}\n\n.gitment-markdown .pl-ii {\n  color: #f8f8f8;\n  background-color: #b52a1d;\n}\n\n.gitment-markdown .pl-c2 {\n  color: #f8f8f8;\n  background-color: #b52a1d;\n}\n\n.gitment-markdown .pl-c2::before {\n  content: \"^M\";\n}\n\n.gitment-markdown .pl-sr .pl-cce {\n  font-weight: bold;\n  color: #63a35c;\n}\n\n.gitment-markdown .pl-ml {\n  color: #693a17;\n}\n\n.gitment-markdown .pl-mh,\n.gitment-markdown .pl-mh .pl-en,\n.gitment-markdown .pl-ms {\n  font-weight: bold;\n  color: #1d3e81;\n}\n\n.gitment-markdown .pl-mq {\n  color: #008080;\n}\n\n.gitment-markdown .pl-mi {\n  font-style: italic;\n  color: #333;\n}\n\n.gitment-markdown .pl-mb {\n  font-weight: bold;\n  color: #333;\n}\n\n.gitment-markdown .pl-md {\n  color: #bd2c00;\n  background-color: #ffecec;\n}\n\n.gitment-markdown .pl-mi1 {\n  color: #55a532;\n  background-color: #eaffea;\n}\n\n.gitment-markdown .pl-mc {\n  color: #ef9700;\n  background-color: #ffe3b4;\n}\n\n.gitment-markdown .pl-mi2 {\n  color: #d8d8d8;\n  background-color: #808080;\n}\n\n.gitment-markdown .pl-mdr {\n  font-weight: bold;\n  color: #795da3;\n}\n\n.gitment-markdown .pl-mo {\n  color: #1d3e81;\n}\n\n.gitment-markdown .pl-ba {\n  color: #595e62;\n}\n\n.gitment-markdown .pl-sg {\n  color: #c0c0c0;\n}\n\n.gitment-markdown .pl-corl {\n  text-decoration: underline;\n  color: #183691;\n}\n\n.gitment-markdown .octicon {\n  display: inline-block;\n  vertical-align: text-top;\n  fill: currentColor;\n}\n\n.gitment-markdown a {\n  background-color: transparent;\n  -webkit-text-decoration-skip: objects;\n}\n\n.gitment-markdown a:active,\n.gitment-markdown a:hover {\n  outline-width: 0;\n}\n\n.gitment-markdown strong {\n  font-weight: inherit;\n}\n\n.gitment-markdown strong {\n  font-weight: bolder;\n}\n\n.gitment-markdown h1 {\n  font-size: 2em;\n  margin: 0.67em 0;\n}\n\n.gitment-markdown img {\n  border-style: none;\n}\n\n.gitment-markdown svg:not(:root) {\n  overflow: hidden;\n}\n\n.gitment-markdown code,\n.gitment-markdown kbd,\n.gitment-markdown pre {\n  font-family: monospace, monospace;\n  font-size: 1em;\n}\n\n.gitment-markdown hr {\n  box-sizing: content-box;\n  height: 0;\n  overflow: visible;\n}\n\n.gitment-markdown input {\n  font: inherit;\n  margin: 0;\n}\n\n.gitment-markdown input {\n  overflow: visible;\n}\n\n.gitment-markdown [type=\"checkbox\"] {\n  box-sizing: border-box;\n  padding: 0;\n}\n\n.gitment-markdown * {\n  box-sizing: border-box;\n}\n\n.gitment-markdown input {\n  font-family: inherit;\n  font-size: inherit;\n  line-height: inherit;\n}\n\n.gitment-markdown a {\n  color: #0366d6;\n  text-decoration: none;\n}\n\n.gitment-markdown a:hover {\n  text-decoration: underline;\n}\n\n.gitment-markdown strong {\n  font-weight: 600;\n}\n\n.gitment-markdown hr {\n  height: 0;\n  margin: 15px 0;\n  overflow: hidden;\n  background: transparent;\n  border: 0;\n  border-bottom: 1px solid #dfe2e5;\n}\n\n.gitment-markdown hr::before {\n  display: table;\n  content: \"\";\n}\n\n.gitment-markdown hr::after {\n  display: table;\n  clear: both;\n  content: \"\";\n}\n\n.gitment-markdown table {\n  border-spacing: 0;\n  border-collapse: collapse;\n}\n\n.gitment-markdown td,\n.gitment-markdown th {\n  padding: 0;\n}\n\n.gitment-markdown h1,\n.gitment-markdown h2,\n.gitment-markdown h3,\n.gitment-markdown h4,\n.gitment-markdown h5,\n.gitment-markdown h6 {\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.gitment-markdown h1 {\n  font-size: 32px;\n  font-weight: 600;\n}\n\n.gitment-markdown h2 {\n  font-size: 24px;\n  font-weight: 600;\n}\n\n.gitment-markdown h3 {\n  font-size: 20px;\n  font-weight: 600;\n}\n\n.gitment-markdown h4 {\n  font-size: 16px;\n  font-weight: 600;\n}\n\n.gitment-markdown h5 {\n  font-size: 14px;\n  font-weight: 600;\n}\n\n.gitment-markdown h6 {\n  font-size: 12px;\n  font-weight: 600;\n}\n\n.gitment-markdown p {\n  margin-top: 0;\n  margin-bottom: 10px;\n}\n\n.gitment-markdown blockquote {\n  margin: 0;\n}\n\n.gitment-markdown ul,\n.gitment-markdown ol {\n  padding-left: 0;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.gitment-markdown ol ol,\n.gitment-markdown ul ol {\n  list-style-type: lower-roman;\n}\n\n.gitment-markdown ul ul ol,\n.gitment-markdown ul ol ol,\n.gitment-markdown ol ul ol,\n.gitment-markdown ol ol ol {\n  list-style-type: lower-alpha;\n}\n\n.gitment-markdown dd {\n  margin-left: 0;\n}\n\n.gitment-markdown code {\n  font-family: \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n  font-size: 12px;\n}\n\n.gitment-markdown pre {\n  margin-top: 0;\n  margin-bottom: 0;\n  font: 12px \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n}\n\n.gitment-markdown .octicon {\n  vertical-align: text-bottom;\n}\n\n.gitment-markdown .pl-0 {\n  padding-left: 0 !important;\n}\n\n.gitment-markdown .pl-1 {\n  padding-left: 4px !important;\n}\n\n.gitment-markdown .pl-2 {\n  padding-left: 8px !important;\n}\n\n.gitment-markdown .pl-3 {\n  padding-left: 16px !important;\n}\n\n.gitment-markdown .pl-4 {\n  padding-left: 24px !important;\n}\n\n.gitment-markdown .pl-5 {\n  padding-left: 32px !important;\n}\n\n.gitment-markdown .pl-6 {\n  padding-left: 40px !important;\n}\n\n.gitment-markdown::before {\n  display: table;\n  content: \"\";\n}\n\n.gitment-markdown::after {\n  display: table;\n  clear: both;\n  content: \"\";\n}\n\n.gitment-markdown>*:first-child {\n  margin-top: 0 !important;\n}\n\n.gitment-markdown>*:last-child {\n  margin-bottom: 0 !important;\n}\n\n.gitment-markdown a:not([href]) {\n  color: inherit;\n  text-decoration: none;\n}\n\n.gitment-markdown .anchor {\n  float: left;\n  padding-right: 4px;\n  margin-left: -20px;\n  line-height: 1;\n}\n\n.gitment-markdown .anchor:focus {\n  outline: none;\n}\n\n.gitment-markdown p,\n.gitment-markdown blockquote,\n.gitment-markdown ul,\n.gitment-markdown ol,\n.gitment-markdown dl,\n.gitment-markdown table,\n.gitment-markdown pre {\n  margin-top: 0;\n  margin-bottom: 16px;\n}\n\n.gitment-markdown hr {\n  height: 0.25em;\n  padding: 0;\n  margin: 24px 0;\n  background-color: #e1e4e8;\n  border: 0;\n}\n\n.gitment-markdown blockquote {\n  padding: 0 1em;\n  color: #6a737d;\n  border-left: 0.25em solid #dfe2e5;\n}\n\n.gitment-markdown blockquote>:first-child {\n  margin-top: 0;\n}\n\n.gitment-markdown blockquote>:last-child {\n  margin-bottom: 0;\n}\n\n.gitment-markdown kbd {\n  display: inline-block;\n  padding: 3px 5px;\n  font-size: 11px;\n  line-height: 10px;\n  color: #444d56;\n  vertical-align: middle;\n  background-color: #fafbfc;\n  border: solid 1px #c6cbd1;\n  border-bottom-color: #959da5;\n  border-radius: 0;\n  box-shadow: inset 0 -1px 0 #959da5;\n}\n\n.gitment-markdown h1,\n.gitment-markdown h2,\n.gitment-markdown h3,\n.gitment-markdown h4,\n.gitment-markdown h5,\n.gitment-markdown h6 {\n  margin-top: 24px;\n  margin-bottom: 16px;\n  font-weight: 600;\n  line-height: 1.25;\n}\n\n.gitment-markdown h1 .octicon-link,\n.gitment-markdown h2 .octicon-link,\n.gitment-markdown h3 .octicon-link,\n.gitment-markdown h4 .octicon-link,\n.gitment-markdown h5 .octicon-link,\n.gitment-markdown h6 .octicon-link {\n  color: #1b1f23;\n  vertical-align: middle;\n  visibility: hidden;\n}\n\n.gitment-markdown h1:hover .anchor,\n.gitment-markdown h2:hover .anchor,\n.gitment-markdown h3:hover .anchor,\n.gitment-markdown h4:hover .anchor,\n.gitment-markdown h5:hover .anchor,\n.gitment-markdown h6:hover .anchor {\n  text-decoration: none;\n}\n\n.gitment-markdown h1:hover .anchor .octicon-link,\n.gitment-markdown h2:hover .anchor .octicon-link,\n.gitment-markdown h3:hover .anchor .octicon-link,\n.gitment-markdown h4:hover .anchor .octicon-link,\n.gitment-markdown h5:hover .anchor .octicon-link,\n.gitment-markdown h6:hover .anchor .octicon-link {\n  visibility: visible;\n}\n\n.gitment-markdown h1 {\n  padding-bottom: 0.3em;\n  font-size: 2em;\n  border-bottom: 1px solid #eaecef;\n}\n\n.gitment-markdown h2 {\n  padding-bottom: 0.3em;\n  font-size: 1.5em;\n  border-bottom: 1px solid #eaecef;\n}\n\n.gitment-markdown h3 {\n  font-size: 1.25em;\n}\n\n.gitment-markdown h4 {\n  font-size: 1em;\n}\n\n.gitment-markdown h5 {\n  font-size: 0.875em;\n}\n\n.gitment-markdown h6 {\n  font-size: 0.85em;\n  color: #6a737d;\n}\n\n.gitment-markdown ul,\n.gitment-markdown ol {\n  padding-left: 2em;\n}\n\n.gitment-markdown ul ul,\n.gitment-markdown ul ol,\n.gitment-markdown ol ol,\n.gitment-markdown ol ul {\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.gitment-markdown li>p {\n  margin-top: 16px;\n}\n\n.gitment-markdown li+li {\n  margin-top: 0.25em;\n}\n\n.gitment-markdown dl {\n  padding: 0;\n}\n\n.gitment-markdown dl dt {\n  padding: 0;\n  margin-top: 16px;\n  font-size: 1em;\n  font-style: italic;\n  font-weight: 600;\n}\n\n.gitment-markdown dl dd {\n  padding: 0 16px;\n  margin-bottom: 16px;\n}\n\n.gitment-markdown table {\n  display: block;\n  width: 100%;\n  overflow: auto;\n}\n\n.gitment-markdown table th {\n  font-weight: 600;\n}\n\n.gitment-markdown table th,\n.gitment-markdown table td {\n  padding: 6px 13px;\n  border: 1px solid #dfe2e5;\n}\n\n.gitment-markdown table tr {\n  background-color: #fff;\n  border-top: 1px solid #c6cbd1;\n}\n\n.gitment-markdown table tr:nth-child(2n) {\n  background-color: #f5f5f5;\n}\n\n.gitment-markdown img {\n  max-width: 100%;\n  box-sizing: content-box;\n  background-color: #fff;\n}\n\n.gitment-markdown code {\n  padding: 0;\n  padding-top: 0.2em;\n  padding-bottom: 0.2em;\n  margin: 0;\n  font-size: 85%;\n  background-color: rgba(27,31,35,0.05);\n  border-radius: 0;\n}\n\n.gitment-markdown code::before,\n.gitment-markdown code::after {\n  letter-spacing: -0.2em;\n  content: \"\\00a0\";\n}\n\n.gitment-markdown pre {\n  word-wrap: normal;\n}\n\n.gitment-markdown pre>code {\n  padding: 0;\n  margin: 0;\n  font-size: 100%;\n  word-break: normal;\n  white-space: pre;\n  background: transparent;\n  border: 0;\n}\n\n.gitment-markdown .highlight {\n  margin-bottom: 16px;\n}\n\n.gitment-markdown .highlight pre {\n  margin-bottom: 0;\n  word-break: normal;\n}\n\n.gitment-markdown .highlight pre,\n.gitment-markdown pre {\n  padding: 16px;\n  overflow: auto;\n  font-size: 85%;\n  line-height: 1.45;\n  background-color: #f5f5f5;\n  border-radius: 0;\n}\n\n.gitment-markdown pre code {\n  display: inline;\n  max-width: auto;\n  padding: 0;\n  margin: 0;\n  overflow: visible;\n  line-height: inherit;\n  word-wrap: normal;\n  background-color: transparent;\n  border: 0;\n}\n\n.gitment-markdown pre code::before,\n.gitment-markdown pre code::after {\n  content: normal;\n}\n\n.gitment-markdown .full-commit .btn-outline:not(:disabled):hover {\n  color: #005cc5;\n  border-color: #005cc5;\n}\n\n.gitment-markdown kbd {\n  display: inline-block;\n  padding: 3px 5px;\n  font: 11px \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n  line-height: 10px;\n  color: #444d56;\n  vertical-align: middle;\n  background-color: #fcfcfc;\n  border: solid 1px #c6cbd1;\n  border-bottom-color: #959da5;\n  border-radius: 0;\n  box-shadow: inset 0 -1px 0 #959da5;\n}\n\n.gitment-markdown :checked+.radio-label {\n  position: relative;\n  z-index: 1;\n  border-color: #0366d6;\n}\n\n.gitment-markdown .task-list-item {\n  list-style-type: none;\n}\n\n.gitment-markdown .task-list-item+.task-list-item {\n  margin-top: 3px;\n}\n\n.gitment-markdown .task-list-item input {\n  margin: 0 0.2em 0.25em -1.6em;\n  vertical-align: middle;\n}\n\n.gitment-markdown hr {\n  border-bottom-color: #eee;\n}","site":{"data":{}},"excerpt":"","more":".gitment-container {\n  font-family: sans-serif;\n  font-size: 14px;\n  line-height: 1.5;\n  color: #333;\n  word-wrap: break-word;\n}\n\n.gitment-container * {\n  box-sizing: border-box;\n}\n\n.gitment-container *:disabled {\n  cursor: not-allowed;\n}\n\n.gitment-container a,\n.gitment-container a:visited {\n  cursor: pointer;\n  text-decoration: none;\n}\n\n.gitment-container a:hover {\n  text-decoration: underline;\n}\n\n.gitment-container .gitment-hidden {\n  display: none;\n}\n\n.gitment-container .gitment-spinner-icon {\n  fill: #333;\n\n  -webkit-animation: gitment-spin 1s steps(12) infinite;\n  animation: gitment-spin 1s steps(12) infinite;\n}\n\n@-webkit-keyframes gitment-spin {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg)\n  }\n}\n\n@keyframes gitment-spin {\n  100% {\n    -webkit-transform: rotate(360deg);\n    transform: rotate(360deg)\n  }\n}\n\n.gitment-root-container {\n  margin: 19px 0;\n}\n\n.gitment-header-container {\n  margin: 19px 0;\n}\n\n.gitment-header-like-btn,\n.gitment-comment-like-btn {\n  cursor: pointer;\n}\n\n.gitment-comment-like-btn {\n  float: right;\n}\n\n.gitment-comment-like-btn.liked {\n  color: #F44336;\n}\n\n.gitment-header-like-btn svg {\n  vertical-align: middle;\n  height: 30px;\n}\n\n.gitment-comment-like-btn svg {\n  vertical-align: middle;\n  height: 20px;\n}\n\n.gitment-header-like-btn.liked svg,\n.gitment-comment-like-btn.liked svg {\n  fill: #F44336;\n}\n\na.gitment-header-issue-link,\na.gitment-header-issue-link:visited {\n  float: right;\n  line-height: 30px;\n  color: #666;\n}\n\na.gitment-header-issue-link:hover {\n  color: #666;\n}\n\n.gitment-comments-loading,\n.gitment-comments-error,\n.gitment-comments-empty {\n  text-align: center;\n  margin: 50px 0;\n}\n\n.gitment-comments-list {\n  list-style: none;\n  padding-left: 0;\n  margin: 0 0 38px;\n}\n\n.gitment-comment,\n.gitment-editor-container {\n  position: relative;\n  min-height: 60px;\n  padding-left: 60px;\n  margin: 19px 0;\n}\n\n.gitment-comment-avatar,\n.gitment-editor-avatar {\n  float: left;\n  margin-left: -60px;\n}\n\n.gitment-comment-avatar,\n.gitment-comment-avatar-img,\n.gitment-comment-avatar,\n.gitment-editor-avatar-img,\n.gitment-editor-avatar svg {\n  width: 44px;\n  height: 44px;\n  border-radius: 3px;\n}\n\n.gitment-editor-avatar .gitment-github-icon {\n  fill: #fff;\n  background-color: #333;\n}\n\n.gitment-comment-main,\n.gitment-editor-main {\n  position: relative;\n  border: 1px solid #CFD8DC;\n  border-radius: 0;\n}\n\n.gitment-editor-main::before,\n.gitment-editor-main::after,\n.gitment-comment-main::before,\n.gitment-comment-main::after {\n  position: absolute;\n  top: 11px;\n  left: -16px;\n  display: block;\n  width: 0;\n  height: 0;\n  pointer-events: none;\n  content: \"\";\n  border-color: transparent;\n  border-style: solid solid outset;\n}\n\n.gitment-editor-main::before,\n.gitment-comment-main::before {\n  border-width: 8px;\n  border-right-color: #CFD8DC;\n}\n\n.gitment-editor-main::after,\n.gitment-comment-main::after {\n  margin-top: 1px;\n  margin-left: 2px;\n  border-width: 7px;\n  border-right-color: #fff;\n}\n\n.gitment-comment-header {\n  margin: 12px 15px;\n  color: #666;\n  background-color: #fff;\n  border-radius: 3px;\n}\n\n.gitment-editor-header {\n  padding: 0;\n  margin: 0;\n  border-bottom: 1px solid #CFD8DC;\n}\n\na.gitment-comment-name,\na.gitment-comment-name:visited {\n  font-weight: 600;\n  color: #666;\n}\n\n.gitment-editor-tabs {\n  margin-bottom: -1px;\n  margin-left: -1px;\n}\n\n.gitment-editor-tab {\n  display: inline-block;\n  padding: 11px 12px;\n  font-size: 14px;\n  line-height: 20px;\n  color: #666;\n  text-decoration: none;\n  background-color: transparent;\n  border-width: 0 1px;\n  border-style: solid;\n  border-color: transparent;\n  border-radius: 0;\n\n  white-space: nowrap;\n  cursor: pointer;\n  user-select: none;\n\n  outline: none;\n}\n\n.gitment-editor-tab.gitment-selected {\n  color: #333;\n  background-color: #fff;\n  border-color: #CFD8DC;\n}\n\n.gitment-editor-login {\n  float: right;\n  margin-top: -30px;\n  margin-right: 15px;\n}\n\na.gitment-footer-project-link,\na.gitment-footer-project-link:visited,\na.gitment-editor-login-link,\na.gitment-editor-login-link:visited {\n  color: #2196F3;\n}\n\na.gitment-editor-logout-link,\na.gitment-editor-logout-link:visited {\n  color: #666;\n}\n\na.gitment-editor-logout-link:hover {\n  color: #2196F3;\n  text-decoration: none;\n}\n\n.gitment-comment-body {\n  position: relative;\n  margin: 12px 15px;\n  overflow: hidden;\n  border-radius: 3px;\n}\n\n.gitment-comment-body-folded {\n  cursor: pointer;\n}\n\n.gitment-comment-body-folded::before {\n  display: block !important;\n  content: \"\";\n  position: absolute;\n  width: 100%;\n  left: 0;\n  top: 0;\n  bottom: 50px;\n  pointer-events: none;\n  background: -webkit-linear-gradient(top, rgba(255, 255, 255, 0), rgba(255, 255, 255, .9));\n  background: linear-gradient(180deg, rgba(255, 255, 255, 0), rgba(255, 255, 255, .9));\n}\n\n.gitment-comment-body-folded::after {\n  display: block !important;\n  content: \"Click to Expand\" !important;\n  text-align: center;\n  color: #666;\n  position: absolute;\n  width: 100%;\n  height: 50px;\n  line-height: 50px;\n  left: 0;\n  bottom: 0;\n  pointer-events: none;\n  background: rgba(255, 255, 255, .9);\n}\n\n.gitment-editor-body {\n  margin: 0;\n}\n\n.gitment-comment-body > *:first-child,\n.gitment-editor-preview > *:first-child {\n  margin-top: 0 !important;\n}\n\n.gitment-comment-body > *:last-child,\n.gitment-editor-preview > *:last-child {\n  margin-bottom: 0 !important;\n}\n\n.gitment-editor-body textarea {\n  display: block;\n  width: 100%;\n  min-height: 150px;\n  max-height: 500px;\n  padding: 16px;\n  resize: vertical;\n\n  max-width: 100%;\n  margin: 0;\n  font-size: 14px;\n  line-height: 1.6;\n\n  background-color: #fff;\n\n  color: #333;\n  vertical-align: middle;\n  border: none;\n  border-radius: 0;\n  outline: none;\n  box-shadow: none;\n\n  overflow: visible;\n}\n\n.gitment-editor-body textarea:focus {\n  background-color: #fff;\n}\n\n.gitment-editor-preview {\n  min-height: 150px;\n\n  padding: 16px;\n  background-color: transparent;\n\n  width: 100%;\n  font-size: 14px;\n\n  line-height: 1.5;\n  word-wrap: break-word;\n}\n\n.gitment-editor-footer {\n  padding: 0;\n  margin-top: 10px;\n}\n\n.gitment-editor-footer::after {\n  display: table;\n  clear: both;\n  content: \"\";\n}\n\na.gitment-editor-footer-tip {\n  display: inline-block;\n  padding-top: 10px;\n  font-size: 12px;\n  color: #666;\n}\n\na.gitment-editor-footer-tip:hover {\n  color: #2196F3;\n  text-decoration: none;\n}\n\n.gitment-comments-pagination {\n  list-style: none;\n  text-align: right;\n  border-radius: 0;\n  margin: -19px 0 19px 0;\n}\n\n.gitment-comments-page-item {\n  display: inline-block;\n  cursor: pointer;\n  border: 1px solid #CFD8DC;\n  margin-left: -1px;\n  padding: .25rem .5rem;\n}\n\n.gitment-comments-page-item:hover {\n  background-color: #f5f5f5;\n}\n\n.gitment-comments-page-item.gitment-selected {\n  background-color: #f5f5f5;\n}\n\n.gitment-editor-submit,\n.gitment-comments-init-btn {\n  color: #fff;\n  background-color: #00BCD4;\n\n  position: relative;\n  display: inline-block;\n  padding: 7px 13px;\n  font-size: 14px;\n  font-weight: 600;\n  line-height: 20px;\n  white-space: nowrap;\n  vertical-align: middle;\n  cursor: pointer;\n  -webkit-user-select: none;\n  -moz-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n  background-size: 110% 110%;\n  border: none;\n  -webkit-appearance: none;\n  -moz-appearance: none;\n  appearance: none;\n}\n\n.gitment-editor-submit:hover,\n.gitment-comments-init-btn:hover {\n  background-color: #00ACC1;\n}\n\n.gitment-comments-init-btn:disabled,\n.gitment-editor-submit:disabled {\n  color: rgba(255,255,255,0.75);\n  background-color: #4DD0E1;\n  box-shadow: none;\n}\n\n.gitment-editor-submit {\n  float: right;\n}\n\n.gitment-footer-container {\n  margin-top: 30px;\n  margin-bottom: 20px;\n  text-align: right;\n  font-size: 12px;\n}\n\n/*\n * Markdown CSS\n * Copied from https://github.com/sindresorhus/github-markdown-css\n */\n.gitment-markdown {\n  -ms-text-size-adjust: 100%;\n  -webkit-text-size-adjust: 100%;\n  line-height: 1.5;\n  color: #333;\n  font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Helvetica, Arial, sans-serif, \"Apple Color Emoji\", \"Segoe UI Emoji\", \"Segoe UI Symbol\";\n  font-size: 16px;\n  line-height: 1.5;\n  word-wrap: break-word;\n}\n\n.gitment-markdown .pl-c {\n  color: #969896;\n}\n\n.gitment-markdown .pl-c1,\n.gitment-markdown .pl-s .pl-v {\n  color: #0086b3;\n}\n\n.gitment-markdown .pl-e,\n.gitment-markdown .pl-en {\n  color: #795da3;\n}\n\n.gitment-markdown .pl-smi,\n.gitment-markdown .pl-s .pl-s1 {\n  color: #333;\n}\n\n.gitment-markdown .pl-ent {\n  color: #63a35c;\n}\n\n.gitment-markdown .pl-k {\n  color: #a71d5d;\n}\n\n.gitment-markdown .pl-s,\n.gitment-markdown .pl-pds,\n.gitment-markdown .pl-s .pl-pse .pl-s1,\n.gitment-markdown .pl-sr,\n.gitment-markdown .pl-sr .pl-cce,\n.gitment-markdown .pl-sr .pl-sre,\n.gitment-markdown .pl-sr .pl-sra {\n  color: #183691;\n}\n\n.gitment-markdown .pl-v,\n.gitment-markdown .pl-smw {\n  color: #ed6a43;\n}\n\n.gitment-markdown .pl-bu {\n  color: #b52a1d;\n}\n\n.gitment-markdown .pl-ii {\n  color: #f8f8f8;\n  background-color: #b52a1d;\n}\n\n.gitment-markdown .pl-c2 {\n  color: #f8f8f8;\n  background-color: #b52a1d;\n}\n\n.gitment-markdown .pl-c2::before {\n  content: \"^M\";\n}\n\n.gitment-markdown .pl-sr .pl-cce {\n  font-weight: bold;\n  color: #63a35c;\n}\n\n.gitment-markdown .pl-ml {\n  color: #693a17;\n}\n\n.gitment-markdown .pl-mh,\n.gitment-markdown .pl-mh .pl-en,\n.gitment-markdown .pl-ms {\n  font-weight: bold;\n  color: #1d3e81;\n}\n\n.gitment-markdown .pl-mq {\n  color: #008080;\n}\n\n.gitment-markdown .pl-mi {\n  font-style: italic;\n  color: #333;\n}\n\n.gitment-markdown .pl-mb {\n  font-weight: bold;\n  color: #333;\n}\n\n.gitment-markdown .pl-md {\n  color: #bd2c00;\n  background-color: #ffecec;\n}\n\n.gitment-markdown .pl-mi1 {\n  color: #55a532;\n  background-color: #eaffea;\n}\n\n.gitment-markdown .pl-mc {\n  color: #ef9700;\n  background-color: #ffe3b4;\n}\n\n.gitment-markdown .pl-mi2 {\n  color: #d8d8d8;\n  background-color: #808080;\n}\n\n.gitment-markdown .pl-mdr {\n  font-weight: bold;\n  color: #795da3;\n}\n\n.gitment-markdown .pl-mo {\n  color: #1d3e81;\n}\n\n.gitment-markdown .pl-ba {\n  color: #595e62;\n}\n\n.gitment-markdown .pl-sg {\n  color: #c0c0c0;\n}\n\n.gitment-markdown .pl-corl {\n  text-decoration: underline;\n  color: #183691;\n}\n\n.gitment-markdown .octicon {\n  display: inline-block;\n  vertical-align: text-top;\n  fill: currentColor;\n}\n\n.gitment-markdown a {\n  background-color: transparent;\n  -webkit-text-decoration-skip: objects;\n}\n\n.gitment-markdown a:active,\n.gitment-markdown a:hover {\n  outline-width: 0;\n}\n\n.gitment-markdown strong {\n  font-weight: inherit;\n}\n\n.gitment-markdown strong {\n  font-weight: bolder;\n}\n\n.gitment-markdown h1 {\n  font-size: 2em;\n  margin: 0.67em 0;\n}\n\n.gitment-markdown img {\n  border-style: none;\n}\n\n.gitment-markdown svg:not(:root) {\n  overflow: hidden;\n}\n\n.gitment-markdown code,\n.gitment-markdown kbd,\n.gitment-markdown pre {\n  font-family: monospace, monospace;\n  font-size: 1em;\n}\n\n.gitment-markdown hr {\n  box-sizing: content-box;\n  height: 0;\n  overflow: visible;\n}\n\n.gitment-markdown input {\n  font: inherit;\n  margin: 0;\n}\n\n.gitment-markdown input {\n  overflow: visible;\n}\n\n.gitment-markdown [type=\"checkbox\"] {\n  box-sizing: border-box;\n  padding: 0;\n}\n\n.gitment-markdown * {\n  box-sizing: border-box;\n}\n\n.gitment-markdown input {\n  font-family: inherit;\n  font-size: inherit;\n  line-height: inherit;\n}\n\n.gitment-markdown a {\n  color: #0366d6;\n  text-decoration: none;\n}\n\n.gitment-markdown a:hover {\n  text-decoration: underline;\n}\n\n.gitment-markdown strong {\n  font-weight: 600;\n}\n\n.gitment-markdown hr {\n  height: 0;\n  margin: 15px 0;\n  overflow: hidden;\n  background: transparent;\n  border: 0;\n  border-bottom: 1px solid #dfe2e5;\n}\n\n.gitment-markdown hr::before {\n  display: table;\n  content: \"\";\n}\n\n.gitment-markdown hr::after {\n  display: table;\n  clear: both;\n  content: \"\";\n}\n\n.gitment-markdown table {\n  border-spacing: 0;\n  border-collapse: collapse;\n}\n\n.gitment-markdown td,\n.gitment-markdown th {\n  padding: 0;\n}\n\n.gitment-markdown h1,\n.gitment-markdown h2,\n.gitment-markdown h3,\n.gitment-markdown h4,\n.gitment-markdown h5,\n.gitment-markdown h6 {\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.gitment-markdown h1 {\n  font-size: 32px;\n  font-weight: 600;\n}\n\n.gitment-markdown h2 {\n  font-size: 24px;\n  font-weight: 600;\n}\n\n.gitment-markdown h3 {\n  font-size: 20px;\n  font-weight: 600;\n}\n\n.gitment-markdown h4 {\n  font-size: 16px;\n  font-weight: 600;\n}\n\n.gitment-markdown h5 {\n  font-size: 14px;\n  font-weight: 600;\n}\n\n.gitment-markdown h6 {\n  font-size: 12px;\n  font-weight: 600;\n}\n\n.gitment-markdown p {\n  margin-top: 0;\n  margin-bottom: 10px;\n}\n\n.gitment-markdown blockquote {\n  margin: 0;\n}\n\n.gitment-markdown ul,\n.gitment-markdown ol {\n  padding-left: 0;\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.gitment-markdown ol ol,\n.gitment-markdown ul ol {\n  list-style-type: lower-roman;\n}\n\n.gitment-markdown ul ul ol,\n.gitment-markdown ul ol ol,\n.gitment-markdown ol ul ol,\n.gitment-markdown ol ol ol {\n  list-style-type: lower-alpha;\n}\n\n.gitment-markdown dd {\n  margin-left: 0;\n}\n\n.gitment-markdown code {\n  font-family: \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n  font-size: 12px;\n}\n\n.gitment-markdown pre {\n  margin-top: 0;\n  margin-bottom: 0;\n  font: 12px \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n}\n\n.gitment-markdown .octicon {\n  vertical-align: text-bottom;\n}\n\n.gitment-markdown .pl-0 {\n  padding-left: 0 !important;\n}\n\n.gitment-markdown .pl-1 {\n  padding-left: 4px !important;\n}\n\n.gitment-markdown .pl-2 {\n  padding-left: 8px !important;\n}\n\n.gitment-markdown .pl-3 {\n  padding-left: 16px !important;\n}\n\n.gitment-markdown .pl-4 {\n  padding-left: 24px !important;\n}\n\n.gitment-markdown .pl-5 {\n  padding-left: 32px !important;\n}\n\n.gitment-markdown .pl-6 {\n  padding-left: 40px !important;\n}\n\n.gitment-markdown::before {\n  display: table;\n  content: \"\";\n}\n\n.gitment-markdown::after {\n  display: table;\n  clear: both;\n  content: \"\";\n}\n\n.gitment-markdown>*:first-child {\n  margin-top: 0 !important;\n}\n\n.gitment-markdown>*:last-child {\n  margin-bottom: 0 !important;\n}\n\n.gitment-markdown a:not([href]) {\n  color: inherit;\n  text-decoration: none;\n}\n\n.gitment-markdown .anchor {\n  float: left;\n  padding-right: 4px;\n  margin-left: -20px;\n  line-height: 1;\n}\n\n.gitment-markdown .anchor:focus {\n  outline: none;\n}\n\n.gitment-markdown p,\n.gitment-markdown blockquote,\n.gitment-markdown ul,\n.gitment-markdown ol,\n.gitment-markdown dl,\n.gitment-markdown table,\n.gitment-markdown pre {\n  margin-top: 0;\n  margin-bottom: 16px;\n}\n\n.gitment-markdown hr {\n  height: 0.25em;\n  padding: 0;\n  margin: 24px 0;\n  background-color: #e1e4e8;\n  border: 0;\n}\n\n.gitment-markdown blockquote {\n  padding: 0 1em;\n  color: #6a737d;\n  border-left: 0.25em solid #dfe2e5;\n}\n\n.gitment-markdown blockquote>:first-child {\n  margin-top: 0;\n}\n\n.gitment-markdown blockquote>:last-child {\n  margin-bottom: 0;\n}\n\n.gitment-markdown kbd {\n  display: inline-block;\n  padding: 3px 5px;\n  font-size: 11px;\n  line-height: 10px;\n  color: #444d56;\n  vertical-align: middle;\n  background-color: #fafbfc;\n  border: solid 1px #c6cbd1;\n  border-bottom-color: #959da5;\n  border-radius: 0;\n  box-shadow: inset 0 -1px 0 #959da5;\n}\n\n.gitment-markdown h1,\n.gitment-markdown h2,\n.gitment-markdown h3,\n.gitment-markdown h4,\n.gitment-markdown h5,\n.gitment-markdown h6 {\n  margin-top: 24px;\n  margin-bottom: 16px;\n  font-weight: 600;\n  line-height: 1.25;\n}\n\n.gitment-markdown h1 .octicon-link,\n.gitment-markdown h2 .octicon-link,\n.gitment-markdown h3 .octicon-link,\n.gitment-markdown h4 .octicon-link,\n.gitment-markdown h5 .octicon-link,\n.gitment-markdown h6 .octicon-link {\n  color: #1b1f23;\n  vertical-align: middle;\n  visibility: hidden;\n}\n\n.gitment-markdown h1:hover .anchor,\n.gitment-markdown h2:hover .anchor,\n.gitment-markdown h3:hover .anchor,\n.gitment-markdown h4:hover .anchor,\n.gitment-markdown h5:hover .anchor,\n.gitment-markdown h6:hover .anchor {\n  text-decoration: none;\n}\n\n.gitment-markdown h1:hover .anchor .octicon-link,\n.gitment-markdown h2:hover .anchor .octicon-link,\n.gitment-markdown h3:hover .anchor .octicon-link,\n.gitment-markdown h4:hover .anchor .octicon-link,\n.gitment-markdown h5:hover .anchor .octicon-link,\n.gitment-markdown h6:hover .anchor .octicon-link {\n  visibility: visible;\n}\n\n.gitment-markdown h1 {\n  padding-bottom: 0.3em;\n  font-size: 2em;\n  border-bottom: 1px solid #eaecef;\n}\n\n.gitment-markdown h2 {\n  padding-bottom: 0.3em;\n  font-size: 1.5em;\n  border-bottom: 1px solid #eaecef;\n}\n\n.gitment-markdown h3 {\n  font-size: 1.25em;\n}\n\n.gitment-markdown h4 {\n  font-size: 1em;\n}\n\n.gitment-markdown h5 {\n  font-size: 0.875em;\n}\n\n.gitment-markdown h6 {\n  font-size: 0.85em;\n  color: #6a737d;\n}\n\n.gitment-markdown ul,\n.gitment-markdown ol {\n  padding-left: 2em;\n}\n\n.gitment-markdown ul ul,\n.gitment-markdown ul ol,\n.gitment-markdown ol ol,\n.gitment-markdown ol ul {\n  margin-top: 0;\n  margin-bottom: 0;\n}\n\n.gitment-markdown li>p {\n  margin-top: 16px;\n}\n\n.gitment-markdown li+li {\n  margin-top: 0.25em;\n}\n\n.gitment-markdown dl {\n  padding: 0;\n}\n\n.gitment-markdown dl dt {\n  padding: 0;\n  margin-top: 16px;\n  font-size: 1em;\n  font-style: italic;\n  font-weight: 600;\n}\n\n.gitment-markdown dl dd {\n  padding: 0 16px;\n  margin-bottom: 16px;\n}\n\n.gitment-markdown table {\n  display: block;\n  width: 100%;\n  overflow: auto;\n}\n\n.gitment-markdown table th {\n  font-weight: 600;\n}\n\n.gitment-markdown table th,\n.gitment-markdown table td {\n  padding: 6px 13px;\n  border: 1px solid #dfe2e5;\n}\n\n.gitment-markdown table tr {\n  background-color: #fff;\n  border-top: 1px solid #c6cbd1;\n}\n\n.gitment-markdown table tr:nth-child(2n) {\n  background-color: #f5f5f5;\n}\n\n.gitment-markdown img {\n  max-width: 100%;\n  box-sizing: content-box;\n  background-color: #fff;\n}\n\n.gitment-markdown code {\n  padding: 0;\n  padding-top: 0.2em;\n  padding-bottom: 0.2em;\n  margin: 0;\n  font-size: 85%;\n  background-color: rgba(27,31,35,0.05);\n  border-radius: 0;\n}\n\n.gitment-markdown code::before,\n.gitment-markdown code::after {\n  letter-spacing: -0.2em;\n  content: \"\\00a0\";\n}\n\n.gitment-markdown pre {\n  word-wrap: normal;\n}\n\n.gitment-markdown pre>code {\n  padding: 0;\n  margin: 0;\n  font-size: 100%;\n  word-break: normal;\n  white-space: pre;\n  background: transparent;\n  border: 0;\n}\n\n.gitment-markdown .highlight {\n  margin-bottom: 16px;\n}\n\n.gitment-markdown .highlight pre {\n  margin-bottom: 0;\n  word-break: normal;\n}\n\n.gitment-markdown .highlight pre,\n.gitment-markdown pre {\n  padding: 16px;\n  overflow: auto;\n  font-size: 85%;\n  line-height: 1.45;\n  background-color: #f5f5f5;\n  border-radius: 0;\n}\n\n.gitment-markdown pre code {\n  display: inline;\n  max-width: auto;\n  padding: 0;\n  margin: 0;\n  overflow: visible;\n  line-height: inherit;\n  word-wrap: normal;\n  background-color: transparent;\n  border: 0;\n}\n\n.gitment-markdown pre code::before,\n.gitment-markdown pre code::after {\n  content: normal;\n}\n\n.gitment-markdown .full-commit .btn-outline:not(:disabled):hover {\n  color: #005cc5;\n  border-color: #005cc5;\n}\n\n.gitment-markdown kbd {\n  display: inline-block;\n  padding: 3px 5px;\n  font: 11px \"SFMono-Regular\", Consolas, \"Liberation Mono\", Menlo, Courier, monospace;\n  line-height: 10px;\n  color: #444d56;\n  vertical-align: middle;\n  background-color: #fcfcfc;\n  border: solid 1px #c6cbd1;\n  border-bottom-color: #959da5;\n  border-radius: 0;\n  box-shadow: inset 0 -1px 0 #959da5;\n}\n\n.gitment-markdown :checked+.radio-label {\n  position: relative;\n  z-index: 1;\n  border-color: #0366d6;\n}\n\n.gitment-markdown .task-list-item {\n  list-style-type: none;\n}\n\n.gitment-markdown .task-list-item+.task-list-item {\n  margin-top: 3px;\n}\n\n.gitment-markdown .task-list-item input {\n  margin: 0 0.2em 0.25em -1.6em;\n  vertical-align: middle;\n}\n\n.gitment-markdown hr {\n  border-bottom-color: #eee;\n}"},{"title":"归档","layout":"page-archive","_content":"","source":"archive/index.md","raw":"---\ntitle: 归档\nlayout: page-archive\n---\n","date":"2018-03-04T15:08:12.828Z","updated":"2018-03-04T15:08:12.828Z","path":"archive/index.html","comments":1,"_id":"cjk698hxl0007znzwes73p9ty","content":"","site":{"data":{}},"excerpt":"","more":""},{"_content":"var Gitment =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 5);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar LS_ACCESS_TOKEN_KEY = exports.LS_ACCESS_TOKEN_KEY = 'gitment-comments-token';\nvar LS_USER_KEY = exports.LS_USER_KEY = 'gitment-user-info';\n\nvar NOT_INITIALIZED_ERROR = exports.NOT_INITIALIZED_ERROR = new Error('Comments Not Initialized');\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global) {\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar __extends = undefined && undefined.__extends || function () {\n    var extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (d, b) {\n        d.__proto__ = b;\n    } || function (d, b) {\n        for (var p in b) {\n            if (b.hasOwnProperty(p)) d[p] = b[p];\n        }\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() {\n            this.constructor = d;\n        }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n}();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nregisterGlobals();\nexports.extras = {\n    allowStateChanges: allowStateChanges,\n    deepEqual: deepEqual,\n    getAtom: getAtom,\n    getDebugName: getDebugName,\n    getDependencyTree: getDependencyTree,\n    getAdministration: getAdministration,\n    getGlobalState: getGlobalState,\n    getObserverTree: getObserverTree,\n    isComputingDerivation: isComputingDerivation,\n    isSpyEnabled: isSpyEnabled,\n    onReactionError: onReactionError,\n    resetGlobalState: resetGlobalState,\n    shareGlobalState: shareGlobalState,\n    spyReport: spyReport,\n    spyReportEnd: spyReportEnd,\n    spyReportStart: spyReportStart,\n    setReactionScheduler: setReactionScheduler\n};\nif ((typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__ === \"undefined\" ? \"undefined\" : _typeof(__MOBX_DEVTOOLS_GLOBAL_HOOK__)) === \"object\") {\n    __MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx(module.exports);\n}\nmodule.exports.default = module.exports;\nvar actionFieldDecorator = createClassPropertyDecorator(function (target, key, value, args, originalDescriptor) {\n    var actionName = args && args.length === 1 ? args[0] : value.name || key || \"<unnamed action>\";\n    var wrappedAction = action(actionName, value);\n    addHiddenProp(target, key, wrappedAction);\n}, function (key) {\n    return this[key];\n}, function () {\n    invariant(false, getMessage(\"m001\"));\n}, false, true);\nvar boundActionDecorator = createClassPropertyDecorator(function (target, key, value) {\n    defineBoundAction(target, key, value);\n}, function (key) {\n    return this[key];\n}, function () {\n    invariant(false, getMessage(\"m001\"));\n}, false, false);\nvar action = function action(arg1, arg2, arg3, arg4) {\n    if (arguments.length === 1 && typeof arg1 === \"function\") return createAction(arg1.name || \"<unnamed action>\", arg1);\n    if (arguments.length === 2 && typeof arg2 === \"function\") return createAction(arg1, arg2);\n    if (arguments.length === 1 && typeof arg1 === \"string\") return namedActionDecorator(arg1);\n    return namedActionDecorator(arg2).apply(null, arguments);\n};\nexports.action = action;\naction.bound = function boundAction(arg1, arg2, arg3) {\n    if (typeof arg1 === \"function\") {\n        var action_1 = createAction(\"<not yet bound action>\", arg1);\n        action_1.autoBind = true;\n        return action_1;\n    }\n    return boundActionDecorator.apply(null, arguments);\n};\nfunction namedActionDecorator(name) {\n    return function (target, prop, descriptor) {\n        if (descriptor && typeof descriptor.value === \"function\") {\n            descriptor.value = createAction(name, descriptor.value);\n            descriptor.enumerable = false;\n            descriptor.configurable = true;\n            return descriptor;\n        }\n        return actionFieldDecorator(name).apply(this, arguments);\n    };\n}\nfunction runInAction(arg1, arg2, arg3) {\n    var actionName = typeof arg1 === \"string\" ? arg1 : arg1.name || \"<unnamed action>\";\n    var fn = typeof arg1 === \"function\" ? arg1 : arg2;\n    var scope = typeof arg1 === \"function\" ? arg2 : arg3;\n    invariant(typeof fn === \"function\", getMessage(\"m002\"));\n    invariant(fn.length === 0, getMessage(\"m003\"));\n    invariant(typeof actionName === \"string\" && actionName.length > 0, \"actions should have valid names, got: '\" + actionName + \"'\");\n    return executeAction(actionName, fn, scope, undefined);\n}\nexports.runInAction = runInAction;\nfunction isAction(thing) {\n    return typeof thing === \"function\" && thing.isMobxAction === true;\n}\nexports.isAction = isAction;\nfunction defineBoundAction(target, propertyName, fn) {\n    var res = function res() {\n        return executeAction(propertyName, fn, target, arguments);\n    };\n    res.isMobxAction = true;\n    addHiddenProp(target, propertyName, res);\n}\nfunction autorun(arg1, arg2, arg3) {\n    var name, view, scope;\n    if (typeof arg1 === \"string\") {\n        name = arg1;\n        view = arg2;\n        scope = arg3;\n    } else {\n        name = arg1.name || \"Autorun@\" + getNextId();\n        view = arg1;\n        scope = arg2;\n    }\n    invariant(typeof view === \"function\", getMessage(\"m004\"));\n    invariant(isAction(view) === false, getMessage(\"m005\"));\n    if (scope) view = view.bind(scope);\n    var reaction = new Reaction(name, function () {\n        this.track(reactionRunner);\n    });\n    function reactionRunner() {\n        view(reaction);\n    }\n    reaction.schedule();\n    return reaction.getDisposer();\n}\nexports.autorun = autorun;\nfunction when(arg1, arg2, arg3, arg4) {\n    var name, predicate, effect, scope;\n    if (typeof arg1 === \"string\") {\n        name = arg1;\n        predicate = arg2;\n        effect = arg3;\n        scope = arg4;\n    } else {\n        name = \"When@\" + getNextId();\n        predicate = arg1;\n        effect = arg2;\n        scope = arg3;\n    }\n    var disposer = autorun(name, function (r) {\n        if (predicate.call(scope)) {\n            r.dispose();\n            var prevUntracked = untrackedStart();\n            effect.call(scope);\n            untrackedEnd(prevUntracked);\n        }\n    });\n    return disposer;\n}\nexports.when = when;\nfunction autorunAsync(arg1, arg2, arg3, arg4) {\n    var name, func, delay, scope;\n    if (typeof arg1 === \"string\") {\n        name = arg1;\n        func = arg2;\n        delay = arg3;\n        scope = arg4;\n    } else {\n        name = arg1.name || \"AutorunAsync@\" + getNextId();\n        func = arg1;\n        delay = arg2;\n        scope = arg3;\n    }\n    invariant(isAction(func) === false, getMessage(\"m006\"));\n    if (delay === void 0) delay = 1;\n    if (scope) func = func.bind(scope);\n    var isScheduled = false;\n    var r = new Reaction(name, function () {\n        if (!isScheduled) {\n            isScheduled = true;\n            setTimeout(function () {\n                isScheduled = false;\n                if (!r.isDisposed) r.track(reactionRunner);\n            }, delay);\n        }\n    });\n    function reactionRunner() {\n        func(r);\n    }\n    r.schedule();\n    return r.getDisposer();\n}\nexports.autorunAsync = autorunAsync;\nfunction reaction(expression, effect, arg3) {\n    if (arguments.length > 3) {\n        fail(getMessage(\"m007\"));\n    }\n    if (isModifierDescriptor(expression)) {\n        fail(getMessage(\"m008\"));\n    }\n    var opts;\n    if ((typeof arg3 === \"undefined\" ? \"undefined\" : _typeof(arg3)) === \"object\") {\n        opts = arg3;\n    } else {\n        opts = {};\n    }\n    opts.name = opts.name || expression.name || effect.name || \"Reaction@\" + getNextId();\n    opts.fireImmediately = arg3 === true || opts.fireImmediately === true;\n    opts.delay = opts.delay || 0;\n    opts.compareStructural = opts.compareStructural || opts.struct || false;\n    effect = action(opts.name, opts.context ? effect.bind(opts.context) : effect);\n    if (opts.context) {\n        expression = expression.bind(opts.context);\n    }\n    var firstTime = true;\n    var isScheduled = false;\n    var nextValue;\n    var r = new Reaction(opts.name, function () {\n        if (firstTime || opts.delay < 1) {\n            reactionRunner();\n        } else if (!isScheduled) {\n            isScheduled = true;\n            setTimeout(function () {\n                isScheduled = false;\n                reactionRunner();\n            }, opts.delay);\n        }\n    });\n    function reactionRunner() {\n        if (r.isDisposed) return;\n        var changed = false;\n        r.track(function () {\n            var v = expression(r);\n            changed = valueDidChange(opts.compareStructural, nextValue, v);\n            nextValue = v;\n        });\n        if (firstTime && opts.fireImmediately) effect(nextValue, r);\n        if (!firstTime && changed === true) effect(nextValue, r);\n        if (firstTime) firstTime = false;\n    }\n    r.schedule();\n    return r.getDisposer();\n}\nexports.reaction = reaction;\nfunction createComputedDecorator(compareStructural) {\n    return createClassPropertyDecorator(function (target, name, _, __, originalDescriptor) {\n        invariant(typeof originalDescriptor !== \"undefined\", getMessage(\"m009\"));\n        invariant(typeof originalDescriptor.get === \"function\", getMessage(\"m010\"));\n        var adm = asObservableObject(target, \"\");\n        defineComputedProperty(adm, name, originalDescriptor.get, originalDescriptor.set, compareStructural, false);\n    }, function (name) {\n        var observable = this.$mobx.values[name];\n        if (observable === undefined) return undefined;\n        return observable.get();\n    }, function (name, value) {\n        this.$mobx.values[name].set(value);\n    }, false, false);\n}\nvar computedDecorator = createComputedDecorator(false);\nvar computedStructDecorator = createComputedDecorator(true);\nvar computed = function computed(arg1, arg2, arg3) {\n    if (typeof arg2 === \"string\") {\n        return computedDecorator.apply(null, arguments);\n    }\n    invariant(typeof arg1 === \"function\", getMessage(\"m011\"));\n    invariant(arguments.length < 3, getMessage(\"m012\"));\n    var opts = (typeof arg2 === \"undefined\" ? \"undefined\" : _typeof(arg2)) === \"object\" ? arg2 : {};\n    opts.setter = typeof arg2 === \"function\" ? arg2 : opts.setter;\n    return new ComputedValue(arg1, opts.context, opts.compareStructural || opts.struct || false, opts.name || arg1.name || \"\", opts.setter);\n};\nexports.computed = computed;\ncomputed.struct = computedStructDecorator;\nfunction createTransformer(transformer, onCleanup) {\n    invariant(typeof transformer === \"function\" && transformer.length < 2, \"createTransformer expects a function that accepts one argument\");\n    var objectCache = {};\n    var resetId = globalState.resetId;\n    var Transformer = function (_super) {\n        __extends(Transformer, _super);\n        function Transformer(sourceIdentifier, sourceObject) {\n            var _this = _super.call(this, function () {\n                return transformer(sourceObject);\n            }, undefined, false, \"Transformer-\" + transformer.name + \"-\" + sourceIdentifier, undefined) || this;\n            _this.sourceIdentifier = sourceIdentifier;\n            _this.sourceObject = sourceObject;\n            return _this;\n        }\n        Transformer.prototype.onBecomeUnobserved = function () {\n            var lastValue = this.value;\n            _super.prototype.onBecomeUnobserved.call(this);\n            delete objectCache[this.sourceIdentifier];\n            if (onCleanup) onCleanup(lastValue, this.sourceObject);\n        };\n        return Transformer;\n    }(ComputedValue);\n    return function (object) {\n        if (resetId !== globalState.resetId) {\n            objectCache = {};\n            resetId = globalState.resetId;\n        }\n        var identifier = getMemoizationId(object);\n        var reactiveTransformer = objectCache[identifier];\n        if (reactiveTransformer) return reactiveTransformer.get();\n        reactiveTransformer = objectCache[identifier] = new Transformer(identifier, object);\n        return reactiveTransformer.get();\n    };\n}\nexports.createTransformer = createTransformer;\nfunction getMemoizationId(object) {\n    if (object === null || (typeof object === \"undefined\" ? \"undefined\" : _typeof(object)) !== \"object\") throw new Error(\"[mobx] transform expected some kind of object, got: \" + object);\n    var tid = object.$transformId;\n    if (tid === undefined) {\n        tid = getNextId();\n        addHiddenProp(object, \"$transformId\", tid);\n    }\n    return tid;\n}\nfunction expr(expr, scope) {\n    if (!isComputingDerivation()) console.warn(getMessage(\"m013\"));\n    return computed(expr, { context: scope }).get();\n}\nexports.expr = expr;\nfunction extendObservable(target) {\n    var properties = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        properties[_i - 1] = arguments[_i];\n    }\n    return extendObservableHelper(target, deepEnhancer, properties);\n}\nexports.extendObservable = extendObservable;\nfunction extendShallowObservable(target) {\n    var properties = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        properties[_i - 1] = arguments[_i];\n    }\n    return extendObservableHelper(target, referenceEnhancer, properties);\n}\nexports.extendShallowObservable = extendShallowObservable;\nfunction extendObservableHelper(target, defaultEnhancer, properties) {\n    invariant(arguments.length >= 2, getMessage(\"m014\"));\n    invariant((typeof target === \"undefined\" ? \"undefined\" : _typeof(target)) === \"object\", getMessage(\"m015\"));\n    invariant(!isObservableMap(target), getMessage(\"m016\"));\n    properties.forEach(function (propSet) {\n        invariant((typeof propSet === \"undefined\" ? \"undefined\" : _typeof(propSet)) === \"object\", getMessage(\"m017\"));\n        invariant(!isObservable(propSet), getMessage(\"m018\"));\n    });\n    var adm = asObservableObject(target);\n    var definedProps = {};\n    for (var i = properties.length - 1; i >= 0; i--) {\n        var propSet = properties[i];\n        for (var key in propSet) {\n            if (definedProps[key] !== true && hasOwnProperty(propSet, key)) {\n                definedProps[key] = true;\n                if (target === propSet && !isPropertyConfigurable(target, key)) continue;\n                var descriptor = Object.getOwnPropertyDescriptor(propSet, key);\n                defineObservablePropertyFromDescriptor(adm, key, descriptor, defaultEnhancer);\n            }\n        }\n    }\n    return target;\n}\nfunction getDependencyTree(thing, property) {\n    return nodeToDependencyTree(getAtom(thing, property));\n}\nfunction nodeToDependencyTree(node) {\n    var result = {\n        name: node.name\n    };\n    if (node.observing && node.observing.length > 0) result.dependencies = unique(node.observing).map(nodeToDependencyTree);\n    return result;\n}\nfunction getObserverTree(thing, property) {\n    return nodeToObserverTree(getAtom(thing, property));\n}\nfunction nodeToObserverTree(node) {\n    var result = {\n        name: node.name\n    };\n    if (hasObservers(node)) result.observers = getObservers(node).map(nodeToObserverTree);\n    return result;\n}\nfunction intercept(thing, propOrHandler, handler) {\n    if (typeof handler === \"function\") return interceptProperty(thing, propOrHandler, handler);else return interceptInterceptable(thing, propOrHandler);\n}\nexports.intercept = intercept;\nfunction interceptInterceptable(thing, handler) {\n    return getAdministration(thing).intercept(handler);\n}\nfunction interceptProperty(thing, property, handler) {\n    return getAdministration(thing, property).intercept(handler);\n}\nfunction isComputed(value, property) {\n    if (value === null || value === undefined) return false;\n    if (property !== undefined) {\n        if (isObservableObject(value) === false) return false;\n        var atom = getAtom(value, property);\n        return isComputedValue(atom);\n    }\n    return isComputedValue(value);\n}\nexports.isComputed = isComputed;\nfunction isObservable(value, property) {\n    if (value === null || value === undefined) return false;\n    if (property !== undefined) {\n        if (isObservableArray(value) || isObservableMap(value)) throw new Error(getMessage(\"m019\"));else if (isObservableObject(value)) {\n            var o = value.$mobx;\n            return o.values && !!o.values[property];\n        }\n        return false;\n    }\n    return isObservableObject(value) || !!value.$mobx || isAtom(value) || isReaction(value) || isComputedValue(value);\n}\nexports.isObservable = isObservable;\nvar deepDecorator = createDecoratorForEnhancer(deepEnhancer);\nvar shallowDecorator = createDecoratorForEnhancer(shallowEnhancer);\nvar refDecorator = createDecoratorForEnhancer(referenceEnhancer);\nvar deepStructDecorator = createDecoratorForEnhancer(deepStructEnhancer);\nvar refStructDecorator = createDecoratorForEnhancer(refStructEnhancer);\nfunction createObservable(v) {\n    if (v === void 0) {\n        v = undefined;\n    }\n    if (typeof arguments[1] === \"string\") return deepDecorator.apply(null, arguments);\n    invariant(arguments.length <= 1, getMessage(\"m021\"));\n    invariant(!isModifierDescriptor(v), getMessage(\"m020\"));\n    if (isObservable(v)) return v;\n    var res = deepEnhancer(v, undefined, undefined);\n    if (res !== v) return res;\n    return observable.box(v);\n}\nvar IObservableFactories = function () {\n    function IObservableFactories() {}\n    IObservableFactories.prototype.box = function (value, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"box\");\n        return new ObservableValue(value, deepEnhancer, name);\n    };\n    IObservableFactories.prototype.shallowBox = function (value, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"shallowBox\");\n        return new ObservableValue(value, referenceEnhancer, name);\n    };\n    IObservableFactories.prototype.array = function (initialValues, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"array\");\n        return new ObservableArray(initialValues, deepEnhancer, name);\n    };\n    IObservableFactories.prototype.shallowArray = function (initialValues, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"shallowArray\");\n        return new ObservableArray(initialValues, referenceEnhancer, name);\n    };\n    IObservableFactories.prototype.map = function (initialValues, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"map\");\n        return new ObservableMap(initialValues, deepEnhancer, name);\n    };\n    IObservableFactories.prototype.shallowMap = function (initialValues, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"shallowMap\");\n        return new ObservableMap(initialValues, referenceEnhancer, name);\n    };\n    IObservableFactories.prototype.object = function (props, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"object\");\n        var res = {};\n        asObservableObject(res, name);\n        extendObservable(res, props);\n        return res;\n    };\n    IObservableFactories.prototype.shallowObject = function (props, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"shallowObject\");\n        var res = {};\n        asObservableObject(res, name);\n        extendShallowObservable(res, props);\n        return res;\n    };\n    IObservableFactories.prototype.ref = function () {\n        if (arguments.length < 2) {\n            return createModifierDescriptor(referenceEnhancer, arguments[0]);\n        } else {\n            return refDecorator.apply(null, arguments);\n        }\n    };\n    IObservableFactories.prototype.shallow = function () {\n        if (arguments.length < 2) {\n            return createModifierDescriptor(shallowEnhancer, arguments[0]);\n        } else {\n            return shallowDecorator.apply(null, arguments);\n        }\n    };\n    IObservableFactories.prototype.deep = function () {\n        if (arguments.length < 2) {\n            return createModifierDescriptor(deepEnhancer, arguments[0]);\n        } else {\n            return deepDecorator.apply(null, arguments);\n        }\n    };\n    IObservableFactories.prototype.struct = function () {\n        if (arguments.length < 2) {\n            return createModifierDescriptor(deepStructEnhancer, arguments[0]);\n        } else {\n            return deepStructDecorator.apply(null, arguments);\n        }\n    };\n    return IObservableFactories;\n}();\nexports.IObservableFactories = IObservableFactories;\nvar observable = createObservable;\nexports.observable = observable;\nObject.keys(IObservableFactories.prototype).forEach(function (key) {\n    return observable[key] = IObservableFactories.prototype[key];\n});\nobservable.deep.struct = observable.struct;\nobservable.ref.struct = function () {\n    if (arguments.length < 2) {\n        return createModifierDescriptor(refStructEnhancer, arguments[0]);\n    } else {\n        return refStructDecorator.apply(null, arguments);\n    }\n};\nfunction incorrectlyUsedAsDecorator(methodName) {\n    fail(\"Expected one or two arguments to observable.\" + methodName + \". Did you accidentally try to use observable.\" + methodName + \" as decorator?\");\n}\nfunction createDecoratorForEnhancer(enhancer) {\n    invariant(!!enhancer, \":(\");\n    return createClassPropertyDecorator(function (target, name, baseValue, _, baseDescriptor) {\n        assertPropertyConfigurable(target, name);\n        invariant(!baseDescriptor || !baseDescriptor.get, getMessage(\"m022\"));\n        var adm = asObservableObject(target, undefined);\n        defineObservableProperty(adm, name, baseValue, enhancer);\n    }, function (name) {\n        var observable = this.$mobx.values[name];\n        if (observable === undefined) return undefined;\n        return observable.get();\n    }, function (name, value) {\n        setPropertyValue(this, name, value);\n    }, true, false);\n}\nfunction observe(thing, propOrCb, cbOrFire, fireImmediately) {\n    if (typeof cbOrFire === \"function\") return observeObservableProperty(thing, propOrCb, cbOrFire, fireImmediately);else return observeObservable(thing, propOrCb, cbOrFire);\n}\nexports.observe = observe;\nfunction observeObservable(thing, listener, fireImmediately) {\n    return getAdministration(thing).observe(listener, fireImmediately);\n}\nfunction observeObservableProperty(thing, property, listener, fireImmediately) {\n    return getAdministration(thing, property).observe(listener, fireImmediately);\n}\nfunction toJS(source, detectCycles, __alreadySeen) {\n    if (detectCycles === void 0) {\n        detectCycles = true;\n    }\n    if (__alreadySeen === void 0) {\n        __alreadySeen = [];\n    }\n    function cache(value) {\n        if (detectCycles) __alreadySeen.push([source, value]);\n        return value;\n    }\n    if (isObservable(source)) {\n        if (detectCycles && __alreadySeen === null) __alreadySeen = [];\n        if (detectCycles && source !== null && (typeof source === \"undefined\" ? \"undefined\" : _typeof(source)) === \"object\") {\n            for (var i = 0, l = __alreadySeen.length; i < l; i++) {\n                if (__alreadySeen[i][0] === source) return __alreadySeen[i][1];\n            }\n        }\n        if (isObservableArray(source)) {\n            var res = cache([]);\n            var toAdd = source.map(function (value) {\n                return toJS(value, detectCycles, __alreadySeen);\n            });\n            res.length = toAdd.length;\n            for (var i = 0, l = toAdd.length; i < l; i++) {\n                res[i] = toAdd[i];\n            }return res;\n        }\n        if (isObservableObject(source)) {\n            var res = cache({});\n            for (var key in source) {\n                res[key] = toJS(source[key], detectCycles, __alreadySeen);\n            }return res;\n        }\n        if (isObservableMap(source)) {\n            var res_1 = cache({});\n            source.forEach(function (value, key) {\n                return res_1[key] = toJS(value, detectCycles, __alreadySeen);\n            });\n            return res_1;\n        }\n        if (isObservableValue(source)) return toJS(source.get(), detectCycles, __alreadySeen);\n    }\n    return source;\n}\nexports.toJS = toJS;\nfunction transaction(action, thisArg) {\n    if (thisArg === void 0) {\n        thisArg = undefined;\n    }\n    deprecated(getMessage(\"m023\"));\n    return runInTransaction.apply(undefined, arguments);\n}\nexports.transaction = transaction;\nfunction runInTransaction(action, thisArg) {\n    if (thisArg === void 0) {\n        thisArg = undefined;\n    }\n    return executeAction(\"\", action);\n}\nfunction log(msg) {\n    console.log(msg);\n    return msg;\n}\nfunction whyRun(thing, prop) {\n    switch (arguments.length) {\n        case 0:\n            thing = globalState.trackingDerivation;\n            if (!thing) return log(getMessage(\"m024\"));\n            break;\n        case 2:\n            thing = getAtom(thing, prop);\n            break;\n    }\n    thing = getAtom(thing);\n    if (isComputedValue(thing)) return log(thing.whyRun());else if (isReaction(thing)) return log(thing.whyRun());\n    return fail(getMessage(\"m025\"));\n}\nexports.whyRun = whyRun;\nfunction createAction(actionName, fn) {\n    invariant(typeof fn === \"function\", getMessage(\"m026\"));\n    invariant(typeof actionName === \"string\" && actionName.length > 0, \"actions should have valid names, got: '\" + actionName + \"'\");\n    var res = function res() {\n        return executeAction(actionName, fn, this, arguments);\n    };\n    res.originalFn = fn;\n    res.isMobxAction = true;\n    return res;\n}\nfunction executeAction(actionName, fn, scope, args) {\n    var runInfo = startAction(actionName, fn, scope, args);\n    try {\n        return fn.apply(scope, args);\n    } finally {\n        endAction(runInfo);\n    }\n}\nfunction startAction(actionName, fn, scope, args) {\n    var notifySpy = isSpyEnabled() && !!actionName;\n    var startTime = 0;\n    if (notifySpy) {\n        startTime = Date.now();\n        var l = args && args.length || 0;\n        var flattendArgs = new Array(l);\n        if (l > 0) for (var i = 0; i < l; i++) {\n            flattendArgs[i] = args[i];\n        }spyReportStart({\n            type: \"action\",\n            name: actionName,\n            fn: fn,\n            object: scope,\n            arguments: flattendArgs\n        });\n    }\n    var prevDerivation = untrackedStart();\n    startBatch();\n    var prevAllowStateChanges = allowStateChangesStart(true);\n    return {\n        prevDerivation: prevDerivation,\n        prevAllowStateChanges: prevAllowStateChanges,\n        notifySpy: notifySpy,\n        startTime: startTime\n    };\n}\nfunction endAction(runInfo) {\n    allowStateChangesEnd(runInfo.prevAllowStateChanges);\n    endBatch();\n    untrackedEnd(runInfo.prevDerivation);\n    if (runInfo.notifySpy) spyReportEnd({ time: Date.now() - runInfo.startTime });\n}\nfunction useStrict(strict) {\n    invariant(globalState.trackingDerivation === null, getMessage(\"m028\"));\n    globalState.strictMode = strict;\n    globalState.allowStateChanges = !strict;\n}\nexports.useStrict = useStrict;\nfunction isStrictModeEnabled() {\n    return globalState.strictMode;\n}\nexports.isStrictModeEnabled = isStrictModeEnabled;\nfunction allowStateChanges(allowStateChanges, func) {\n    var prev = allowStateChangesStart(allowStateChanges);\n    var res;\n    try {\n        res = func();\n    } finally {\n        allowStateChangesEnd(prev);\n    }\n    return res;\n}\nfunction allowStateChangesStart(allowStateChanges) {\n    var prev = globalState.allowStateChanges;\n    globalState.allowStateChanges = allowStateChanges;\n    return prev;\n}\nfunction allowStateChangesEnd(prev) {\n    globalState.allowStateChanges = prev;\n}\nvar BaseAtom = function () {\n    function BaseAtom(name) {\n        if (name === void 0) {\n            name = \"Atom@\" + getNextId();\n        }\n        this.name = name;\n        this.isPendingUnobservation = true;\n        this.observers = [];\n        this.observersIndexes = {};\n        this.diffValue = 0;\n        this.lastAccessedBy = 0;\n        this.lowestObserverState = IDerivationState.NOT_TRACKING;\n    }\n    BaseAtom.prototype.onBecomeUnobserved = function () {};\n    BaseAtom.prototype.reportObserved = function () {\n        reportObserved(this);\n    };\n    BaseAtom.prototype.reportChanged = function () {\n        startBatch();\n        propagateChanged(this);\n        endBatch();\n    };\n    BaseAtom.prototype.toString = function () {\n        return this.name;\n    };\n    return BaseAtom;\n}();\nexports.BaseAtom = BaseAtom;\nvar Atom = function (_super) {\n    __extends(Atom, _super);\n    function Atom(name, onBecomeObservedHandler, onBecomeUnobservedHandler) {\n        if (name === void 0) {\n            name = \"Atom@\" + getNextId();\n        }\n        if (onBecomeObservedHandler === void 0) {\n            onBecomeObservedHandler = noop;\n        }\n        if (onBecomeUnobservedHandler === void 0) {\n            onBecomeUnobservedHandler = noop;\n        }\n        var _this = _super.call(this, name) || this;\n        _this.name = name;\n        _this.onBecomeObservedHandler = onBecomeObservedHandler;\n        _this.onBecomeUnobservedHandler = onBecomeUnobservedHandler;\n        _this.isPendingUnobservation = false;\n        _this.isBeingTracked = false;\n        return _this;\n    }\n    Atom.prototype.reportObserved = function () {\n        startBatch();\n        _super.prototype.reportObserved.call(this);\n        if (!this.isBeingTracked) {\n            this.isBeingTracked = true;\n            this.onBecomeObservedHandler();\n        }\n        endBatch();\n        return !!globalState.trackingDerivation;\n    };\n    Atom.prototype.onBecomeUnobserved = function () {\n        this.isBeingTracked = false;\n        this.onBecomeUnobservedHandler();\n    };\n    return Atom;\n}(BaseAtom);\nexports.Atom = Atom;\nvar isAtom = createInstanceofPredicate(\"Atom\", BaseAtom);\nvar ComputedValue = function () {\n    function ComputedValue(derivation, scope, compareStructural, name, setter) {\n        this.derivation = derivation;\n        this.scope = scope;\n        this.compareStructural = compareStructural;\n        this.dependenciesState = IDerivationState.NOT_TRACKING;\n        this.observing = [];\n        this.newObserving = null;\n        this.isPendingUnobservation = false;\n        this.observers = [];\n        this.observersIndexes = {};\n        this.diffValue = 0;\n        this.runId = 0;\n        this.lastAccessedBy = 0;\n        this.lowestObserverState = IDerivationState.UP_TO_DATE;\n        this.unboundDepsCount = 0;\n        this.__mapid = \"#\" + getNextId();\n        this.value = undefined;\n        this.isComputing = false;\n        this.isRunningSetter = false;\n        this.name = name || \"ComputedValue@\" + getNextId();\n        if (setter) this.setter = createAction(name + \"-setter\", setter);\n    }\n    ComputedValue.prototype.onBecomeStale = function () {\n        propagateMaybeChanged(this);\n    };\n    ComputedValue.prototype.onBecomeUnobserved = function () {\n        invariant(this.dependenciesState !== IDerivationState.NOT_TRACKING, getMessage(\"m029\"));\n        clearObserving(this);\n        this.value = undefined;\n    };\n    ComputedValue.prototype.get = function () {\n        invariant(!this.isComputing, \"Cycle detected in computation \" + this.name, this.derivation);\n        if (globalState.inBatch === 0) {\n            startBatch();\n            if (shouldCompute(this)) this.value = this.computeValue(false);\n            endBatch();\n        } else {\n            reportObserved(this);\n            if (shouldCompute(this)) if (this.trackAndCompute()) propagateChangeConfirmed(this);\n        }\n        var result = this.value;\n        if (isCaughtException(result)) throw result.cause;\n        return result;\n    };\n    ComputedValue.prototype.peek = function () {\n        var res = this.computeValue(false);\n        if (isCaughtException(res)) throw res.cause;\n        return res;\n    };\n    ComputedValue.prototype.set = function (value) {\n        if (this.setter) {\n            invariant(!this.isRunningSetter, \"The setter of computed value '\" + this.name + \"' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?\");\n            this.isRunningSetter = true;\n            try {\n                this.setter.call(this.scope, value);\n            } finally {\n                this.isRunningSetter = false;\n            }\n        } else invariant(false, \"[ComputedValue '\" + this.name + \"'] It is not possible to assign a new value to a computed value.\");\n    };\n    ComputedValue.prototype.trackAndCompute = function () {\n        if (isSpyEnabled()) {\n            spyReport({\n                object: this.scope,\n                type: \"compute\",\n                fn: this.derivation\n            });\n        }\n        var oldValue = this.value;\n        var newValue = this.value = this.computeValue(true);\n        return isCaughtException(newValue) || valueDidChange(this.compareStructural, newValue, oldValue);\n    };\n    ComputedValue.prototype.computeValue = function (track) {\n        this.isComputing = true;\n        globalState.computationDepth++;\n        var res;\n        if (track) {\n            res = trackDerivedFunction(this, this.derivation, this.scope);\n        } else {\n            try {\n                res = this.derivation.call(this.scope);\n            } catch (e) {\n                res = new CaughtException(e);\n            }\n        }\n        globalState.computationDepth--;\n        this.isComputing = false;\n        return res;\n    };\n    ;\n    ComputedValue.prototype.observe = function (listener, fireImmediately) {\n        var _this = this;\n        var firstTime = true;\n        var prevValue = undefined;\n        return autorun(function () {\n            var newValue = _this.get();\n            if (!firstTime || fireImmediately) {\n                var prevU = untrackedStart();\n                listener({\n                    type: \"update\",\n                    object: _this,\n                    newValue: newValue,\n                    oldValue: prevValue\n                });\n                untrackedEnd(prevU);\n            }\n            firstTime = false;\n            prevValue = newValue;\n        });\n    };\n    ComputedValue.prototype.toJSON = function () {\n        return this.get();\n    };\n    ComputedValue.prototype.toString = function () {\n        return this.name + \"[\" + this.derivation.toString() + \"]\";\n    };\n    ComputedValue.prototype.valueOf = function () {\n        return toPrimitive(this.get());\n    };\n    ;\n    ComputedValue.prototype.whyRun = function () {\n        var isTracking = Boolean(globalState.trackingDerivation);\n        var observing = unique(this.isComputing ? this.newObserving : this.observing).map(function (dep) {\n            return dep.name;\n        });\n        var observers = unique(getObservers(this).map(function (dep) {\n            return dep.name;\n        }));\n        return \"\\nWhyRun? computation '\" + this.name + \"':\\n * Running because: \" + (isTracking ? \"[active] the value of this computation is needed by a reaction\" : this.isComputing ? \"[get] The value of this computed was requested outside a reaction\" : \"[idle] not running at the moment\") + \"\\n\" + (this.dependenciesState === IDerivationState.NOT_TRACKING ? getMessage(\"m032\") : \" * This computation will re-run if any of the following observables changes:\\n    \" + joinStrings(observing) + \"\\n    \" + (this.isComputing && isTracking ? \" (... or any observable accessed during the remainder of the current run)\" : \"\") + \"\\n\\t\" + getMessage(\"m038\") + \"\\n\\n  * If the outcome of this computation changes, the following observers will be re-run:\\n    \" + joinStrings(observers) + \"\\n\");\n    };\n    return ComputedValue;\n}();\nComputedValue.prototype[primitiveSymbol()] = ComputedValue.prototype.valueOf;\nvar isComputedValue = createInstanceofPredicate(\"ComputedValue\", ComputedValue);\nvar IDerivationState;\n(function (IDerivationState) {\n    IDerivationState[IDerivationState[\"NOT_TRACKING\"] = -1] = \"NOT_TRACKING\";\n    IDerivationState[IDerivationState[\"UP_TO_DATE\"] = 0] = \"UP_TO_DATE\";\n    IDerivationState[IDerivationState[\"POSSIBLY_STALE\"] = 1] = \"POSSIBLY_STALE\";\n    IDerivationState[IDerivationState[\"STALE\"] = 2] = \"STALE\";\n})(IDerivationState || (IDerivationState = {}));\nexports.IDerivationState = IDerivationState;\nvar CaughtException = function () {\n    function CaughtException(cause) {\n        this.cause = cause;\n    }\n    return CaughtException;\n}();\nfunction isCaughtException(e) {\n    return e instanceof CaughtException;\n}\nfunction shouldCompute(derivation) {\n    switch (derivation.dependenciesState) {\n        case IDerivationState.UP_TO_DATE:\n            return false;\n        case IDerivationState.NOT_TRACKING:\n        case IDerivationState.STALE:\n            return true;\n        case IDerivationState.POSSIBLY_STALE:\n            {\n                var prevUntracked = untrackedStart();\n                var obs = derivation.observing,\n                    l = obs.length;\n                for (var i = 0; i < l; i++) {\n                    var obj = obs[i];\n                    if (isComputedValue(obj)) {\n                        try {\n                            obj.get();\n                        } catch (e) {\n                            untrackedEnd(prevUntracked);\n                            return true;\n                        }\n                        if (derivation.dependenciesState === IDerivationState.STALE) {\n                            untrackedEnd(prevUntracked);\n                            return true;\n                        }\n                    }\n                }\n                changeDependenciesStateTo0(derivation);\n                untrackedEnd(prevUntracked);\n                return false;\n            }\n    }\n}\nfunction isComputingDerivation() {\n    return globalState.trackingDerivation !== null;\n}\nfunction checkIfStateModificationsAreAllowed(atom) {\n    var hasObservers = atom.observers.length > 0;\n    if (globalState.computationDepth > 0 && hasObservers) fail(getMessage(\"m031\") + atom.name);\n    if (!globalState.allowStateChanges && hasObservers) fail(getMessage(globalState.strictMode ? \"m030a\" : \"m030b\") + atom.name);\n}\nfunction trackDerivedFunction(derivation, f, context) {\n    changeDependenciesStateTo0(derivation);\n    derivation.newObserving = new Array(derivation.observing.length + 100);\n    derivation.unboundDepsCount = 0;\n    derivation.runId = ++globalState.runId;\n    var prevTracking = globalState.trackingDerivation;\n    globalState.trackingDerivation = derivation;\n    var result;\n    try {\n        result = f.call(context);\n    } catch (e) {\n        result = new CaughtException(e);\n    }\n    globalState.trackingDerivation = prevTracking;\n    bindDependencies(derivation);\n    return result;\n}\nfunction bindDependencies(derivation) {\n    var prevObserving = derivation.observing;\n    var observing = derivation.observing = derivation.newObserving;\n    derivation.newObserving = null;\n    var i0 = 0,\n        l = derivation.unboundDepsCount;\n    for (var i = 0; i < l; i++) {\n        var dep = observing[i];\n        if (dep.diffValue === 0) {\n            dep.diffValue = 1;\n            if (i0 !== i) observing[i0] = dep;\n            i0++;\n        }\n    }\n    observing.length = i0;\n    l = prevObserving.length;\n    while (l--) {\n        var dep = prevObserving[l];\n        if (dep.diffValue === 0) {\n            removeObserver(dep, derivation);\n        }\n        dep.diffValue = 0;\n    }\n    while (i0--) {\n        var dep = observing[i0];\n        if (dep.diffValue === 1) {\n            dep.diffValue = 0;\n            addObserver(dep, derivation);\n        }\n    }\n}\nfunction clearObserving(derivation) {\n    var obs = derivation.observing;\n    var i = obs.length;\n    while (i--) {\n        removeObserver(obs[i], derivation);\n    }derivation.dependenciesState = IDerivationState.NOT_TRACKING;\n    obs.length = 0;\n}\nfunction untracked(action) {\n    var prev = untrackedStart();\n    var res = action();\n    untrackedEnd(prev);\n    return res;\n}\nexports.untracked = untracked;\nfunction untrackedStart() {\n    var prev = globalState.trackingDerivation;\n    globalState.trackingDerivation = null;\n    return prev;\n}\nfunction untrackedEnd(prev) {\n    globalState.trackingDerivation = prev;\n}\nfunction changeDependenciesStateTo0(derivation) {\n    if (derivation.dependenciesState === IDerivationState.UP_TO_DATE) return;\n    derivation.dependenciesState = IDerivationState.UP_TO_DATE;\n    var obs = derivation.observing;\n    var i = obs.length;\n    while (i--) {\n        obs[i].lowestObserverState = IDerivationState.UP_TO_DATE;\n    }\n}\nvar persistentKeys = [\"mobxGuid\", \"resetId\", \"spyListeners\", \"strictMode\", \"runId\"];\nvar MobXGlobals = function () {\n    function MobXGlobals() {\n        this.version = 5;\n        this.trackingDerivation = null;\n        this.computationDepth = 0;\n        this.runId = 0;\n        this.mobxGuid = 0;\n        this.inBatch = 0;\n        this.pendingUnobservations = [];\n        this.pendingReactions = [];\n        this.isRunningReactions = false;\n        this.allowStateChanges = true;\n        this.strictMode = false;\n        this.resetId = 0;\n        this.spyListeners = [];\n        this.globalReactionErrorHandlers = [];\n    }\n    return MobXGlobals;\n}();\nvar globalState = new MobXGlobals();\nfunction shareGlobalState() {\n    var global = getGlobal();\n    var ownState = globalState;\n    if (global.__mobservableTrackingStack || global.__mobservableViewStack) throw new Error(\"[mobx] An incompatible version of mobservable is already loaded.\");\n    if (global.__mobxGlobal && global.__mobxGlobal.version !== ownState.version) throw new Error(\"[mobx] An incompatible version of mobx is already loaded.\");\n    if (global.__mobxGlobal) globalState = global.__mobxGlobal;else global.__mobxGlobal = ownState;\n}\nfunction getGlobalState() {\n    return globalState;\n}\nfunction registerGlobals() {}\nfunction resetGlobalState() {\n    globalState.resetId++;\n    var defaultGlobals = new MobXGlobals();\n    for (var key in defaultGlobals) {\n        if (persistentKeys.indexOf(key) === -1) globalState[key] = defaultGlobals[key];\n    }globalState.allowStateChanges = !globalState.strictMode;\n}\nfunction hasObservers(observable) {\n    return observable.observers && observable.observers.length > 0;\n}\nfunction getObservers(observable) {\n    return observable.observers;\n}\nfunction invariantObservers(observable) {\n    var list = observable.observers;\n    var map = observable.observersIndexes;\n    var l = list.length;\n    for (var i = 0; i < l; i++) {\n        var id = list[i].__mapid;\n        if (i) {\n            invariant(map[id] === i, \"INTERNAL ERROR maps derivation.__mapid to index in list\");\n        } else {\n            invariant(!(id in map), \"INTERNAL ERROR observer on index 0 shouldnt be held in map.\");\n        }\n    }\n    invariant(list.length === 0 || Object.keys(map).length === list.length - 1, \"INTERNAL ERROR there is no junk in map\");\n}\nfunction addObserver(observable, node) {\n    var l = observable.observers.length;\n    if (l) {\n        observable.observersIndexes[node.__mapid] = l;\n    }\n    observable.observers[l] = node;\n    if (observable.lowestObserverState > node.dependenciesState) observable.lowestObserverState = node.dependenciesState;\n}\nfunction removeObserver(observable, node) {\n    if (observable.observers.length === 1) {\n        observable.observers.length = 0;\n        queueForUnobservation(observable);\n    } else {\n        var list = observable.observers;\n        var map_1 = observable.observersIndexes;\n        var filler = list.pop();\n        if (filler !== node) {\n            var index = map_1[node.__mapid] || 0;\n            if (index) {\n                map_1[filler.__mapid] = index;\n            } else {\n                delete map_1[filler.__mapid];\n            }\n            list[index] = filler;\n        }\n        delete map_1[node.__mapid];\n    }\n}\nfunction queueForUnobservation(observable) {\n    if (!observable.isPendingUnobservation) {\n        observable.isPendingUnobservation = true;\n        globalState.pendingUnobservations.push(observable);\n    }\n}\nfunction startBatch() {\n    globalState.inBatch++;\n}\nfunction endBatch() {\n    if (--globalState.inBatch === 0) {\n        runReactions();\n        var list = globalState.pendingUnobservations;\n        for (var i = 0; i < list.length; i++) {\n            var observable_1 = list[i];\n            observable_1.isPendingUnobservation = false;\n            if (observable_1.observers.length === 0) {\n                observable_1.onBecomeUnobserved();\n            }\n        }\n        globalState.pendingUnobservations = [];\n    }\n}\nfunction reportObserved(observable) {\n    var derivation = globalState.trackingDerivation;\n    if (derivation !== null) {\n        if (derivation.runId !== observable.lastAccessedBy) {\n            observable.lastAccessedBy = derivation.runId;\n            derivation.newObserving[derivation.unboundDepsCount++] = observable;\n        }\n    } else if (observable.observers.length === 0) {\n        queueForUnobservation(observable);\n    }\n}\nfunction invariantLOS(observable, msg) {\n    var min = getObservers(observable).reduce(function (a, b) {\n        return Math.min(a, b.dependenciesState);\n    }, 2);\n    if (min >= observable.lowestObserverState) return;\n    throw new Error(\"lowestObserverState is wrong for \" + msg + \" because \" + min + \" < \" + observable.lowestObserverState);\n}\nfunction propagateChanged(observable) {\n    if (observable.lowestObserverState === IDerivationState.STALE) return;\n    observable.lowestObserverState = IDerivationState.STALE;\n    var observers = observable.observers;\n    var i = observers.length;\n    while (i--) {\n        var d = observers[i];\n        if (d.dependenciesState === IDerivationState.UP_TO_DATE) d.onBecomeStale();\n        d.dependenciesState = IDerivationState.STALE;\n    }\n}\nfunction propagateChangeConfirmed(observable) {\n    if (observable.lowestObserverState === IDerivationState.STALE) return;\n    observable.lowestObserverState = IDerivationState.STALE;\n    var observers = observable.observers;\n    var i = observers.length;\n    while (i--) {\n        var d = observers[i];\n        if (d.dependenciesState === IDerivationState.POSSIBLY_STALE) d.dependenciesState = IDerivationState.STALE;else if (d.dependenciesState === IDerivationState.UP_TO_DATE) observable.lowestObserverState = IDerivationState.UP_TO_DATE;\n    }\n}\nfunction propagateMaybeChanged(observable) {\n    if (observable.lowestObserverState !== IDerivationState.UP_TO_DATE) return;\n    observable.lowestObserverState = IDerivationState.POSSIBLY_STALE;\n    var observers = observable.observers;\n    var i = observers.length;\n    while (i--) {\n        var d = observers[i];\n        if (d.dependenciesState === IDerivationState.UP_TO_DATE) {\n            d.dependenciesState = IDerivationState.POSSIBLY_STALE;\n            d.onBecomeStale();\n        }\n    }\n}\nvar Reaction = function () {\n    function Reaction(name, onInvalidate) {\n        if (name === void 0) {\n            name = \"Reaction@\" + getNextId();\n        }\n        this.name = name;\n        this.onInvalidate = onInvalidate;\n        this.observing = [];\n        this.newObserving = [];\n        this.dependenciesState = IDerivationState.NOT_TRACKING;\n        this.diffValue = 0;\n        this.runId = 0;\n        this.unboundDepsCount = 0;\n        this.__mapid = \"#\" + getNextId();\n        this.isDisposed = false;\n        this._isScheduled = false;\n        this._isTrackPending = false;\n        this._isRunning = false;\n    }\n    Reaction.prototype.onBecomeStale = function () {\n        this.schedule();\n    };\n    Reaction.prototype.schedule = function () {\n        if (!this._isScheduled) {\n            this._isScheduled = true;\n            globalState.pendingReactions.push(this);\n            runReactions();\n        }\n    };\n    Reaction.prototype.isScheduled = function () {\n        return this._isScheduled;\n    };\n    Reaction.prototype.runReaction = function () {\n        if (!this.isDisposed) {\n            startBatch();\n            this._isScheduled = false;\n            if (shouldCompute(this)) {\n                this._isTrackPending = true;\n                this.onInvalidate();\n                if (this._isTrackPending && isSpyEnabled()) {\n                    spyReport({\n                        object: this,\n                        type: \"scheduled-reaction\"\n                    });\n                }\n            }\n            endBatch();\n        }\n    };\n    Reaction.prototype.track = function (fn) {\n        startBatch();\n        var notify = isSpyEnabled();\n        var startTime;\n        if (notify) {\n            startTime = Date.now();\n            spyReportStart({\n                object: this,\n                type: \"reaction\",\n                fn: fn\n            });\n        }\n        this._isRunning = true;\n        var result = trackDerivedFunction(this, fn, undefined);\n        this._isRunning = false;\n        this._isTrackPending = false;\n        if (this.isDisposed) {\n            clearObserving(this);\n        }\n        if (isCaughtException(result)) this.reportExceptionInDerivation(result.cause);\n        if (notify) {\n            spyReportEnd({\n                time: Date.now() - startTime\n            });\n        }\n        endBatch();\n    };\n    Reaction.prototype.reportExceptionInDerivation = function (error) {\n        var _this = this;\n        if (this.errorHandler) {\n            this.errorHandler(error, this);\n            return;\n        }\n        var message = \"[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '\" + this;\n        var messageToUser = getMessage(\"m037\");\n        console.error(message || messageToUser, error);\n        if (isSpyEnabled()) {\n            spyReport({\n                type: \"error\",\n                message: message,\n                error: error,\n                object: this\n            });\n        }\n        globalState.globalReactionErrorHandlers.forEach(function (f) {\n            return f(error, _this);\n        });\n    };\n    Reaction.prototype.dispose = function () {\n        if (!this.isDisposed) {\n            this.isDisposed = true;\n            if (!this._isRunning) {\n                startBatch();\n                clearObserving(this);\n                endBatch();\n            }\n        }\n    };\n    Reaction.prototype.getDisposer = function () {\n        var r = this.dispose.bind(this);\n        r.$mobx = this;\n        r.onError = registerErrorHandler;\n        return r;\n    };\n    Reaction.prototype.toString = function () {\n        return \"Reaction[\" + this.name + \"]\";\n    };\n    Reaction.prototype.whyRun = function () {\n        var observing = unique(this._isRunning ? this.newObserving : this.observing).map(function (dep) {\n            return dep.name;\n        });\n        return \"\\nWhyRun? reaction '\" + this.name + \"':\\n * Status: [\" + (this.isDisposed ? \"stopped\" : this._isRunning ? \"running\" : this.isScheduled() ? \"scheduled\" : \"idle\") + \"]\\n * This reaction will re-run if any of the following observables changes:\\n    \" + joinStrings(observing) + \"\\n    \" + (this._isRunning ? \" (... or any observable accessed during the remainder of the current run)\" : \"\") + \"\\n\\t\" + getMessage(\"m038\") + \"\\n\";\n    };\n    return Reaction;\n}();\nexports.Reaction = Reaction;\nfunction registerErrorHandler(handler) {\n    invariant(this && this.$mobx && isReaction(this.$mobx), \"Invalid `this`\");\n    invariant(!this.$mobx.errorHandler, \"Only one onErrorHandler can be registered\");\n    this.$mobx.errorHandler = handler;\n}\nfunction onReactionError(handler) {\n    globalState.globalReactionErrorHandlers.push(handler);\n    return function () {\n        var idx = globalState.globalReactionErrorHandlers.indexOf(handler);\n        if (idx >= 0) globalState.globalReactionErrorHandlers.splice(idx, 1);\n    };\n}\nvar MAX_REACTION_ITERATIONS = 100;\nvar reactionScheduler = function reactionScheduler(f) {\n    return f();\n};\nfunction runReactions() {\n    if (globalState.inBatch > 0 || globalState.isRunningReactions) return;\n    reactionScheduler(runReactionsHelper);\n}\nfunction runReactionsHelper() {\n    globalState.isRunningReactions = true;\n    var allReactions = globalState.pendingReactions;\n    var iterations = 0;\n    while (allReactions.length > 0) {\n        if (++iterations === MAX_REACTION_ITERATIONS) {\n            console.error(\"Reaction doesn't converge to a stable state after \" + MAX_REACTION_ITERATIONS + \" iterations.\" + (\" Probably there is a cycle in the reactive function: \" + allReactions[0]));\n            allReactions.splice(0);\n        }\n        var remainingReactions = allReactions.splice(0);\n        for (var i = 0, l = remainingReactions.length; i < l; i++) {\n            remainingReactions[i].runReaction();\n        }\n    }\n    globalState.isRunningReactions = false;\n}\nvar isReaction = createInstanceofPredicate(\"Reaction\", Reaction);\nfunction setReactionScheduler(fn) {\n    var baseScheduler = reactionScheduler;\n    reactionScheduler = function reactionScheduler(f) {\n        return fn(function () {\n            return baseScheduler(f);\n        });\n    };\n}\nfunction isSpyEnabled() {\n    return !!globalState.spyListeners.length;\n}\nfunction spyReport(event) {\n    if (!globalState.spyListeners.length) return;\n    var listeners = globalState.spyListeners;\n    for (var i = 0, l = listeners.length; i < l; i++) {\n        listeners[i](event);\n    }\n}\nfunction spyReportStart(event) {\n    var change = objectAssign({}, event, { spyReportStart: true });\n    spyReport(change);\n}\nvar END_EVENT = { spyReportEnd: true };\nfunction spyReportEnd(change) {\n    if (change) spyReport(objectAssign({}, change, END_EVENT));else spyReport(END_EVENT);\n}\nfunction spy(listener) {\n    globalState.spyListeners.push(listener);\n    return once(function () {\n        var idx = globalState.spyListeners.indexOf(listener);\n        if (idx !== -1) globalState.spyListeners.splice(idx, 1);\n    });\n}\nexports.spy = spy;\nfunction hasInterceptors(interceptable) {\n    return interceptable.interceptors && interceptable.interceptors.length > 0;\n}\nfunction registerInterceptor(interceptable, handler) {\n    var interceptors = interceptable.interceptors || (interceptable.interceptors = []);\n    interceptors.push(handler);\n    return once(function () {\n        var idx = interceptors.indexOf(handler);\n        if (idx !== -1) interceptors.splice(idx, 1);\n    });\n}\nfunction interceptChange(interceptable, change) {\n    var prevU = untrackedStart();\n    try {\n        var interceptors = interceptable.interceptors;\n        if (interceptors) for (var i = 0, l = interceptors.length; i < l; i++) {\n            change = interceptors[i](change);\n            invariant(!change || change.type, \"Intercept handlers should return nothing or a change object\");\n            if (!change) break;\n        }\n        return change;\n    } finally {\n        untrackedEnd(prevU);\n    }\n}\nfunction hasListeners(listenable) {\n    return listenable.changeListeners && listenable.changeListeners.length > 0;\n}\nfunction registerListener(listenable, handler) {\n    var listeners = listenable.changeListeners || (listenable.changeListeners = []);\n    listeners.push(handler);\n    return once(function () {\n        var idx = listeners.indexOf(handler);\n        if (idx !== -1) listeners.splice(idx, 1);\n    });\n}\nfunction notifyListeners(listenable, change) {\n    var prevU = untrackedStart();\n    var listeners = listenable.changeListeners;\n    if (!listeners) return;\n    listeners = listeners.slice();\n    for (var i = 0, l = listeners.length; i < l; i++) {\n        listeners[i](change);\n    }\n    untrackedEnd(prevU);\n}\nfunction asReference(value) {\n    deprecated(\"asReference is deprecated, use observable.ref instead\");\n    return observable.ref(value);\n}\nexports.asReference = asReference;\nfunction asStructure(value) {\n    deprecated(\"asStructure is deprecated. Use observable.struct, computed.struct or reaction options instead.\");\n    return observable.struct(value);\n}\nexports.asStructure = asStructure;\nfunction asFlat(value) {\n    deprecated(\"asFlat is deprecated, use observable.shallow instead\");\n    return observable.shallow(value);\n}\nexports.asFlat = asFlat;\nfunction asMap(data) {\n    deprecated(\"asMap is deprecated, use observable.map or observable.shallowMap instead\");\n    return observable.map(data || {});\n}\nexports.asMap = asMap;\nfunction isModifierDescriptor(thing) {\n    return (typeof thing === \"undefined\" ? \"undefined\" : _typeof(thing)) === \"object\" && thing !== null && thing.isMobxModifierDescriptor === true;\n}\nexports.isModifierDescriptor = isModifierDescriptor;\nfunction createModifierDescriptor(enhancer, initialValue) {\n    invariant(!isModifierDescriptor(initialValue), \"Modifiers cannot be nested\");\n    return {\n        isMobxModifierDescriptor: true,\n        initialValue: initialValue,\n        enhancer: enhancer\n    };\n}\nfunction deepEnhancer(v, _, name) {\n    if (isModifierDescriptor(v)) fail(\"You tried to assign a modifier wrapped value to a collection, please define modifiers when creating the collection, not when modifying it\");\n    if (isObservable(v)) return v;\n    if (Array.isArray(v)) return observable.array(v, name);\n    if (isPlainObject(v)) return observable.object(v, name);\n    if (isES6Map(v)) return observable.map(v, name);\n    return v;\n}\nfunction shallowEnhancer(v, _, name) {\n    if (isModifierDescriptor(v)) fail(\"You tried to assign a modifier wrapped value to a collection, please define modifiers when creating the collection, not when modifying it\");\n    if (v === undefined || v === null) return v;\n    if (isObservableObject(v) || isObservableArray(v) || isObservableMap(v)) return v;\n    if (Array.isArray(v)) return observable.shallowArray(v, name);\n    if (isPlainObject(v)) return observable.shallowObject(v, name);\n    if (isES6Map(v)) return observable.shallowMap(v, name);\n    return fail(\"The shallow modifier / decorator can only used in combination with arrays, objects and maps\");\n}\nfunction referenceEnhancer(newValue) {\n    return newValue;\n}\nfunction deepStructEnhancer(v, oldValue, name) {\n    if (deepEqual(v, oldValue)) return oldValue;\n    if (isObservable(v)) return v;\n    if (Array.isArray(v)) return new ObservableArray(v, deepStructEnhancer, name);\n    if (isES6Map(v)) return new ObservableMap(v, deepStructEnhancer, name);\n    if (isPlainObject(v)) {\n        var res = {};\n        asObservableObject(res, name);\n        extendObservableHelper(res, deepStructEnhancer, [v]);\n        return res;\n    }\n    return v;\n}\nfunction refStructEnhancer(v, oldValue, name) {\n    if (deepEqual(v, oldValue)) return oldValue;\n    return v;\n}\nvar MAX_SPLICE_SIZE = 10000;\nvar safariPrototypeSetterInheritanceBug = function () {\n    var v = false;\n    var p = {};\n    Object.defineProperty(p, \"0\", { set: function set() {\n            v = true;\n        } });\n    Object.create(p)[\"0\"] = 1;\n    return v === false;\n}();\nvar OBSERVABLE_ARRAY_BUFFER_SIZE = 0;\nvar StubArray = function () {\n    function StubArray() {}\n    return StubArray;\n}();\nStubArray.prototype = [];\nvar ObservableArrayAdministration = function () {\n    function ObservableArrayAdministration(name, enhancer, array, owned) {\n        this.array = array;\n        this.owned = owned;\n        this.lastKnownLength = 0;\n        this.interceptors = null;\n        this.changeListeners = null;\n        this.atom = new BaseAtom(name || \"ObservableArray@\" + getNextId());\n        this.enhancer = function (newV, oldV) {\n            return enhancer(newV, oldV, name + \"[..]\");\n        };\n    }\n    ObservableArrayAdministration.prototype.intercept = function (handler) {\n        return registerInterceptor(this, handler);\n    };\n    ObservableArrayAdministration.prototype.observe = function (listener, fireImmediately) {\n        if (fireImmediately === void 0) {\n            fireImmediately = false;\n        }\n        if (fireImmediately) {\n            listener({\n                object: this.array,\n                type: \"splice\",\n                index: 0,\n                added: this.values.slice(),\n                addedCount: this.values.length,\n                removed: [],\n                removedCount: 0\n            });\n        }\n        return registerListener(this, listener);\n    };\n    ObservableArrayAdministration.prototype.getArrayLength = function () {\n        this.atom.reportObserved();\n        return this.values.length;\n    };\n    ObservableArrayAdministration.prototype.setArrayLength = function (newLength) {\n        if (typeof newLength !== \"number\" || newLength < 0) throw new Error(\"[mobx.array] Out of range: \" + newLength);\n        var currentLength = this.values.length;\n        if (newLength === currentLength) return;else if (newLength > currentLength) {\n            var newItems = new Array(newLength - currentLength);\n            for (var i = 0; i < newLength - currentLength; i++) {\n                newItems[i] = undefined;\n            }this.spliceWithArray(currentLength, 0, newItems);\n        } else this.spliceWithArray(newLength, currentLength - newLength);\n    };\n    ObservableArrayAdministration.prototype.updateArrayLength = function (oldLength, delta) {\n        if (oldLength !== this.lastKnownLength) throw new Error(\"[mobx] Modification exception: the internal structure of an observable array was changed. Did you use peek() to change it?\");\n        this.lastKnownLength += delta;\n        if (delta > 0 && oldLength + delta + 1 > OBSERVABLE_ARRAY_BUFFER_SIZE) reserveArrayBuffer(oldLength + delta + 1);\n    };\n    ObservableArrayAdministration.prototype.spliceWithArray = function (index, deleteCount, newItems) {\n        var _this = this;\n        checkIfStateModificationsAreAllowed(this.atom);\n        var length = this.values.length;\n        if (index === undefined) index = 0;else if (index > length) index = length;else if (index < 0) index = Math.max(0, length + index);\n        if (arguments.length === 1) deleteCount = length - index;else if (deleteCount === undefined || deleteCount === null) deleteCount = 0;else deleteCount = Math.max(0, Math.min(deleteCount, length - index));\n        if (newItems === undefined) newItems = [];\n        if (hasInterceptors(this)) {\n            var change = interceptChange(this, {\n                object: this.array,\n                type: \"splice\",\n                index: index,\n                removedCount: deleteCount,\n                added: newItems\n            });\n            if (!change) return EMPTY_ARRAY;\n            deleteCount = change.removedCount;\n            newItems = change.added;\n        }\n        newItems = newItems.map(function (v) {\n            return _this.enhancer(v, undefined);\n        });\n        var lengthDelta = newItems.length - deleteCount;\n        this.updateArrayLength(length, lengthDelta);\n        var res = this.spliceItemsIntoValues(index, deleteCount, newItems);\n        if (deleteCount !== 0 || newItems.length !== 0) this.notifyArraySplice(index, newItems, res);\n        return res;\n    };\n    ObservableArrayAdministration.prototype.spliceItemsIntoValues = function (index, deleteCount, newItems) {\n        if (newItems.length < MAX_SPLICE_SIZE) {\n            return (_a = this.values).splice.apply(_a, [index, deleteCount].concat(newItems));\n        } else {\n            var res = this.values.slice(index, index + deleteCount);\n            this.values = this.values.slice(0, index).concat(newItems, this.values.slice(index + deleteCount));\n            return res;\n        }\n        var _a;\n    };\n    ObservableArrayAdministration.prototype.notifyArrayChildUpdate = function (index, newValue, oldValue) {\n        var notifySpy = !this.owned && isSpyEnabled();\n        var notify = hasListeners(this);\n        var change = notify || notifySpy ? {\n            object: this.array,\n            type: \"update\",\n            index: index, newValue: newValue, oldValue: oldValue\n        } : null;\n        if (notifySpy) spyReportStart(change);\n        this.atom.reportChanged();\n        if (notify) notifyListeners(this, change);\n        if (notifySpy) spyReportEnd();\n    };\n    ObservableArrayAdministration.prototype.notifyArraySplice = function (index, added, removed) {\n        var notifySpy = !this.owned && isSpyEnabled();\n        var notify = hasListeners(this);\n        var change = notify || notifySpy ? {\n            object: this.array,\n            type: \"splice\",\n            index: index, removed: removed, added: added,\n            removedCount: removed.length,\n            addedCount: added.length\n        } : null;\n        if (notifySpy) spyReportStart(change);\n        this.atom.reportChanged();\n        if (notify) notifyListeners(this, change);\n        if (notifySpy) spyReportEnd();\n    };\n    return ObservableArrayAdministration;\n}();\nvar ObservableArray = function (_super) {\n    __extends(ObservableArray, _super);\n    function ObservableArray(initialValues, enhancer, name, owned) {\n        if (name === void 0) {\n            name = \"ObservableArray@\" + getNextId();\n        }\n        if (owned === void 0) {\n            owned = false;\n        }\n        var _this = _super.call(this) || this;\n        var adm = new ObservableArrayAdministration(name, enhancer, _this, owned);\n        addHiddenFinalProp(_this, \"$mobx\", adm);\n        if (initialValues && initialValues.length) {\n            adm.updateArrayLength(0, initialValues.length);\n            adm.values = initialValues.map(function (v) {\n                return enhancer(v, undefined, name + \"[..]\");\n            });\n            adm.notifyArraySplice(0, adm.values.slice(), EMPTY_ARRAY);\n        } else {\n            adm.values = [];\n        }\n        if (safariPrototypeSetterInheritanceBug) {\n            Object.defineProperty(adm.array, \"0\", ENTRY_0);\n        }\n        return _this;\n    }\n    ObservableArray.prototype.intercept = function (handler) {\n        return this.$mobx.intercept(handler);\n    };\n    ObservableArray.prototype.observe = function (listener, fireImmediately) {\n        if (fireImmediately === void 0) {\n            fireImmediately = false;\n        }\n        return this.$mobx.observe(listener, fireImmediately);\n    };\n    ObservableArray.prototype.clear = function () {\n        return this.splice(0);\n    };\n    ObservableArray.prototype.concat = function () {\n        var arrays = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            arrays[_i] = arguments[_i];\n        }\n        this.$mobx.atom.reportObserved();\n        return Array.prototype.concat.apply(this.peek(), arrays.map(function (a) {\n            return isObservableArray(a) ? a.peek() : a;\n        }));\n    };\n    ObservableArray.prototype.replace = function (newItems) {\n        return this.$mobx.spliceWithArray(0, this.$mobx.values.length, newItems);\n    };\n    ObservableArray.prototype.toJS = function () {\n        return this.slice();\n    };\n    ObservableArray.prototype.toJSON = function () {\n        return this.toJS();\n    };\n    ObservableArray.prototype.peek = function () {\n        return this.$mobx.values;\n    };\n    ObservableArray.prototype.find = function (predicate, thisArg, fromIndex) {\n        if (fromIndex === void 0) {\n            fromIndex = 0;\n        }\n        this.$mobx.atom.reportObserved();\n        var items = this.$mobx.values,\n            l = items.length;\n        for (var i = fromIndex; i < l; i++) {\n            if (predicate.call(thisArg, items[i], i, this)) return items[i];\n        }return undefined;\n    };\n    ObservableArray.prototype.splice = function (index, deleteCount) {\n        var newItems = [];\n        for (var _i = 2; _i < arguments.length; _i++) {\n            newItems[_i - 2] = arguments[_i];\n        }\n        switch (arguments.length) {\n            case 0:\n                return [];\n            case 1:\n                return this.$mobx.spliceWithArray(index);\n            case 2:\n                return this.$mobx.spliceWithArray(index, deleteCount);\n        }\n        return this.$mobx.spliceWithArray(index, deleteCount, newItems);\n    };\n    ObservableArray.prototype.spliceWithArray = function (index, deleteCount, newItems) {\n        return this.$mobx.spliceWithArray(index, deleteCount, newItems);\n    };\n    ObservableArray.prototype.push = function () {\n        var items = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            items[_i] = arguments[_i];\n        }\n        var adm = this.$mobx;\n        adm.spliceWithArray(adm.values.length, 0, items);\n        return adm.values.length;\n    };\n    ObservableArray.prototype.pop = function () {\n        return this.splice(Math.max(this.$mobx.values.length - 1, 0), 1)[0];\n    };\n    ObservableArray.prototype.shift = function () {\n        return this.splice(0, 1)[0];\n    };\n    ObservableArray.prototype.unshift = function () {\n        var items = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            items[_i] = arguments[_i];\n        }\n        var adm = this.$mobx;\n        adm.spliceWithArray(0, 0, items);\n        return adm.values.length;\n    };\n    ObservableArray.prototype.reverse = function () {\n        this.$mobx.atom.reportObserved();\n        var clone = this.slice();\n        return clone.reverse.apply(clone, arguments);\n    };\n    ObservableArray.prototype.sort = function (compareFn) {\n        this.$mobx.atom.reportObserved();\n        var clone = this.slice();\n        return clone.sort.apply(clone, arguments);\n    };\n    ObservableArray.prototype.remove = function (value) {\n        var idx = this.$mobx.values.indexOf(value);\n        if (idx > -1) {\n            this.splice(idx, 1);\n            return true;\n        }\n        return false;\n    };\n    ObservableArray.prototype.move = function (fromIndex, toIndex) {\n        function checkIndex(index) {\n            if (index < 0) {\n                throw new Error(\"[mobx.array] Index out of bounds: \" + index + \" is negative\");\n            }\n            var length = this.$mobx.values.length;\n            if (index >= length) {\n                throw new Error(\"[mobx.array] Index out of bounds: \" + index + \" is not smaller than \" + length);\n            }\n        }\n        checkIndex.call(this, fromIndex);\n        checkIndex.call(this, toIndex);\n        if (fromIndex === toIndex) {\n            return;\n        }\n        var oldItems = this.$mobx.values;\n        var newItems;\n        if (fromIndex < toIndex) {\n            newItems = oldItems.slice(0, fromIndex).concat(oldItems.slice(fromIndex + 1, toIndex + 1), [oldItems[fromIndex]], oldItems.slice(toIndex + 1));\n        } else {\n            newItems = oldItems.slice(0, toIndex).concat([oldItems[fromIndex]], oldItems.slice(toIndex, fromIndex), oldItems.slice(fromIndex + 1));\n        }\n        this.replace(newItems);\n    };\n    ObservableArray.prototype.toString = function () {\n        this.$mobx.atom.reportObserved();\n        return Array.prototype.toString.apply(this.$mobx.values, arguments);\n    };\n    ObservableArray.prototype.toLocaleString = function () {\n        this.$mobx.atom.reportObserved();\n        return Array.prototype.toLocaleString.apply(this.$mobx.values, arguments);\n    };\n    return ObservableArray;\n}(StubArray);\ndeclareIterator(ObservableArray.prototype, function () {\n    return arrayAsIterator(this.slice());\n});\nmakeNonEnumerable(ObservableArray.prototype, [\"constructor\", \"intercept\", \"observe\", \"clear\", \"concat\", \"replace\", \"toJS\", \"toJSON\", \"peek\", \"find\", \"splice\", \"spliceWithArray\", \"push\", \"pop\", \"shift\", \"unshift\", \"reverse\", \"sort\", \"remove\", \"move\", \"toString\", \"toLocaleString\"]);\nObject.defineProperty(ObservableArray.prototype, \"length\", {\n    enumerable: false,\n    configurable: true,\n    get: function get() {\n        return this.$mobx.getArrayLength();\n    },\n    set: function set(newLength) {\n        this.$mobx.setArrayLength(newLength);\n    }\n});\n[\"every\", \"filter\", \"forEach\", \"indexOf\", \"join\", \"lastIndexOf\", \"map\", \"reduce\", \"reduceRight\", \"slice\", \"some\"].forEach(function (funcName) {\n    var baseFunc = Array.prototype[funcName];\n    invariant(typeof baseFunc === \"function\", \"Base function not defined on Array prototype: '\" + funcName + \"'\");\n    addHiddenProp(ObservableArray.prototype, funcName, function () {\n        this.$mobx.atom.reportObserved();\n        return baseFunc.apply(this.$mobx.values, arguments);\n    });\n});\nvar ENTRY_0 = {\n    configurable: true,\n    enumerable: false,\n    set: createArraySetter(0),\n    get: createArrayGetter(0)\n};\nfunction createArrayBufferItem(index) {\n    var set = createArraySetter(index);\n    var get = createArrayGetter(index);\n    Object.defineProperty(ObservableArray.prototype, \"\" + index, {\n        enumerable: false,\n        configurable: true,\n        set: set, get: get\n    });\n}\nfunction createArraySetter(index) {\n    return function (newValue) {\n        var adm = this.$mobx;\n        var values = adm.values;\n        if (index < values.length) {\n            checkIfStateModificationsAreAllowed(adm.atom);\n            var oldValue = values[index];\n            if (hasInterceptors(adm)) {\n                var change = interceptChange(adm, {\n                    type: \"update\",\n                    object: adm.array,\n                    index: index, newValue: newValue\n                });\n                if (!change) return;\n                newValue = change.newValue;\n            }\n            newValue = adm.enhancer(newValue, oldValue);\n            var changed = newValue !== oldValue;\n            if (changed) {\n                values[index] = newValue;\n                adm.notifyArrayChildUpdate(index, newValue, oldValue);\n            }\n        } else if (index === values.length) {\n            adm.spliceWithArray(index, 0, [newValue]);\n        } else throw new Error(\"[mobx.array] Index out of bounds, \" + index + \" is larger than \" + values.length);\n    };\n}\nfunction createArrayGetter(index) {\n    return function () {\n        var impl = this.$mobx;\n        if (impl) {\n            if (index < impl.values.length) {\n                impl.atom.reportObserved();\n                return impl.values[index];\n            }\n            console.warn(\"[mobx.array] Attempt to read an array index (\" + index + \") that is out of bounds (\" + impl.values.length + \"). Please check length first. Out of bound indices will not be tracked by MobX\");\n        }\n        return undefined;\n    };\n}\nfunction reserveArrayBuffer(max) {\n    for (var index = OBSERVABLE_ARRAY_BUFFER_SIZE; index < max; index++) {\n        createArrayBufferItem(index);\n    }OBSERVABLE_ARRAY_BUFFER_SIZE = max;\n}\nreserveArrayBuffer(1000);\nvar isObservableArrayAdministration = createInstanceofPredicate(\"ObservableArrayAdministration\", ObservableArrayAdministration);\nfunction isObservableArray(thing) {\n    return isObject(thing) && isObservableArrayAdministration(thing.$mobx);\n}\nexports.isObservableArray = isObservableArray;\nvar ObservableMapMarker = {};\nvar ObservableMap = function () {\n    function ObservableMap(initialData, enhancer, name) {\n        if (enhancer === void 0) {\n            enhancer = deepEnhancer;\n        }\n        if (name === void 0) {\n            name = \"ObservableMap@\" + getNextId();\n        }\n        this.enhancer = enhancer;\n        this.name = name;\n        this.$mobx = ObservableMapMarker;\n        this._data = {};\n        this._hasMap = {};\n        this._keys = new ObservableArray(undefined, referenceEnhancer, this.name + \".keys()\", true);\n        this.interceptors = null;\n        this.changeListeners = null;\n        this.merge(initialData);\n    }\n    ObservableMap.prototype._has = function (key) {\n        return typeof this._data[key] !== \"undefined\";\n    };\n    ObservableMap.prototype.has = function (key) {\n        if (!this.isValidKey(key)) return false;\n        key = \"\" + key;\n        if (this._hasMap[key]) return this._hasMap[key].get();\n        return this._updateHasMapEntry(key, false).get();\n    };\n    ObservableMap.prototype.set = function (key, value) {\n        this.assertValidKey(key);\n        key = \"\" + key;\n        var hasKey = this._has(key);\n        if (hasInterceptors(this)) {\n            var change = interceptChange(this, {\n                type: hasKey ? \"update\" : \"add\",\n                object: this,\n                newValue: value,\n                name: key\n            });\n            if (!change) return this;\n            value = change.newValue;\n        }\n        if (hasKey) {\n            this._updateValue(key, value);\n        } else {\n            this._addValue(key, value);\n        }\n        return this;\n    };\n    ObservableMap.prototype.delete = function (key) {\n        var _this = this;\n        this.assertValidKey(key);\n        key = \"\" + key;\n        if (hasInterceptors(this)) {\n            var change = interceptChange(this, {\n                type: \"delete\",\n                object: this,\n                name: key\n            });\n            if (!change) return false;\n        }\n        if (this._has(key)) {\n            var notifySpy = isSpyEnabled();\n            var notify = hasListeners(this);\n            var change = notify || notifySpy ? {\n                type: \"delete\",\n                object: this,\n                oldValue: this._data[key].value,\n                name: key\n            } : null;\n            if (notifySpy) spyReportStart(change);\n            runInTransaction(function () {\n                _this._keys.remove(key);\n                _this._updateHasMapEntry(key, false);\n                var observable = _this._data[key];\n                observable.setNewValue(undefined);\n                _this._data[key] = undefined;\n            });\n            if (notify) notifyListeners(this, change);\n            if (notifySpy) spyReportEnd();\n            return true;\n        }\n        return false;\n    };\n    ObservableMap.prototype._updateHasMapEntry = function (key, value) {\n        var entry = this._hasMap[key];\n        if (entry) {\n            entry.setNewValue(value);\n        } else {\n            entry = this._hasMap[key] = new ObservableValue(value, referenceEnhancer, this.name + \".\" + key + \"?\", false);\n        }\n        return entry;\n    };\n    ObservableMap.prototype._updateValue = function (name, newValue) {\n        var observable = this._data[name];\n        newValue = observable.prepareNewValue(newValue);\n        if (newValue !== UNCHANGED) {\n            var notifySpy = isSpyEnabled();\n            var notify = hasListeners(this);\n            var change = notify || notifySpy ? {\n                type: \"update\",\n                object: this,\n                oldValue: observable.value,\n                name: name, newValue: newValue\n            } : null;\n            if (notifySpy) spyReportStart(change);\n            observable.setNewValue(newValue);\n            if (notify) notifyListeners(this, change);\n            if (notifySpy) spyReportEnd();\n        }\n    };\n    ObservableMap.prototype._addValue = function (name, newValue) {\n        var _this = this;\n        runInTransaction(function () {\n            var observable = _this._data[name] = new ObservableValue(newValue, _this.enhancer, _this.name + \".\" + name, false);\n            newValue = observable.value;\n            _this._updateHasMapEntry(name, true);\n            _this._keys.push(name);\n        });\n        var notifySpy = isSpyEnabled();\n        var notify = hasListeners(this);\n        var change = notify || notifySpy ? {\n            type: \"add\",\n            object: this,\n            name: name, newValue: newValue\n        } : null;\n        if (notifySpy) spyReportStart(change);\n        if (notify) notifyListeners(this, change);\n        if (notifySpy) spyReportEnd();\n    };\n    ObservableMap.prototype.get = function (key) {\n        key = \"\" + key;\n        if (this.has(key)) return this._data[key].get();\n        return undefined;\n    };\n    ObservableMap.prototype.keys = function () {\n        return arrayAsIterator(this._keys.slice());\n    };\n    ObservableMap.prototype.values = function () {\n        return arrayAsIterator(this._keys.map(this.get, this));\n    };\n    ObservableMap.prototype.entries = function () {\n        var _this = this;\n        return arrayAsIterator(this._keys.map(function (key) {\n            return [key, _this.get(key)];\n        }));\n    };\n    ObservableMap.prototype.forEach = function (callback, thisArg) {\n        var _this = this;\n        this.keys().forEach(function (key) {\n            return callback.call(thisArg, _this.get(key), key, _this);\n        });\n    };\n    ObservableMap.prototype.merge = function (other) {\n        var _this = this;\n        if (isObservableMap(other)) {\n            other = other.toJS();\n        }\n        runInTransaction(function () {\n            if (isPlainObject(other)) Object.keys(other).forEach(function (key) {\n                return _this.set(key, other[key]);\n            });else if (Array.isArray(other)) other.forEach(function (_a) {\n                var key = _a[0],\n                    value = _a[1];\n                return _this.set(key, value);\n            });else if (isES6Map(other)) other.forEach(function (value, key) {\n                return _this.set(key, value);\n            });else if (other !== null && other !== undefined) fail(\"Cannot initialize map from \" + other);\n        });\n        return this;\n    };\n    ObservableMap.prototype.clear = function () {\n        var _this = this;\n        runInTransaction(function () {\n            untracked(function () {\n                _this.keys().forEach(_this.delete, _this);\n            });\n        });\n    };\n    ObservableMap.prototype.replace = function (values) {\n        var _this = this;\n        runInTransaction(function () {\n            _this.clear();\n            _this.merge(values);\n        });\n        return this;\n    };\n    Object.defineProperty(ObservableMap.prototype, \"size\", {\n        get: function get() {\n            return this._keys.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ObservableMap.prototype.toJS = function () {\n        var _this = this;\n        var res = {};\n        this.keys().forEach(function (key) {\n            return res[key] = _this.get(key);\n        });\n        return res;\n    };\n    ObservableMap.prototype.toJSON = function () {\n        return this.toJS();\n    };\n    ObservableMap.prototype.isValidKey = function (key) {\n        if (key === null || key === undefined) return false;\n        if (typeof key === \"string\" || typeof key === \"number\" || typeof key === \"boolean\") return true;\n        return false;\n    };\n    ObservableMap.prototype.assertValidKey = function (key) {\n        if (!this.isValidKey(key)) throw new Error(\"[mobx.map] Invalid key: '\" + key + \"', only strings, numbers and booleans are accepted as key in observable maps.\");\n    };\n    ObservableMap.prototype.toString = function () {\n        var _this = this;\n        return this.name + \"[{ \" + this.keys().map(function (key) {\n            return key + \": \" + (\"\" + _this.get(key));\n        }).join(\", \") + \" }]\";\n    };\n    ObservableMap.prototype.observe = function (listener, fireImmediately) {\n        invariant(fireImmediately !== true, getMessage(\"m033\"));\n        return registerListener(this, listener);\n    };\n    ObservableMap.prototype.intercept = function (handler) {\n        return registerInterceptor(this, handler);\n    };\n    return ObservableMap;\n}();\nexports.ObservableMap = ObservableMap;\ndeclareIterator(ObservableMap.prototype, function () {\n    return this.entries();\n});\nfunction map(initialValues) {\n    deprecated(\"`mobx.map` is deprecated, use `new ObservableMap` or `mobx.observable.map` instead\");\n    return observable.map(initialValues);\n}\nexports.map = map;\nvar isObservableMap = createInstanceofPredicate(\"ObservableMap\", ObservableMap);\nexports.isObservableMap = isObservableMap;\nvar ObservableObjectAdministration = function () {\n    function ObservableObjectAdministration(target, name) {\n        this.target = target;\n        this.name = name;\n        this.values = {};\n        this.changeListeners = null;\n        this.interceptors = null;\n    }\n    ObservableObjectAdministration.prototype.observe = function (callback, fireImmediately) {\n        invariant(fireImmediately !== true, \"`observe` doesn't support the fire immediately property for observable objects.\");\n        return registerListener(this, callback);\n    };\n    ObservableObjectAdministration.prototype.intercept = function (handler) {\n        return registerInterceptor(this, handler);\n    };\n    return ObservableObjectAdministration;\n}();\nfunction asObservableObject(target, name) {\n    if (isObservableObject(target)) return target.$mobx;\n    invariant(Object.isExtensible(target), getMessage(\"m035\"));\n    if (!isPlainObject(target)) name = (target.constructor.name || \"ObservableObject\") + \"@\" + getNextId();\n    if (!name) name = \"ObservableObject@\" + getNextId();\n    var adm = new ObservableObjectAdministration(target, name);\n    addHiddenFinalProp(target, \"$mobx\", adm);\n    return adm;\n}\nfunction defineObservablePropertyFromDescriptor(adm, propName, descriptor, defaultEnhancer) {\n    if (adm.values[propName]) {\n        invariant(\"value\" in descriptor, \"The property \" + propName + \" in \" + adm.name + \" is already observable, cannot redefine it as computed property\");\n        adm.target[propName] = descriptor.value;\n        return;\n    }\n    if (\"value\" in descriptor) {\n        if (isModifierDescriptor(descriptor.value)) {\n            var modifierDescriptor = descriptor.value;\n            defineObservableProperty(adm, propName, modifierDescriptor.initialValue, modifierDescriptor.enhancer);\n        } else if (isAction(descriptor.value) && descriptor.value.autoBind === true) {\n            defineBoundAction(adm.target, propName, descriptor.value.originalFn);\n        } else if (isComputedValue(descriptor.value)) {\n            defineComputedPropertyFromComputedValue(adm, propName, descriptor.value);\n        } else {\n            defineObservableProperty(adm, propName, descriptor.value, defaultEnhancer);\n        }\n    } else {\n        defineComputedProperty(adm, propName, descriptor.get, descriptor.set, false, true);\n    }\n}\nfunction defineObservableProperty(adm, propName, newValue, enhancer) {\n    assertPropertyConfigurable(adm.target, propName);\n    if (hasInterceptors(adm)) {\n        var change = interceptChange(adm, {\n            object: adm.target,\n            name: propName,\n            type: \"add\",\n            newValue: newValue\n        });\n        if (!change) return;\n        newValue = change.newValue;\n    }\n    var observable = adm.values[propName] = new ObservableValue(newValue, enhancer, adm.name + \".\" + propName, false);\n    newValue = observable.value;\n    Object.defineProperty(adm.target, propName, generateObservablePropConfig(propName));\n    notifyPropertyAddition(adm, adm.target, propName, newValue);\n}\nfunction defineComputedProperty(adm, propName, getter, setter, compareStructural, asInstanceProperty) {\n    if (asInstanceProperty) assertPropertyConfigurable(adm.target, propName);\n    adm.values[propName] = new ComputedValue(getter, adm.target, compareStructural, adm.name + \".\" + propName, setter);\n    if (asInstanceProperty) {\n        Object.defineProperty(adm.target, propName, generateComputedPropConfig(propName));\n    }\n}\nfunction defineComputedPropertyFromComputedValue(adm, propName, computedValue) {\n    var name = adm.name + \".\" + propName;\n    computedValue.name = name;\n    if (!computedValue.scope) computedValue.scope = adm.target;\n    adm.values[propName] = computedValue;\n    Object.defineProperty(adm.target, propName, generateComputedPropConfig(propName));\n}\nvar observablePropertyConfigs = {};\nvar computedPropertyConfigs = {};\nfunction generateObservablePropConfig(propName) {\n    return observablePropertyConfigs[propName] || (observablePropertyConfigs[propName] = {\n        configurable: true,\n        enumerable: true,\n        get: function get() {\n            return this.$mobx.values[propName].get();\n        },\n        set: function set(v) {\n            setPropertyValue(this, propName, v);\n        }\n    });\n}\nfunction generateComputedPropConfig(propName) {\n    return computedPropertyConfigs[propName] || (computedPropertyConfigs[propName] = {\n        configurable: true,\n        enumerable: false,\n        get: function get() {\n            return this.$mobx.values[propName].get();\n        },\n        set: function set(v) {\n            return this.$mobx.values[propName].set(v);\n        }\n    });\n}\nfunction setPropertyValue(instance, name, newValue) {\n    var adm = instance.$mobx;\n    var observable = adm.values[name];\n    if (hasInterceptors(adm)) {\n        var change = interceptChange(adm, {\n            type: \"update\",\n            object: instance,\n            name: name, newValue: newValue\n        });\n        if (!change) return;\n        newValue = change.newValue;\n    }\n    newValue = observable.prepareNewValue(newValue);\n    if (newValue !== UNCHANGED) {\n        var notify = hasListeners(adm);\n        var notifySpy = isSpyEnabled();\n        var change = notify || notifySpy ? {\n            type: \"update\",\n            object: instance,\n            oldValue: observable.value,\n            name: name, newValue: newValue\n        } : null;\n        if (notifySpy) spyReportStart(change);\n        observable.setNewValue(newValue);\n        if (notify) notifyListeners(adm, change);\n        if (notifySpy) spyReportEnd();\n    }\n}\nfunction notifyPropertyAddition(adm, object, name, newValue) {\n    var notify = hasListeners(adm);\n    var notifySpy = isSpyEnabled();\n    var change = notify || notifySpy ? {\n        type: \"add\",\n        object: object, name: name, newValue: newValue\n    } : null;\n    if (notifySpy) spyReportStart(change);\n    if (notify) notifyListeners(adm, change);\n    if (notifySpy) spyReportEnd();\n}\nvar isObservableObjectAdministration = createInstanceofPredicate(\"ObservableObjectAdministration\", ObservableObjectAdministration);\nfunction isObservableObject(thing) {\n    if (isObject(thing)) {\n        runLazyInitializers(thing);\n        return isObservableObjectAdministration(thing.$mobx);\n    }\n    return false;\n}\nexports.isObservableObject = isObservableObject;\nvar UNCHANGED = {};\nvar ObservableValue = function (_super) {\n    __extends(ObservableValue, _super);\n    function ObservableValue(value, enhancer, name, notifySpy) {\n        if (name === void 0) {\n            name = \"ObservableValue@\" + getNextId();\n        }\n        if (notifySpy === void 0) {\n            notifySpy = true;\n        }\n        var _this = _super.call(this, name) || this;\n        _this.enhancer = enhancer;\n        _this.hasUnreportedChange = false;\n        _this.value = enhancer(value, undefined, name);\n        if (notifySpy && isSpyEnabled()) {\n            spyReport({ type: \"create\", object: _this, newValue: _this.value });\n        }\n        return _this;\n    }\n    ObservableValue.prototype.set = function (newValue) {\n        var oldValue = this.value;\n        newValue = this.prepareNewValue(newValue);\n        if (newValue !== UNCHANGED) {\n            var notifySpy = isSpyEnabled();\n            if (notifySpy) {\n                spyReportStart({\n                    type: \"update\",\n                    object: this,\n                    newValue: newValue, oldValue: oldValue\n                });\n            }\n            this.setNewValue(newValue);\n            if (notifySpy) spyReportEnd();\n        }\n    };\n    ObservableValue.prototype.prepareNewValue = function (newValue) {\n        checkIfStateModificationsAreAllowed(this);\n        if (hasInterceptors(this)) {\n            var change = interceptChange(this, { object: this, type: \"update\", newValue: newValue });\n            if (!change) return UNCHANGED;\n            newValue = change.newValue;\n        }\n        newValue = this.enhancer(newValue, this.value, this.name);\n        return this.value !== newValue ? newValue : UNCHANGED;\n    };\n    ObservableValue.prototype.setNewValue = function (newValue) {\n        var oldValue = this.value;\n        this.value = newValue;\n        this.reportChanged();\n        if (hasListeners(this)) {\n            notifyListeners(this, {\n                type: \"update\",\n                object: this,\n                newValue: newValue,\n                oldValue: oldValue\n            });\n        }\n    };\n    ObservableValue.prototype.get = function () {\n        this.reportObserved();\n        return this.value;\n    };\n    ObservableValue.prototype.intercept = function (handler) {\n        return registerInterceptor(this, handler);\n    };\n    ObservableValue.prototype.observe = function (listener, fireImmediately) {\n        if (fireImmediately) listener({\n            object: this,\n            type: \"update\",\n            newValue: this.value,\n            oldValue: undefined\n        });\n        return registerListener(this, listener);\n    };\n    ObservableValue.prototype.toJSON = function () {\n        return this.get();\n    };\n    ObservableValue.prototype.toString = function () {\n        return this.name + \"[\" + this.value + \"]\";\n    };\n    ObservableValue.prototype.valueOf = function () {\n        return toPrimitive(this.get());\n    };\n    return ObservableValue;\n}(BaseAtom);\nObservableValue.prototype[primitiveSymbol()] = ObservableValue.prototype.valueOf;\nvar isObservableValue = createInstanceofPredicate(\"ObservableValue\", ObservableValue);\nexports.isBoxedObservable = isObservableValue;\nfunction getAtom(thing, property) {\n    if ((typeof thing === \"undefined\" ? \"undefined\" : _typeof(thing)) === \"object\" && thing !== null) {\n        if (isObservableArray(thing)) {\n            invariant(property === undefined, getMessage(\"m036\"));\n            return thing.$mobx.atom;\n        }\n        if (isObservableMap(thing)) {\n            var anyThing = thing;\n            if (property === undefined) return getAtom(anyThing._keys);\n            var observable_2 = anyThing._data[property] || anyThing._hasMap[property];\n            invariant(!!observable_2, \"the entry '\" + property + \"' does not exist in the observable map '\" + getDebugName(thing) + \"'\");\n            return observable_2;\n        }\n        runLazyInitializers(thing);\n        if (isObservableObject(thing)) {\n            if (!property) return fail(\"please specify a property\");\n            var observable_3 = thing.$mobx.values[property];\n            invariant(!!observable_3, \"no observable property '\" + property + \"' found on the observable object '\" + getDebugName(thing) + \"'\");\n            return observable_3;\n        }\n        if (isAtom(thing) || isComputedValue(thing) || isReaction(thing)) {\n            return thing;\n        }\n    } else if (typeof thing === \"function\") {\n        if (isReaction(thing.$mobx)) {\n            return thing.$mobx;\n        }\n    }\n    return fail(\"Cannot obtain atom from \" + thing);\n}\nfunction getAdministration(thing, property) {\n    invariant(thing, \"Expecting some object\");\n    if (property !== undefined) return getAdministration(getAtom(thing, property));\n    if (isAtom(thing) || isComputedValue(thing) || isReaction(thing)) return thing;\n    if (isObservableMap(thing)) return thing;\n    runLazyInitializers(thing);\n    if (thing.$mobx) return thing.$mobx;\n    invariant(false, \"Cannot obtain administration from \" + thing);\n}\nfunction getDebugName(thing, property) {\n    var named;\n    if (property !== undefined) named = getAtom(thing, property);else if (isObservableObject(thing) || isObservableMap(thing)) named = getAdministration(thing);else named = getAtom(thing);\n    return named.name;\n}\nfunction createClassPropertyDecorator(onInitialize, _get, _set, enumerable, allowCustomArguments) {\n    function classPropertyDecorator(target, key, descriptor, customArgs, argLen) {\n        if (argLen === void 0) {\n            argLen = 0;\n        }\n        invariant(allowCustomArguments || quacksLikeADecorator(arguments), \"This function is a decorator, but it wasn't invoked like a decorator\");\n        if (!descriptor) {\n            var newDescriptor = {\n                enumerable: enumerable,\n                configurable: true,\n                get: function get() {\n                    if (!this.__mobxInitializedProps || this.__mobxInitializedProps[key] !== true) typescriptInitializeProperty(this, key, undefined, onInitialize, customArgs, descriptor);\n                    return _get.call(this, key);\n                },\n                set: function set(v) {\n                    if (!this.__mobxInitializedProps || this.__mobxInitializedProps[key] !== true) {\n                        typescriptInitializeProperty(this, key, v, onInitialize, customArgs, descriptor);\n                    } else {\n                        _set.call(this, key, v);\n                    }\n                }\n            };\n            if (arguments.length < 3 || arguments.length === 5 && argLen < 3) {\n                Object.defineProperty(target, key, newDescriptor);\n            }\n            return newDescriptor;\n        } else {\n            if (!hasOwnProperty(target, \"__mobxLazyInitializers\")) {\n                addHiddenProp(target, \"__mobxLazyInitializers\", target.__mobxLazyInitializers && target.__mobxLazyInitializers.slice() || []);\n            }\n            var value_1 = descriptor.value,\n                initializer_1 = descriptor.initializer;\n            target.__mobxLazyInitializers.push(function (instance) {\n                onInitialize(instance, key, initializer_1 ? initializer_1.call(instance) : value_1, customArgs, descriptor);\n            });\n            return {\n                enumerable: enumerable, configurable: true,\n                get: function get() {\n                    if (this.__mobxDidRunLazyInitializers !== true) runLazyInitializers(this);\n                    return _get.call(this, key);\n                },\n                set: function set(v) {\n                    if (this.__mobxDidRunLazyInitializers !== true) runLazyInitializers(this);\n                    _set.call(this, key, v);\n                }\n            };\n        }\n    }\n    if (allowCustomArguments) {\n        return function () {\n            if (quacksLikeADecorator(arguments)) return classPropertyDecorator.apply(null, arguments);\n            var outerArgs = arguments;\n            var argLen = arguments.length;\n            return function (target, key, descriptor) {\n                return classPropertyDecorator(target, key, descriptor, outerArgs, argLen);\n            };\n        };\n    }\n    return classPropertyDecorator;\n}\nfunction typescriptInitializeProperty(instance, key, v, onInitialize, customArgs, baseDescriptor) {\n    if (!hasOwnProperty(instance, \"__mobxInitializedProps\")) addHiddenProp(instance, \"__mobxInitializedProps\", {});\n    instance.__mobxInitializedProps[key] = true;\n    onInitialize(instance, key, v, customArgs, baseDescriptor);\n}\nfunction runLazyInitializers(instance) {\n    if (instance.__mobxDidRunLazyInitializers === true) return;\n    if (instance.__mobxLazyInitializers) {\n        addHiddenProp(instance, \"__mobxDidRunLazyInitializers\", true);\n        instance.__mobxDidRunLazyInitializers && instance.__mobxLazyInitializers.forEach(function (initializer) {\n            return initializer(instance);\n        });\n    }\n}\nfunction quacksLikeADecorator(args) {\n    return (args.length === 2 || args.length === 3) && typeof args[1] === \"string\";\n}\nfunction iteratorSymbol() {\n    return typeof Symbol === \"function\" && Symbol.iterator || \"@@iterator\";\n}\nvar IS_ITERATING_MARKER = \"__$$iterating\";\nfunction arrayAsIterator(array) {\n    invariant(array[IS_ITERATING_MARKER] !== true, \"Illegal state: cannot recycle array as iterator\");\n    addHiddenFinalProp(array, IS_ITERATING_MARKER, true);\n    var idx = -1;\n    addHiddenFinalProp(array, \"next\", function next() {\n        idx++;\n        return {\n            done: idx >= this.length,\n            value: idx < this.length ? this[idx] : undefined\n        };\n    });\n    return array;\n}\nfunction declareIterator(prototType, iteratorFactory) {\n    addHiddenFinalProp(prototType, iteratorSymbol(), iteratorFactory);\n}\nvar messages = {\n    \"m001\": \"It is not allowed to assign new values to @action fields\",\n    \"m002\": \"`runInAction` expects a function\",\n    \"m003\": \"`runInAction` expects a function without arguments\",\n    \"m004\": \"autorun expects a function\",\n    \"m005\": \"Warning: attempted to pass an action to autorun. Actions are untracked and will not trigger on state changes. Use `reaction` or wrap only your state modification code in an action.\",\n    \"m006\": \"Warning: attempted to pass an action to autorunAsync. Actions are untracked and will not trigger on state changes. Use `reaction` or wrap only your state modification code in an action.\",\n    \"m007\": \"reaction only accepts 2 or 3 arguments. If migrating from MobX 2, please provide an options object\",\n    \"m008\": \"wrapping reaction expression in `asReference` is no longer supported, use options object instead\",\n    \"m009\": \"@computed can only be used on getter functions, like: '@computed get myProps() { return ...; }'. It looks like it was used on a property.\",\n    \"m010\": \"@computed can only be used on getter functions, like: '@computed get myProps() { return ...; }'\",\n    \"m011\": \"First argument to `computed` should be an expression. If using computed as decorator, don't pass it arguments\",\n    \"m012\": \"computed takes one or two arguments if used as function\",\n    \"m013\": \"[mobx.expr] 'expr' should only be used inside other reactive functions.\",\n    \"m014\": \"extendObservable expected 2 or more arguments\",\n    \"m015\": \"extendObservable expects an object as first argument\",\n    \"m016\": \"extendObservable should not be used on maps, use map.merge instead\",\n    \"m017\": \"all arguments of extendObservable should be objects\",\n    \"m018\": \"extending an object with another observable (object) is not supported. Please construct an explicit propertymap, using `toJS` if need. See issue #540\",\n    \"m019\": \"[mobx.isObservable] isObservable(object, propertyName) is not supported for arrays and maps. Use map.has or array.length instead.\",\n    \"m020\": \"modifiers can only be used for individual object properties\",\n    \"m021\": \"observable expects zero or one arguments\",\n    \"m022\": \"@observable can not be used on getters, use @computed instead\",\n    \"m023\": \"Using `transaction` is deprecated, use `runInAction` or `(@)action` instead.\",\n    \"m024\": \"whyRun() can only be used if a derivation is active, or by passing an computed value / reaction explicitly. If you invoked whyRun from inside a computation; the computation is currently suspended but re-evaluating because somebody requested its value.\",\n    \"m025\": \"whyRun can only be used on reactions and computed values\",\n    \"m026\": \"`action` can only be invoked on functions\",\n    \"m028\": \"It is not allowed to set `useStrict` when a derivation is running\",\n    \"m029\": \"INTERNAL ERROR only onBecomeUnobserved shouldn't be called twice in a row\",\n    \"m030a\": \"Since strict-mode is enabled, changing observed observable values outside actions is not allowed. Please wrap the code in an `action` if this change is intended. Tried to modify: \",\n    \"m030b\": \"Side effects like changing state are not allowed at this point. Are you trying to modify state from, for example, the render function of a React component? Tried to modify: \",\n    \"m031\": \"Computed values are not allowed to not cause side effects by changing observables that are already being observed. Tried to modify: \",\n    \"m032\": \"* This computation is suspended (not in use by any reaction) and won't run automatically.\\n\tDidn't expect this computation to be suspended at this point?\\n\t  1. Make sure this computation is used by a reaction (reaction, autorun, observer).\\n\t  2. Check whether you are using this computation synchronously (in the same stack as they reaction that needs it).\",\n    \"m033\": \"`observe` doesn't support the fire immediately property for observable maps.\",\n    \"m034\": \"`mobx.map` is deprecated, use `new ObservableMap` or `mobx.observable.map` instead\",\n    \"m035\": \"Cannot make the designated object observable; it is not extensible\",\n    \"m036\": \"It is not possible to get index atoms from arrays\",\n    \"m037\": \"Hi there! I'm sorry you have just run into an exception.\\nIf your debugger ends up here, know that some reaction (like the render() of an observer component, autorun or reaction)\\nthrew an exception and that mobx caught it, to avoid that it brings the rest of your application down.\\nThe original cause of the exception (the code that caused this reaction to run (again)), is still in the stack.\\n\\nHowever, more interesting is the actual stack trace of the error itself.\\nHopefully the error is an instanceof Error, because in that case you can inspect the original stack of the error from where it was thrown.\\nSee `error.stack` property, or press the very subtle \\\"(...)\\\" link you see near the console.error message that probably brought you here.\\nThat stack is more interesting than the stack of this console.error itself.\\n\\nIf the exception you see is an exception you created yourself, make sure to use `throw new Error(\\\"Oops\\\")` instead of `throw \\\"Oops\\\"`,\\nbecause the javascript environment will only preserve the original stack trace in the first form.\\n\\nYou can also make sure the debugger pauses the next time this very same exception is thrown by enabling \\\"Pause on caught exception\\\".\\n(Note that it might pause on many other, unrelated exception as well).\\n\\nIf that all doesn't help you out, feel free to open an issue https://github.com/mobxjs/mobx/issues!\\n\",\n    \"m038\": \"Missing items in this list?\\n    1. Check whether all used values are properly marked as observable (use isObservable to verify)\\n    2. Make sure you didn't dereference values too early. MobX observes props, not primitives. E.g: use 'person.name' instead of 'name' in your computation.\\n\"\n};\nfunction getMessage(id) {\n    return messages[id];\n}\nvar EMPTY_ARRAY = [];\nObject.freeze(EMPTY_ARRAY);\nfunction getGlobal() {\n    return global;\n}\nfunction getNextId() {\n    return ++globalState.mobxGuid;\n}\nfunction fail(message, thing) {\n    invariant(false, message, thing);\n    throw \"X\";\n}\nfunction invariant(check, message, thing) {\n    if (!check) throw new Error(\"[mobx] Invariant failed: \" + message + (thing ? \" in '\" + thing + \"'\" : \"\"));\n}\nvar deprecatedMessages = [];\nfunction deprecated(msg) {\n    if (deprecatedMessages.indexOf(msg) !== -1) return false;\n    deprecatedMessages.push(msg);\n    console.error(\"[mobx] Deprecated: \" + msg);\n    return true;\n}\nfunction once(func) {\n    var invoked = false;\n    return function () {\n        if (invoked) return;\n        invoked = true;\n        return func.apply(this, arguments);\n    };\n}\nvar noop = function noop() {};\nfunction unique(list) {\n    var res = [];\n    list.forEach(function (item) {\n        if (res.indexOf(item) === -1) res.push(item);\n    });\n    return res;\n}\nfunction joinStrings(things, limit, separator) {\n    if (limit === void 0) {\n        limit = 100;\n    }\n    if (separator === void 0) {\n        separator = \" - \";\n    }\n    if (!things) return \"\";\n    var sliced = things.slice(0, limit);\n    return \"\" + sliced.join(separator) + (things.length > limit ? \" (... and \" + (things.length - limit) + \"more)\" : \"\");\n}\nfunction isObject(value) {\n    return value !== null && (typeof value === \"undefined\" ? \"undefined\" : _typeof(value)) === \"object\";\n}\nfunction isPlainObject(value) {\n    if (value === null || (typeof value === \"undefined\" ? \"undefined\" : _typeof(value)) !== \"object\") return false;\n    var proto = Object.getPrototypeOf(value);\n    return proto === Object.prototype || proto === null;\n}\nfunction objectAssign() {\n    var res = arguments[0];\n    for (var i = 1, l = arguments.length; i < l; i++) {\n        var source = arguments[i];\n        for (var key in source) {\n            if (hasOwnProperty(source, key)) {\n                res[key] = source[key];\n            }\n        }\n    }\n    return res;\n}\nfunction valueDidChange(compareStructural, oldValue, newValue) {\n    if (typeof oldValue === 'number' && isNaN(oldValue)) {\n        return typeof newValue !== 'number' || !isNaN(newValue);\n    }\n    return compareStructural ? !deepEqual(oldValue, newValue) : oldValue !== newValue;\n}\nvar prototypeHasOwnProperty = Object.prototype.hasOwnProperty;\nfunction hasOwnProperty(object, propName) {\n    return prototypeHasOwnProperty.call(object, propName);\n}\nfunction makeNonEnumerable(object, propNames) {\n    for (var i = 0; i < propNames.length; i++) {\n        addHiddenProp(object, propNames[i], object[propNames[i]]);\n    }\n}\nfunction addHiddenProp(object, propName, value) {\n    Object.defineProperty(object, propName, {\n        enumerable: false,\n        writable: true,\n        configurable: true,\n        value: value\n    });\n}\nfunction addHiddenFinalProp(object, propName, value) {\n    Object.defineProperty(object, propName, {\n        enumerable: false,\n        writable: false,\n        configurable: true,\n        value: value\n    });\n}\nfunction isPropertyConfigurable(object, prop) {\n    var descriptor = Object.getOwnPropertyDescriptor(object, prop);\n    return !descriptor || descriptor.configurable !== false && descriptor.writable !== false;\n}\nfunction assertPropertyConfigurable(object, prop) {\n    invariant(isPropertyConfigurable(object, prop), \"Cannot make property '\" + prop + \"' observable, it is not configurable and writable in the target object\");\n}\nfunction getEnumerableKeys(obj) {\n    var res = [];\n    for (var key in obj) {\n        res.push(key);\n    }return res;\n}\nfunction deepEqual(a, b) {\n    if (a === null && b === null) return true;\n    if (a === undefined && b === undefined) return true;\n    if ((typeof a === \"undefined\" ? \"undefined\" : _typeof(a)) !== \"object\") return a === b;\n    var aIsArray = isArrayLike(a);\n    var aIsMap = isMapLike(a);\n    if (aIsArray !== isArrayLike(b)) {\n        return false;\n    } else if (aIsMap !== isMapLike(b)) {\n        return false;\n    } else if (aIsArray) {\n        if (a.length !== b.length) return false;\n        for (var i = a.length - 1; i >= 0; i--) {\n            if (!deepEqual(a[i], b[i])) return false;\n        }return true;\n    } else if (aIsMap) {\n        if (a.size !== b.size) return false;\n        var equals_1 = true;\n        a.forEach(function (value, key) {\n            equals_1 = equals_1 && deepEqual(b.get(key), value);\n        });\n        return equals_1;\n    } else if ((typeof a === \"undefined\" ? \"undefined\" : _typeof(a)) === \"object\" && (typeof b === \"undefined\" ? \"undefined\" : _typeof(b)) === \"object\") {\n        if (a === null || b === null) return false;\n        if (isMapLike(a) && isMapLike(b)) {\n            if (a.size !== b.size) return false;\n            return deepEqual(observable.shallowMap(a).entries(), observable.shallowMap(b).entries());\n        }\n        if (getEnumerableKeys(a).length !== getEnumerableKeys(b).length) return false;\n        for (var prop in a) {\n            if (!(prop in b)) return false;\n            if (!deepEqual(a[prop], b[prop])) return false;\n        }\n        return true;\n    }\n    return false;\n}\nfunction createInstanceofPredicate(name, clazz) {\n    var propName = \"isMobX\" + name;\n    clazz.prototype[propName] = true;\n    return function (x) {\n        return isObject(x) && x[propName] === true;\n    };\n}\nfunction isArrayLike(x) {\n    return Array.isArray(x) || isObservableArray(x);\n}\nexports.isArrayLike = isArrayLike;\nfunction isMapLike(x) {\n    return isES6Map(x) || isObservableMap(x);\n}\nfunction isES6Map(thing) {\n    if (getGlobal().Map !== undefined && thing instanceof getGlobal().Map) return true;\n    return false;\n}\nfunction primitiveSymbol() {\n    return typeof Symbol === \"function\" && Symbol.toPrimitive || \"@@toPrimitive\";\n}\nfunction toPrimitive(value) {\n    return value === null ? null : (typeof value === \"undefined\" ? \"undefined\" : _typeof(value)) === \"object\" ? \"\" + value : value;\n}\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(4)))\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _icons = __webpack_require__(6);\n\nvar _constants = __webpack_require__(0);\n\nfunction renderHeader(_ref, instance) {\n  var meta = _ref.meta,\n      user = _ref.user,\n      reactions = _ref.reactions;\n\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-header-container';\n\n  var likeButton = document.createElement('span');\n  var likedReaction = reactions.find(function (reaction) {\n    return reaction.content === 'heart' && reaction.user.login === user.login;\n  });\n  likeButton.className = 'gitment-header-like-btn';\n  likeButton.innerHTML = '\\n    ' + _icons.heart + '\\n    ' + (likedReaction ? 'Unlike' : 'Like') + '\\n    ' + (meta.reactions && meta.reactions.heart ? ' \\u2022 <strong>' + meta.reactions.heart + '</strong> Liked' : '') + '\\n  ';\n\n  if (likedReaction) {\n    likeButton.classList.add('liked');\n    likeButton.onclick = function () {\n      return instance.unlike();\n    };\n  } else {\n    likeButton.classList.remove('liked');\n    likeButton.onclick = function () {\n      return instance.like();\n    };\n  }\n  container.appendChild(likeButton);\n\n  var commentsCount = document.createElement('span');\n  commentsCount.innerHTML = '\\n    ' + (meta.comments ? ' \\u2022 <strong>' + meta.comments + '</strong> Comments' : '') + '\\n  ';\n  container.appendChild(commentsCount);\n\n  var issueLink = document.createElement('a');\n  issueLink.className = 'gitment-header-issue-link';\n  issueLink.href = meta.html_url;\n  issueLink.target = '_blank';\n  issueLink.innerText = 'Issue Page';\n  container.appendChild(issueLink);\n\n  return container;\n}\n\nfunction renderComments(_ref2, instance) {\n  var meta = _ref2.meta,\n      comments = _ref2.comments,\n      commentReactions = _ref2.commentReactions,\n      currentPage = _ref2.currentPage,\n      user = _ref2.user,\n      error = _ref2.error;\n\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-comments-container';\n\n  if (error) {\n    var errorBlock = document.createElement('div');\n    errorBlock.className = 'gitment-comments-error';\n\n    if (error === _constants.NOT_INITIALIZED_ERROR && user.login && user.login.toLowerCase() === instance.owner.toLowerCase()) {\n      var initHint = document.createElement('div');\n      var initButton = document.createElement('button');\n      initButton.className = 'gitment-comments-init-btn';\n      initButton.onclick = function () {\n        initButton.setAttribute('disabled', true);\n        instance.init().catch(function (e) {\n          initButton.removeAttribute('disabled');\n          alert(e);\n        });\n      };\n      initButton.innerText = 'Initialize Comments';\n      initHint.appendChild(initButton);\n      errorBlock.appendChild(initHint);\n    } else {\n      errorBlock.innerText = error;\n    }\n    container.appendChild(errorBlock);\n    return container;\n  } else if (comments === undefined) {\n    var loading = document.createElement('div');\n    loading.innerText = 'Loading comments...';\n    loading.className = 'gitment-comments-loading';\n    container.appendChild(loading);\n    return container;\n  } else if (!comments.length) {\n    var emptyBlock = document.createElement('div');\n    emptyBlock.className = 'gitment-comments-empty';\n    emptyBlock.innerText = 'No Comment Yet';\n    container.appendChild(emptyBlock);\n    return container;\n  }\n\n  var commentsList = document.createElement('ul');\n  commentsList.className = 'gitment-comments-list';\n\n  comments.forEach(function (comment) {\n    var createDate = new Date(comment.created_at);\n    var updateDate = new Date(comment.updated_at);\n    var commentItem = document.createElement('li');\n    commentItem.className = 'gitment-comment';\n    commentItem.innerHTML = '\\n      <a class=\"gitment-comment-avatar\" href=\"' + comment.user.html_url + '\" target=\"_blank\">\\n        <img class=\"gitment-comment-avatar-img\" src=\"' + comment.user.avatar_url + '\"/>\\n      </a>\\n      <div class=\"gitment-comment-main\">\\n        <div class=\"gitment-comment-header\">\\n          <a class=\"gitment-comment-name\" href=\"' + comment.user.html_url + '\" target=\"_blank\">\\n            ' + comment.user.login + '\\n          </a>\\n          commented on\\n          <span title=\"' + createDate + '\">' + createDate.toDateString() + '</span>\\n          ' + (createDate.toString() !== updateDate.toString() ? ' \\u2022 <span title=\"comment was edited at ' + updateDate + '\">edited</span>' : '') + '\\n          <div class=\"gitment-comment-like-btn\">' + _icons.heart + ' ' + (comment.reactions.heart || '') + '</div>\\n        </div>\\n        <div class=\"gitment-comment-body gitment-markdown\">' + comment.body_html + '</div>\\n      </div>\\n    ';\n    var likeButton = commentItem.querySelector('.gitment-comment-like-btn');\n    var likedReaction = commentReactions[comment.id] && commentReactions[comment.id].find(function (reaction) {\n      return reaction.content === 'heart' && reaction.user.login === user.login;\n    });\n    if (likedReaction) {\n      likeButton.classList.add('liked');\n      likeButton.onclick = function () {\n        return instance.unlikeAComment(comment.id);\n      };\n    } else {\n      likeButton.classList.remove('liked');\n      likeButton.onclick = function () {\n        return instance.likeAComment(comment.id);\n      };\n    }\n\n    // dirty\n    // use a blank image to trigger height calculating when element rendered\n    var imgTrigger = document.createElement('img');\n    var markdownBody = commentItem.querySelector('.gitment-comment-body');\n    imgTrigger.className = 'gitment-hidden';\n    imgTrigger.src = \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\";\n    imgTrigger.onload = function () {\n      if (markdownBody.clientHeight > instance.maxCommentHeight) {\n        markdownBody.classList.add('gitment-comment-body-folded');\n        markdownBody.style.maxHeight = instance.maxCommentHeight + 'px';\n        markdownBody.title = 'Click to Expand';\n        markdownBody.onclick = function () {\n          markdownBody.classList.remove('gitment-comment-body-folded');\n          markdownBody.style.maxHeight = '';\n          markdownBody.title = '';\n          markdownBody.onclick = null;\n        };\n      }\n    };\n    commentItem.appendChild(imgTrigger);\n\n    commentsList.appendChild(commentItem);\n  });\n\n  container.appendChild(commentsList);\n\n  if (meta) {\n    var pageCount = Math.ceil(meta.comments / instance.perPage);\n    if (pageCount > 1) {\n      var pagination = document.createElement('ul');\n      pagination.className = 'gitment-comments-pagination';\n\n      if (currentPage > 1) {\n        var previousButton = document.createElement('li');\n        previousButton.className = 'gitment-comments-page-item';\n        previousButton.innerText = 'Previous';\n        previousButton.onclick = function () {\n          return instance.goto(currentPage - 1);\n        };\n        pagination.appendChild(previousButton);\n      }\n\n      var _loop = function _loop(i) {\n        var pageItem = document.createElement('li');\n        pageItem.className = 'gitment-comments-page-item';\n        pageItem.innerText = i;\n        pageItem.onclick = function () {\n          return instance.goto(i);\n        };\n        if (currentPage === i) pageItem.classList.add('gitment-selected');\n        pagination.appendChild(pageItem);\n      };\n\n      for (var i = 1; i <= pageCount; i++) {\n        _loop(i);\n      }\n\n      if (currentPage < pageCount) {\n        var nextButton = document.createElement('li');\n        nextButton.className = 'gitment-comments-page-item';\n        nextButton.innerText = 'Next';\n        nextButton.onclick = function () {\n          return instance.goto(currentPage + 1);\n        };\n        pagination.appendChild(nextButton);\n      }\n\n      container.appendChild(pagination);\n    }\n  }\n\n  return container;\n}\n\nfunction renderEditor(_ref3, instance) {\n  var user = _ref3.user,\n      error = _ref3.error;\n\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-editor-container';\n\n  var shouldDisable = user.login && !error ? '' : 'disabled';\n  var disabledTip = user.login ? '' : 'Login to Comment';\n  container.innerHTML = '\\n      ' + (user.login ? '<a class=\"gitment-editor-avatar\" href=\"' + user.html_url + '\" target=\"_blank\">\\n            <img class=\"gitment-editor-avatar-img\" src=\"' + user.avatar_url + '\"/>\\n          </a>' : user.isLoggingIn ? '<div class=\"gitment-editor-avatar\">' + _icons.spinner + '</div>' : '<a class=\"gitment-editor-avatar\" href=\"' + instance.loginLink + '\" title=\"login with GitHub\">\\n              ' + _icons.github + '\\n            </a>') + '\\n    </a>\\n    <div class=\"gitment-editor-main\">\\n      <div class=\"gitment-editor-header\">\\n        <nav class=\"gitment-editor-tabs\">\\n          <button class=\"gitment-editor-tab gitment-selected\">Write</button>\\n          <button class=\"gitment-editor-tab\">Preview</button>\\n        </nav>\\n        <div class=\"gitment-editor-login\">\\n          ' + (user.login ? '<a class=\"gitment-editor-logout-link\">Logout</a>' : user.isLoggingIn ? 'Logging in...' : '<a class=\"gitment-editor-login-link\" href=\"' + instance.loginLink + '\">Login</a> with GitHub') + '\\n        </div>\\n      </div>\\n      <div class=\"gitment-editor-body\">\\n        <div class=\"gitment-editor-write-field\">\\n          <textarea placeholder=\"Leave a comment\" title=\"' + disabledTip + '\" ' + shouldDisable + '></textarea>\\n        </div>\\n        <div class=\"gitment-editor-preview-field gitment-hidden\">\\n          <div class=\"gitment-editor-preview gitment-markdown\"></div>\\n        </div>\\n      </div>\\n    </div>\\n    <div class=\"gitment-editor-footer\">\\n      <a class=\"gitment-editor-footer-tip\" href=\"https://guides.github.com/features/mastering-markdown/\" target=\"_blank\">\\n        Styling with Markdown is supported\\n      </a>\\n      <button class=\"gitment-editor-submit\" title=\"' + disabledTip + '\" ' + shouldDisable + '>Comment</button>\\n    </div>\\n  ';\n  if (user.login) {\n    container.querySelector('.gitment-editor-logout-link').onclick = function () {\n      return instance.logout();\n    };\n  }\n\n  var writeField = container.querySelector('.gitment-editor-write-field');\n  var previewField = container.querySelector('.gitment-editor-preview-field');\n\n  var textarea = writeField.querySelector('textarea');\n  textarea.oninput = function () {\n    textarea.style.height = 'auto';\n    var style = window.getComputedStyle(textarea, null);\n    var height = parseInt(style.height, 10);\n    var clientHeight = textarea.clientHeight;\n    var scrollHeight = textarea.scrollHeight;\n    if (clientHeight < scrollHeight) {\n      textarea.style.height = height + scrollHeight - clientHeight + 'px';\n    }\n  };\n\n  var _container$querySelec = container.querySelectorAll('.gitment-editor-tab'),\n      _container$querySelec2 = _slicedToArray(_container$querySelec, 2),\n      writeTab = _container$querySelec2[0],\n      previewTab = _container$querySelec2[1];\n\n  writeTab.onclick = function () {\n    writeTab.classList.add('gitment-selected');\n    previewTab.classList.remove('gitment-selected');\n    writeField.classList.remove('gitment-hidden');\n    previewField.classList.add('gitment-hidden');\n\n    textarea.focus();\n  };\n  previewTab.onclick = function () {\n    previewTab.classList.add('gitment-selected');\n    writeTab.classList.remove('gitment-selected');\n    previewField.classList.remove('gitment-hidden');\n    writeField.classList.add('gitment-hidden');\n\n    var preview = previewField.querySelector('.gitment-editor-preview');\n    var content = textarea.value.trim();\n    if (!content) {\n      preview.innerText = 'Nothing to preview';\n      return;\n    }\n\n    preview.innerText = 'Loading preview...';\n    instance.markdown(content).then(function (html) {\n      return preview.innerHTML = html;\n    });\n  };\n\n  var submitButton = container.querySelector('.gitment-editor-submit');\n  submitButton.onclick = function () {\n    submitButton.innerText = 'Submitting...';\n    submitButton.setAttribute('disabled', true);\n    instance.post(textarea.value.trim()).then(function (data) {\n      textarea.value = '';\n      textarea.style.height = 'auto';\n      submitButton.removeAttribute('disabled');\n      submitButton.innerText = 'Comment';\n    }).catch(function (e) {\n      alert(e);\n      submitButton.removeAttribute('disabled');\n      submitButton.innerText = 'Comment';\n    });\n  };\n\n  return container;\n}\n\nfunction renderFooter() {\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-footer-container';\n  container.innerHTML = '\\n    Powered by\\n    <a class=\"gitment-footer-project-link\" href=\"https://github.com/imsun/gitment\" target=\"_blank\">\\n      Gitment\\n    </a>\\n  ';\n  return container;\n}\n\nfunction render(state, instance) {\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-root-container';\n  container.appendChild(instance.renderHeader(state, instance));\n  container.appendChild(instance.renderComments(state, instance));\n  container.appendChild(instance.renderEditor(state, instance));\n  container.appendChild(instance.renderFooter(state, instance));\n  return container;\n}\n\nexports.default = { render: render, renderHeader: renderHeader, renderComments: renderComments, renderEditor: renderEditor, renderFooter: renderFooter };\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.http = exports.Query = exports.isString = undefined;\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nexports.getTargetContainer = getTargetContainer;\n\nvar _constants = __webpack_require__(0);\n\nvar isString = exports.isString = function isString(s) {\n  return toString.call(s) === '[object String]';\n};\n\nfunction getTargetContainer(container) {\n  var targetContainer = void 0;\n  if (container instanceof Element) {\n    targetContainer = container;\n  } else if (isString(container)) {\n    targetContainer = document.getElementById(container);\n  } else {\n    targetContainer = document.createElement('div');\n  }\n\n  return targetContainer;\n}\n\nvar Query = exports.Query = {\n  parse: function parse() {\n    var search = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : window.location.search;\n\n    if (!search) return {};\n    var queryString = search[0] === '?' ? search.substring(1) : search;\n    var query = {};\n    queryString.split('&').forEach(function (queryStr) {\n      var _queryStr$split = queryStr.split('='),\n          _queryStr$split2 = _slicedToArray(_queryStr$split, 2),\n          key = _queryStr$split2[0],\n          value = _queryStr$split2[1];\n\n      if (key) query[key] = value;\n    });\n\n    return query;\n  },\n  stringify: function stringify(query) {\n    var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '?';\n\n    var queryString = Object.keys(query).map(function (key) {\n      return key + '=' + encodeURIComponent(query[key] || '');\n    }).join('&');\n    return queryString ? prefix + queryString : '';\n  }\n};\n\nfunction ajaxFactory(method) {\n  return function (apiPath) {\n    var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var base = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'https://api.github.com';\n\n    var req = new XMLHttpRequest();\n    var token = localStorage.getItem(_constants.LS_ACCESS_TOKEN_KEY);\n\n    var url = '' + base + apiPath;\n    var body = null;\n    if (method === 'GET' || method === 'DELETE') {\n      url += Query.stringify(data);\n    }\n\n    var p = new Promise(function (resolve, reject) {\n      req.addEventListener('load', function () {\n        var contentType = req.getResponseHeader('content-type');\n        var res = req.responseText;\n        if (!/json/.test(contentType)) {\n          resolve(res);\n          return;\n        }\n        var data = req.responseText ? JSON.parse(res) : {};\n        if (data.message) {\n          reject(new Error(data.message));\n        } else {\n          resolve(data);\n        }\n      });\n      req.addEventListener('error', function (error) {\n        return reject(error);\n      });\n    });\n    req.open(method, url, true);\n\n    req.setRequestHeader('Accept', 'application/vnd.github.squirrel-girl-preview, application/vnd.github.html+json');\n    if (token) {\n      req.setRequestHeader('Authorization', 'token ' + token);\n    }\n    if (method !== 'GET' && method !== 'DELETE') {\n      body = JSON.stringify(data);\n      req.setRequestHeader('Content-Type', 'application/json');\n    }\n\n    req.send(body);\n    return p;\n  };\n}\n\nvar http = exports.http = {\n  get: ajaxFactory('GET'),\n  post: ajaxFactory('POST'),\n  delete: ajaxFactory('DELETE'),\n  put: ajaxFactory('PUT')\n};\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar g;\n\n// This works in non-strict mode\ng = function () {\n\treturn this;\n}();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || Function(\"return this\")() || (1, eval)(\"this\");\n} catch (e) {\n\t// This works if the window reference is available\n\tif ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _mobx = __webpack_require__(1);\n\nvar _constants = __webpack_require__(0);\n\nvar _utils = __webpack_require__(3);\n\nvar _default = __webpack_require__(2);\n\nvar _default2 = _interopRequireDefault(_default);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar scope = 'public_repo';\n\nfunction extendRenderer(instance, renderer) {\n  instance[renderer] = function (container) {\n    var targetContainer = (0, _utils.getTargetContainer)(container);\n    var render = instance.theme[renderer] || instance.defaultTheme[renderer];\n\n    (0, _mobx.autorun)(function () {\n      var e = render(instance.state, instance);\n      if (targetContainer.firstChild) {\n        targetContainer.replaceChild(e, targetContainer.firstChild);\n      } else {\n        targetContainer.appendChild(e);\n      }\n    });\n\n    return targetContainer;\n  };\n}\n\nvar Gitment = function () {\n  _createClass(Gitment, [{\n    key: 'accessToken',\n    get: function get() {\n      return localStorage.getItem(_constants.LS_ACCESS_TOKEN_KEY);\n    },\n    set: function set(token) {\n      localStorage.setItem(_constants.LS_ACCESS_TOKEN_KEY, token);\n    }\n  }, {\n    key: 'loginLink',\n    get: function get() {\n      var oauthUri = 'https://github.com/login/oauth/authorize';\n      var redirect_uri = this.oauth.redirect_uri || window.location.href;\n\n      var oauthParams = Object.assign({\n        scope: scope,\n        redirect_uri: redirect_uri\n      }, this.oauth);\n\n      return '' + oauthUri + _utils.Query.stringify(oauthParams);\n    }\n  }]);\n\n  function Gitment() {\n    var _this = this;\n\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, Gitment);\n\n    this.defaultTheme = _default2.default;\n    this.useTheme(_default2.default);\n\n    Object.assign(this, {\n      id: window.location.href,\n      title: window.document.title,\n      link: window.location.href,\n      desc: '',\n      labels: [],\n      theme: _default2.default,\n      oauth: {},\n      perPage: 20,\n      maxCommentHeight: 250\n    }, options);\n\n    this.useTheme(this.theme);\n\n    var user = {};\n    try {\n      var userInfo = localStorage.getItem(_constants.LS_USER_KEY);\n      if (this.accessToken && userInfo) {\n        Object.assign(user, JSON.parse(userInfo), {\n          fromCache: true\n        });\n      }\n    } catch (e) {\n      localStorage.removeItem(_constants.LS_USER_KEY);\n    }\n\n    this.state = (0, _mobx.observable)({\n      user: user,\n      error: null,\n      meta: {},\n      comments: undefined,\n      reactions: [],\n      commentReactions: {},\n      currentPage: 1\n    });\n\n    var query = _utils.Query.parse();\n    if (query.code) {\n      var _oauth = this.oauth,\n          client_id = _oauth.client_id,\n          client_secret = _oauth.client_secret;\n\n      var code = query.code;\n      delete query.code;\n      var search = _utils.Query.stringify(query);\n      var replacedUrl = '' + window.location.origin + window.location.pathname + search + window.location.hash;\n      history.replaceState({}, '', replacedUrl);\n\n      Object.assign(this, {\n        id: replacedUrl,\n        link: replacedUrl\n      }, options);\n\n      this.state.user.isLoggingIn = true;\n      _utils.http.post('https://gh-oauth.imsun.net', {\n        code: code,\n        client_id: client_id,\n        client_secret: client_secret\n      }, '').then(function (data) {\n        _this.accessToken = data.access_token;\n        _this.update();\n      }).catch(function (e) {\n        _this.state.user.isLoggingIn = false;\n        alert(e);\n      });\n    } else {\n      this.update();\n    }\n  }\n\n  _createClass(Gitment, [{\n    key: 'init',\n    value: function init() {\n      var _this2 = this;\n\n      return this.createIssue().then(function () {\n        return _this2.loadComments();\n      }).then(function (comments) {\n        _this2.state.error = null;\n        return comments;\n      });\n    }\n  }, {\n    key: 'useTheme',\n    value: function useTheme() {\n      var _this3 = this;\n\n      var theme = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      this.theme = theme;\n\n      var renderers = Object.keys(this.theme);\n      renderers.forEach(function (renderer) {\n        return extendRenderer(_this3, renderer);\n      });\n    }\n  }, {\n    key: 'update',\n    value: function update() {\n      var _this4 = this;\n\n      return Promise.all([this.loadMeta(), this.loadUserInfo()]).then(function () {\n        return Promise.all([_this4.loadComments().then(function () {\n          return _this4.loadCommentReactions();\n        }), _this4.loadReactions()]);\n      }).catch(function (e) {\n        return _this4.state.error = e;\n      });\n    }\n  }, {\n    key: 'markdown',\n    value: function markdown(text) {\n      return _utils.http.post('/markdown', {\n        text: text,\n        mode: 'gfm'\n      });\n    }\n  }, {\n    key: 'createIssue',\n    value: function createIssue() {\n      var _this5 = this;\n\n      var id = this.id,\n          owner = this.owner,\n          repo = this.repo,\n          title = this.title,\n          link = this.link,\n          desc = this.desc,\n          labels = this.labels;\n\n\n      return _utils.http.post('/repos/' + owner + '/' + repo + '/issues', {\n        title: title,\n        labels: labels.concat(['gitment', id]),\n        body: link + '\\n\\n' + desc\n      }).then(function (meta) {\n        _this5.state.meta = meta;\n        return meta;\n      });\n    }\n  }, {\n    key: 'getIssue',\n    value: function getIssue() {\n      if (this.state.meta.id) return Promise.resolve(this.state.meta);\n\n      return this.loadMeta();\n    }\n  }, {\n    key: 'post',\n    value: function post(body) {\n      var _this6 = this;\n\n      return this.getIssue().then(function (issue) {\n        return _utils.http.post(issue.comments_url, { body: body }, '');\n      }).then(function (data) {\n        _this6.state.meta.comments++;\n        var pageCount = Math.ceil(_this6.state.meta.comments / _this6.perPage);\n        if (_this6.state.currentPage === pageCount) {\n          _this6.state.comments.push(data);\n        }\n        return data;\n      });\n    }\n  }, {\n    key: 'loadMeta',\n    value: function loadMeta() {\n      var _this7 = this;\n\n      var id = this.id,\n          owner = this.owner,\n          repo = this.repo;\n\n      return _utils.http.get('/repos/' + owner + '/' + repo + '/issues', {\n        creator: owner,\n        labels: id\n      }).then(function (issues) {\n        if (!issues.length) return Promise.reject(_constants.NOT_INITIALIZED_ERROR);\n        _this7.state.meta = issues[0];\n        return issues[0];\n      });\n    }\n  }, {\n    key: 'loadComments',\n    value: function loadComments() {\n      var _this8 = this;\n\n      var page = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.state.currentPage;\n\n      return this.getIssue().then(function (issue) {\n        return _utils.http.get(issue.comments_url, { page: page, per_page: _this8.perPage }, '');\n      }).then(function (comments) {\n        _this8.state.comments = comments;\n        return comments;\n      });\n    }\n  }, {\n    key: 'loadUserInfo',\n    value: function loadUserInfo() {\n      var _this9 = this;\n\n      if (!this.accessToken) {\n        this.logout();\n        return Promise.resolve({});\n      }\n\n      return _utils.http.get('/user').then(function (user) {\n        _this9.state.user = user;\n        localStorage.setItem(_constants.LS_USER_KEY, JSON.stringify(user));\n        return user;\n      });\n    }\n  }, {\n    key: 'loadReactions',\n    value: function loadReactions() {\n      var _this10 = this;\n\n      if (!this.accessToken) {\n        this.state.reactions = [];\n        return Promise.resolve([]);\n      }\n\n      return this.getIssue().then(function (issue) {\n        if (!issue.reactions.total_count) return [];\n        return _utils.http.get(issue.reactions.url, {}, '');\n      }).then(function (reactions) {\n        _this10.state.reactions = reactions;\n        return reactions;\n      });\n    }\n  }, {\n    key: 'loadCommentReactions',\n    value: function loadCommentReactions() {\n      var _this11 = this;\n\n      if (!this.accessToken) {\n        this.state.commentReactions = {};\n        return Promise.resolve([]);\n      }\n\n      var comments = this.state.comments;\n      var comentReactions = {};\n\n      return Promise.all(comments.map(function (comment) {\n        if (!comment.reactions.total_count) return [];\n\n        var owner = _this11.owner,\n            repo = _this11.repo;\n\n        return _utils.http.get('/repos/' + owner + '/' + repo + '/issues/comments/' + comment.id + '/reactions', {});\n      })).then(function (reactionsArray) {\n        comments.forEach(function (comment, index) {\n          comentReactions[comment.id] = reactionsArray[index];\n        });\n        _this11.state.commentReactions = comentReactions;\n\n        return comentReactions;\n      });\n    }\n  }, {\n    key: 'login',\n    value: function login() {\n      window.location.href = this.loginLink;\n    }\n  }, {\n    key: 'logout',\n    value: function logout() {\n      localStorage.removeItem(_constants.LS_ACCESS_TOKEN_KEY);\n      localStorage.removeItem(_constants.LS_USER_KEY);\n      this.state.user = {};\n    }\n  }, {\n    key: 'goto',\n    value: function goto(page) {\n      this.state.currentPage = page;\n      this.state.comments = undefined;\n      return this.loadComments(page);\n    }\n  }, {\n    key: 'like',\n    value: function like() {\n      var _this12 = this;\n\n      if (!this.accessToken) {\n        alert('Login to Like');\n        return Promise.reject();\n      }\n\n      var owner = this.owner,\n          repo = this.repo;\n\n\n      return _utils.http.post('/repos/' + owner + '/' + repo + '/issues/' + this.state.meta.number + '/reactions', {\n        content: 'heart'\n      }).then(function (reaction) {\n        _this12.state.reactions.push(reaction);\n        _this12.state.meta.reactions.heart++;\n      });\n    }\n  }, {\n    key: 'unlike',\n    value: function unlike() {\n      var _this13 = this;\n\n      if (!this.accessToken) return Promise.reject();\n\n      var _state = this.state,\n          user = _state.user,\n          reactions = _state.reactions;\n\n      var index = reactions.findIndex(function (reaction) {\n        return reaction.user.login === user.login;\n      });\n      return _utils.http.delete('/reactions/' + reactions[index].id).then(function () {\n        reactions.splice(index, 1);\n        _this13.state.meta.reactions.heart--;\n      });\n    }\n  }, {\n    key: 'likeAComment',\n    value: function likeAComment(commentId) {\n      var _this14 = this;\n\n      if (!this.accessToken) {\n        alert('Login to Like');\n        return Promise.reject();\n      }\n\n      var owner = this.owner,\n          repo = this.repo;\n\n      var comment = this.state.comments.find(function (comment) {\n        return comment.id === commentId;\n      });\n\n      return _utils.http.post('/repos/' + owner + '/' + repo + '/issues/comments/' + commentId + '/reactions', {\n        content: 'heart'\n      }).then(function (reaction) {\n        _this14.state.commentReactions[commentId].push(reaction);\n        comment.reactions.heart++;\n      });\n    }\n  }, {\n    key: 'unlikeAComment',\n    value: function unlikeAComment(commentId) {\n      if (!this.accessToken) return Promise.reject();\n\n      var reactions = this.state.commentReactions[commentId];\n      var comment = this.state.comments.find(function (comment) {\n        return comment.id === commentId;\n      });\n      var user = this.state.user;\n\n      var index = reactions.findIndex(function (reaction) {\n        return reaction.user.login === user.login;\n      });\n\n      return _utils.http.delete('/reactions/' + reactions[index].id).then(function () {\n        reactions.splice(index, 1);\n        comment.reactions.heart--;\n      });\n    }\n  }]);\n\n  return Gitment;\n}();\n\nmodule.exports = Gitment;\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/**\n * Modified from https://github.com/evil-icons/evil-icons\n */\n\nvar close = exports.close = '<svg class=\"gitment-close-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 50 50\"><path d=\"M37.304 11.282l1.414 1.414-26.022 26.02-1.414-1.413z\"/><path d=\"M12.696 11.282l26.022 26.02-1.414 1.415-26.022-26.02z\"/></svg>';\nvar github = exports.github = '<svg class=\"gitment-github-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 50 50\"><path d=\"M25 10c-8.3 0-15 6.7-15 15 0 6.6 4.3 12.2 10.3 14.2.8.1 1-.3 1-.7v-2.6c-4.2.9-5.1-2-5.1-2-.7-1.7-1.7-2.2-1.7-2.2-1.4-.9.1-.9.1-.9 1.5.1 2.3 1.5 2.3 1.5 1.3 2.3 3.5 1.6 4.4 1.2.1-1 .5-1.6 1-2-3.3-.4-6.8-1.7-6.8-7.4 0-1.6.6-3 1.5-4-.2-.4-.7-1.9.1-4 0 0 1.3-.4 4.1 1.5 1.2-.3 2.5-.5 3.8-.5 1.3 0 2.6.2 3.8.5 2.9-1.9 4.1-1.5 4.1-1.5.8 2.1.3 3.6.1 4 1 1 1.5 2.4 1.5 4 0 5.8-3.5 7-6.8 7.4.5.5 1 1.4 1 2.8v4.1c0 .4.3.9 1 .7 6-2 10.2-7.6 10.2-14.2C40 16.7 33.3 10 25 10z\"/></svg>';\nvar heart = exports.heart = '<svg class=\"gitment-heart-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 50 50\"><path d=\"M25 39.7l-.6-.5C11.5 28.7 8 25 8 19c0-5 4-9 9-9 4.1 0 6.4 2.3 8 4.1 1.6-1.8 3.9-4.1 8-4.1 5 0 9 4 9 9 0 6-3.5 9.7-16.4 20.2l-.6.5zM17 12c-3.9 0-7 3.1-7 7 0 5.1 3.2 8.5 15 18.1 11.8-9.6 15-13 15-18.1 0-3.9-3.1-7-7-7-3.5 0-5.4 2.1-6.9 3.8L25 17.1l-1.1-1.3C22.4 14.1 20.5 12 17 12z\"/></svg>';\nvar spinner = exports.spinner = '<svg class=\"gitment-spinner-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 50 50\"><path d=\"M25 18c-.6 0-1-.4-1-1V9c0-.6.4-1 1-1s1 .4 1 1v8c0 .6-.4 1-1 1z\"/><path opacity=\".3\" d=\"M25 42c-.6 0-1-.4-1-1v-8c0-.6.4-1 1-1s1 .4 1 1v8c0 .6-.4 1-1 1z\"/><path opacity=\".3\" d=\"M29 19c-.2 0-.3 0-.5-.1-.4-.3-.6-.8-.3-1.3l4-6.9c.3-.4.8-.6 1.3-.3.4.3.6.8.3 1.3l-4 6.9c-.2.2-.5.4-.8.4z\"/><path opacity=\".3\" d=\"M17 39.8c-.2 0-.3 0-.5-.1-.4-.3-.6-.8-.3-1.3l4-6.9c.3-.4.8-.6 1.3-.3.4.3.6.8.3 1.3l-4 6.9c-.2.2-.5.4-.8.4z\"/><path opacity=\".93\" d=\"M21 19c-.3 0-.6-.2-.8-.5l-4-6.9c-.3-.4-.1-1 .3-1.3.4-.3 1-.1 1.3.3l4 6.9c.3.4.1 1-.3 1.3-.2.2-.3.2-.5.2z\"/><path opacity=\".3\" d=\"M33 39.8c-.3 0-.6-.2-.8-.5l-4-6.9c-.3-.4-.1-1 .3-1.3.4-.3 1-.1 1.3.3l4 6.9c.3.4.1 1-.3 1.3-.2.1-.3.2-.5.2z\"/><path opacity=\".65\" d=\"M17 26H9c-.6 0-1-.4-1-1s.4-1 1-1h8c.6 0 1 .4 1 1s-.4 1-1 1z\"/><path opacity=\".3\" d=\"M41 26h-8c-.6 0-1-.4-1-1s.4-1 1-1h8c.6 0 1 .4 1 1s-.4 1-1 1z\"/><path opacity=\".86\" d=\"M18.1 21.9c-.2 0-.3 0-.5-.1l-6.9-4c-.4-.3-.6-.8-.3-1.3.3-.4.8-.6 1.3-.3l6.9 4c.4.3.6.8.3 1.3-.2.3-.5.4-.8.4z\"/><path opacity=\".3\" d=\"M38.9 33.9c-.2 0-.3 0-.5-.1l-6.9-4c-.4-.3-.6-.8-.3-1.3.3-.4.8-.6 1.3-.3l6.9 4c.4.3.6.8.3 1.3-.2.3-.5.4-.8.4z\"/><path opacity=\".44\" d=\"M11.1 33.9c-.3 0-.6-.2-.8-.5-.3-.4-.1-1 .3-1.3l6.9-4c.4-.3 1-.1 1.3.3.3.4.1 1-.3 1.3l-6.9 4c-.1.2-.3.2-.5.2z\"/><path opacity=\".3\" d=\"M31.9 21.9c-.3 0-.6-.2-.8-.5-.3-.4-.1-1 .3-1.3l6.9-4c.4-.3 1-.1 1.3.3.3.4.1 1-.3 1.3l-6.9 4c-.2.2-.3.2-.5.2z\"/></svg>';\n\n/***/ })\n/******/ ]);\n//# sourceMappingURL=gitment.browser.js.map","source":"js/gitment.browser.js","raw":"var Gitment =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 5);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar LS_ACCESS_TOKEN_KEY = exports.LS_ACCESS_TOKEN_KEY = 'gitment-comments-token';\nvar LS_USER_KEY = exports.LS_USER_KEY = 'gitment-user-info';\n\nvar NOT_INITIALIZED_ERROR = exports.NOT_INITIALIZED_ERROR = new Error('Comments Not Initialized');\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global) {\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar __extends = undefined && undefined.__extends || function () {\n    var extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (d, b) {\n        d.__proto__ = b;\n    } || function (d, b) {\n        for (var p in b) {\n            if (b.hasOwnProperty(p)) d[p] = b[p];\n        }\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() {\n            this.constructor = d;\n        }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n}();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nregisterGlobals();\nexports.extras = {\n    allowStateChanges: allowStateChanges,\n    deepEqual: deepEqual,\n    getAtom: getAtom,\n    getDebugName: getDebugName,\n    getDependencyTree: getDependencyTree,\n    getAdministration: getAdministration,\n    getGlobalState: getGlobalState,\n    getObserverTree: getObserverTree,\n    isComputingDerivation: isComputingDerivation,\n    isSpyEnabled: isSpyEnabled,\n    onReactionError: onReactionError,\n    resetGlobalState: resetGlobalState,\n    shareGlobalState: shareGlobalState,\n    spyReport: spyReport,\n    spyReportEnd: spyReportEnd,\n    spyReportStart: spyReportStart,\n    setReactionScheduler: setReactionScheduler\n};\nif ((typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__ === \"undefined\" ? \"undefined\" : _typeof(__MOBX_DEVTOOLS_GLOBAL_HOOK__)) === \"object\") {\n    __MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx(module.exports);\n}\nmodule.exports.default = module.exports;\nvar actionFieldDecorator = createClassPropertyDecorator(function (target, key, value, args, originalDescriptor) {\n    var actionName = args && args.length === 1 ? args[0] : value.name || key || \"<unnamed action>\";\n    var wrappedAction = action(actionName, value);\n    addHiddenProp(target, key, wrappedAction);\n}, function (key) {\n    return this[key];\n}, function () {\n    invariant(false, getMessage(\"m001\"));\n}, false, true);\nvar boundActionDecorator = createClassPropertyDecorator(function (target, key, value) {\n    defineBoundAction(target, key, value);\n}, function (key) {\n    return this[key];\n}, function () {\n    invariant(false, getMessage(\"m001\"));\n}, false, false);\nvar action = function action(arg1, arg2, arg3, arg4) {\n    if (arguments.length === 1 && typeof arg1 === \"function\") return createAction(arg1.name || \"<unnamed action>\", arg1);\n    if (arguments.length === 2 && typeof arg2 === \"function\") return createAction(arg1, arg2);\n    if (arguments.length === 1 && typeof arg1 === \"string\") return namedActionDecorator(arg1);\n    return namedActionDecorator(arg2).apply(null, arguments);\n};\nexports.action = action;\naction.bound = function boundAction(arg1, arg2, arg3) {\n    if (typeof arg1 === \"function\") {\n        var action_1 = createAction(\"<not yet bound action>\", arg1);\n        action_1.autoBind = true;\n        return action_1;\n    }\n    return boundActionDecorator.apply(null, arguments);\n};\nfunction namedActionDecorator(name) {\n    return function (target, prop, descriptor) {\n        if (descriptor && typeof descriptor.value === \"function\") {\n            descriptor.value = createAction(name, descriptor.value);\n            descriptor.enumerable = false;\n            descriptor.configurable = true;\n            return descriptor;\n        }\n        return actionFieldDecorator(name).apply(this, arguments);\n    };\n}\nfunction runInAction(arg1, arg2, arg3) {\n    var actionName = typeof arg1 === \"string\" ? arg1 : arg1.name || \"<unnamed action>\";\n    var fn = typeof arg1 === \"function\" ? arg1 : arg2;\n    var scope = typeof arg1 === \"function\" ? arg2 : arg3;\n    invariant(typeof fn === \"function\", getMessage(\"m002\"));\n    invariant(fn.length === 0, getMessage(\"m003\"));\n    invariant(typeof actionName === \"string\" && actionName.length > 0, \"actions should have valid names, got: '\" + actionName + \"'\");\n    return executeAction(actionName, fn, scope, undefined);\n}\nexports.runInAction = runInAction;\nfunction isAction(thing) {\n    return typeof thing === \"function\" && thing.isMobxAction === true;\n}\nexports.isAction = isAction;\nfunction defineBoundAction(target, propertyName, fn) {\n    var res = function res() {\n        return executeAction(propertyName, fn, target, arguments);\n    };\n    res.isMobxAction = true;\n    addHiddenProp(target, propertyName, res);\n}\nfunction autorun(arg1, arg2, arg3) {\n    var name, view, scope;\n    if (typeof arg1 === \"string\") {\n        name = arg1;\n        view = arg2;\n        scope = arg3;\n    } else {\n        name = arg1.name || \"Autorun@\" + getNextId();\n        view = arg1;\n        scope = arg2;\n    }\n    invariant(typeof view === \"function\", getMessage(\"m004\"));\n    invariant(isAction(view) === false, getMessage(\"m005\"));\n    if (scope) view = view.bind(scope);\n    var reaction = new Reaction(name, function () {\n        this.track(reactionRunner);\n    });\n    function reactionRunner() {\n        view(reaction);\n    }\n    reaction.schedule();\n    return reaction.getDisposer();\n}\nexports.autorun = autorun;\nfunction when(arg1, arg2, arg3, arg4) {\n    var name, predicate, effect, scope;\n    if (typeof arg1 === \"string\") {\n        name = arg1;\n        predicate = arg2;\n        effect = arg3;\n        scope = arg4;\n    } else {\n        name = \"When@\" + getNextId();\n        predicate = arg1;\n        effect = arg2;\n        scope = arg3;\n    }\n    var disposer = autorun(name, function (r) {\n        if (predicate.call(scope)) {\n            r.dispose();\n            var prevUntracked = untrackedStart();\n            effect.call(scope);\n            untrackedEnd(prevUntracked);\n        }\n    });\n    return disposer;\n}\nexports.when = when;\nfunction autorunAsync(arg1, arg2, arg3, arg4) {\n    var name, func, delay, scope;\n    if (typeof arg1 === \"string\") {\n        name = arg1;\n        func = arg2;\n        delay = arg3;\n        scope = arg4;\n    } else {\n        name = arg1.name || \"AutorunAsync@\" + getNextId();\n        func = arg1;\n        delay = arg2;\n        scope = arg3;\n    }\n    invariant(isAction(func) === false, getMessage(\"m006\"));\n    if (delay === void 0) delay = 1;\n    if (scope) func = func.bind(scope);\n    var isScheduled = false;\n    var r = new Reaction(name, function () {\n        if (!isScheduled) {\n            isScheduled = true;\n            setTimeout(function () {\n                isScheduled = false;\n                if (!r.isDisposed) r.track(reactionRunner);\n            }, delay);\n        }\n    });\n    function reactionRunner() {\n        func(r);\n    }\n    r.schedule();\n    return r.getDisposer();\n}\nexports.autorunAsync = autorunAsync;\nfunction reaction(expression, effect, arg3) {\n    if (arguments.length > 3) {\n        fail(getMessage(\"m007\"));\n    }\n    if (isModifierDescriptor(expression)) {\n        fail(getMessage(\"m008\"));\n    }\n    var opts;\n    if ((typeof arg3 === \"undefined\" ? \"undefined\" : _typeof(arg3)) === \"object\") {\n        opts = arg3;\n    } else {\n        opts = {};\n    }\n    opts.name = opts.name || expression.name || effect.name || \"Reaction@\" + getNextId();\n    opts.fireImmediately = arg3 === true || opts.fireImmediately === true;\n    opts.delay = opts.delay || 0;\n    opts.compareStructural = opts.compareStructural || opts.struct || false;\n    effect = action(opts.name, opts.context ? effect.bind(opts.context) : effect);\n    if (opts.context) {\n        expression = expression.bind(opts.context);\n    }\n    var firstTime = true;\n    var isScheduled = false;\n    var nextValue;\n    var r = new Reaction(opts.name, function () {\n        if (firstTime || opts.delay < 1) {\n            reactionRunner();\n        } else if (!isScheduled) {\n            isScheduled = true;\n            setTimeout(function () {\n                isScheduled = false;\n                reactionRunner();\n            }, opts.delay);\n        }\n    });\n    function reactionRunner() {\n        if (r.isDisposed) return;\n        var changed = false;\n        r.track(function () {\n            var v = expression(r);\n            changed = valueDidChange(opts.compareStructural, nextValue, v);\n            nextValue = v;\n        });\n        if (firstTime && opts.fireImmediately) effect(nextValue, r);\n        if (!firstTime && changed === true) effect(nextValue, r);\n        if (firstTime) firstTime = false;\n    }\n    r.schedule();\n    return r.getDisposer();\n}\nexports.reaction = reaction;\nfunction createComputedDecorator(compareStructural) {\n    return createClassPropertyDecorator(function (target, name, _, __, originalDescriptor) {\n        invariant(typeof originalDescriptor !== \"undefined\", getMessage(\"m009\"));\n        invariant(typeof originalDescriptor.get === \"function\", getMessage(\"m010\"));\n        var adm = asObservableObject(target, \"\");\n        defineComputedProperty(adm, name, originalDescriptor.get, originalDescriptor.set, compareStructural, false);\n    }, function (name) {\n        var observable = this.$mobx.values[name];\n        if (observable === undefined) return undefined;\n        return observable.get();\n    }, function (name, value) {\n        this.$mobx.values[name].set(value);\n    }, false, false);\n}\nvar computedDecorator = createComputedDecorator(false);\nvar computedStructDecorator = createComputedDecorator(true);\nvar computed = function computed(arg1, arg2, arg3) {\n    if (typeof arg2 === \"string\") {\n        return computedDecorator.apply(null, arguments);\n    }\n    invariant(typeof arg1 === \"function\", getMessage(\"m011\"));\n    invariant(arguments.length < 3, getMessage(\"m012\"));\n    var opts = (typeof arg2 === \"undefined\" ? \"undefined\" : _typeof(arg2)) === \"object\" ? arg2 : {};\n    opts.setter = typeof arg2 === \"function\" ? arg2 : opts.setter;\n    return new ComputedValue(arg1, opts.context, opts.compareStructural || opts.struct || false, opts.name || arg1.name || \"\", opts.setter);\n};\nexports.computed = computed;\ncomputed.struct = computedStructDecorator;\nfunction createTransformer(transformer, onCleanup) {\n    invariant(typeof transformer === \"function\" && transformer.length < 2, \"createTransformer expects a function that accepts one argument\");\n    var objectCache = {};\n    var resetId = globalState.resetId;\n    var Transformer = function (_super) {\n        __extends(Transformer, _super);\n        function Transformer(sourceIdentifier, sourceObject) {\n            var _this = _super.call(this, function () {\n                return transformer(sourceObject);\n            }, undefined, false, \"Transformer-\" + transformer.name + \"-\" + sourceIdentifier, undefined) || this;\n            _this.sourceIdentifier = sourceIdentifier;\n            _this.sourceObject = sourceObject;\n            return _this;\n        }\n        Transformer.prototype.onBecomeUnobserved = function () {\n            var lastValue = this.value;\n            _super.prototype.onBecomeUnobserved.call(this);\n            delete objectCache[this.sourceIdentifier];\n            if (onCleanup) onCleanup(lastValue, this.sourceObject);\n        };\n        return Transformer;\n    }(ComputedValue);\n    return function (object) {\n        if (resetId !== globalState.resetId) {\n            objectCache = {};\n            resetId = globalState.resetId;\n        }\n        var identifier = getMemoizationId(object);\n        var reactiveTransformer = objectCache[identifier];\n        if (reactiveTransformer) return reactiveTransformer.get();\n        reactiveTransformer = objectCache[identifier] = new Transformer(identifier, object);\n        return reactiveTransformer.get();\n    };\n}\nexports.createTransformer = createTransformer;\nfunction getMemoizationId(object) {\n    if (object === null || (typeof object === \"undefined\" ? \"undefined\" : _typeof(object)) !== \"object\") throw new Error(\"[mobx] transform expected some kind of object, got: \" + object);\n    var tid = object.$transformId;\n    if (tid === undefined) {\n        tid = getNextId();\n        addHiddenProp(object, \"$transformId\", tid);\n    }\n    return tid;\n}\nfunction expr(expr, scope) {\n    if (!isComputingDerivation()) console.warn(getMessage(\"m013\"));\n    return computed(expr, { context: scope }).get();\n}\nexports.expr = expr;\nfunction extendObservable(target) {\n    var properties = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        properties[_i - 1] = arguments[_i];\n    }\n    return extendObservableHelper(target, deepEnhancer, properties);\n}\nexports.extendObservable = extendObservable;\nfunction extendShallowObservable(target) {\n    var properties = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        properties[_i - 1] = arguments[_i];\n    }\n    return extendObservableHelper(target, referenceEnhancer, properties);\n}\nexports.extendShallowObservable = extendShallowObservable;\nfunction extendObservableHelper(target, defaultEnhancer, properties) {\n    invariant(arguments.length >= 2, getMessage(\"m014\"));\n    invariant((typeof target === \"undefined\" ? \"undefined\" : _typeof(target)) === \"object\", getMessage(\"m015\"));\n    invariant(!isObservableMap(target), getMessage(\"m016\"));\n    properties.forEach(function (propSet) {\n        invariant((typeof propSet === \"undefined\" ? \"undefined\" : _typeof(propSet)) === \"object\", getMessage(\"m017\"));\n        invariant(!isObservable(propSet), getMessage(\"m018\"));\n    });\n    var adm = asObservableObject(target);\n    var definedProps = {};\n    for (var i = properties.length - 1; i >= 0; i--) {\n        var propSet = properties[i];\n        for (var key in propSet) {\n            if (definedProps[key] !== true && hasOwnProperty(propSet, key)) {\n                definedProps[key] = true;\n                if (target === propSet && !isPropertyConfigurable(target, key)) continue;\n                var descriptor = Object.getOwnPropertyDescriptor(propSet, key);\n                defineObservablePropertyFromDescriptor(adm, key, descriptor, defaultEnhancer);\n            }\n        }\n    }\n    return target;\n}\nfunction getDependencyTree(thing, property) {\n    return nodeToDependencyTree(getAtom(thing, property));\n}\nfunction nodeToDependencyTree(node) {\n    var result = {\n        name: node.name\n    };\n    if (node.observing && node.observing.length > 0) result.dependencies = unique(node.observing).map(nodeToDependencyTree);\n    return result;\n}\nfunction getObserverTree(thing, property) {\n    return nodeToObserverTree(getAtom(thing, property));\n}\nfunction nodeToObserverTree(node) {\n    var result = {\n        name: node.name\n    };\n    if (hasObservers(node)) result.observers = getObservers(node).map(nodeToObserverTree);\n    return result;\n}\nfunction intercept(thing, propOrHandler, handler) {\n    if (typeof handler === \"function\") return interceptProperty(thing, propOrHandler, handler);else return interceptInterceptable(thing, propOrHandler);\n}\nexports.intercept = intercept;\nfunction interceptInterceptable(thing, handler) {\n    return getAdministration(thing).intercept(handler);\n}\nfunction interceptProperty(thing, property, handler) {\n    return getAdministration(thing, property).intercept(handler);\n}\nfunction isComputed(value, property) {\n    if (value === null || value === undefined) return false;\n    if (property !== undefined) {\n        if (isObservableObject(value) === false) return false;\n        var atom = getAtom(value, property);\n        return isComputedValue(atom);\n    }\n    return isComputedValue(value);\n}\nexports.isComputed = isComputed;\nfunction isObservable(value, property) {\n    if (value === null || value === undefined) return false;\n    if (property !== undefined) {\n        if (isObservableArray(value) || isObservableMap(value)) throw new Error(getMessage(\"m019\"));else if (isObservableObject(value)) {\n            var o = value.$mobx;\n            return o.values && !!o.values[property];\n        }\n        return false;\n    }\n    return isObservableObject(value) || !!value.$mobx || isAtom(value) || isReaction(value) || isComputedValue(value);\n}\nexports.isObservable = isObservable;\nvar deepDecorator = createDecoratorForEnhancer(deepEnhancer);\nvar shallowDecorator = createDecoratorForEnhancer(shallowEnhancer);\nvar refDecorator = createDecoratorForEnhancer(referenceEnhancer);\nvar deepStructDecorator = createDecoratorForEnhancer(deepStructEnhancer);\nvar refStructDecorator = createDecoratorForEnhancer(refStructEnhancer);\nfunction createObservable(v) {\n    if (v === void 0) {\n        v = undefined;\n    }\n    if (typeof arguments[1] === \"string\") return deepDecorator.apply(null, arguments);\n    invariant(arguments.length <= 1, getMessage(\"m021\"));\n    invariant(!isModifierDescriptor(v), getMessage(\"m020\"));\n    if (isObservable(v)) return v;\n    var res = deepEnhancer(v, undefined, undefined);\n    if (res !== v) return res;\n    return observable.box(v);\n}\nvar IObservableFactories = function () {\n    function IObservableFactories() {}\n    IObservableFactories.prototype.box = function (value, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"box\");\n        return new ObservableValue(value, deepEnhancer, name);\n    };\n    IObservableFactories.prototype.shallowBox = function (value, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"shallowBox\");\n        return new ObservableValue(value, referenceEnhancer, name);\n    };\n    IObservableFactories.prototype.array = function (initialValues, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"array\");\n        return new ObservableArray(initialValues, deepEnhancer, name);\n    };\n    IObservableFactories.prototype.shallowArray = function (initialValues, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"shallowArray\");\n        return new ObservableArray(initialValues, referenceEnhancer, name);\n    };\n    IObservableFactories.prototype.map = function (initialValues, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"map\");\n        return new ObservableMap(initialValues, deepEnhancer, name);\n    };\n    IObservableFactories.prototype.shallowMap = function (initialValues, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"shallowMap\");\n        return new ObservableMap(initialValues, referenceEnhancer, name);\n    };\n    IObservableFactories.prototype.object = function (props, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"object\");\n        var res = {};\n        asObservableObject(res, name);\n        extendObservable(res, props);\n        return res;\n    };\n    IObservableFactories.prototype.shallowObject = function (props, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"shallowObject\");\n        var res = {};\n        asObservableObject(res, name);\n        extendShallowObservable(res, props);\n        return res;\n    };\n    IObservableFactories.prototype.ref = function () {\n        if (arguments.length < 2) {\n            return createModifierDescriptor(referenceEnhancer, arguments[0]);\n        } else {\n            return refDecorator.apply(null, arguments);\n        }\n    };\n    IObservableFactories.prototype.shallow = function () {\n        if (arguments.length < 2) {\n            return createModifierDescriptor(shallowEnhancer, arguments[0]);\n        } else {\n            return shallowDecorator.apply(null, arguments);\n        }\n    };\n    IObservableFactories.prototype.deep = function () {\n        if (arguments.length < 2) {\n            return createModifierDescriptor(deepEnhancer, arguments[0]);\n        } else {\n            return deepDecorator.apply(null, arguments);\n        }\n    };\n    IObservableFactories.prototype.struct = function () {\n        if (arguments.length < 2) {\n            return createModifierDescriptor(deepStructEnhancer, arguments[0]);\n        } else {\n            return deepStructDecorator.apply(null, arguments);\n        }\n    };\n    return IObservableFactories;\n}();\nexports.IObservableFactories = IObservableFactories;\nvar observable = createObservable;\nexports.observable = observable;\nObject.keys(IObservableFactories.prototype).forEach(function (key) {\n    return observable[key] = IObservableFactories.prototype[key];\n});\nobservable.deep.struct = observable.struct;\nobservable.ref.struct = function () {\n    if (arguments.length < 2) {\n        return createModifierDescriptor(refStructEnhancer, arguments[0]);\n    } else {\n        return refStructDecorator.apply(null, arguments);\n    }\n};\nfunction incorrectlyUsedAsDecorator(methodName) {\n    fail(\"Expected one or two arguments to observable.\" + methodName + \". Did you accidentally try to use observable.\" + methodName + \" as decorator?\");\n}\nfunction createDecoratorForEnhancer(enhancer) {\n    invariant(!!enhancer, \":(\");\n    return createClassPropertyDecorator(function (target, name, baseValue, _, baseDescriptor) {\n        assertPropertyConfigurable(target, name);\n        invariant(!baseDescriptor || !baseDescriptor.get, getMessage(\"m022\"));\n        var adm = asObservableObject(target, undefined);\n        defineObservableProperty(adm, name, baseValue, enhancer);\n    }, function (name) {\n        var observable = this.$mobx.values[name];\n        if (observable === undefined) return undefined;\n        return observable.get();\n    }, function (name, value) {\n        setPropertyValue(this, name, value);\n    }, true, false);\n}\nfunction observe(thing, propOrCb, cbOrFire, fireImmediately) {\n    if (typeof cbOrFire === \"function\") return observeObservableProperty(thing, propOrCb, cbOrFire, fireImmediately);else return observeObservable(thing, propOrCb, cbOrFire);\n}\nexports.observe = observe;\nfunction observeObservable(thing, listener, fireImmediately) {\n    return getAdministration(thing).observe(listener, fireImmediately);\n}\nfunction observeObservableProperty(thing, property, listener, fireImmediately) {\n    return getAdministration(thing, property).observe(listener, fireImmediately);\n}\nfunction toJS(source, detectCycles, __alreadySeen) {\n    if (detectCycles === void 0) {\n        detectCycles = true;\n    }\n    if (__alreadySeen === void 0) {\n        __alreadySeen = [];\n    }\n    function cache(value) {\n        if (detectCycles) __alreadySeen.push([source, value]);\n        return value;\n    }\n    if (isObservable(source)) {\n        if (detectCycles && __alreadySeen === null) __alreadySeen = [];\n        if (detectCycles && source !== null && (typeof source === \"undefined\" ? \"undefined\" : _typeof(source)) === \"object\") {\n            for (var i = 0, l = __alreadySeen.length; i < l; i++) {\n                if (__alreadySeen[i][0] === source) return __alreadySeen[i][1];\n            }\n        }\n        if (isObservableArray(source)) {\n            var res = cache([]);\n            var toAdd = source.map(function (value) {\n                return toJS(value, detectCycles, __alreadySeen);\n            });\n            res.length = toAdd.length;\n            for (var i = 0, l = toAdd.length; i < l; i++) {\n                res[i] = toAdd[i];\n            }return res;\n        }\n        if (isObservableObject(source)) {\n            var res = cache({});\n            for (var key in source) {\n                res[key] = toJS(source[key], detectCycles, __alreadySeen);\n            }return res;\n        }\n        if (isObservableMap(source)) {\n            var res_1 = cache({});\n            source.forEach(function (value, key) {\n                return res_1[key] = toJS(value, detectCycles, __alreadySeen);\n            });\n            return res_1;\n        }\n        if (isObservableValue(source)) return toJS(source.get(), detectCycles, __alreadySeen);\n    }\n    return source;\n}\nexports.toJS = toJS;\nfunction transaction(action, thisArg) {\n    if (thisArg === void 0) {\n        thisArg = undefined;\n    }\n    deprecated(getMessage(\"m023\"));\n    return runInTransaction.apply(undefined, arguments);\n}\nexports.transaction = transaction;\nfunction runInTransaction(action, thisArg) {\n    if (thisArg === void 0) {\n        thisArg = undefined;\n    }\n    return executeAction(\"\", action);\n}\nfunction log(msg) {\n    console.log(msg);\n    return msg;\n}\nfunction whyRun(thing, prop) {\n    switch (arguments.length) {\n        case 0:\n            thing = globalState.trackingDerivation;\n            if (!thing) return log(getMessage(\"m024\"));\n            break;\n        case 2:\n            thing = getAtom(thing, prop);\n            break;\n    }\n    thing = getAtom(thing);\n    if (isComputedValue(thing)) return log(thing.whyRun());else if (isReaction(thing)) return log(thing.whyRun());\n    return fail(getMessage(\"m025\"));\n}\nexports.whyRun = whyRun;\nfunction createAction(actionName, fn) {\n    invariant(typeof fn === \"function\", getMessage(\"m026\"));\n    invariant(typeof actionName === \"string\" && actionName.length > 0, \"actions should have valid names, got: '\" + actionName + \"'\");\n    var res = function res() {\n        return executeAction(actionName, fn, this, arguments);\n    };\n    res.originalFn = fn;\n    res.isMobxAction = true;\n    return res;\n}\nfunction executeAction(actionName, fn, scope, args) {\n    var runInfo = startAction(actionName, fn, scope, args);\n    try {\n        return fn.apply(scope, args);\n    } finally {\n        endAction(runInfo);\n    }\n}\nfunction startAction(actionName, fn, scope, args) {\n    var notifySpy = isSpyEnabled() && !!actionName;\n    var startTime = 0;\n    if (notifySpy) {\n        startTime = Date.now();\n        var l = args && args.length || 0;\n        var flattendArgs = new Array(l);\n        if (l > 0) for (var i = 0; i < l; i++) {\n            flattendArgs[i] = args[i];\n        }spyReportStart({\n            type: \"action\",\n            name: actionName,\n            fn: fn,\n            object: scope,\n            arguments: flattendArgs\n        });\n    }\n    var prevDerivation = untrackedStart();\n    startBatch();\n    var prevAllowStateChanges = allowStateChangesStart(true);\n    return {\n        prevDerivation: prevDerivation,\n        prevAllowStateChanges: prevAllowStateChanges,\n        notifySpy: notifySpy,\n        startTime: startTime\n    };\n}\nfunction endAction(runInfo) {\n    allowStateChangesEnd(runInfo.prevAllowStateChanges);\n    endBatch();\n    untrackedEnd(runInfo.prevDerivation);\n    if (runInfo.notifySpy) spyReportEnd({ time: Date.now() - runInfo.startTime });\n}\nfunction useStrict(strict) {\n    invariant(globalState.trackingDerivation === null, getMessage(\"m028\"));\n    globalState.strictMode = strict;\n    globalState.allowStateChanges = !strict;\n}\nexports.useStrict = useStrict;\nfunction isStrictModeEnabled() {\n    return globalState.strictMode;\n}\nexports.isStrictModeEnabled = isStrictModeEnabled;\nfunction allowStateChanges(allowStateChanges, func) {\n    var prev = allowStateChangesStart(allowStateChanges);\n    var res;\n    try {\n        res = func();\n    } finally {\n        allowStateChangesEnd(prev);\n    }\n    return res;\n}\nfunction allowStateChangesStart(allowStateChanges) {\n    var prev = globalState.allowStateChanges;\n    globalState.allowStateChanges = allowStateChanges;\n    return prev;\n}\nfunction allowStateChangesEnd(prev) {\n    globalState.allowStateChanges = prev;\n}\nvar BaseAtom = function () {\n    function BaseAtom(name) {\n        if (name === void 0) {\n            name = \"Atom@\" + getNextId();\n        }\n        this.name = name;\n        this.isPendingUnobservation = true;\n        this.observers = [];\n        this.observersIndexes = {};\n        this.diffValue = 0;\n        this.lastAccessedBy = 0;\n        this.lowestObserverState = IDerivationState.NOT_TRACKING;\n    }\n    BaseAtom.prototype.onBecomeUnobserved = function () {};\n    BaseAtom.prototype.reportObserved = function () {\n        reportObserved(this);\n    };\n    BaseAtom.prototype.reportChanged = function () {\n        startBatch();\n        propagateChanged(this);\n        endBatch();\n    };\n    BaseAtom.prototype.toString = function () {\n        return this.name;\n    };\n    return BaseAtom;\n}();\nexports.BaseAtom = BaseAtom;\nvar Atom = function (_super) {\n    __extends(Atom, _super);\n    function Atom(name, onBecomeObservedHandler, onBecomeUnobservedHandler) {\n        if (name === void 0) {\n            name = \"Atom@\" + getNextId();\n        }\n        if (onBecomeObservedHandler === void 0) {\n            onBecomeObservedHandler = noop;\n        }\n        if (onBecomeUnobservedHandler === void 0) {\n            onBecomeUnobservedHandler = noop;\n        }\n        var _this = _super.call(this, name) || this;\n        _this.name = name;\n        _this.onBecomeObservedHandler = onBecomeObservedHandler;\n        _this.onBecomeUnobservedHandler = onBecomeUnobservedHandler;\n        _this.isPendingUnobservation = false;\n        _this.isBeingTracked = false;\n        return _this;\n    }\n    Atom.prototype.reportObserved = function () {\n        startBatch();\n        _super.prototype.reportObserved.call(this);\n        if (!this.isBeingTracked) {\n            this.isBeingTracked = true;\n            this.onBecomeObservedHandler();\n        }\n        endBatch();\n        return !!globalState.trackingDerivation;\n    };\n    Atom.prototype.onBecomeUnobserved = function () {\n        this.isBeingTracked = false;\n        this.onBecomeUnobservedHandler();\n    };\n    return Atom;\n}(BaseAtom);\nexports.Atom = Atom;\nvar isAtom = createInstanceofPredicate(\"Atom\", BaseAtom);\nvar ComputedValue = function () {\n    function ComputedValue(derivation, scope, compareStructural, name, setter) {\n        this.derivation = derivation;\n        this.scope = scope;\n        this.compareStructural = compareStructural;\n        this.dependenciesState = IDerivationState.NOT_TRACKING;\n        this.observing = [];\n        this.newObserving = null;\n        this.isPendingUnobservation = false;\n        this.observers = [];\n        this.observersIndexes = {};\n        this.diffValue = 0;\n        this.runId = 0;\n        this.lastAccessedBy = 0;\n        this.lowestObserverState = IDerivationState.UP_TO_DATE;\n        this.unboundDepsCount = 0;\n        this.__mapid = \"#\" + getNextId();\n        this.value = undefined;\n        this.isComputing = false;\n        this.isRunningSetter = false;\n        this.name = name || \"ComputedValue@\" + getNextId();\n        if (setter) this.setter = createAction(name + \"-setter\", setter);\n    }\n    ComputedValue.prototype.onBecomeStale = function () {\n        propagateMaybeChanged(this);\n    };\n    ComputedValue.prototype.onBecomeUnobserved = function () {\n        invariant(this.dependenciesState !== IDerivationState.NOT_TRACKING, getMessage(\"m029\"));\n        clearObserving(this);\n        this.value = undefined;\n    };\n    ComputedValue.prototype.get = function () {\n        invariant(!this.isComputing, \"Cycle detected in computation \" + this.name, this.derivation);\n        if (globalState.inBatch === 0) {\n            startBatch();\n            if (shouldCompute(this)) this.value = this.computeValue(false);\n            endBatch();\n        } else {\n            reportObserved(this);\n            if (shouldCompute(this)) if (this.trackAndCompute()) propagateChangeConfirmed(this);\n        }\n        var result = this.value;\n        if (isCaughtException(result)) throw result.cause;\n        return result;\n    };\n    ComputedValue.prototype.peek = function () {\n        var res = this.computeValue(false);\n        if (isCaughtException(res)) throw res.cause;\n        return res;\n    };\n    ComputedValue.prototype.set = function (value) {\n        if (this.setter) {\n            invariant(!this.isRunningSetter, \"The setter of computed value '\" + this.name + \"' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?\");\n            this.isRunningSetter = true;\n            try {\n                this.setter.call(this.scope, value);\n            } finally {\n                this.isRunningSetter = false;\n            }\n        } else invariant(false, \"[ComputedValue '\" + this.name + \"'] It is not possible to assign a new value to a computed value.\");\n    };\n    ComputedValue.prototype.trackAndCompute = function () {\n        if (isSpyEnabled()) {\n            spyReport({\n                object: this.scope,\n                type: \"compute\",\n                fn: this.derivation\n            });\n        }\n        var oldValue = this.value;\n        var newValue = this.value = this.computeValue(true);\n        return isCaughtException(newValue) || valueDidChange(this.compareStructural, newValue, oldValue);\n    };\n    ComputedValue.prototype.computeValue = function (track) {\n        this.isComputing = true;\n        globalState.computationDepth++;\n        var res;\n        if (track) {\n            res = trackDerivedFunction(this, this.derivation, this.scope);\n        } else {\n            try {\n                res = this.derivation.call(this.scope);\n            } catch (e) {\n                res = new CaughtException(e);\n            }\n        }\n        globalState.computationDepth--;\n        this.isComputing = false;\n        return res;\n    };\n    ;\n    ComputedValue.prototype.observe = function (listener, fireImmediately) {\n        var _this = this;\n        var firstTime = true;\n        var prevValue = undefined;\n        return autorun(function () {\n            var newValue = _this.get();\n            if (!firstTime || fireImmediately) {\n                var prevU = untrackedStart();\n                listener({\n                    type: \"update\",\n                    object: _this,\n                    newValue: newValue,\n                    oldValue: prevValue\n                });\n                untrackedEnd(prevU);\n            }\n            firstTime = false;\n            prevValue = newValue;\n        });\n    };\n    ComputedValue.prototype.toJSON = function () {\n        return this.get();\n    };\n    ComputedValue.prototype.toString = function () {\n        return this.name + \"[\" + this.derivation.toString() + \"]\";\n    };\n    ComputedValue.prototype.valueOf = function () {\n        return toPrimitive(this.get());\n    };\n    ;\n    ComputedValue.prototype.whyRun = function () {\n        var isTracking = Boolean(globalState.trackingDerivation);\n        var observing = unique(this.isComputing ? this.newObserving : this.observing).map(function (dep) {\n            return dep.name;\n        });\n        var observers = unique(getObservers(this).map(function (dep) {\n            return dep.name;\n        }));\n        return \"\\nWhyRun? computation '\" + this.name + \"':\\n * Running because: \" + (isTracking ? \"[active] the value of this computation is needed by a reaction\" : this.isComputing ? \"[get] The value of this computed was requested outside a reaction\" : \"[idle] not running at the moment\") + \"\\n\" + (this.dependenciesState === IDerivationState.NOT_TRACKING ? getMessage(\"m032\") : \" * This computation will re-run if any of the following observables changes:\\n    \" + joinStrings(observing) + \"\\n    \" + (this.isComputing && isTracking ? \" (... or any observable accessed during the remainder of the current run)\" : \"\") + \"\\n\\t\" + getMessage(\"m038\") + \"\\n\\n  * If the outcome of this computation changes, the following observers will be re-run:\\n    \" + joinStrings(observers) + \"\\n\");\n    };\n    return ComputedValue;\n}();\nComputedValue.prototype[primitiveSymbol()] = ComputedValue.prototype.valueOf;\nvar isComputedValue = createInstanceofPredicate(\"ComputedValue\", ComputedValue);\nvar IDerivationState;\n(function (IDerivationState) {\n    IDerivationState[IDerivationState[\"NOT_TRACKING\"] = -1] = \"NOT_TRACKING\";\n    IDerivationState[IDerivationState[\"UP_TO_DATE\"] = 0] = \"UP_TO_DATE\";\n    IDerivationState[IDerivationState[\"POSSIBLY_STALE\"] = 1] = \"POSSIBLY_STALE\";\n    IDerivationState[IDerivationState[\"STALE\"] = 2] = \"STALE\";\n})(IDerivationState || (IDerivationState = {}));\nexports.IDerivationState = IDerivationState;\nvar CaughtException = function () {\n    function CaughtException(cause) {\n        this.cause = cause;\n    }\n    return CaughtException;\n}();\nfunction isCaughtException(e) {\n    return e instanceof CaughtException;\n}\nfunction shouldCompute(derivation) {\n    switch (derivation.dependenciesState) {\n        case IDerivationState.UP_TO_DATE:\n            return false;\n        case IDerivationState.NOT_TRACKING:\n        case IDerivationState.STALE:\n            return true;\n        case IDerivationState.POSSIBLY_STALE:\n            {\n                var prevUntracked = untrackedStart();\n                var obs = derivation.observing,\n                    l = obs.length;\n                for (var i = 0; i < l; i++) {\n                    var obj = obs[i];\n                    if (isComputedValue(obj)) {\n                        try {\n                            obj.get();\n                        } catch (e) {\n                            untrackedEnd(prevUntracked);\n                            return true;\n                        }\n                        if (derivation.dependenciesState === IDerivationState.STALE) {\n                            untrackedEnd(prevUntracked);\n                            return true;\n                        }\n                    }\n                }\n                changeDependenciesStateTo0(derivation);\n                untrackedEnd(prevUntracked);\n                return false;\n            }\n    }\n}\nfunction isComputingDerivation() {\n    return globalState.trackingDerivation !== null;\n}\nfunction checkIfStateModificationsAreAllowed(atom) {\n    var hasObservers = atom.observers.length > 0;\n    if (globalState.computationDepth > 0 && hasObservers) fail(getMessage(\"m031\") + atom.name);\n    if (!globalState.allowStateChanges && hasObservers) fail(getMessage(globalState.strictMode ? \"m030a\" : \"m030b\") + atom.name);\n}\nfunction trackDerivedFunction(derivation, f, context) {\n    changeDependenciesStateTo0(derivation);\n    derivation.newObserving = new Array(derivation.observing.length + 100);\n    derivation.unboundDepsCount = 0;\n    derivation.runId = ++globalState.runId;\n    var prevTracking = globalState.trackingDerivation;\n    globalState.trackingDerivation = derivation;\n    var result;\n    try {\n        result = f.call(context);\n    } catch (e) {\n        result = new CaughtException(e);\n    }\n    globalState.trackingDerivation = prevTracking;\n    bindDependencies(derivation);\n    return result;\n}\nfunction bindDependencies(derivation) {\n    var prevObserving = derivation.observing;\n    var observing = derivation.observing = derivation.newObserving;\n    derivation.newObserving = null;\n    var i0 = 0,\n        l = derivation.unboundDepsCount;\n    for (var i = 0; i < l; i++) {\n        var dep = observing[i];\n        if (dep.diffValue === 0) {\n            dep.diffValue = 1;\n            if (i0 !== i) observing[i0] = dep;\n            i0++;\n        }\n    }\n    observing.length = i0;\n    l = prevObserving.length;\n    while (l--) {\n        var dep = prevObserving[l];\n        if (dep.diffValue === 0) {\n            removeObserver(dep, derivation);\n        }\n        dep.diffValue = 0;\n    }\n    while (i0--) {\n        var dep = observing[i0];\n        if (dep.diffValue === 1) {\n            dep.diffValue = 0;\n            addObserver(dep, derivation);\n        }\n    }\n}\nfunction clearObserving(derivation) {\n    var obs = derivation.observing;\n    var i = obs.length;\n    while (i--) {\n        removeObserver(obs[i], derivation);\n    }derivation.dependenciesState = IDerivationState.NOT_TRACKING;\n    obs.length = 0;\n}\nfunction untracked(action) {\n    var prev = untrackedStart();\n    var res = action();\n    untrackedEnd(prev);\n    return res;\n}\nexports.untracked = untracked;\nfunction untrackedStart() {\n    var prev = globalState.trackingDerivation;\n    globalState.trackingDerivation = null;\n    return prev;\n}\nfunction untrackedEnd(prev) {\n    globalState.trackingDerivation = prev;\n}\nfunction changeDependenciesStateTo0(derivation) {\n    if (derivation.dependenciesState === IDerivationState.UP_TO_DATE) return;\n    derivation.dependenciesState = IDerivationState.UP_TO_DATE;\n    var obs = derivation.observing;\n    var i = obs.length;\n    while (i--) {\n        obs[i].lowestObserverState = IDerivationState.UP_TO_DATE;\n    }\n}\nvar persistentKeys = [\"mobxGuid\", \"resetId\", \"spyListeners\", \"strictMode\", \"runId\"];\nvar MobXGlobals = function () {\n    function MobXGlobals() {\n        this.version = 5;\n        this.trackingDerivation = null;\n        this.computationDepth = 0;\n        this.runId = 0;\n        this.mobxGuid = 0;\n        this.inBatch = 0;\n        this.pendingUnobservations = [];\n        this.pendingReactions = [];\n        this.isRunningReactions = false;\n        this.allowStateChanges = true;\n        this.strictMode = false;\n        this.resetId = 0;\n        this.spyListeners = [];\n        this.globalReactionErrorHandlers = [];\n    }\n    return MobXGlobals;\n}();\nvar globalState = new MobXGlobals();\nfunction shareGlobalState() {\n    var global = getGlobal();\n    var ownState = globalState;\n    if (global.__mobservableTrackingStack || global.__mobservableViewStack) throw new Error(\"[mobx] An incompatible version of mobservable is already loaded.\");\n    if (global.__mobxGlobal && global.__mobxGlobal.version !== ownState.version) throw new Error(\"[mobx] An incompatible version of mobx is already loaded.\");\n    if (global.__mobxGlobal) globalState = global.__mobxGlobal;else global.__mobxGlobal = ownState;\n}\nfunction getGlobalState() {\n    return globalState;\n}\nfunction registerGlobals() {}\nfunction resetGlobalState() {\n    globalState.resetId++;\n    var defaultGlobals = new MobXGlobals();\n    for (var key in defaultGlobals) {\n        if (persistentKeys.indexOf(key) === -1) globalState[key] = defaultGlobals[key];\n    }globalState.allowStateChanges = !globalState.strictMode;\n}\nfunction hasObservers(observable) {\n    return observable.observers && observable.observers.length > 0;\n}\nfunction getObservers(observable) {\n    return observable.observers;\n}\nfunction invariantObservers(observable) {\n    var list = observable.observers;\n    var map = observable.observersIndexes;\n    var l = list.length;\n    for (var i = 0; i < l; i++) {\n        var id = list[i].__mapid;\n        if (i) {\n            invariant(map[id] === i, \"INTERNAL ERROR maps derivation.__mapid to index in list\");\n        } else {\n            invariant(!(id in map), \"INTERNAL ERROR observer on index 0 shouldnt be held in map.\");\n        }\n    }\n    invariant(list.length === 0 || Object.keys(map).length === list.length - 1, \"INTERNAL ERROR there is no junk in map\");\n}\nfunction addObserver(observable, node) {\n    var l = observable.observers.length;\n    if (l) {\n        observable.observersIndexes[node.__mapid] = l;\n    }\n    observable.observers[l] = node;\n    if (observable.lowestObserverState > node.dependenciesState) observable.lowestObserverState = node.dependenciesState;\n}\nfunction removeObserver(observable, node) {\n    if (observable.observers.length === 1) {\n        observable.observers.length = 0;\n        queueForUnobservation(observable);\n    } else {\n        var list = observable.observers;\n        var map_1 = observable.observersIndexes;\n        var filler = list.pop();\n        if (filler !== node) {\n            var index = map_1[node.__mapid] || 0;\n            if (index) {\n                map_1[filler.__mapid] = index;\n            } else {\n                delete map_1[filler.__mapid];\n            }\n            list[index] = filler;\n        }\n        delete map_1[node.__mapid];\n    }\n}\nfunction queueForUnobservation(observable) {\n    if (!observable.isPendingUnobservation) {\n        observable.isPendingUnobservation = true;\n        globalState.pendingUnobservations.push(observable);\n    }\n}\nfunction startBatch() {\n    globalState.inBatch++;\n}\nfunction endBatch() {\n    if (--globalState.inBatch === 0) {\n        runReactions();\n        var list = globalState.pendingUnobservations;\n        for (var i = 0; i < list.length; i++) {\n            var observable_1 = list[i];\n            observable_1.isPendingUnobservation = false;\n            if (observable_1.observers.length === 0) {\n                observable_1.onBecomeUnobserved();\n            }\n        }\n        globalState.pendingUnobservations = [];\n    }\n}\nfunction reportObserved(observable) {\n    var derivation = globalState.trackingDerivation;\n    if (derivation !== null) {\n        if (derivation.runId !== observable.lastAccessedBy) {\n            observable.lastAccessedBy = derivation.runId;\n            derivation.newObserving[derivation.unboundDepsCount++] = observable;\n        }\n    } else if (observable.observers.length === 0) {\n        queueForUnobservation(observable);\n    }\n}\nfunction invariantLOS(observable, msg) {\n    var min = getObservers(observable).reduce(function (a, b) {\n        return Math.min(a, b.dependenciesState);\n    }, 2);\n    if (min >= observable.lowestObserverState) return;\n    throw new Error(\"lowestObserverState is wrong for \" + msg + \" because \" + min + \" < \" + observable.lowestObserverState);\n}\nfunction propagateChanged(observable) {\n    if (observable.lowestObserverState === IDerivationState.STALE) return;\n    observable.lowestObserverState = IDerivationState.STALE;\n    var observers = observable.observers;\n    var i = observers.length;\n    while (i--) {\n        var d = observers[i];\n        if (d.dependenciesState === IDerivationState.UP_TO_DATE) d.onBecomeStale();\n        d.dependenciesState = IDerivationState.STALE;\n    }\n}\nfunction propagateChangeConfirmed(observable) {\n    if (observable.lowestObserverState === IDerivationState.STALE) return;\n    observable.lowestObserverState = IDerivationState.STALE;\n    var observers = observable.observers;\n    var i = observers.length;\n    while (i--) {\n        var d = observers[i];\n        if (d.dependenciesState === IDerivationState.POSSIBLY_STALE) d.dependenciesState = IDerivationState.STALE;else if (d.dependenciesState === IDerivationState.UP_TO_DATE) observable.lowestObserverState = IDerivationState.UP_TO_DATE;\n    }\n}\nfunction propagateMaybeChanged(observable) {\n    if (observable.lowestObserverState !== IDerivationState.UP_TO_DATE) return;\n    observable.lowestObserverState = IDerivationState.POSSIBLY_STALE;\n    var observers = observable.observers;\n    var i = observers.length;\n    while (i--) {\n        var d = observers[i];\n        if (d.dependenciesState === IDerivationState.UP_TO_DATE) {\n            d.dependenciesState = IDerivationState.POSSIBLY_STALE;\n            d.onBecomeStale();\n        }\n    }\n}\nvar Reaction = function () {\n    function Reaction(name, onInvalidate) {\n        if (name === void 0) {\n            name = \"Reaction@\" + getNextId();\n        }\n        this.name = name;\n        this.onInvalidate = onInvalidate;\n        this.observing = [];\n        this.newObserving = [];\n        this.dependenciesState = IDerivationState.NOT_TRACKING;\n        this.diffValue = 0;\n        this.runId = 0;\n        this.unboundDepsCount = 0;\n        this.__mapid = \"#\" + getNextId();\n        this.isDisposed = false;\n        this._isScheduled = false;\n        this._isTrackPending = false;\n        this._isRunning = false;\n    }\n    Reaction.prototype.onBecomeStale = function () {\n        this.schedule();\n    };\n    Reaction.prototype.schedule = function () {\n        if (!this._isScheduled) {\n            this._isScheduled = true;\n            globalState.pendingReactions.push(this);\n            runReactions();\n        }\n    };\n    Reaction.prototype.isScheduled = function () {\n        return this._isScheduled;\n    };\n    Reaction.prototype.runReaction = function () {\n        if (!this.isDisposed) {\n            startBatch();\n            this._isScheduled = false;\n            if (shouldCompute(this)) {\n                this._isTrackPending = true;\n                this.onInvalidate();\n                if (this._isTrackPending && isSpyEnabled()) {\n                    spyReport({\n                        object: this,\n                        type: \"scheduled-reaction\"\n                    });\n                }\n            }\n            endBatch();\n        }\n    };\n    Reaction.prototype.track = function (fn) {\n        startBatch();\n        var notify = isSpyEnabled();\n        var startTime;\n        if (notify) {\n            startTime = Date.now();\n            spyReportStart({\n                object: this,\n                type: \"reaction\",\n                fn: fn\n            });\n        }\n        this._isRunning = true;\n        var result = trackDerivedFunction(this, fn, undefined);\n        this._isRunning = false;\n        this._isTrackPending = false;\n        if (this.isDisposed) {\n            clearObserving(this);\n        }\n        if (isCaughtException(result)) this.reportExceptionInDerivation(result.cause);\n        if (notify) {\n            spyReportEnd({\n                time: Date.now() - startTime\n            });\n        }\n        endBatch();\n    };\n    Reaction.prototype.reportExceptionInDerivation = function (error) {\n        var _this = this;\n        if (this.errorHandler) {\n            this.errorHandler(error, this);\n            return;\n        }\n        var message = \"[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '\" + this;\n        var messageToUser = getMessage(\"m037\");\n        console.error(message || messageToUser, error);\n        if (isSpyEnabled()) {\n            spyReport({\n                type: \"error\",\n                message: message,\n                error: error,\n                object: this\n            });\n        }\n        globalState.globalReactionErrorHandlers.forEach(function (f) {\n            return f(error, _this);\n        });\n    };\n    Reaction.prototype.dispose = function () {\n        if (!this.isDisposed) {\n            this.isDisposed = true;\n            if (!this._isRunning) {\n                startBatch();\n                clearObserving(this);\n                endBatch();\n            }\n        }\n    };\n    Reaction.prototype.getDisposer = function () {\n        var r = this.dispose.bind(this);\n        r.$mobx = this;\n        r.onError = registerErrorHandler;\n        return r;\n    };\n    Reaction.prototype.toString = function () {\n        return \"Reaction[\" + this.name + \"]\";\n    };\n    Reaction.prototype.whyRun = function () {\n        var observing = unique(this._isRunning ? this.newObserving : this.observing).map(function (dep) {\n            return dep.name;\n        });\n        return \"\\nWhyRun? reaction '\" + this.name + \"':\\n * Status: [\" + (this.isDisposed ? \"stopped\" : this._isRunning ? \"running\" : this.isScheduled() ? \"scheduled\" : \"idle\") + \"]\\n * This reaction will re-run if any of the following observables changes:\\n    \" + joinStrings(observing) + \"\\n    \" + (this._isRunning ? \" (... or any observable accessed during the remainder of the current run)\" : \"\") + \"\\n\\t\" + getMessage(\"m038\") + \"\\n\";\n    };\n    return Reaction;\n}();\nexports.Reaction = Reaction;\nfunction registerErrorHandler(handler) {\n    invariant(this && this.$mobx && isReaction(this.$mobx), \"Invalid `this`\");\n    invariant(!this.$mobx.errorHandler, \"Only one onErrorHandler can be registered\");\n    this.$mobx.errorHandler = handler;\n}\nfunction onReactionError(handler) {\n    globalState.globalReactionErrorHandlers.push(handler);\n    return function () {\n        var idx = globalState.globalReactionErrorHandlers.indexOf(handler);\n        if (idx >= 0) globalState.globalReactionErrorHandlers.splice(idx, 1);\n    };\n}\nvar MAX_REACTION_ITERATIONS = 100;\nvar reactionScheduler = function reactionScheduler(f) {\n    return f();\n};\nfunction runReactions() {\n    if (globalState.inBatch > 0 || globalState.isRunningReactions) return;\n    reactionScheduler(runReactionsHelper);\n}\nfunction runReactionsHelper() {\n    globalState.isRunningReactions = true;\n    var allReactions = globalState.pendingReactions;\n    var iterations = 0;\n    while (allReactions.length > 0) {\n        if (++iterations === MAX_REACTION_ITERATIONS) {\n            console.error(\"Reaction doesn't converge to a stable state after \" + MAX_REACTION_ITERATIONS + \" iterations.\" + (\" Probably there is a cycle in the reactive function: \" + allReactions[0]));\n            allReactions.splice(0);\n        }\n        var remainingReactions = allReactions.splice(0);\n        for (var i = 0, l = remainingReactions.length; i < l; i++) {\n            remainingReactions[i].runReaction();\n        }\n    }\n    globalState.isRunningReactions = false;\n}\nvar isReaction = createInstanceofPredicate(\"Reaction\", Reaction);\nfunction setReactionScheduler(fn) {\n    var baseScheduler = reactionScheduler;\n    reactionScheduler = function reactionScheduler(f) {\n        return fn(function () {\n            return baseScheduler(f);\n        });\n    };\n}\nfunction isSpyEnabled() {\n    return !!globalState.spyListeners.length;\n}\nfunction spyReport(event) {\n    if (!globalState.spyListeners.length) return;\n    var listeners = globalState.spyListeners;\n    for (var i = 0, l = listeners.length; i < l; i++) {\n        listeners[i](event);\n    }\n}\nfunction spyReportStart(event) {\n    var change = objectAssign({}, event, { spyReportStart: true });\n    spyReport(change);\n}\nvar END_EVENT = { spyReportEnd: true };\nfunction spyReportEnd(change) {\n    if (change) spyReport(objectAssign({}, change, END_EVENT));else spyReport(END_EVENT);\n}\nfunction spy(listener) {\n    globalState.spyListeners.push(listener);\n    return once(function () {\n        var idx = globalState.spyListeners.indexOf(listener);\n        if (idx !== -1) globalState.spyListeners.splice(idx, 1);\n    });\n}\nexports.spy = spy;\nfunction hasInterceptors(interceptable) {\n    return interceptable.interceptors && interceptable.interceptors.length > 0;\n}\nfunction registerInterceptor(interceptable, handler) {\n    var interceptors = interceptable.interceptors || (interceptable.interceptors = []);\n    interceptors.push(handler);\n    return once(function () {\n        var idx = interceptors.indexOf(handler);\n        if (idx !== -1) interceptors.splice(idx, 1);\n    });\n}\nfunction interceptChange(interceptable, change) {\n    var prevU = untrackedStart();\n    try {\n        var interceptors = interceptable.interceptors;\n        if (interceptors) for (var i = 0, l = interceptors.length; i < l; i++) {\n            change = interceptors[i](change);\n            invariant(!change || change.type, \"Intercept handlers should return nothing or a change object\");\n            if (!change) break;\n        }\n        return change;\n    } finally {\n        untrackedEnd(prevU);\n    }\n}\nfunction hasListeners(listenable) {\n    return listenable.changeListeners && listenable.changeListeners.length > 0;\n}\nfunction registerListener(listenable, handler) {\n    var listeners = listenable.changeListeners || (listenable.changeListeners = []);\n    listeners.push(handler);\n    return once(function () {\n        var idx = listeners.indexOf(handler);\n        if (idx !== -1) listeners.splice(idx, 1);\n    });\n}\nfunction notifyListeners(listenable, change) {\n    var prevU = untrackedStart();\n    var listeners = listenable.changeListeners;\n    if (!listeners) return;\n    listeners = listeners.slice();\n    for (var i = 0, l = listeners.length; i < l; i++) {\n        listeners[i](change);\n    }\n    untrackedEnd(prevU);\n}\nfunction asReference(value) {\n    deprecated(\"asReference is deprecated, use observable.ref instead\");\n    return observable.ref(value);\n}\nexports.asReference = asReference;\nfunction asStructure(value) {\n    deprecated(\"asStructure is deprecated. Use observable.struct, computed.struct or reaction options instead.\");\n    return observable.struct(value);\n}\nexports.asStructure = asStructure;\nfunction asFlat(value) {\n    deprecated(\"asFlat is deprecated, use observable.shallow instead\");\n    return observable.shallow(value);\n}\nexports.asFlat = asFlat;\nfunction asMap(data) {\n    deprecated(\"asMap is deprecated, use observable.map or observable.shallowMap instead\");\n    return observable.map(data || {});\n}\nexports.asMap = asMap;\nfunction isModifierDescriptor(thing) {\n    return (typeof thing === \"undefined\" ? \"undefined\" : _typeof(thing)) === \"object\" && thing !== null && thing.isMobxModifierDescriptor === true;\n}\nexports.isModifierDescriptor = isModifierDescriptor;\nfunction createModifierDescriptor(enhancer, initialValue) {\n    invariant(!isModifierDescriptor(initialValue), \"Modifiers cannot be nested\");\n    return {\n        isMobxModifierDescriptor: true,\n        initialValue: initialValue,\n        enhancer: enhancer\n    };\n}\nfunction deepEnhancer(v, _, name) {\n    if (isModifierDescriptor(v)) fail(\"You tried to assign a modifier wrapped value to a collection, please define modifiers when creating the collection, not when modifying it\");\n    if (isObservable(v)) return v;\n    if (Array.isArray(v)) return observable.array(v, name);\n    if (isPlainObject(v)) return observable.object(v, name);\n    if (isES6Map(v)) return observable.map(v, name);\n    return v;\n}\nfunction shallowEnhancer(v, _, name) {\n    if (isModifierDescriptor(v)) fail(\"You tried to assign a modifier wrapped value to a collection, please define modifiers when creating the collection, not when modifying it\");\n    if (v === undefined || v === null) return v;\n    if (isObservableObject(v) || isObservableArray(v) || isObservableMap(v)) return v;\n    if (Array.isArray(v)) return observable.shallowArray(v, name);\n    if (isPlainObject(v)) return observable.shallowObject(v, name);\n    if (isES6Map(v)) return observable.shallowMap(v, name);\n    return fail(\"The shallow modifier / decorator can only used in combination with arrays, objects and maps\");\n}\nfunction referenceEnhancer(newValue) {\n    return newValue;\n}\nfunction deepStructEnhancer(v, oldValue, name) {\n    if (deepEqual(v, oldValue)) return oldValue;\n    if (isObservable(v)) return v;\n    if (Array.isArray(v)) return new ObservableArray(v, deepStructEnhancer, name);\n    if (isES6Map(v)) return new ObservableMap(v, deepStructEnhancer, name);\n    if (isPlainObject(v)) {\n        var res = {};\n        asObservableObject(res, name);\n        extendObservableHelper(res, deepStructEnhancer, [v]);\n        return res;\n    }\n    return v;\n}\nfunction refStructEnhancer(v, oldValue, name) {\n    if (deepEqual(v, oldValue)) return oldValue;\n    return v;\n}\nvar MAX_SPLICE_SIZE = 10000;\nvar safariPrototypeSetterInheritanceBug = function () {\n    var v = false;\n    var p = {};\n    Object.defineProperty(p, \"0\", { set: function set() {\n            v = true;\n        } });\n    Object.create(p)[\"0\"] = 1;\n    return v === false;\n}();\nvar OBSERVABLE_ARRAY_BUFFER_SIZE = 0;\nvar StubArray = function () {\n    function StubArray() {}\n    return StubArray;\n}();\nStubArray.prototype = [];\nvar ObservableArrayAdministration = function () {\n    function ObservableArrayAdministration(name, enhancer, array, owned) {\n        this.array = array;\n        this.owned = owned;\n        this.lastKnownLength = 0;\n        this.interceptors = null;\n        this.changeListeners = null;\n        this.atom = new BaseAtom(name || \"ObservableArray@\" + getNextId());\n        this.enhancer = function (newV, oldV) {\n            return enhancer(newV, oldV, name + \"[..]\");\n        };\n    }\n    ObservableArrayAdministration.prototype.intercept = function (handler) {\n        return registerInterceptor(this, handler);\n    };\n    ObservableArrayAdministration.prototype.observe = function (listener, fireImmediately) {\n        if (fireImmediately === void 0) {\n            fireImmediately = false;\n        }\n        if (fireImmediately) {\n            listener({\n                object: this.array,\n                type: \"splice\",\n                index: 0,\n                added: this.values.slice(),\n                addedCount: this.values.length,\n                removed: [],\n                removedCount: 0\n            });\n        }\n        return registerListener(this, listener);\n    };\n    ObservableArrayAdministration.prototype.getArrayLength = function () {\n        this.atom.reportObserved();\n        return this.values.length;\n    };\n    ObservableArrayAdministration.prototype.setArrayLength = function (newLength) {\n        if (typeof newLength !== \"number\" || newLength < 0) throw new Error(\"[mobx.array] Out of range: \" + newLength);\n        var currentLength = this.values.length;\n        if (newLength === currentLength) return;else if (newLength > currentLength) {\n            var newItems = new Array(newLength - currentLength);\n            for (var i = 0; i < newLength - currentLength; i++) {\n                newItems[i] = undefined;\n            }this.spliceWithArray(currentLength, 0, newItems);\n        } else this.spliceWithArray(newLength, currentLength - newLength);\n    };\n    ObservableArrayAdministration.prototype.updateArrayLength = function (oldLength, delta) {\n        if (oldLength !== this.lastKnownLength) throw new Error(\"[mobx] Modification exception: the internal structure of an observable array was changed. Did you use peek() to change it?\");\n        this.lastKnownLength += delta;\n        if (delta > 0 && oldLength + delta + 1 > OBSERVABLE_ARRAY_BUFFER_SIZE) reserveArrayBuffer(oldLength + delta + 1);\n    };\n    ObservableArrayAdministration.prototype.spliceWithArray = function (index, deleteCount, newItems) {\n        var _this = this;\n        checkIfStateModificationsAreAllowed(this.atom);\n        var length = this.values.length;\n        if (index === undefined) index = 0;else if (index > length) index = length;else if (index < 0) index = Math.max(0, length + index);\n        if (arguments.length === 1) deleteCount = length - index;else if (deleteCount === undefined || deleteCount === null) deleteCount = 0;else deleteCount = Math.max(0, Math.min(deleteCount, length - index));\n        if (newItems === undefined) newItems = [];\n        if (hasInterceptors(this)) {\n            var change = interceptChange(this, {\n                object: this.array,\n                type: \"splice\",\n                index: index,\n                removedCount: deleteCount,\n                added: newItems\n            });\n            if (!change) return EMPTY_ARRAY;\n            deleteCount = change.removedCount;\n            newItems = change.added;\n        }\n        newItems = newItems.map(function (v) {\n            return _this.enhancer(v, undefined);\n        });\n        var lengthDelta = newItems.length - deleteCount;\n        this.updateArrayLength(length, lengthDelta);\n        var res = this.spliceItemsIntoValues(index, deleteCount, newItems);\n        if (deleteCount !== 0 || newItems.length !== 0) this.notifyArraySplice(index, newItems, res);\n        return res;\n    };\n    ObservableArrayAdministration.prototype.spliceItemsIntoValues = function (index, deleteCount, newItems) {\n        if (newItems.length < MAX_SPLICE_SIZE) {\n            return (_a = this.values).splice.apply(_a, [index, deleteCount].concat(newItems));\n        } else {\n            var res = this.values.slice(index, index + deleteCount);\n            this.values = this.values.slice(0, index).concat(newItems, this.values.slice(index + deleteCount));\n            return res;\n        }\n        var _a;\n    };\n    ObservableArrayAdministration.prototype.notifyArrayChildUpdate = function (index, newValue, oldValue) {\n        var notifySpy = !this.owned && isSpyEnabled();\n        var notify = hasListeners(this);\n        var change = notify || notifySpy ? {\n            object: this.array,\n            type: \"update\",\n            index: index, newValue: newValue, oldValue: oldValue\n        } : null;\n        if (notifySpy) spyReportStart(change);\n        this.atom.reportChanged();\n        if (notify) notifyListeners(this, change);\n        if (notifySpy) spyReportEnd();\n    };\n    ObservableArrayAdministration.prototype.notifyArraySplice = function (index, added, removed) {\n        var notifySpy = !this.owned && isSpyEnabled();\n        var notify = hasListeners(this);\n        var change = notify || notifySpy ? {\n            object: this.array,\n            type: \"splice\",\n            index: index, removed: removed, added: added,\n            removedCount: removed.length,\n            addedCount: added.length\n        } : null;\n        if (notifySpy) spyReportStart(change);\n        this.atom.reportChanged();\n        if (notify) notifyListeners(this, change);\n        if (notifySpy) spyReportEnd();\n    };\n    return ObservableArrayAdministration;\n}();\nvar ObservableArray = function (_super) {\n    __extends(ObservableArray, _super);\n    function ObservableArray(initialValues, enhancer, name, owned) {\n        if (name === void 0) {\n            name = \"ObservableArray@\" + getNextId();\n        }\n        if (owned === void 0) {\n            owned = false;\n        }\n        var _this = _super.call(this) || this;\n        var adm = new ObservableArrayAdministration(name, enhancer, _this, owned);\n        addHiddenFinalProp(_this, \"$mobx\", adm);\n        if (initialValues && initialValues.length) {\n            adm.updateArrayLength(0, initialValues.length);\n            adm.values = initialValues.map(function (v) {\n                return enhancer(v, undefined, name + \"[..]\");\n            });\n            adm.notifyArraySplice(0, adm.values.slice(), EMPTY_ARRAY);\n        } else {\n            adm.values = [];\n        }\n        if (safariPrototypeSetterInheritanceBug) {\n            Object.defineProperty(adm.array, \"0\", ENTRY_0);\n        }\n        return _this;\n    }\n    ObservableArray.prototype.intercept = function (handler) {\n        return this.$mobx.intercept(handler);\n    };\n    ObservableArray.prototype.observe = function (listener, fireImmediately) {\n        if (fireImmediately === void 0) {\n            fireImmediately = false;\n        }\n        return this.$mobx.observe(listener, fireImmediately);\n    };\n    ObservableArray.prototype.clear = function () {\n        return this.splice(0);\n    };\n    ObservableArray.prototype.concat = function () {\n        var arrays = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            arrays[_i] = arguments[_i];\n        }\n        this.$mobx.atom.reportObserved();\n        return Array.prototype.concat.apply(this.peek(), arrays.map(function (a) {\n            return isObservableArray(a) ? a.peek() : a;\n        }));\n    };\n    ObservableArray.prototype.replace = function (newItems) {\n        return this.$mobx.spliceWithArray(0, this.$mobx.values.length, newItems);\n    };\n    ObservableArray.prototype.toJS = function () {\n        return this.slice();\n    };\n    ObservableArray.prototype.toJSON = function () {\n        return this.toJS();\n    };\n    ObservableArray.prototype.peek = function () {\n        return this.$mobx.values;\n    };\n    ObservableArray.prototype.find = function (predicate, thisArg, fromIndex) {\n        if (fromIndex === void 0) {\n            fromIndex = 0;\n        }\n        this.$mobx.atom.reportObserved();\n        var items = this.$mobx.values,\n            l = items.length;\n        for (var i = fromIndex; i < l; i++) {\n            if (predicate.call(thisArg, items[i], i, this)) return items[i];\n        }return undefined;\n    };\n    ObservableArray.prototype.splice = function (index, deleteCount) {\n        var newItems = [];\n        for (var _i = 2; _i < arguments.length; _i++) {\n            newItems[_i - 2] = arguments[_i];\n        }\n        switch (arguments.length) {\n            case 0:\n                return [];\n            case 1:\n                return this.$mobx.spliceWithArray(index);\n            case 2:\n                return this.$mobx.spliceWithArray(index, deleteCount);\n        }\n        return this.$mobx.spliceWithArray(index, deleteCount, newItems);\n    };\n    ObservableArray.prototype.spliceWithArray = function (index, deleteCount, newItems) {\n        return this.$mobx.spliceWithArray(index, deleteCount, newItems);\n    };\n    ObservableArray.prototype.push = function () {\n        var items = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            items[_i] = arguments[_i];\n        }\n        var adm = this.$mobx;\n        adm.spliceWithArray(adm.values.length, 0, items);\n        return adm.values.length;\n    };\n    ObservableArray.prototype.pop = function () {\n        return this.splice(Math.max(this.$mobx.values.length - 1, 0), 1)[0];\n    };\n    ObservableArray.prototype.shift = function () {\n        return this.splice(0, 1)[0];\n    };\n    ObservableArray.prototype.unshift = function () {\n        var items = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            items[_i] = arguments[_i];\n        }\n        var adm = this.$mobx;\n        adm.spliceWithArray(0, 0, items);\n        return adm.values.length;\n    };\n    ObservableArray.prototype.reverse = function () {\n        this.$mobx.atom.reportObserved();\n        var clone = this.slice();\n        return clone.reverse.apply(clone, arguments);\n    };\n    ObservableArray.prototype.sort = function (compareFn) {\n        this.$mobx.atom.reportObserved();\n        var clone = this.slice();\n        return clone.sort.apply(clone, arguments);\n    };\n    ObservableArray.prototype.remove = function (value) {\n        var idx = this.$mobx.values.indexOf(value);\n        if (idx > -1) {\n            this.splice(idx, 1);\n            return true;\n        }\n        return false;\n    };\n    ObservableArray.prototype.move = function (fromIndex, toIndex) {\n        function checkIndex(index) {\n            if (index < 0) {\n                throw new Error(\"[mobx.array] Index out of bounds: \" + index + \" is negative\");\n            }\n            var length = this.$mobx.values.length;\n            if (index >= length) {\n                throw new Error(\"[mobx.array] Index out of bounds: \" + index + \" is not smaller than \" + length);\n            }\n        }\n        checkIndex.call(this, fromIndex);\n        checkIndex.call(this, toIndex);\n        if (fromIndex === toIndex) {\n            return;\n        }\n        var oldItems = this.$mobx.values;\n        var newItems;\n        if (fromIndex < toIndex) {\n            newItems = oldItems.slice(0, fromIndex).concat(oldItems.slice(fromIndex + 1, toIndex + 1), [oldItems[fromIndex]], oldItems.slice(toIndex + 1));\n        } else {\n            newItems = oldItems.slice(0, toIndex).concat([oldItems[fromIndex]], oldItems.slice(toIndex, fromIndex), oldItems.slice(fromIndex + 1));\n        }\n        this.replace(newItems);\n    };\n    ObservableArray.prototype.toString = function () {\n        this.$mobx.atom.reportObserved();\n        return Array.prototype.toString.apply(this.$mobx.values, arguments);\n    };\n    ObservableArray.prototype.toLocaleString = function () {\n        this.$mobx.atom.reportObserved();\n        return Array.prototype.toLocaleString.apply(this.$mobx.values, arguments);\n    };\n    return ObservableArray;\n}(StubArray);\ndeclareIterator(ObservableArray.prototype, function () {\n    return arrayAsIterator(this.slice());\n});\nmakeNonEnumerable(ObservableArray.prototype, [\"constructor\", \"intercept\", \"observe\", \"clear\", \"concat\", \"replace\", \"toJS\", \"toJSON\", \"peek\", \"find\", \"splice\", \"spliceWithArray\", \"push\", \"pop\", \"shift\", \"unshift\", \"reverse\", \"sort\", \"remove\", \"move\", \"toString\", \"toLocaleString\"]);\nObject.defineProperty(ObservableArray.prototype, \"length\", {\n    enumerable: false,\n    configurable: true,\n    get: function get() {\n        return this.$mobx.getArrayLength();\n    },\n    set: function set(newLength) {\n        this.$mobx.setArrayLength(newLength);\n    }\n});\n[\"every\", \"filter\", \"forEach\", \"indexOf\", \"join\", \"lastIndexOf\", \"map\", \"reduce\", \"reduceRight\", \"slice\", \"some\"].forEach(function (funcName) {\n    var baseFunc = Array.prototype[funcName];\n    invariant(typeof baseFunc === \"function\", \"Base function not defined on Array prototype: '\" + funcName + \"'\");\n    addHiddenProp(ObservableArray.prototype, funcName, function () {\n        this.$mobx.atom.reportObserved();\n        return baseFunc.apply(this.$mobx.values, arguments);\n    });\n});\nvar ENTRY_0 = {\n    configurable: true,\n    enumerable: false,\n    set: createArraySetter(0),\n    get: createArrayGetter(0)\n};\nfunction createArrayBufferItem(index) {\n    var set = createArraySetter(index);\n    var get = createArrayGetter(index);\n    Object.defineProperty(ObservableArray.prototype, \"\" + index, {\n        enumerable: false,\n        configurable: true,\n        set: set, get: get\n    });\n}\nfunction createArraySetter(index) {\n    return function (newValue) {\n        var adm = this.$mobx;\n        var values = adm.values;\n        if (index < values.length) {\n            checkIfStateModificationsAreAllowed(adm.atom);\n            var oldValue = values[index];\n            if (hasInterceptors(adm)) {\n                var change = interceptChange(adm, {\n                    type: \"update\",\n                    object: adm.array,\n                    index: index, newValue: newValue\n                });\n                if (!change) return;\n                newValue = change.newValue;\n            }\n            newValue = adm.enhancer(newValue, oldValue);\n            var changed = newValue !== oldValue;\n            if (changed) {\n                values[index] = newValue;\n                adm.notifyArrayChildUpdate(index, newValue, oldValue);\n            }\n        } else if (index === values.length) {\n            adm.spliceWithArray(index, 0, [newValue]);\n        } else throw new Error(\"[mobx.array] Index out of bounds, \" + index + \" is larger than \" + values.length);\n    };\n}\nfunction createArrayGetter(index) {\n    return function () {\n        var impl = this.$mobx;\n        if (impl) {\n            if (index < impl.values.length) {\n                impl.atom.reportObserved();\n                return impl.values[index];\n            }\n            console.warn(\"[mobx.array] Attempt to read an array index (\" + index + \") that is out of bounds (\" + impl.values.length + \"). Please check length first. Out of bound indices will not be tracked by MobX\");\n        }\n        return undefined;\n    };\n}\nfunction reserveArrayBuffer(max) {\n    for (var index = OBSERVABLE_ARRAY_BUFFER_SIZE; index < max; index++) {\n        createArrayBufferItem(index);\n    }OBSERVABLE_ARRAY_BUFFER_SIZE = max;\n}\nreserveArrayBuffer(1000);\nvar isObservableArrayAdministration = createInstanceofPredicate(\"ObservableArrayAdministration\", ObservableArrayAdministration);\nfunction isObservableArray(thing) {\n    return isObject(thing) && isObservableArrayAdministration(thing.$mobx);\n}\nexports.isObservableArray = isObservableArray;\nvar ObservableMapMarker = {};\nvar ObservableMap = function () {\n    function ObservableMap(initialData, enhancer, name) {\n        if (enhancer === void 0) {\n            enhancer = deepEnhancer;\n        }\n        if (name === void 0) {\n            name = \"ObservableMap@\" + getNextId();\n        }\n        this.enhancer = enhancer;\n        this.name = name;\n        this.$mobx = ObservableMapMarker;\n        this._data = {};\n        this._hasMap = {};\n        this._keys = new ObservableArray(undefined, referenceEnhancer, this.name + \".keys()\", true);\n        this.interceptors = null;\n        this.changeListeners = null;\n        this.merge(initialData);\n    }\n    ObservableMap.prototype._has = function (key) {\n        return typeof this._data[key] !== \"undefined\";\n    };\n    ObservableMap.prototype.has = function (key) {\n        if (!this.isValidKey(key)) return false;\n        key = \"\" + key;\n        if (this._hasMap[key]) return this._hasMap[key].get();\n        return this._updateHasMapEntry(key, false).get();\n    };\n    ObservableMap.prototype.set = function (key, value) {\n        this.assertValidKey(key);\n        key = \"\" + key;\n        var hasKey = this._has(key);\n        if (hasInterceptors(this)) {\n            var change = interceptChange(this, {\n                type: hasKey ? \"update\" : \"add\",\n                object: this,\n                newValue: value,\n                name: key\n            });\n            if (!change) return this;\n            value = change.newValue;\n        }\n        if (hasKey) {\n            this._updateValue(key, value);\n        } else {\n            this._addValue(key, value);\n        }\n        return this;\n    };\n    ObservableMap.prototype.delete = function (key) {\n        var _this = this;\n        this.assertValidKey(key);\n        key = \"\" + key;\n        if (hasInterceptors(this)) {\n            var change = interceptChange(this, {\n                type: \"delete\",\n                object: this,\n                name: key\n            });\n            if (!change) return false;\n        }\n        if (this._has(key)) {\n            var notifySpy = isSpyEnabled();\n            var notify = hasListeners(this);\n            var change = notify || notifySpy ? {\n                type: \"delete\",\n                object: this,\n                oldValue: this._data[key].value,\n                name: key\n            } : null;\n            if (notifySpy) spyReportStart(change);\n            runInTransaction(function () {\n                _this._keys.remove(key);\n                _this._updateHasMapEntry(key, false);\n                var observable = _this._data[key];\n                observable.setNewValue(undefined);\n                _this._data[key] = undefined;\n            });\n            if (notify) notifyListeners(this, change);\n            if (notifySpy) spyReportEnd();\n            return true;\n        }\n        return false;\n    };\n    ObservableMap.prototype._updateHasMapEntry = function (key, value) {\n        var entry = this._hasMap[key];\n        if (entry) {\n            entry.setNewValue(value);\n        } else {\n            entry = this._hasMap[key] = new ObservableValue(value, referenceEnhancer, this.name + \".\" + key + \"?\", false);\n        }\n        return entry;\n    };\n    ObservableMap.prototype._updateValue = function (name, newValue) {\n        var observable = this._data[name];\n        newValue = observable.prepareNewValue(newValue);\n        if (newValue !== UNCHANGED) {\n            var notifySpy = isSpyEnabled();\n            var notify = hasListeners(this);\n            var change = notify || notifySpy ? {\n                type: \"update\",\n                object: this,\n                oldValue: observable.value,\n                name: name, newValue: newValue\n            } : null;\n            if (notifySpy) spyReportStart(change);\n            observable.setNewValue(newValue);\n            if (notify) notifyListeners(this, change);\n            if (notifySpy) spyReportEnd();\n        }\n    };\n    ObservableMap.prototype._addValue = function (name, newValue) {\n        var _this = this;\n        runInTransaction(function () {\n            var observable = _this._data[name] = new ObservableValue(newValue, _this.enhancer, _this.name + \".\" + name, false);\n            newValue = observable.value;\n            _this._updateHasMapEntry(name, true);\n            _this._keys.push(name);\n        });\n        var notifySpy = isSpyEnabled();\n        var notify = hasListeners(this);\n        var change = notify || notifySpy ? {\n            type: \"add\",\n            object: this,\n            name: name, newValue: newValue\n        } : null;\n        if (notifySpy) spyReportStart(change);\n        if (notify) notifyListeners(this, change);\n        if (notifySpy) spyReportEnd();\n    };\n    ObservableMap.prototype.get = function (key) {\n        key = \"\" + key;\n        if (this.has(key)) return this._data[key].get();\n        return undefined;\n    };\n    ObservableMap.prototype.keys = function () {\n        return arrayAsIterator(this._keys.slice());\n    };\n    ObservableMap.prototype.values = function () {\n        return arrayAsIterator(this._keys.map(this.get, this));\n    };\n    ObservableMap.prototype.entries = function () {\n        var _this = this;\n        return arrayAsIterator(this._keys.map(function (key) {\n            return [key, _this.get(key)];\n        }));\n    };\n    ObservableMap.prototype.forEach = function (callback, thisArg) {\n        var _this = this;\n        this.keys().forEach(function (key) {\n            return callback.call(thisArg, _this.get(key), key, _this);\n        });\n    };\n    ObservableMap.prototype.merge = function (other) {\n        var _this = this;\n        if (isObservableMap(other)) {\n            other = other.toJS();\n        }\n        runInTransaction(function () {\n            if (isPlainObject(other)) Object.keys(other).forEach(function (key) {\n                return _this.set(key, other[key]);\n            });else if (Array.isArray(other)) other.forEach(function (_a) {\n                var key = _a[0],\n                    value = _a[1];\n                return _this.set(key, value);\n            });else if (isES6Map(other)) other.forEach(function (value, key) {\n                return _this.set(key, value);\n            });else if (other !== null && other !== undefined) fail(\"Cannot initialize map from \" + other);\n        });\n        return this;\n    };\n    ObservableMap.prototype.clear = function () {\n        var _this = this;\n        runInTransaction(function () {\n            untracked(function () {\n                _this.keys().forEach(_this.delete, _this);\n            });\n        });\n    };\n    ObservableMap.prototype.replace = function (values) {\n        var _this = this;\n        runInTransaction(function () {\n            _this.clear();\n            _this.merge(values);\n        });\n        return this;\n    };\n    Object.defineProperty(ObservableMap.prototype, \"size\", {\n        get: function get() {\n            return this._keys.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ObservableMap.prototype.toJS = function () {\n        var _this = this;\n        var res = {};\n        this.keys().forEach(function (key) {\n            return res[key] = _this.get(key);\n        });\n        return res;\n    };\n    ObservableMap.prototype.toJSON = function () {\n        return this.toJS();\n    };\n    ObservableMap.prototype.isValidKey = function (key) {\n        if (key === null || key === undefined) return false;\n        if (typeof key === \"string\" || typeof key === \"number\" || typeof key === \"boolean\") return true;\n        return false;\n    };\n    ObservableMap.prototype.assertValidKey = function (key) {\n        if (!this.isValidKey(key)) throw new Error(\"[mobx.map] Invalid key: '\" + key + \"', only strings, numbers and booleans are accepted as key in observable maps.\");\n    };\n    ObservableMap.prototype.toString = function () {\n        var _this = this;\n        return this.name + \"[{ \" + this.keys().map(function (key) {\n            return key + \": \" + (\"\" + _this.get(key));\n        }).join(\", \") + \" }]\";\n    };\n    ObservableMap.prototype.observe = function (listener, fireImmediately) {\n        invariant(fireImmediately !== true, getMessage(\"m033\"));\n        return registerListener(this, listener);\n    };\n    ObservableMap.prototype.intercept = function (handler) {\n        return registerInterceptor(this, handler);\n    };\n    return ObservableMap;\n}();\nexports.ObservableMap = ObservableMap;\ndeclareIterator(ObservableMap.prototype, function () {\n    return this.entries();\n});\nfunction map(initialValues) {\n    deprecated(\"`mobx.map` is deprecated, use `new ObservableMap` or `mobx.observable.map` instead\");\n    return observable.map(initialValues);\n}\nexports.map = map;\nvar isObservableMap = createInstanceofPredicate(\"ObservableMap\", ObservableMap);\nexports.isObservableMap = isObservableMap;\nvar ObservableObjectAdministration = function () {\n    function ObservableObjectAdministration(target, name) {\n        this.target = target;\n        this.name = name;\n        this.values = {};\n        this.changeListeners = null;\n        this.interceptors = null;\n    }\n    ObservableObjectAdministration.prototype.observe = function (callback, fireImmediately) {\n        invariant(fireImmediately !== true, \"`observe` doesn't support the fire immediately property for observable objects.\");\n        return registerListener(this, callback);\n    };\n    ObservableObjectAdministration.prototype.intercept = function (handler) {\n        return registerInterceptor(this, handler);\n    };\n    return ObservableObjectAdministration;\n}();\nfunction asObservableObject(target, name) {\n    if (isObservableObject(target)) return target.$mobx;\n    invariant(Object.isExtensible(target), getMessage(\"m035\"));\n    if (!isPlainObject(target)) name = (target.constructor.name || \"ObservableObject\") + \"@\" + getNextId();\n    if (!name) name = \"ObservableObject@\" + getNextId();\n    var adm = new ObservableObjectAdministration(target, name);\n    addHiddenFinalProp(target, \"$mobx\", adm);\n    return adm;\n}\nfunction defineObservablePropertyFromDescriptor(adm, propName, descriptor, defaultEnhancer) {\n    if (adm.values[propName]) {\n        invariant(\"value\" in descriptor, \"The property \" + propName + \" in \" + adm.name + \" is already observable, cannot redefine it as computed property\");\n        adm.target[propName] = descriptor.value;\n        return;\n    }\n    if (\"value\" in descriptor) {\n        if (isModifierDescriptor(descriptor.value)) {\n            var modifierDescriptor = descriptor.value;\n            defineObservableProperty(adm, propName, modifierDescriptor.initialValue, modifierDescriptor.enhancer);\n        } else if (isAction(descriptor.value) && descriptor.value.autoBind === true) {\n            defineBoundAction(adm.target, propName, descriptor.value.originalFn);\n        } else if (isComputedValue(descriptor.value)) {\n            defineComputedPropertyFromComputedValue(adm, propName, descriptor.value);\n        } else {\n            defineObservableProperty(adm, propName, descriptor.value, defaultEnhancer);\n        }\n    } else {\n        defineComputedProperty(adm, propName, descriptor.get, descriptor.set, false, true);\n    }\n}\nfunction defineObservableProperty(adm, propName, newValue, enhancer) {\n    assertPropertyConfigurable(adm.target, propName);\n    if (hasInterceptors(adm)) {\n        var change = interceptChange(adm, {\n            object: adm.target,\n            name: propName,\n            type: \"add\",\n            newValue: newValue\n        });\n        if (!change) return;\n        newValue = change.newValue;\n    }\n    var observable = adm.values[propName] = new ObservableValue(newValue, enhancer, adm.name + \".\" + propName, false);\n    newValue = observable.value;\n    Object.defineProperty(adm.target, propName, generateObservablePropConfig(propName));\n    notifyPropertyAddition(adm, adm.target, propName, newValue);\n}\nfunction defineComputedProperty(adm, propName, getter, setter, compareStructural, asInstanceProperty) {\n    if (asInstanceProperty) assertPropertyConfigurable(adm.target, propName);\n    adm.values[propName] = new ComputedValue(getter, adm.target, compareStructural, adm.name + \".\" + propName, setter);\n    if (asInstanceProperty) {\n        Object.defineProperty(adm.target, propName, generateComputedPropConfig(propName));\n    }\n}\nfunction defineComputedPropertyFromComputedValue(adm, propName, computedValue) {\n    var name = adm.name + \".\" + propName;\n    computedValue.name = name;\n    if (!computedValue.scope) computedValue.scope = adm.target;\n    adm.values[propName] = computedValue;\n    Object.defineProperty(adm.target, propName, generateComputedPropConfig(propName));\n}\nvar observablePropertyConfigs = {};\nvar computedPropertyConfigs = {};\nfunction generateObservablePropConfig(propName) {\n    return observablePropertyConfigs[propName] || (observablePropertyConfigs[propName] = {\n        configurable: true,\n        enumerable: true,\n        get: function get() {\n            return this.$mobx.values[propName].get();\n        },\n        set: function set(v) {\n            setPropertyValue(this, propName, v);\n        }\n    });\n}\nfunction generateComputedPropConfig(propName) {\n    return computedPropertyConfigs[propName] || (computedPropertyConfigs[propName] = {\n        configurable: true,\n        enumerable: false,\n        get: function get() {\n            return this.$mobx.values[propName].get();\n        },\n        set: function set(v) {\n            return this.$mobx.values[propName].set(v);\n        }\n    });\n}\nfunction setPropertyValue(instance, name, newValue) {\n    var adm = instance.$mobx;\n    var observable = adm.values[name];\n    if (hasInterceptors(adm)) {\n        var change = interceptChange(adm, {\n            type: \"update\",\n            object: instance,\n            name: name, newValue: newValue\n        });\n        if (!change) return;\n        newValue = change.newValue;\n    }\n    newValue = observable.prepareNewValue(newValue);\n    if (newValue !== UNCHANGED) {\n        var notify = hasListeners(adm);\n        var notifySpy = isSpyEnabled();\n        var change = notify || notifySpy ? {\n            type: \"update\",\n            object: instance,\n            oldValue: observable.value,\n            name: name, newValue: newValue\n        } : null;\n        if (notifySpy) spyReportStart(change);\n        observable.setNewValue(newValue);\n        if (notify) notifyListeners(adm, change);\n        if (notifySpy) spyReportEnd();\n    }\n}\nfunction notifyPropertyAddition(adm, object, name, newValue) {\n    var notify = hasListeners(adm);\n    var notifySpy = isSpyEnabled();\n    var change = notify || notifySpy ? {\n        type: \"add\",\n        object: object, name: name, newValue: newValue\n    } : null;\n    if (notifySpy) spyReportStart(change);\n    if (notify) notifyListeners(adm, change);\n    if (notifySpy) spyReportEnd();\n}\nvar isObservableObjectAdministration = createInstanceofPredicate(\"ObservableObjectAdministration\", ObservableObjectAdministration);\nfunction isObservableObject(thing) {\n    if (isObject(thing)) {\n        runLazyInitializers(thing);\n        return isObservableObjectAdministration(thing.$mobx);\n    }\n    return false;\n}\nexports.isObservableObject = isObservableObject;\nvar UNCHANGED = {};\nvar ObservableValue = function (_super) {\n    __extends(ObservableValue, _super);\n    function ObservableValue(value, enhancer, name, notifySpy) {\n        if (name === void 0) {\n            name = \"ObservableValue@\" + getNextId();\n        }\n        if (notifySpy === void 0) {\n            notifySpy = true;\n        }\n        var _this = _super.call(this, name) || this;\n        _this.enhancer = enhancer;\n        _this.hasUnreportedChange = false;\n        _this.value = enhancer(value, undefined, name);\n        if (notifySpy && isSpyEnabled()) {\n            spyReport({ type: \"create\", object: _this, newValue: _this.value });\n        }\n        return _this;\n    }\n    ObservableValue.prototype.set = function (newValue) {\n        var oldValue = this.value;\n        newValue = this.prepareNewValue(newValue);\n        if (newValue !== UNCHANGED) {\n            var notifySpy = isSpyEnabled();\n            if (notifySpy) {\n                spyReportStart({\n                    type: \"update\",\n                    object: this,\n                    newValue: newValue, oldValue: oldValue\n                });\n            }\n            this.setNewValue(newValue);\n            if (notifySpy) spyReportEnd();\n        }\n    };\n    ObservableValue.prototype.prepareNewValue = function (newValue) {\n        checkIfStateModificationsAreAllowed(this);\n        if (hasInterceptors(this)) {\n            var change = interceptChange(this, { object: this, type: \"update\", newValue: newValue });\n            if (!change) return UNCHANGED;\n            newValue = change.newValue;\n        }\n        newValue = this.enhancer(newValue, this.value, this.name);\n        return this.value !== newValue ? newValue : UNCHANGED;\n    };\n    ObservableValue.prototype.setNewValue = function (newValue) {\n        var oldValue = this.value;\n        this.value = newValue;\n        this.reportChanged();\n        if (hasListeners(this)) {\n            notifyListeners(this, {\n                type: \"update\",\n                object: this,\n                newValue: newValue,\n                oldValue: oldValue\n            });\n        }\n    };\n    ObservableValue.prototype.get = function () {\n        this.reportObserved();\n        return this.value;\n    };\n    ObservableValue.prototype.intercept = function (handler) {\n        return registerInterceptor(this, handler);\n    };\n    ObservableValue.prototype.observe = function (listener, fireImmediately) {\n        if (fireImmediately) listener({\n            object: this,\n            type: \"update\",\n            newValue: this.value,\n            oldValue: undefined\n        });\n        return registerListener(this, listener);\n    };\n    ObservableValue.prototype.toJSON = function () {\n        return this.get();\n    };\n    ObservableValue.prototype.toString = function () {\n        return this.name + \"[\" + this.value + \"]\";\n    };\n    ObservableValue.prototype.valueOf = function () {\n        return toPrimitive(this.get());\n    };\n    return ObservableValue;\n}(BaseAtom);\nObservableValue.prototype[primitiveSymbol()] = ObservableValue.prototype.valueOf;\nvar isObservableValue = createInstanceofPredicate(\"ObservableValue\", ObservableValue);\nexports.isBoxedObservable = isObservableValue;\nfunction getAtom(thing, property) {\n    if ((typeof thing === \"undefined\" ? \"undefined\" : _typeof(thing)) === \"object\" && thing !== null) {\n        if (isObservableArray(thing)) {\n            invariant(property === undefined, getMessage(\"m036\"));\n            return thing.$mobx.atom;\n        }\n        if (isObservableMap(thing)) {\n            var anyThing = thing;\n            if (property === undefined) return getAtom(anyThing._keys);\n            var observable_2 = anyThing._data[property] || anyThing._hasMap[property];\n            invariant(!!observable_2, \"the entry '\" + property + \"' does not exist in the observable map '\" + getDebugName(thing) + \"'\");\n            return observable_2;\n        }\n        runLazyInitializers(thing);\n        if (isObservableObject(thing)) {\n            if (!property) return fail(\"please specify a property\");\n            var observable_3 = thing.$mobx.values[property];\n            invariant(!!observable_3, \"no observable property '\" + property + \"' found on the observable object '\" + getDebugName(thing) + \"'\");\n            return observable_3;\n        }\n        if (isAtom(thing) || isComputedValue(thing) || isReaction(thing)) {\n            return thing;\n        }\n    } else if (typeof thing === \"function\") {\n        if (isReaction(thing.$mobx)) {\n            return thing.$mobx;\n        }\n    }\n    return fail(\"Cannot obtain atom from \" + thing);\n}\nfunction getAdministration(thing, property) {\n    invariant(thing, \"Expecting some object\");\n    if (property !== undefined) return getAdministration(getAtom(thing, property));\n    if (isAtom(thing) || isComputedValue(thing) || isReaction(thing)) return thing;\n    if (isObservableMap(thing)) return thing;\n    runLazyInitializers(thing);\n    if (thing.$mobx) return thing.$mobx;\n    invariant(false, \"Cannot obtain administration from \" + thing);\n}\nfunction getDebugName(thing, property) {\n    var named;\n    if (property !== undefined) named = getAtom(thing, property);else if (isObservableObject(thing) || isObservableMap(thing)) named = getAdministration(thing);else named = getAtom(thing);\n    return named.name;\n}\nfunction createClassPropertyDecorator(onInitialize, _get, _set, enumerable, allowCustomArguments) {\n    function classPropertyDecorator(target, key, descriptor, customArgs, argLen) {\n        if (argLen === void 0) {\n            argLen = 0;\n        }\n        invariant(allowCustomArguments || quacksLikeADecorator(arguments), \"This function is a decorator, but it wasn't invoked like a decorator\");\n        if (!descriptor) {\n            var newDescriptor = {\n                enumerable: enumerable,\n                configurable: true,\n                get: function get() {\n                    if (!this.__mobxInitializedProps || this.__mobxInitializedProps[key] !== true) typescriptInitializeProperty(this, key, undefined, onInitialize, customArgs, descriptor);\n                    return _get.call(this, key);\n                },\n                set: function set(v) {\n                    if (!this.__mobxInitializedProps || this.__mobxInitializedProps[key] !== true) {\n                        typescriptInitializeProperty(this, key, v, onInitialize, customArgs, descriptor);\n                    } else {\n                        _set.call(this, key, v);\n                    }\n                }\n            };\n            if (arguments.length < 3 || arguments.length === 5 && argLen < 3) {\n                Object.defineProperty(target, key, newDescriptor);\n            }\n            return newDescriptor;\n        } else {\n            if (!hasOwnProperty(target, \"__mobxLazyInitializers\")) {\n                addHiddenProp(target, \"__mobxLazyInitializers\", target.__mobxLazyInitializers && target.__mobxLazyInitializers.slice() || []);\n            }\n            var value_1 = descriptor.value,\n                initializer_1 = descriptor.initializer;\n            target.__mobxLazyInitializers.push(function (instance) {\n                onInitialize(instance, key, initializer_1 ? initializer_1.call(instance) : value_1, customArgs, descriptor);\n            });\n            return {\n                enumerable: enumerable, configurable: true,\n                get: function get() {\n                    if (this.__mobxDidRunLazyInitializers !== true) runLazyInitializers(this);\n                    return _get.call(this, key);\n                },\n                set: function set(v) {\n                    if (this.__mobxDidRunLazyInitializers !== true) runLazyInitializers(this);\n                    _set.call(this, key, v);\n                }\n            };\n        }\n    }\n    if (allowCustomArguments) {\n        return function () {\n            if (quacksLikeADecorator(arguments)) return classPropertyDecorator.apply(null, arguments);\n            var outerArgs = arguments;\n            var argLen = arguments.length;\n            return function (target, key, descriptor) {\n                return classPropertyDecorator(target, key, descriptor, outerArgs, argLen);\n            };\n        };\n    }\n    return classPropertyDecorator;\n}\nfunction typescriptInitializeProperty(instance, key, v, onInitialize, customArgs, baseDescriptor) {\n    if (!hasOwnProperty(instance, \"__mobxInitializedProps\")) addHiddenProp(instance, \"__mobxInitializedProps\", {});\n    instance.__mobxInitializedProps[key] = true;\n    onInitialize(instance, key, v, customArgs, baseDescriptor);\n}\nfunction runLazyInitializers(instance) {\n    if (instance.__mobxDidRunLazyInitializers === true) return;\n    if (instance.__mobxLazyInitializers) {\n        addHiddenProp(instance, \"__mobxDidRunLazyInitializers\", true);\n        instance.__mobxDidRunLazyInitializers && instance.__mobxLazyInitializers.forEach(function (initializer) {\n            return initializer(instance);\n        });\n    }\n}\nfunction quacksLikeADecorator(args) {\n    return (args.length === 2 || args.length === 3) && typeof args[1] === \"string\";\n}\nfunction iteratorSymbol() {\n    return typeof Symbol === \"function\" && Symbol.iterator || \"@@iterator\";\n}\nvar IS_ITERATING_MARKER = \"__$$iterating\";\nfunction arrayAsIterator(array) {\n    invariant(array[IS_ITERATING_MARKER] !== true, \"Illegal state: cannot recycle array as iterator\");\n    addHiddenFinalProp(array, IS_ITERATING_MARKER, true);\n    var idx = -1;\n    addHiddenFinalProp(array, \"next\", function next() {\n        idx++;\n        return {\n            done: idx >= this.length,\n            value: idx < this.length ? this[idx] : undefined\n        };\n    });\n    return array;\n}\nfunction declareIterator(prototType, iteratorFactory) {\n    addHiddenFinalProp(prototType, iteratorSymbol(), iteratorFactory);\n}\nvar messages = {\n    \"m001\": \"It is not allowed to assign new values to @action fields\",\n    \"m002\": \"`runInAction` expects a function\",\n    \"m003\": \"`runInAction` expects a function without arguments\",\n    \"m004\": \"autorun expects a function\",\n    \"m005\": \"Warning: attempted to pass an action to autorun. Actions are untracked and will not trigger on state changes. Use `reaction` or wrap only your state modification code in an action.\",\n    \"m006\": \"Warning: attempted to pass an action to autorunAsync. Actions are untracked and will not trigger on state changes. Use `reaction` or wrap only your state modification code in an action.\",\n    \"m007\": \"reaction only accepts 2 or 3 arguments. If migrating from MobX 2, please provide an options object\",\n    \"m008\": \"wrapping reaction expression in `asReference` is no longer supported, use options object instead\",\n    \"m009\": \"@computed can only be used on getter functions, like: '@computed get myProps() { return ...; }'. It looks like it was used on a property.\",\n    \"m010\": \"@computed can only be used on getter functions, like: '@computed get myProps() { return ...; }'\",\n    \"m011\": \"First argument to `computed` should be an expression. If using computed as decorator, don't pass it arguments\",\n    \"m012\": \"computed takes one or two arguments if used as function\",\n    \"m013\": \"[mobx.expr] 'expr' should only be used inside other reactive functions.\",\n    \"m014\": \"extendObservable expected 2 or more arguments\",\n    \"m015\": \"extendObservable expects an object as first argument\",\n    \"m016\": \"extendObservable should not be used on maps, use map.merge instead\",\n    \"m017\": \"all arguments of extendObservable should be objects\",\n    \"m018\": \"extending an object with another observable (object) is not supported. Please construct an explicit propertymap, using `toJS` if need. See issue #540\",\n    \"m019\": \"[mobx.isObservable] isObservable(object, propertyName) is not supported for arrays and maps. Use map.has or array.length instead.\",\n    \"m020\": \"modifiers can only be used for individual object properties\",\n    \"m021\": \"observable expects zero or one arguments\",\n    \"m022\": \"@observable can not be used on getters, use @computed instead\",\n    \"m023\": \"Using `transaction` is deprecated, use `runInAction` or `(@)action` instead.\",\n    \"m024\": \"whyRun() can only be used if a derivation is active, or by passing an computed value / reaction explicitly. If you invoked whyRun from inside a computation; the computation is currently suspended but re-evaluating because somebody requested its value.\",\n    \"m025\": \"whyRun can only be used on reactions and computed values\",\n    \"m026\": \"`action` can only be invoked on functions\",\n    \"m028\": \"It is not allowed to set `useStrict` when a derivation is running\",\n    \"m029\": \"INTERNAL ERROR only onBecomeUnobserved shouldn't be called twice in a row\",\n    \"m030a\": \"Since strict-mode is enabled, changing observed observable values outside actions is not allowed. Please wrap the code in an `action` if this change is intended. Tried to modify: \",\n    \"m030b\": \"Side effects like changing state are not allowed at this point. Are you trying to modify state from, for example, the render function of a React component? Tried to modify: \",\n    \"m031\": \"Computed values are not allowed to not cause side effects by changing observables that are already being observed. Tried to modify: \",\n    \"m032\": \"* This computation is suspended (not in use by any reaction) and won't run automatically.\\n\tDidn't expect this computation to be suspended at this point?\\n\t  1. Make sure this computation is used by a reaction (reaction, autorun, observer).\\n\t  2. Check whether you are using this computation synchronously (in the same stack as they reaction that needs it).\",\n    \"m033\": \"`observe` doesn't support the fire immediately property for observable maps.\",\n    \"m034\": \"`mobx.map` is deprecated, use `new ObservableMap` or `mobx.observable.map` instead\",\n    \"m035\": \"Cannot make the designated object observable; it is not extensible\",\n    \"m036\": \"It is not possible to get index atoms from arrays\",\n    \"m037\": \"Hi there! I'm sorry you have just run into an exception.\\nIf your debugger ends up here, know that some reaction (like the render() of an observer component, autorun or reaction)\\nthrew an exception and that mobx caught it, to avoid that it brings the rest of your application down.\\nThe original cause of the exception (the code that caused this reaction to run (again)), is still in the stack.\\n\\nHowever, more interesting is the actual stack trace of the error itself.\\nHopefully the error is an instanceof Error, because in that case you can inspect the original stack of the error from where it was thrown.\\nSee `error.stack` property, or press the very subtle \\\"(...)\\\" link you see near the console.error message that probably brought you here.\\nThat stack is more interesting than the stack of this console.error itself.\\n\\nIf the exception you see is an exception you created yourself, make sure to use `throw new Error(\\\"Oops\\\")` instead of `throw \\\"Oops\\\"`,\\nbecause the javascript environment will only preserve the original stack trace in the first form.\\n\\nYou can also make sure the debugger pauses the next time this very same exception is thrown by enabling \\\"Pause on caught exception\\\".\\n(Note that it might pause on many other, unrelated exception as well).\\n\\nIf that all doesn't help you out, feel free to open an issue https://github.com/mobxjs/mobx/issues!\\n\",\n    \"m038\": \"Missing items in this list?\\n    1. Check whether all used values are properly marked as observable (use isObservable to verify)\\n    2. Make sure you didn't dereference values too early. MobX observes props, not primitives. E.g: use 'person.name' instead of 'name' in your computation.\\n\"\n};\nfunction getMessage(id) {\n    return messages[id];\n}\nvar EMPTY_ARRAY = [];\nObject.freeze(EMPTY_ARRAY);\nfunction getGlobal() {\n    return global;\n}\nfunction getNextId() {\n    return ++globalState.mobxGuid;\n}\nfunction fail(message, thing) {\n    invariant(false, message, thing);\n    throw \"X\";\n}\nfunction invariant(check, message, thing) {\n    if (!check) throw new Error(\"[mobx] Invariant failed: \" + message + (thing ? \" in '\" + thing + \"'\" : \"\"));\n}\nvar deprecatedMessages = [];\nfunction deprecated(msg) {\n    if (deprecatedMessages.indexOf(msg) !== -1) return false;\n    deprecatedMessages.push(msg);\n    console.error(\"[mobx] Deprecated: \" + msg);\n    return true;\n}\nfunction once(func) {\n    var invoked = false;\n    return function () {\n        if (invoked) return;\n        invoked = true;\n        return func.apply(this, arguments);\n    };\n}\nvar noop = function noop() {};\nfunction unique(list) {\n    var res = [];\n    list.forEach(function (item) {\n        if (res.indexOf(item) === -1) res.push(item);\n    });\n    return res;\n}\nfunction joinStrings(things, limit, separator) {\n    if (limit === void 0) {\n        limit = 100;\n    }\n    if (separator === void 0) {\n        separator = \" - \";\n    }\n    if (!things) return \"\";\n    var sliced = things.slice(0, limit);\n    return \"\" + sliced.join(separator) + (things.length > limit ? \" (... and \" + (things.length - limit) + \"more)\" : \"\");\n}\nfunction isObject(value) {\n    return value !== null && (typeof value === \"undefined\" ? \"undefined\" : _typeof(value)) === \"object\";\n}\nfunction isPlainObject(value) {\n    if (value === null || (typeof value === \"undefined\" ? \"undefined\" : _typeof(value)) !== \"object\") return false;\n    var proto = Object.getPrototypeOf(value);\n    return proto === Object.prototype || proto === null;\n}\nfunction objectAssign() {\n    var res = arguments[0];\n    for (var i = 1, l = arguments.length; i < l; i++) {\n        var source = arguments[i];\n        for (var key in source) {\n            if (hasOwnProperty(source, key)) {\n                res[key] = source[key];\n            }\n        }\n    }\n    return res;\n}\nfunction valueDidChange(compareStructural, oldValue, newValue) {\n    if (typeof oldValue === 'number' && isNaN(oldValue)) {\n        return typeof newValue !== 'number' || !isNaN(newValue);\n    }\n    return compareStructural ? !deepEqual(oldValue, newValue) : oldValue !== newValue;\n}\nvar prototypeHasOwnProperty = Object.prototype.hasOwnProperty;\nfunction hasOwnProperty(object, propName) {\n    return prototypeHasOwnProperty.call(object, propName);\n}\nfunction makeNonEnumerable(object, propNames) {\n    for (var i = 0; i < propNames.length; i++) {\n        addHiddenProp(object, propNames[i], object[propNames[i]]);\n    }\n}\nfunction addHiddenProp(object, propName, value) {\n    Object.defineProperty(object, propName, {\n        enumerable: false,\n        writable: true,\n        configurable: true,\n        value: value\n    });\n}\nfunction addHiddenFinalProp(object, propName, value) {\n    Object.defineProperty(object, propName, {\n        enumerable: false,\n        writable: false,\n        configurable: true,\n        value: value\n    });\n}\nfunction isPropertyConfigurable(object, prop) {\n    var descriptor = Object.getOwnPropertyDescriptor(object, prop);\n    return !descriptor || descriptor.configurable !== false && descriptor.writable !== false;\n}\nfunction assertPropertyConfigurable(object, prop) {\n    invariant(isPropertyConfigurable(object, prop), \"Cannot make property '\" + prop + \"' observable, it is not configurable and writable in the target object\");\n}\nfunction getEnumerableKeys(obj) {\n    var res = [];\n    for (var key in obj) {\n        res.push(key);\n    }return res;\n}\nfunction deepEqual(a, b) {\n    if (a === null && b === null) return true;\n    if (a === undefined && b === undefined) return true;\n    if ((typeof a === \"undefined\" ? \"undefined\" : _typeof(a)) !== \"object\") return a === b;\n    var aIsArray = isArrayLike(a);\n    var aIsMap = isMapLike(a);\n    if (aIsArray !== isArrayLike(b)) {\n        return false;\n    } else if (aIsMap !== isMapLike(b)) {\n        return false;\n    } else if (aIsArray) {\n        if (a.length !== b.length) return false;\n        for (var i = a.length - 1; i >= 0; i--) {\n            if (!deepEqual(a[i], b[i])) return false;\n        }return true;\n    } else if (aIsMap) {\n        if (a.size !== b.size) return false;\n        var equals_1 = true;\n        a.forEach(function (value, key) {\n            equals_1 = equals_1 && deepEqual(b.get(key), value);\n        });\n        return equals_1;\n    } else if ((typeof a === \"undefined\" ? \"undefined\" : _typeof(a)) === \"object\" && (typeof b === \"undefined\" ? \"undefined\" : _typeof(b)) === \"object\") {\n        if (a === null || b === null) return false;\n        if (isMapLike(a) && isMapLike(b)) {\n            if (a.size !== b.size) return false;\n            return deepEqual(observable.shallowMap(a).entries(), observable.shallowMap(b).entries());\n        }\n        if (getEnumerableKeys(a).length !== getEnumerableKeys(b).length) return false;\n        for (var prop in a) {\n            if (!(prop in b)) return false;\n            if (!deepEqual(a[prop], b[prop])) return false;\n        }\n        return true;\n    }\n    return false;\n}\nfunction createInstanceofPredicate(name, clazz) {\n    var propName = \"isMobX\" + name;\n    clazz.prototype[propName] = true;\n    return function (x) {\n        return isObject(x) && x[propName] === true;\n    };\n}\nfunction isArrayLike(x) {\n    return Array.isArray(x) || isObservableArray(x);\n}\nexports.isArrayLike = isArrayLike;\nfunction isMapLike(x) {\n    return isES6Map(x) || isObservableMap(x);\n}\nfunction isES6Map(thing) {\n    if (getGlobal().Map !== undefined && thing instanceof getGlobal().Map) return true;\n    return false;\n}\nfunction primitiveSymbol() {\n    return typeof Symbol === \"function\" && Symbol.toPrimitive || \"@@toPrimitive\";\n}\nfunction toPrimitive(value) {\n    return value === null ? null : (typeof value === \"undefined\" ? \"undefined\" : _typeof(value)) === \"object\" ? \"\" + value : value;\n}\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(4)))\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _icons = __webpack_require__(6);\n\nvar _constants = __webpack_require__(0);\n\nfunction renderHeader(_ref, instance) {\n  var meta = _ref.meta,\n      user = _ref.user,\n      reactions = _ref.reactions;\n\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-header-container';\n\n  var likeButton = document.createElement('span');\n  var likedReaction = reactions.find(function (reaction) {\n    return reaction.content === 'heart' && reaction.user.login === user.login;\n  });\n  likeButton.className = 'gitment-header-like-btn';\n  likeButton.innerHTML = '\\n    ' + _icons.heart + '\\n    ' + (likedReaction ? 'Unlike' : 'Like') + '\\n    ' + (meta.reactions && meta.reactions.heart ? ' \\u2022 <strong>' + meta.reactions.heart + '</strong> Liked' : '') + '\\n  ';\n\n  if (likedReaction) {\n    likeButton.classList.add('liked');\n    likeButton.onclick = function () {\n      return instance.unlike();\n    };\n  } else {\n    likeButton.classList.remove('liked');\n    likeButton.onclick = function () {\n      return instance.like();\n    };\n  }\n  container.appendChild(likeButton);\n\n  var commentsCount = document.createElement('span');\n  commentsCount.innerHTML = '\\n    ' + (meta.comments ? ' \\u2022 <strong>' + meta.comments + '</strong> Comments' : '') + '\\n  ';\n  container.appendChild(commentsCount);\n\n  var issueLink = document.createElement('a');\n  issueLink.className = 'gitment-header-issue-link';\n  issueLink.href = meta.html_url;\n  issueLink.target = '_blank';\n  issueLink.innerText = 'Issue Page';\n  container.appendChild(issueLink);\n\n  return container;\n}\n\nfunction renderComments(_ref2, instance) {\n  var meta = _ref2.meta,\n      comments = _ref2.comments,\n      commentReactions = _ref2.commentReactions,\n      currentPage = _ref2.currentPage,\n      user = _ref2.user,\n      error = _ref2.error;\n\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-comments-container';\n\n  if (error) {\n    var errorBlock = document.createElement('div');\n    errorBlock.className = 'gitment-comments-error';\n\n    if (error === _constants.NOT_INITIALIZED_ERROR && user.login && user.login.toLowerCase() === instance.owner.toLowerCase()) {\n      var initHint = document.createElement('div');\n      var initButton = document.createElement('button');\n      initButton.className = 'gitment-comments-init-btn';\n      initButton.onclick = function () {\n        initButton.setAttribute('disabled', true);\n        instance.init().catch(function (e) {\n          initButton.removeAttribute('disabled');\n          alert(e);\n        });\n      };\n      initButton.innerText = 'Initialize Comments';\n      initHint.appendChild(initButton);\n      errorBlock.appendChild(initHint);\n    } else {\n      errorBlock.innerText = error;\n    }\n    container.appendChild(errorBlock);\n    return container;\n  } else if (comments === undefined) {\n    var loading = document.createElement('div');\n    loading.innerText = 'Loading comments...';\n    loading.className = 'gitment-comments-loading';\n    container.appendChild(loading);\n    return container;\n  } else if (!comments.length) {\n    var emptyBlock = document.createElement('div');\n    emptyBlock.className = 'gitment-comments-empty';\n    emptyBlock.innerText = 'No Comment Yet';\n    container.appendChild(emptyBlock);\n    return container;\n  }\n\n  var commentsList = document.createElement('ul');\n  commentsList.className = 'gitment-comments-list';\n\n  comments.forEach(function (comment) {\n    var createDate = new Date(comment.created_at);\n    var updateDate = new Date(comment.updated_at);\n    var commentItem = document.createElement('li');\n    commentItem.className = 'gitment-comment';\n    commentItem.innerHTML = '\\n      <a class=\"gitment-comment-avatar\" href=\"' + comment.user.html_url + '\" target=\"_blank\">\\n        <img class=\"gitment-comment-avatar-img\" src=\"' + comment.user.avatar_url + '\"/>\\n      </a>\\n      <div class=\"gitment-comment-main\">\\n        <div class=\"gitment-comment-header\">\\n          <a class=\"gitment-comment-name\" href=\"' + comment.user.html_url + '\" target=\"_blank\">\\n            ' + comment.user.login + '\\n          </a>\\n          commented on\\n          <span title=\"' + createDate + '\">' + createDate.toDateString() + '</span>\\n          ' + (createDate.toString() !== updateDate.toString() ? ' \\u2022 <span title=\"comment was edited at ' + updateDate + '\">edited</span>' : '') + '\\n          <div class=\"gitment-comment-like-btn\">' + _icons.heart + ' ' + (comment.reactions.heart || '') + '</div>\\n        </div>\\n        <div class=\"gitment-comment-body gitment-markdown\">' + comment.body_html + '</div>\\n      </div>\\n    ';\n    var likeButton = commentItem.querySelector('.gitment-comment-like-btn');\n    var likedReaction = commentReactions[comment.id] && commentReactions[comment.id].find(function (reaction) {\n      return reaction.content === 'heart' && reaction.user.login === user.login;\n    });\n    if (likedReaction) {\n      likeButton.classList.add('liked');\n      likeButton.onclick = function () {\n        return instance.unlikeAComment(comment.id);\n      };\n    } else {\n      likeButton.classList.remove('liked');\n      likeButton.onclick = function () {\n        return instance.likeAComment(comment.id);\n      };\n    }\n\n    // dirty\n    // use a blank image to trigger height calculating when element rendered\n    var imgTrigger = document.createElement('img');\n    var markdownBody = commentItem.querySelector('.gitment-comment-body');\n    imgTrigger.className = 'gitment-hidden';\n    imgTrigger.src = \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\";\n    imgTrigger.onload = function () {\n      if (markdownBody.clientHeight > instance.maxCommentHeight) {\n        markdownBody.classList.add('gitment-comment-body-folded');\n        markdownBody.style.maxHeight = instance.maxCommentHeight + 'px';\n        markdownBody.title = 'Click to Expand';\n        markdownBody.onclick = function () {\n          markdownBody.classList.remove('gitment-comment-body-folded');\n          markdownBody.style.maxHeight = '';\n          markdownBody.title = '';\n          markdownBody.onclick = null;\n        };\n      }\n    };\n    commentItem.appendChild(imgTrigger);\n\n    commentsList.appendChild(commentItem);\n  });\n\n  container.appendChild(commentsList);\n\n  if (meta) {\n    var pageCount = Math.ceil(meta.comments / instance.perPage);\n    if (pageCount > 1) {\n      var pagination = document.createElement('ul');\n      pagination.className = 'gitment-comments-pagination';\n\n      if (currentPage > 1) {\n        var previousButton = document.createElement('li');\n        previousButton.className = 'gitment-comments-page-item';\n        previousButton.innerText = 'Previous';\n        previousButton.onclick = function () {\n          return instance.goto(currentPage - 1);\n        };\n        pagination.appendChild(previousButton);\n      }\n\n      var _loop = function _loop(i) {\n        var pageItem = document.createElement('li');\n        pageItem.className = 'gitment-comments-page-item';\n        pageItem.innerText = i;\n        pageItem.onclick = function () {\n          return instance.goto(i);\n        };\n        if (currentPage === i) pageItem.classList.add('gitment-selected');\n        pagination.appendChild(pageItem);\n      };\n\n      for (var i = 1; i <= pageCount; i++) {\n        _loop(i);\n      }\n\n      if (currentPage < pageCount) {\n        var nextButton = document.createElement('li');\n        nextButton.className = 'gitment-comments-page-item';\n        nextButton.innerText = 'Next';\n        nextButton.onclick = function () {\n          return instance.goto(currentPage + 1);\n        };\n        pagination.appendChild(nextButton);\n      }\n\n      container.appendChild(pagination);\n    }\n  }\n\n  return container;\n}\n\nfunction renderEditor(_ref3, instance) {\n  var user = _ref3.user,\n      error = _ref3.error;\n\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-editor-container';\n\n  var shouldDisable = user.login && !error ? '' : 'disabled';\n  var disabledTip = user.login ? '' : 'Login to Comment';\n  container.innerHTML = '\\n      ' + (user.login ? '<a class=\"gitment-editor-avatar\" href=\"' + user.html_url + '\" target=\"_blank\">\\n            <img class=\"gitment-editor-avatar-img\" src=\"' + user.avatar_url + '\"/>\\n          </a>' : user.isLoggingIn ? '<div class=\"gitment-editor-avatar\">' + _icons.spinner + '</div>' : '<a class=\"gitment-editor-avatar\" href=\"' + instance.loginLink + '\" title=\"login with GitHub\">\\n              ' + _icons.github + '\\n            </a>') + '\\n    </a>\\n    <div class=\"gitment-editor-main\">\\n      <div class=\"gitment-editor-header\">\\n        <nav class=\"gitment-editor-tabs\">\\n          <button class=\"gitment-editor-tab gitment-selected\">Write</button>\\n          <button class=\"gitment-editor-tab\">Preview</button>\\n        </nav>\\n        <div class=\"gitment-editor-login\">\\n          ' + (user.login ? '<a class=\"gitment-editor-logout-link\">Logout</a>' : user.isLoggingIn ? 'Logging in...' : '<a class=\"gitment-editor-login-link\" href=\"' + instance.loginLink + '\">Login</a> with GitHub') + '\\n        </div>\\n      </div>\\n      <div class=\"gitment-editor-body\">\\n        <div class=\"gitment-editor-write-field\">\\n          <textarea placeholder=\"Leave a comment\" title=\"' + disabledTip + '\" ' + shouldDisable + '></textarea>\\n        </div>\\n        <div class=\"gitment-editor-preview-field gitment-hidden\">\\n          <div class=\"gitment-editor-preview gitment-markdown\"></div>\\n        </div>\\n      </div>\\n    </div>\\n    <div class=\"gitment-editor-footer\">\\n      <a class=\"gitment-editor-footer-tip\" href=\"https://guides.github.com/features/mastering-markdown/\" target=\"_blank\">\\n        Styling with Markdown is supported\\n      </a>\\n      <button class=\"gitment-editor-submit\" title=\"' + disabledTip + '\" ' + shouldDisable + '>Comment</button>\\n    </div>\\n  ';\n  if (user.login) {\n    container.querySelector('.gitment-editor-logout-link').onclick = function () {\n      return instance.logout();\n    };\n  }\n\n  var writeField = container.querySelector('.gitment-editor-write-field');\n  var previewField = container.querySelector('.gitment-editor-preview-field');\n\n  var textarea = writeField.querySelector('textarea');\n  textarea.oninput = function () {\n    textarea.style.height = 'auto';\n    var style = window.getComputedStyle(textarea, null);\n    var height = parseInt(style.height, 10);\n    var clientHeight = textarea.clientHeight;\n    var scrollHeight = textarea.scrollHeight;\n    if (clientHeight < scrollHeight) {\n      textarea.style.height = height + scrollHeight - clientHeight + 'px';\n    }\n  };\n\n  var _container$querySelec = container.querySelectorAll('.gitment-editor-tab'),\n      _container$querySelec2 = _slicedToArray(_container$querySelec, 2),\n      writeTab = _container$querySelec2[0],\n      previewTab = _container$querySelec2[1];\n\n  writeTab.onclick = function () {\n    writeTab.classList.add('gitment-selected');\n    previewTab.classList.remove('gitment-selected');\n    writeField.classList.remove('gitment-hidden');\n    previewField.classList.add('gitment-hidden');\n\n    textarea.focus();\n  };\n  previewTab.onclick = function () {\n    previewTab.classList.add('gitment-selected');\n    writeTab.classList.remove('gitment-selected');\n    previewField.classList.remove('gitment-hidden');\n    writeField.classList.add('gitment-hidden');\n\n    var preview = previewField.querySelector('.gitment-editor-preview');\n    var content = textarea.value.trim();\n    if (!content) {\n      preview.innerText = 'Nothing to preview';\n      return;\n    }\n\n    preview.innerText = 'Loading preview...';\n    instance.markdown(content).then(function (html) {\n      return preview.innerHTML = html;\n    });\n  };\n\n  var submitButton = container.querySelector('.gitment-editor-submit');\n  submitButton.onclick = function () {\n    submitButton.innerText = 'Submitting...';\n    submitButton.setAttribute('disabled', true);\n    instance.post(textarea.value.trim()).then(function (data) {\n      textarea.value = '';\n      textarea.style.height = 'auto';\n      submitButton.removeAttribute('disabled');\n      submitButton.innerText = 'Comment';\n    }).catch(function (e) {\n      alert(e);\n      submitButton.removeAttribute('disabled');\n      submitButton.innerText = 'Comment';\n    });\n  };\n\n  return container;\n}\n\nfunction renderFooter() {\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-footer-container';\n  container.innerHTML = '\\n    Powered by\\n    <a class=\"gitment-footer-project-link\" href=\"https://github.com/imsun/gitment\" target=\"_blank\">\\n      Gitment\\n    </a>\\n  ';\n  return container;\n}\n\nfunction render(state, instance) {\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-root-container';\n  container.appendChild(instance.renderHeader(state, instance));\n  container.appendChild(instance.renderComments(state, instance));\n  container.appendChild(instance.renderEditor(state, instance));\n  container.appendChild(instance.renderFooter(state, instance));\n  return container;\n}\n\nexports.default = { render: render, renderHeader: renderHeader, renderComments: renderComments, renderEditor: renderEditor, renderFooter: renderFooter };\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.http = exports.Query = exports.isString = undefined;\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nexports.getTargetContainer = getTargetContainer;\n\nvar _constants = __webpack_require__(0);\n\nvar isString = exports.isString = function isString(s) {\n  return toString.call(s) === '[object String]';\n};\n\nfunction getTargetContainer(container) {\n  var targetContainer = void 0;\n  if (container instanceof Element) {\n    targetContainer = container;\n  } else if (isString(container)) {\n    targetContainer = document.getElementById(container);\n  } else {\n    targetContainer = document.createElement('div');\n  }\n\n  return targetContainer;\n}\n\nvar Query = exports.Query = {\n  parse: function parse() {\n    var search = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : window.location.search;\n\n    if (!search) return {};\n    var queryString = search[0] === '?' ? search.substring(1) : search;\n    var query = {};\n    queryString.split('&').forEach(function (queryStr) {\n      var _queryStr$split = queryStr.split('='),\n          _queryStr$split2 = _slicedToArray(_queryStr$split, 2),\n          key = _queryStr$split2[0],\n          value = _queryStr$split2[1];\n\n      if (key) query[key] = value;\n    });\n\n    return query;\n  },\n  stringify: function stringify(query) {\n    var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '?';\n\n    var queryString = Object.keys(query).map(function (key) {\n      return key + '=' + encodeURIComponent(query[key] || '');\n    }).join('&');\n    return queryString ? prefix + queryString : '';\n  }\n};\n\nfunction ajaxFactory(method) {\n  return function (apiPath) {\n    var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var base = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'https://api.github.com';\n\n    var req = new XMLHttpRequest();\n    var token = localStorage.getItem(_constants.LS_ACCESS_TOKEN_KEY);\n\n    var url = '' + base + apiPath;\n    var body = null;\n    if (method === 'GET' || method === 'DELETE') {\n      url += Query.stringify(data);\n    }\n\n    var p = new Promise(function (resolve, reject) {\n      req.addEventListener('load', function () {\n        var contentType = req.getResponseHeader('content-type');\n        var res = req.responseText;\n        if (!/json/.test(contentType)) {\n          resolve(res);\n          return;\n        }\n        var data = req.responseText ? JSON.parse(res) : {};\n        if (data.message) {\n          reject(new Error(data.message));\n        } else {\n          resolve(data);\n        }\n      });\n      req.addEventListener('error', function (error) {\n        return reject(error);\n      });\n    });\n    req.open(method, url, true);\n\n    req.setRequestHeader('Accept', 'application/vnd.github.squirrel-girl-preview, application/vnd.github.html+json');\n    if (token) {\n      req.setRequestHeader('Authorization', 'token ' + token);\n    }\n    if (method !== 'GET' && method !== 'DELETE') {\n      body = JSON.stringify(data);\n      req.setRequestHeader('Content-Type', 'application/json');\n    }\n\n    req.send(body);\n    return p;\n  };\n}\n\nvar http = exports.http = {\n  get: ajaxFactory('GET'),\n  post: ajaxFactory('POST'),\n  delete: ajaxFactory('DELETE'),\n  put: ajaxFactory('PUT')\n};\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar g;\n\n// This works in non-strict mode\ng = function () {\n\treturn this;\n}();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || Function(\"return this\")() || (1, eval)(\"this\");\n} catch (e) {\n\t// This works if the window reference is available\n\tif ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _mobx = __webpack_require__(1);\n\nvar _constants = __webpack_require__(0);\n\nvar _utils = __webpack_require__(3);\n\nvar _default = __webpack_require__(2);\n\nvar _default2 = _interopRequireDefault(_default);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar scope = 'public_repo';\n\nfunction extendRenderer(instance, renderer) {\n  instance[renderer] = function (container) {\n    var targetContainer = (0, _utils.getTargetContainer)(container);\n    var render = instance.theme[renderer] || instance.defaultTheme[renderer];\n\n    (0, _mobx.autorun)(function () {\n      var e = render(instance.state, instance);\n      if (targetContainer.firstChild) {\n        targetContainer.replaceChild(e, targetContainer.firstChild);\n      } else {\n        targetContainer.appendChild(e);\n      }\n    });\n\n    return targetContainer;\n  };\n}\n\nvar Gitment = function () {\n  _createClass(Gitment, [{\n    key: 'accessToken',\n    get: function get() {\n      return localStorage.getItem(_constants.LS_ACCESS_TOKEN_KEY);\n    },\n    set: function set(token) {\n      localStorage.setItem(_constants.LS_ACCESS_TOKEN_KEY, token);\n    }\n  }, {\n    key: 'loginLink',\n    get: function get() {\n      var oauthUri = 'https://github.com/login/oauth/authorize';\n      var redirect_uri = this.oauth.redirect_uri || window.location.href;\n\n      var oauthParams = Object.assign({\n        scope: scope,\n        redirect_uri: redirect_uri\n      }, this.oauth);\n\n      return '' + oauthUri + _utils.Query.stringify(oauthParams);\n    }\n  }]);\n\n  function Gitment() {\n    var _this = this;\n\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, Gitment);\n\n    this.defaultTheme = _default2.default;\n    this.useTheme(_default2.default);\n\n    Object.assign(this, {\n      id: window.location.href,\n      title: window.document.title,\n      link: window.location.href,\n      desc: '',\n      labels: [],\n      theme: _default2.default,\n      oauth: {},\n      perPage: 20,\n      maxCommentHeight: 250\n    }, options);\n\n    this.useTheme(this.theme);\n\n    var user = {};\n    try {\n      var userInfo = localStorage.getItem(_constants.LS_USER_KEY);\n      if (this.accessToken && userInfo) {\n        Object.assign(user, JSON.parse(userInfo), {\n          fromCache: true\n        });\n      }\n    } catch (e) {\n      localStorage.removeItem(_constants.LS_USER_KEY);\n    }\n\n    this.state = (0, _mobx.observable)({\n      user: user,\n      error: null,\n      meta: {},\n      comments: undefined,\n      reactions: [],\n      commentReactions: {},\n      currentPage: 1\n    });\n\n    var query = _utils.Query.parse();\n    if (query.code) {\n      var _oauth = this.oauth,\n          client_id = _oauth.client_id,\n          client_secret = _oauth.client_secret;\n\n      var code = query.code;\n      delete query.code;\n      var search = _utils.Query.stringify(query);\n      var replacedUrl = '' + window.location.origin + window.location.pathname + search + window.location.hash;\n      history.replaceState({}, '', replacedUrl);\n\n      Object.assign(this, {\n        id: replacedUrl,\n        link: replacedUrl\n      }, options);\n\n      this.state.user.isLoggingIn = true;\n      _utils.http.post('https://gh-oauth.imsun.net', {\n        code: code,\n        client_id: client_id,\n        client_secret: client_secret\n      }, '').then(function (data) {\n        _this.accessToken = data.access_token;\n        _this.update();\n      }).catch(function (e) {\n        _this.state.user.isLoggingIn = false;\n        alert(e);\n      });\n    } else {\n      this.update();\n    }\n  }\n\n  _createClass(Gitment, [{\n    key: 'init',\n    value: function init() {\n      var _this2 = this;\n\n      return this.createIssue().then(function () {\n        return _this2.loadComments();\n      }).then(function (comments) {\n        _this2.state.error = null;\n        return comments;\n      });\n    }\n  }, {\n    key: 'useTheme',\n    value: function useTheme() {\n      var _this3 = this;\n\n      var theme = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      this.theme = theme;\n\n      var renderers = Object.keys(this.theme);\n      renderers.forEach(function (renderer) {\n        return extendRenderer(_this3, renderer);\n      });\n    }\n  }, {\n    key: 'update',\n    value: function update() {\n      var _this4 = this;\n\n      return Promise.all([this.loadMeta(), this.loadUserInfo()]).then(function () {\n        return Promise.all([_this4.loadComments().then(function () {\n          return _this4.loadCommentReactions();\n        }), _this4.loadReactions()]);\n      }).catch(function (e) {\n        return _this4.state.error = e;\n      });\n    }\n  }, {\n    key: 'markdown',\n    value: function markdown(text) {\n      return _utils.http.post('/markdown', {\n        text: text,\n        mode: 'gfm'\n      });\n    }\n  }, {\n    key: 'createIssue',\n    value: function createIssue() {\n      var _this5 = this;\n\n      var id = this.id,\n          owner = this.owner,\n          repo = this.repo,\n          title = this.title,\n          link = this.link,\n          desc = this.desc,\n          labels = this.labels;\n\n\n      return _utils.http.post('/repos/' + owner + '/' + repo + '/issues', {\n        title: title,\n        labels: labels.concat(['gitment', id]),\n        body: link + '\\n\\n' + desc\n      }).then(function (meta) {\n        _this5.state.meta = meta;\n        return meta;\n      });\n    }\n  }, {\n    key: 'getIssue',\n    value: function getIssue() {\n      if (this.state.meta.id) return Promise.resolve(this.state.meta);\n\n      return this.loadMeta();\n    }\n  }, {\n    key: 'post',\n    value: function post(body) {\n      var _this6 = this;\n\n      return this.getIssue().then(function (issue) {\n        return _utils.http.post(issue.comments_url, { body: body }, '');\n      }).then(function (data) {\n        _this6.state.meta.comments++;\n        var pageCount = Math.ceil(_this6.state.meta.comments / _this6.perPage);\n        if (_this6.state.currentPage === pageCount) {\n          _this6.state.comments.push(data);\n        }\n        return data;\n      });\n    }\n  }, {\n    key: 'loadMeta',\n    value: function loadMeta() {\n      var _this7 = this;\n\n      var id = this.id,\n          owner = this.owner,\n          repo = this.repo;\n\n      return _utils.http.get('/repos/' + owner + '/' + repo + '/issues', {\n        creator: owner,\n        labels: id\n      }).then(function (issues) {\n        if (!issues.length) return Promise.reject(_constants.NOT_INITIALIZED_ERROR);\n        _this7.state.meta = issues[0];\n        return issues[0];\n      });\n    }\n  }, {\n    key: 'loadComments',\n    value: function loadComments() {\n      var _this8 = this;\n\n      var page = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.state.currentPage;\n\n      return this.getIssue().then(function (issue) {\n        return _utils.http.get(issue.comments_url, { page: page, per_page: _this8.perPage }, '');\n      }).then(function (comments) {\n        _this8.state.comments = comments;\n        return comments;\n      });\n    }\n  }, {\n    key: 'loadUserInfo',\n    value: function loadUserInfo() {\n      var _this9 = this;\n\n      if (!this.accessToken) {\n        this.logout();\n        return Promise.resolve({});\n      }\n\n      return _utils.http.get('/user').then(function (user) {\n        _this9.state.user = user;\n        localStorage.setItem(_constants.LS_USER_KEY, JSON.stringify(user));\n        return user;\n      });\n    }\n  }, {\n    key: 'loadReactions',\n    value: function loadReactions() {\n      var _this10 = this;\n\n      if (!this.accessToken) {\n        this.state.reactions = [];\n        return Promise.resolve([]);\n      }\n\n      return this.getIssue().then(function (issue) {\n        if (!issue.reactions.total_count) return [];\n        return _utils.http.get(issue.reactions.url, {}, '');\n      }).then(function (reactions) {\n        _this10.state.reactions = reactions;\n        return reactions;\n      });\n    }\n  }, {\n    key: 'loadCommentReactions',\n    value: function loadCommentReactions() {\n      var _this11 = this;\n\n      if (!this.accessToken) {\n        this.state.commentReactions = {};\n        return Promise.resolve([]);\n      }\n\n      var comments = this.state.comments;\n      var comentReactions = {};\n\n      return Promise.all(comments.map(function (comment) {\n        if (!comment.reactions.total_count) return [];\n\n        var owner = _this11.owner,\n            repo = _this11.repo;\n\n        return _utils.http.get('/repos/' + owner + '/' + repo + '/issues/comments/' + comment.id + '/reactions', {});\n      })).then(function (reactionsArray) {\n        comments.forEach(function (comment, index) {\n          comentReactions[comment.id] = reactionsArray[index];\n        });\n        _this11.state.commentReactions = comentReactions;\n\n        return comentReactions;\n      });\n    }\n  }, {\n    key: 'login',\n    value: function login() {\n      window.location.href = this.loginLink;\n    }\n  }, {\n    key: 'logout',\n    value: function logout() {\n      localStorage.removeItem(_constants.LS_ACCESS_TOKEN_KEY);\n      localStorage.removeItem(_constants.LS_USER_KEY);\n      this.state.user = {};\n    }\n  }, {\n    key: 'goto',\n    value: function goto(page) {\n      this.state.currentPage = page;\n      this.state.comments = undefined;\n      return this.loadComments(page);\n    }\n  }, {\n    key: 'like',\n    value: function like() {\n      var _this12 = this;\n\n      if (!this.accessToken) {\n        alert('Login to Like');\n        return Promise.reject();\n      }\n\n      var owner = this.owner,\n          repo = this.repo;\n\n\n      return _utils.http.post('/repos/' + owner + '/' + repo + '/issues/' + this.state.meta.number + '/reactions', {\n        content: 'heart'\n      }).then(function (reaction) {\n        _this12.state.reactions.push(reaction);\n        _this12.state.meta.reactions.heart++;\n      });\n    }\n  }, {\n    key: 'unlike',\n    value: function unlike() {\n      var _this13 = this;\n\n      if (!this.accessToken) return Promise.reject();\n\n      var _state = this.state,\n          user = _state.user,\n          reactions = _state.reactions;\n\n      var index = reactions.findIndex(function (reaction) {\n        return reaction.user.login === user.login;\n      });\n      return _utils.http.delete('/reactions/' + reactions[index].id).then(function () {\n        reactions.splice(index, 1);\n        _this13.state.meta.reactions.heart--;\n      });\n    }\n  }, {\n    key: 'likeAComment',\n    value: function likeAComment(commentId) {\n      var _this14 = this;\n\n      if (!this.accessToken) {\n        alert('Login to Like');\n        return Promise.reject();\n      }\n\n      var owner = this.owner,\n          repo = this.repo;\n\n      var comment = this.state.comments.find(function (comment) {\n        return comment.id === commentId;\n      });\n\n      return _utils.http.post('/repos/' + owner + '/' + repo + '/issues/comments/' + commentId + '/reactions', {\n        content: 'heart'\n      }).then(function (reaction) {\n        _this14.state.commentReactions[commentId].push(reaction);\n        comment.reactions.heart++;\n      });\n    }\n  }, {\n    key: 'unlikeAComment',\n    value: function unlikeAComment(commentId) {\n      if (!this.accessToken) return Promise.reject();\n\n      var reactions = this.state.commentReactions[commentId];\n      var comment = this.state.comments.find(function (comment) {\n        return comment.id === commentId;\n      });\n      var user = this.state.user;\n\n      var index = reactions.findIndex(function (reaction) {\n        return reaction.user.login === user.login;\n      });\n\n      return _utils.http.delete('/reactions/' + reactions[index].id).then(function () {\n        reactions.splice(index, 1);\n        comment.reactions.heart--;\n      });\n    }\n  }]);\n\n  return Gitment;\n}();\n\nmodule.exports = Gitment;\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/**\n * Modified from https://github.com/evil-icons/evil-icons\n */\n\nvar close = exports.close = '<svg class=\"gitment-close-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 50 50\"><path d=\"M37.304 11.282l1.414 1.414-26.022 26.02-1.414-1.413z\"/><path d=\"M12.696 11.282l26.022 26.02-1.414 1.415-26.022-26.02z\"/></svg>';\nvar github = exports.github = '<svg class=\"gitment-github-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 50 50\"><path d=\"M25 10c-8.3 0-15 6.7-15 15 0 6.6 4.3 12.2 10.3 14.2.8.1 1-.3 1-.7v-2.6c-4.2.9-5.1-2-5.1-2-.7-1.7-1.7-2.2-1.7-2.2-1.4-.9.1-.9.1-.9 1.5.1 2.3 1.5 2.3 1.5 1.3 2.3 3.5 1.6 4.4 1.2.1-1 .5-1.6 1-2-3.3-.4-6.8-1.7-6.8-7.4 0-1.6.6-3 1.5-4-.2-.4-.7-1.9.1-4 0 0 1.3-.4 4.1 1.5 1.2-.3 2.5-.5 3.8-.5 1.3 0 2.6.2 3.8.5 2.9-1.9 4.1-1.5 4.1-1.5.8 2.1.3 3.6.1 4 1 1 1.5 2.4 1.5 4 0 5.8-3.5 7-6.8 7.4.5.5 1 1.4 1 2.8v4.1c0 .4.3.9 1 .7 6-2 10.2-7.6 10.2-14.2C40 16.7 33.3 10 25 10z\"/></svg>';\nvar heart = exports.heart = '<svg class=\"gitment-heart-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 50 50\"><path d=\"M25 39.7l-.6-.5C11.5 28.7 8 25 8 19c0-5 4-9 9-9 4.1 0 6.4 2.3 8 4.1 1.6-1.8 3.9-4.1 8-4.1 5 0 9 4 9 9 0 6-3.5 9.7-16.4 20.2l-.6.5zM17 12c-3.9 0-7 3.1-7 7 0 5.1 3.2 8.5 15 18.1 11.8-9.6 15-13 15-18.1 0-3.9-3.1-7-7-7-3.5 0-5.4 2.1-6.9 3.8L25 17.1l-1.1-1.3C22.4 14.1 20.5 12 17 12z\"/></svg>';\nvar spinner = exports.spinner = '<svg class=\"gitment-spinner-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 50 50\"><path d=\"M25 18c-.6 0-1-.4-1-1V9c0-.6.4-1 1-1s1 .4 1 1v8c0 .6-.4 1-1 1z\"/><path opacity=\".3\" d=\"M25 42c-.6 0-1-.4-1-1v-8c0-.6.4-1 1-1s1 .4 1 1v8c0 .6-.4 1-1 1z\"/><path opacity=\".3\" d=\"M29 19c-.2 0-.3 0-.5-.1-.4-.3-.6-.8-.3-1.3l4-6.9c.3-.4.8-.6 1.3-.3.4.3.6.8.3 1.3l-4 6.9c-.2.2-.5.4-.8.4z\"/><path opacity=\".3\" d=\"M17 39.8c-.2 0-.3 0-.5-.1-.4-.3-.6-.8-.3-1.3l4-6.9c.3-.4.8-.6 1.3-.3.4.3.6.8.3 1.3l-4 6.9c-.2.2-.5.4-.8.4z\"/><path opacity=\".93\" d=\"M21 19c-.3 0-.6-.2-.8-.5l-4-6.9c-.3-.4-.1-1 .3-1.3.4-.3 1-.1 1.3.3l4 6.9c.3.4.1 1-.3 1.3-.2.2-.3.2-.5.2z\"/><path opacity=\".3\" d=\"M33 39.8c-.3 0-.6-.2-.8-.5l-4-6.9c-.3-.4-.1-1 .3-1.3.4-.3 1-.1 1.3.3l4 6.9c.3.4.1 1-.3 1.3-.2.1-.3.2-.5.2z\"/><path opacity=\".65\" d=\"M17 26H9c-.6 0-1-.4-1-1s.4-1 1-1h8c.6 0 1 .4 1 1s-.4 1-1 1z\"/><path opacity=\".3\" d=\"M41 26h-8c-.6 0-1-.4-1-1s.4-1 1-1h8c.6 0 1 .4 1 1s-.4 1-1 1z\"/><path opacity=\".86\" d=\"M18.1 21.9c-.2 0-.3 0-.5-.1l-6.9-4c-.4-.3-.6-.8-.3-1.3.3-.4.8-.6 1.3-.3l6.9 4c.4.3.6.8.3 1.3-.2.3-.5.4-.8.4z\"/><path opacity=\".3\" d=\"M38.9 33.9c-.2 0-.3 0-.5-.1l-6.9-4c-.4-.3-.6-.8-.3-1.3.3-.4.8-.6 1.3-.3l6.9 4c.4.3.6.8.3 1.3-.2.3-.5.4-.8.4z\"/><path opacity=\".44\" d=\"M11.1 33.9c-.3 0-.6-.2-.8-.5-.3-.4-.1-1 .3-1.3l6.9-4c.4-.3 1-.1 1.3.3.3.4.1 1-.3 1.3l-6.9 4c-.1.2-.3.2-.5.2z\"/><path opacity=\".3\" d=\"M31.9 21.9c-.3 0-.6-.2-.8-.5-.3-.4-.1-1 .3-1.3l6.9-4c.4-.3 1-.1 1.3.3.3.4.1 1-.3 1.3l-6.9 4c-.2.2-.3.2-.5.2z\"/></svg>';\n\n/***/ })\n/******/ ]);\n//# sourceMappingURL=gitment.browser.js.map","date":"2018-03-04T15:08:12.842Z","updated":"2018-03-04T15:08:12.842Z","path":"js/gitment.browser.js","layout":"false","title":"","comments":1,"_id":"cjk698hzv001gznzwi5smnjmv","content":"var Gitment =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 5);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar LS_ACCESS_TOKEN_KEY = exports.LS_ACCESS_TOKEN_KEY = 'gitment-comments-token';\nvar LS_USER_KEY = exports.LS_USER_KEY = 'gitment-user-info';\n\nvar NOT_INITIALIZED_ERROR = exports.NOT_INITIALIZED_ERROR = new Error('Comments Not Initialized');\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global) {\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar __extends = undefined && undefined.__extends || function () {\n    var extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (d, b) {\n        d.__proto__ = b;\n    } || function (d, b) {\n        for (var p in b) {\n            if (b.hasOwnProperty(p)) d[p] = b[p];\n        }\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() {\n            this.constructor = d;\n        }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n}();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nregisterGlobals();\nexports.extras = {\n    allowStateChanges: allowStateChanges,\n    deepEqual: deepEqual,\n    getAtom: getAtom,\n    getDebugName: getDebugName,\n    getDependencyTree: getDependencyTree,\n    getAdministration: getAdministration,\n    getGlobalState: getGlobalState,\n    getObserverTree: getObserverTree,\n    isComputingDerivation: isComputingDerivation,\n    isSpyEnabled: isSpyEnabled,\n    onReactionError: onReactionError,\n    resetGlobalState: resetGlobalState,\n    shareGlobalState: shareGlobalState,\n    spyReport: spyReport,\n    spyReportEnd: spyReportEnd,\n    spyReportStart: spyReportStart,\n    setReactionScheduler: setReactionScheduler\n};\nif ((typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__ === \"undefined\" ? \"undefined\" : _typeof(__MOBX_DEVTOOLS_GLOBAL_HOOK__)) === \"object\") {\n    __MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx(module.exports);\n}\nmodule.exports.default = module.exports;\nvar actionFieldDecorator = createClassPropertyDecorator(function (target, key, value, args, originalDescriptor) {\n    var actionName = args && args.length === 1 ? args[0] : value.name || key || \"<unnamed action=\"\">\";\n    var wrappedAction = action(actionName, value);\n    addHiddenProp(target, key, wrappedAction);\n}, function (key) {\n    return this[key];\n}, function () {\n    invariant(false, getMessage(\"m001\"));\n}, false, true);\nvar boundActionDecorator = createClassPropertyDecorator(function (target, key, value) {\n    defineBoundAction(target, key, value);\n}, function (key) {\n    return this[key];\n}, function () {\n    invariant(false, getMessage(\"m001\"));\n}, false, false);\nvar action = function action(arg1, arg2, arg3, arg4) {\n    if (arguments.length === 1 && typeof arg1 === \"function\") return createAction(arg1.name || \"<unnamed action=\"\">\", arg1);\n    if (arguments.length === 2 && typeof arg2 === \"function\") return createAction(arg1, arg2);\n    if (arguments.length === 1 && typeof arg1 === \"string\") return namedActionDecorator(arg1);\n    return namedActionDecorator(arg2).apply(null, arguments);\n};\nexports.action = action;\naction.bound = function boundAction(arg1, arg2, arg3) {\n    if (typeof arg1 === \"function\") {\n        var action_1 = createAction(\"<not yet=\"\" bound=\"\" action=\"\">\", arg1);\n        action_1.autoBind = true;\n        return action_1;\n    }\n    return boundActionDecorator.apply(null, arguments);\n};\nfunction namedActionDecorator(name) {\n    return function (target, prop, descriptor) {\n        if (descriptor && typeof descriptor.value === \"function\") {\n            descriptor.value = createAction(name, descriptor.value);\n            descriptor.enumerable = false;\n            descriptor.configurable = true;\n            return descriptor;\n        }\n        return actionFieldDecorator(name).apply(this, arguments);\n    };\n}\nfunction runInAction(arg1, arg2, arg3) {\n    var actionName = typeof arg1 === \"string\" ? arg1 : arg1.name || \"<unnamed action=\"\">\";\n    var fn = typeof arg1 === \"function\" ? arg1 : arg2;\n    var scope = typeof arg1 === \"function\" ? arg2 : arg3;\n    invariant(typeof fn === \"function\", getMessage(\"m002\"));\n    invariant(fn.length === 0, getMessage(\"m003\"));\n    invariant(typeof actionName === \"string\" && actionName.length > 0, \"actions should have valid names, got: '\" + actionName + \"'\");\n    return executeAction(actionName, fn, scope, undefined);\n}\nexports.runInAction = runInAction;\nfunction isAction(thing) {\n    return typeof thing === \"function\" && thing.isMobxAction === true;\n}\nexports.isAction = isAction;\nfunction defineBoundAction(target, propertyName, fn) {\n    var res = function res() {\n        return executeAction(propertyName, fn, target, arguments);\n    };\n    res.isMobxAction = true;\n    addHiddenProp(target, propertyName, res);\n}\nfunction autorun(arg1, arg2, arg3) {\n    var name, view, scope;\n    if (typeof arg1 === \"string\") {\n        name = arg1;\n        view = arg2;\n        scope = arg3;\n    } else {\n        name = arg1.name || \"Autorun@\" + getNextId();\n        view = arg1;\n        scope = arg2;\n    }\n    invariant(typeof view === \"function\", getMessage(\"m004\"));\n    invariant(isAction(view) === false, getMessage(\"m005\"));\n    if (scope) view = view.bind(scope);\n    var reaction = new Reaction(name, function () {\n        this.track(reactionRunner);\n    });\n    function reactionRunner() {\n        view(reaction);\n    }\n    reaction.schedule();\n    return reaction.getDisposer();\n}\nexports.autorun = autorun;\nfunction when(arg1, arg2, arg3, arg4) {\n    var name, predicate, effect, scope;\n    if (typeof arg1 === \"string\") {\n        name = arg1;\n        predicate = arg2;\n        effect = arg3;\n        scope = arg4;\n    } else {\n        name = \"When@\" + getNextId();\n        predicate = arg1;\n        effect = arg2;\n        scope = arg3;\n    }\n    var disposer = autorun(name, function (r) {\n        if (predicate.call(scope)) {\n            r.dispose();\n            var prevUntracked = untrackedStart();\n            effect.call(scope);\n            untrackedEnd(prevUntracked);\n        }\n    });\n    return disposer;\n}\nexports.when = when;\nfunction autorunAsync(arg1, arg2, arg3, arg4) {\n    var name, func, delay, scope;\n    if (typeof arg1 === \"string\") {\n        name = arg1;\n        func = arg2;\n        delay = arg3;\n        scope = arg4;\n    } else {\n        name = arg1.name || \"AutorunAsync@\" + getNextId();\n        func = arg1;\n        delay = arg2;\n        scope = arg3;\n    }\n    invariant(isAction(func) === false, getMessage(\"m006\"));\n    if (delay === void 0) delay = 1;\n    if (scope) func = func.bind(scope);\n    var isScheduled = false;\n    var r = new Reaction(name, function () {\n        if (!isScheduled) {\n            isScheduled = true;\n            setTimeout(function () {\n                isScheduled = false;\n                if (!r.isDisposed) r.track(reactionRunner);\n            }, delay);\n        }\n    });\n    function reactionRunner() {\n        func(r);\n    }\n    r.schedule();\n    return r.getDisposer();\n}\nexports.autorunAsync = autorunAsync;\nfunction reaction(expression, effect, arg3) {\n    if (arguments.length > 3) {\n        fail(getMessage(\"m007\"));\n    }\n    if (isModifierDescriptor(expression)) {\n        fail(getMessage(\"m008\"));\n    }\n    var opts;\n    if ((typeof arg3 === \"undefined\" ? \"undefined\" : _typeof(arg3)) === \"object\") {\n        opts = arg3;\n    } else {\n        opts = {};\n    }\n    opts.name = opts.name || expression.name || effect.name || \"Reaction@\" + getNextId();\n    opts.fireImmediately = arg3 === true || opts.fireImmediately === true;\n    opts.delay = opts.delay || 0;\n    opts.compareStructural = opts.compareStructural || opts.struct || false;\n    effect = action(opts.name, opts.context ? effect.bind(opts.context) : effect);\n    if (opts.context) {\n        expression = expression.bind(opts.context);\n    }\n    var firstTime = true;\n    var isScheduled = false;\n    var nextValue;\n    var r = new Reaction(opts.name, function () {\n        if (firstTime || opts.delay < 1) {\n            reactionRunner();\n        } else if (!isScheduled) {\n            isScheduled = true;\n            setTimeout(function () {\n                isScheduled = false;\n                reactionRunner();\n            }, opts.delay);\n        }\n    });\n    function reactionRunner() {\n        if (r.isDisposed) return;\n        var changed = false;\n        r.track(function () {\n            var v = expression(r);\n            changed = valueDidChange(opts.compareStructural, nextValue, v);\n            nextValue = v;\n        });\n        if (firstTime && opts.fireImmediately) effect(nextValue, r);\n        if (!firstTime && changed === true) effect(nextValue, r);\n        if (firstTime) firstTime = false;\n    }\n    r.schedule();\n    return r.getDisposer();\n}\nexports.reaction = reaction;\nfunction createComputedDecorator(compareStructural) {\n    return createClassPropertyDecorator(function (target, name, _, __, originalDescriptor) {\n        invariant(typeof originalDescriptor !== \"undefined\", getMessage(\"m009\"));\n        invariant(typeof originalDescriptor.get === \"function\", getMessage(\"m010\"));\n        var adm = asObservableObject(target, \"\");\n        defineComputedProperty(adm, name, originalDescriptor.get, originalDescriptor.set, compareStructural, false);\n    }, function (name) {\n        var observable = this.$mobx.values[name];\n        if (observable === undefined) return undefined;\n        return observable.get();\n    }, function (name, value) {\n        this.$mobx.values[name].set(value);\n    }, false, false);\n}\nvar computedDecorator = createComputedDecorator(false);\nvar computedStructDecorator = createComputedDecorator(true);\nvar computed = function computed(arg1, arg2, arg3) {\n    if (typeof arg2 === \"string\") {\n        return computedDecorator.apply(null, arguments);\n    }\n    invariant(typeof arg1 === \"function\", getMessage(\"m011\"));\n    invariant(arguments.length < 3, getMessage(\"m012\"));\n    var opts = (typeof arg2 === \"undefined\" ? \"undefined\" : _typeof(arg2)) === \"object\" ? arg2 : {};\n    opts.setter = typeof arg2 === \"function\" ? arg2 : opts.setter;\n    return new ComputedValue(arg1, opts.context, opts.compareStructural || opts.struct || false, opts.name || arg1.name || \"\", opts.setter);\n};\nexports.computed = computed;\ncomputed.struct = computedStructDecorator;\nfunction createTransformer(transformer, onCleanup) {\n    invariant(typeof transformer === \"function\" && transformer.length < 2, \"createTransformer expects a function that accepts one argument\");\n    var objectCache = {};\n    var resetId = globalState.resetId;\n    var Transformer = function (_super) {\n        __extends(Transformer, _super);\n        function Transformer(sourceIdentifier, sourceObject) {\n            var _this = _super.call(this, function () {\n                return transformer(sourceObject);\n            }, undefined, false, \"Transformer-\" + transformer.name + \"-\" + sourceIdentifier, undefined) || this;\n            _this.sourceIdentifier = sourceIdentifier;\n            _this.sourceObject = sourceObject;\n            return _this;\n        }\n        Transformer.prototype.onBecomeUnobserved = function () {\n            var lastValue = this.value;\n            _super.prototype.onBecomeUnobserved.call(this);\n            delete objectCache[this.sourceIdentifier];\n            if (onCleanup) onCleanup(lastValue, this.sourceObject);\n        };\n        return Transformer;\n    }(ComputedValue);\n    return function (object) {\n        if (resetId !== globalState.resetId) {\n            objectCache = {};\n            resetId = globalState.resetId;\n        }\n        var identifier = getMemoizationId(object);\n        var reactiveTransformer = objectCache[identifier];\n        if (reactiveTransformer) return reactiveTransformer.get();\n        reactiveTransformer = objectCache[identifier] = new Transformer(identifier, object);\n        return reactiveTransformer.get();\n    };\n}\nexports.createTransformer = createTransformer;\nfunction getMemoizationId(object) {\n    if (object === null || (typeof object === \"undefined\" ? \"undefined\" : _typeof(object)) !== \"object\") throw new Error(\"[mobx] transform expected some kind of object, got: \" + object);\n    var tid = object.$transformId;\n    if (tid === undefined) {\n        tid = getNextId();\n        addHiddenProp(object, \"$transformId\", tid);\n    }\n    return tid;\n}\nfunction expr(expr, scope) {\n    if (!isComputingDerivation()) console.warn(getMessage(\"m013\"));\n    return computed(expr, { context: scope }).get();\n}\nexports.expr = expr;\nfunction extendObservable(target) {\n    var properties = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        properties[_i - 1] = arguments[_i];\n    }\n    return extendObservableHelper(target, deepEnhancer, properties);\n}\nexports.extendObservable = extendObservable;\nfunction extendShallowObservable(target) {\n    var properties = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        properties[_i - 1] = arguments[_i];\n    }\n    return extendObservableHelper(target, referenceEnhancer, properties);\n}\nexports.extendShallowObservable = extendShallowObservable;\nfunction extendObservableHelper(target, defaultEnhancer, properties) {\n    invariant(arguments.length >= 2, getMessage(\"m014\"));\n    invariant((typeof target === \"undefined\" ? \"undefined\" : _typeof(target)) === \"object\", getMessage(\"m015\"));\n    invariant(!isObservableMap(target), getMessage(\"m016\"));\n    properties.forEach(function (propSet) {\n        invariant((typeof propSet === \"undefined\" ? \"undefined\" : _typeof(propSet)) === \"object\", getMessage(\"m017\"));\n        invariant(!isObservable(propSet), getMessage(\"m018\"));\n    });\n    var adm = asObservableObject(target);\n    var definedProps = {};\n    for (var i = properties.length - 1; i >= 0; i--) {\n        var propSet = properties[i];\n        for (var key in propSet) {\n            if (definedProps[key] !== true && hasOwnProperty(propSet, key)) {\n                definedProps[key] = true;\n                if (target === propSet && !isPropertyConfigurable(target, key)) continue;\n                var descriptor = Object.getOwnPropertyDescriptor(propSet, key);\n                defineObservablePropertyFromDescriptor(adm, key, descriptor, defaultEnhancer);\n            }\n        }\n    }\n    return target;\n}\nfunction getDependencyTree(thing, property) {\n    return nodeToDependencyTree(getAtom(thing, property));\n}\nfunction nodeToDependencyTree(node) {\n    var result = {\n        name: node.name\n    };\n    if (node.observing && node.observing.length > 0) result.dependencies = unique(node.observing).map(nodeToDependencyTree);\n    return result;\n}\nfunction getObserverTree(thing, property) {\n    return nodeToObserverTree(getAtom(thing, property));\n}\nfunction nodeToObserverTree(node) {\n    var result = {\n        name: node.name\n    };\n    if (hasObservers(node)) result.observers = getObservers(node).map(nodeToObserverTree);\n    return result;\n}\nfunction intercept(thing, propOrHandler, handler) {\n    if (typeof handler === \"function\") return interceptProperty(thing, propOrHandler, handler);else return interceptInterceptable(thing, propOrHandler);\n}\nexports.intercept = intercept;\nfunction interceptInterceptable(thing, handler) {\n    return getAdministration(thing).intercept(handler);\n}\nfunction interceptProperty(thing, property, handler) {\n    return getAdministration(thing, property).intercept(handler);\n}\nfunction isComputed(value, property) {\n    if (value === null || value === undefined) return false;\n    if (property !== undefined) {\n        if (isObservableObject(value) === false) return false;\n        var atom = getAtom(value, property);\n        return isComputedValue(atom);\n    }\n    return isComputedValue(value);\n}\nexports.isComputed = isComputed;\nfunction isObservable(value, property) {\n    if (value === null || value === undefined) return false;\n    if (property !== undefined) {\n        if (isObservableArray(value) || isObservableMap(value)) throw new Error(getMessage(\"m019\"));else if (isObservableObject(value)) {\n            var o = value.$mobx;\n            return o.values && !!o.values[property];\n        }\n        return false;\n    }\n    return isObservableObject(value) || !!value.$mobx || isAtom(value) || isReaction(value) || isComputedValue(value);\n}\nexports.isObservable = isObservable;\nvar deepDecorator = createDecoratorForEnhancer(deepEnhancer);\nvar shallowDecorator = createDecoratorForEnhancer(shallowEnhancer);\nvar refDecorator = createDecoratorForEnhancer(referenceEnhancer);\nvar deepStructDecorator = createDecoratorForEnhancer(deepStructEnhancer);\nvar refStructDecorator = createDecoratorForEnhancer(refStructEnhancer);\nfunction createObservable(v) {\n    if (v === void 0) {\n        v = undefined;\n    }\n    if (typeof arguments[1] === \"string\") return deepDecorator.apply(null, arguments);\n    invariant(arguments.length <= 1,=\"\" getmessage(\"m021\"));=\"\" invariant(!ismodifierdescriptor(v),=\"\" getmessage(\"m020\"));=\"\" if=\"\" (isobservable(v))=\"\" return=\"\" v;=\"\" var=\"\" res=\"deepEnhancer(v,\" undefined,=\"\" undefined);=\"\" (res=\"\" !=\"=\" v)=\"\" res;=\"\" observable.box(v);=\"\" }=\"\" iobservablefactories=\"function\" ()=\"\" {=\"\" function=\"\" iobservablefactories()=\"\" {}=\"\" iobservablefactories.prototype.box=\"function\" (value,=\"\" name)=\"\" (arguments.length=\"\"> 2) incorrectlyUsedAsDecorator(\"box\");\n        return new ObservableValue(value, deepEnhancer, name);\n    };\n    IObservableFactories.prototype.shallowBox = function (value, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"shallowBox\");\n        return new ObservableValue(value, referenceEnhancer, name);\n    };\n    IObservableFactories.prototype.array = function (initialValues, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"array\");\n        return new ObservableArray(initialValues, deepEnhancer, name);\n    };\n    IObservableFactories.prototype.shallowArray = function (initialValues, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"shallowArray\");\n        return new ObservableArray(initialValues, referenceEnhancer, name);\n    };\n    IObservableFactories.prototype.map = function (initialValues, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"map\");\n        return new ObservableMap(initialValues, deepEnhancer, name);\n    };\n    IObservableFactories.prototype.shallowMap = function (initialValues, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"shallowMap\");\n        return new ObservableMap(initialValues, referenceEnhancer, name);\n    };\n    IObservableFactories.prototype.object = function (props, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"object\");\n        var res = {};\n        asObservableObject(res, name);\n        extendObservable(res, props);\n        return res;\n    };\n    IObservableFactories.prototype.shallowObject = function (props, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"shallowObject\");\n        var res = {};\n        asObservableObject(res, name);\n        extendShallowObservable(res, props);\n        return res;\n    };\n    IObservableFactories.prototype.ref = function () {\n        if (arguments.length < 2) {\n            return createModifierDescriptor(referenceEnhancer, arguments[0]);\n        } else {\n            return refDecorator.apply(null, arguments);\n        }\n    };\n    IObservableFactories.prototype.shallow = function () {\n        if (arguments.length < 2) {\n            return createModifierDescriptor(shallowEnhancer, arguments[0]);\n        } else {\n            return shallowDecorator.apply(null, arguments);\n        }\n    };\n    IObservableFactories.prototype.deep = function () {\n        if (arguments.length < 2) {\n            return createModifierDescriptor(deepEnhancer, arguments[0]);\n        } else {\n            return deepDecorator.apply(null, arguments);\n        }\n    };\n    IObservableFactories.prototype.struct = function () {\n        if (arguments.length < 2) {\n            return createModifierDescriptor(deepStructEnhancer, arguments[0]);\n        } else {\n            return deepStructDecorator.apply(null, arguments);\n        }\n    };\n    return IObservableFactories;\n}();\nexports.IObservableFactories = IObservableFactories;\nvar observable = createObservable;\nexports.observable = observable;\nObject.keys(IObservableFactories.prototype).forEach(function (key) {\n    return observable[key] = IObservableFactories.prototype[key];\n});\nobservable.deep.struct = observable.struct;\nobservable.ref.struct = function () {\n    if (arguments.length < 2) {\n        return createModifierDescriptor(refStructEnhancer, arguments[0]);\n    } else {\n        return refStructDecorator.apply(null, arguments);\n    }\n};\nfunction incorrectlyUsedAsDecorator(methodName) {\n    fail(\"Expected one or two arguments to observable.\" + methodName + \". Did you accidentally try to use observable.\" + methodName + \" as decorator?\");\n}\nfunction createDecoratorForEnhancer(enhancer) {\n    invariant(!!enhancer, \":(\");\n    return createClassPropertyDecorator(function (target, name, baseValue, _, baseDescriptor) {\n        assertPropertyConfigurable(target, name);\n        invariant(!baseDescriptor || !baseDescriptor.get, getMessage(\"m022\"));\n        var adm = asObservableObject(target, undefined);\n        defineObservableProperty(adm, name, baseValue, enhancer);\n    }, function (name) {\n        var observable = this.$mobx.values[name];\n        if (observable === undefined) return undefined;\n        return observable.get();\n    }, function (name, value) {\n        setPropertyValue(this, name, value);\n    }, true, false);\n}\nfunction observe(thing, propOrCb, cbOrFire, fireImmediately) {\n    if (typeof cbOrFire === \"function\") return observeObservableProperty(thing, propOrCb, cbOrFire, fireImmediately);else return observeObservable(thing, propOrCb, cbOrFire);\n}\nexports.observe = observe;\nfunction observeObservable(thing, listener, fireImmediately) {\n    return getAdministration(thing).observe(listener, fireImmediately);\n}\nfunction observeObservableProperty(thing, property, listener, fireImmediately) {\n    return getAdministration(thing, property).observe(listener, fireImmediately);\n}\nfunction toJS(source, detectCycles, __alreadySeen) {\n    if (detectCycles === void 0) {\n        detectCycles = true;\n    }\n    if (__alreadySeen === void 0) {\n        __alreadySeen = [];\n    }\n    function cache(value) {\n        if (detectCycles) __alreadySeen.push([source, value]);\n        return value;\n    }\n    if (isObservable(source)) {\n        if (detectCycles && __alreadySeen === null) __alreadySeen = [];\n        if (detectCycles && source !== null && (typeof source === \"undefined\" ? \"undefined\" : _typeof(source)) === \"object\") {\n            for (var i = 0, l = __alreadySeen.length; i < l; i++) {\n                if (__alreadySeen[i][0] === source) return __alreadySeen[i][1];\n            }\n        }\n        if (isObservableArray(source)) {\n            var res = cache([]);\n            var toAdd = source.map(function (value) {\n                return toJS(value, detectCycles, __alreadySeen);\n            });\n            res.length = toAdd.length;\n            for (var i = 0, l = toAdd.length; i < l; i++) {\n                res[i] = toAdd[i];\n            }return res;\n        }\n        if (isObservableObject(source)) {\n            var res = cache({});\n            for (var key in source) {\n                res[key] = toJS(source[key], detectCycles, __alreadySeen);\n            }return res;\n        }\n        if (isObservableMap(source)) {\n            var res_1 = cache({});\n            source.forEach(function (value, key) {\n                return res_1[key] = toJS(value, detectCycles, __alreadySeen);\n            });\n            return res_1;\n        }\n        if (isObservableValue(source)) return toJS(source.get(), detectCycles, __alreadySeen);\n    }\n    return source;\n}\nexports.toJS = toJS;\nfunction transaction(action, thisArg) {\n    if (thisArg === void 0) {\n        thisArg = undefined;\n    }\n    deprecated(getMessage(\"m023\"));\n    return runInTransaction.apply(undefined, arguments);\n}\nexports.transaction = transaction;\nfunction runInTransaction(action, thisArg) {\n    if (thisArg === void 0) {\n        thisArg = undefined;\n    }\n    return executeAction(\"\", action);\n}\nfunction log(msg) {\n    console.log(msg);\n    return msg;\n}\nfunction whyRun(thing, prop) {\n    switch (arguments.length) {\n        case 0:\n            thing = globalState.trackingDerivation;\n            if (!thing) return log(getMessage(\"m024\"));\n            break;\n        case 2:\n            thing = getAtom(thing, prop);\n            break;\n    }\n    thing = getAtom(thing);\n    if (isComputedValue(thing)) return log(thing.whyRun());else if (isReaction(thing)) return log(thing.whyRun());\n    return fail(getMessage(\"m025\"));\n}\nexports.whyRun = whyRun;\nfunction createAction(actionName, fn) {\n    invariant(typeof fn === \"function\", getMessage(\"m026\"));\n    invariant(typeof actionName === \"string\" && actionName.length > 0, \"actions should have valid names, got: '\" + actionName + \"'\");\n    var res = function res() {\n        return executeAction(actionName, fn, this, arguments);\n    };\n    res.originalFn = fn;\n    res.isMobxAction = true;\n    return res;\n}\nfunction executeAction(actionName, fn, scope, args) {\n    var runInfo = startAction(actionName, fn, scope, args);\n    try {\n        return fn.apply(scope, args);\n    } finally {\n        endAction(runInfo);\n    }\n}\nfunction startAction(actionName, fn, scope, args) {\n    var notifySpy = isSpyEnabled() && !!actionName;\n    var startTime = 0;\n    if (notifySpy) {\n        startTime = Date.now();\n        var l = args && args.length || 0;\n        var flattendArgs = new Array(l);\n        if (l > 0) for (var i = 0; i < l; i++) {\n            flattendArgs[i] = args[i];\n        }spyReportStart({\n            type: \"action\",\n            name: actionName,\n            fn: fn,\n            object: scope,\n            arguments: flattendArgs\n        });\n    }\n    var prevDerivation = untrackedStart();\n    startBatch();\n    var prevAllowStateChanges = allowStateChangesStart(true);\n    return {\n        prevDerivation: prevDerivation,\n        prevAllowStateChanges: prevAllowStateChanges,\n        notifySpy: notifySpy,\n        startTime: startTime\n    };\n}\nfunction endAction(runInfo) {\n    allowStateChangesEnd(runInfo.prevAllowStateChanges);\n    endBatch();\n    untrackedEnd(runInfo.prevDerivation);\n    if (runInfo.notifySpy) spyReportEnd({ time: Date.now() - runInfo.startTime });\n}\nfunction useStrict(strict) {\n    invariant(globalState.trackingDerivation === null, getMessage(\"m028\"));\n    globalState.strictMode = strict;\n    globalState.allowStateChanges = !strict;\n}\nexports.useStrict = useStrict;\nfunction isStrictModeEnabled() {\n    return globalState.strictMode;\n}\nexports.isStrictModeEnabled = isStrictModeEnabled;\nfunction allowStateChanges(allowStateChanges, func) {\n    var prev = allowStateChangesStart(allowStateChanges);\n    var res;\n    try {\n        res = func();\n    } finally {\n        allowStateChangesEnd(prev);\n    }\n    return res;\n}\nfunction allowStateChangesStart(allowStateChanges) {\n    var prev = globalState.allowStateChanges;\n    globalState.allowStateChanges = allowStateChanges;\n    return prev;\n}\nfunction allowStateChangesEnd(prev) {\n    globalState.allowStateChanges = prev;\n}\nvar BaseAtom = function () {\n    function BaseAtom(name) {\n        if (name === void 0) {\n            name = \"Atom@\" + getNextId();\n        }\n        this.name = name;\n        this.isPendingUnobservation = true;\n        this.observers = [];\n        this.observersIndexes = {};\n        this.diffValue = 0;\n        this.lastAccessedBy = 0;\n        this.lowestObserverState = IDerivationState.NOT_TRACKING;\n    }\n    BaseAtom.prototype.onBecomeUnobserved = function () {};\n    BaseAtom.prototype.reportObserved = function () {\n        reportObserved(this);\n    };\n    BaseAtom.prototype.reportChanged = function () {\n        startBatch();\n        propagateChanged(this);\n        endBatch();\n    };\n    BaseAtom.prototype.toString = function () {\n        return this.name;\n    };\n    return BaseAtom;\n}();\nexports.BaseAtom = BaseAtom;\nvar Atom = function (_super) {\n    __extends(Atom, _super);\n    function Atom(name, onBecomeObservedHandler, onBecomeUnobservedHandler) {\n        if (name === void 0) {\n            name = \"Atom@\" + getNextId();\n        }\n        if (onBecomeObservedHandler === void 0) {\n            onBecomeObservedHandler = noop;\n        }\n        if (onBecomeUnobservedHandler === void 0) {\n            onBecomeUnobservedHandler = noop;\n        }\n        var _this = _super.call(this, name) || this;\n        _this.name = name;\n        _this.onBecomeObservedHandler = onBecomeObservedHandler;\n        _this.onBecomeUnobservedHandler = onBecomeUnobservedHandler;\n        _this.isPendingUnobservation = false;\n        _this.isBeingTracked = false;\n        return _this;\n    }\n    Atom.prototype.reportObserved = function () {\n        startBatch();\n        _super.prototype.reportObserved.call(this);\n        if (!this.isBeingTracked) {\n            this.isBeingTracked = true;\n            this.onBecomeObservedHandler();\n        }\n        endBatch();\n        return !!globalState.trackingDerivation;\n    };\n    Atom.prototype.onBecomeUnobserved = function () {\n        this.isBeingTracked = false;\n        this.onBecomeUnobservedHandler();\n    };\n    return Atom;\n}(BaseAtom);\nexports.Atom = Atom;\nvar isAtom = createInstanceofPredicate(\"Atom\", BaseAtom);\nvar ComputedValue = function () {\n    function ComputedValue(derivation, scope, compareStructural, name, setter) {\n        this.derivation = derivation;\n        this.scope = scope;\n        this.compareStructural = compareStructural;\n        this.dependenciesState = IDerivationState.NOT_TRACKING;\n        this.observing = [];\n        this.newObserving = null;\n        this.isPendingUnobservation = false;\n        this.observers = [];\n        this.observersIndexes = {};\n        this.diffValue = 0;\n        this.runId = 0;\n        this.lastAccessedBy = 0;\n        this.lowestObserverState = IDerivationState.UP_TO_DATE;\n        this.unboundDepsCount = 0;\n        this.__mapid = \"#\" + getNextId();\n        this.value = undefined;\n        this.isComputing = false;\n        this.isRunningSetter = false;\n        this.name = name || \"ComputedValue@\" + getNextId();\n        if (setter) this.setter = createAction(name + \"-setter\", setter);\n    }\n    ComputedValue.prototype.onBecomeStale = function () {\n        propagateMaybeChanged(this);\n    };\n    ComputedValue.prototype.onBecomeUnobserved = function () {\n        invariant(this.dependenciesState !== IDerivationState.NOT_TRACKING, getMessage(\"m029\"));\n        clearObserving(this);\n        this.value = undefined;\n    };\n    ComputedValue.prototype.get = function () {\n        invariant(!this.isComputing, \"Cycle detected in computation \" + this.name, this.derivation);\n        if (globalState.inBatch === 0) {\n            startBatch();\n            if (shouldCompute(this)) this.value = this.computeValue(false);\n            endBatch();\n        } else {\n            reportObserved(this);\n            if (shouldCompute(this)) if (this.trackAndCompute()) propagateChangeConfirmed(this);\n        }\n        var result = this.value;\n        if (isCaughtException(result)) throw result.cause;\n        return result;\n    };\n    ComputedValue.prototype.peek = function () {\n        var res = this.computeValue(false);\n        if (isCaughtException(res)) throw res.cause;\n        return res;\n    };\n    ComputedValue.prototype.set = function (value) {\n        if (this.setter) {\n            invariant(!this.isRunningSetter, \"The setter of computed value '\" + this.name + \"' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?\");\n            this.isRunningSetter = true;\n            try {\n                this.setter.call(this.scope, value);\n            } finally {\n                this.isRunningSetter = false;\n            }\n        } else invariant(false, \"[ComputedValue '\" + this.name + \"'] It is not possible to assign a new value to a computed value.\");\n    };\n    ComputedValue.prototype.trackAndCompute = function () {\n        if (isSpyEnabled()) {\n            spyReport({\n                object: this.scope,\n                type: \"compute\",\n                fn: this.derivation\n            });\n        }\n        var oldValue = this.value;\n        var newValue = this.value = this.computeValue(true);\n        return isCaughtException(newValue) || valueDidChange(this.compareStructural, newValue, oldValue);\n    };\n    ComputedValue.prototype.computeValue = function (track) {\n        this.isComputing = true;\n        globalState.computationDepth++;\n        var res;\n        if (track) {\n            res = trackDerivedFunction(this, this.derivation, this.scope);\n        } else {\n            try {\n                res = this.derivation.call(this.scope);\n            } catch (e) {\n                res = new CaughtException(e);\n            }\n        }\n        globalState.computationDepth--;\n        this.isComputing = false;\n        return res;\n    };\n    ;\n    ComputedValue.prototype.observe = function (listener, fireImmediately) {\n        var _this = this;\n        var firstTime = true;\n        var prevValue = undefined;\n        return autorun(function () {\n            var newValue = _this.get();\n            if (!firstTime || fireImmediately) {\n                var prevU = untrackedStart();\n                listener({\n                    type: \"update\",\n                    object: _this,\n                    newValue: newValue,\n                    oldValue: prevValue\n                });\n                untrackedEnd(prevU);\n            }\n            firstTime = false;\n            prevValue = newValue;\n        });\n    };\n    ComputedValue.prototype.toJSON = function () {\n        return this.get();\n    };\n    ComputedValue.prototype.toString = function () {\n        return this.name + \"[\" + this.derivation.toString() + \"]\";\n    };\n    ComputedValue.prototype.valueOf = function () {\n        return toPrimitive(this.get());\n    };\n    ;\n    ComputedValue.prototype.whyRun = function () {\n        var isTracking = Boolean(globalState.trackingDerivation);\n        var observing = unique(this.isComputing ? this.newObserving : this.observing).map(function (dep) {\n            return dep.name;\n        });\n        var observers = unique(getObservers(this).map(function (dep) {\n            return dep.name;\n        }));\n        return \"\\nWhyRun? computation '\" + this.name + \"':\\n * Running because: \" + (isTracking ? \"[active] the value of this computation is needed by a reaction\" : this.isComputing ? \"[get] The value of this computed was requested outside a reaction\" : \"[idle] not running at the moment\") + \"\\n\" + (this.dependenciesState === IDerivationState.NOT_TRACKING ? getMessage(\"m032\") : \" * This computation will re-run if any of the following observables changes:\\n    \" + joinStrings(observing) + \"\\n    \" + (this.isComputing && isTracking ? \" (... or any observable accessed during the remainder of the current run)\" : \"\") + \"\\n\\t\" + getMessage(\"m038\") + \"\\n\\n  * If the outcome of this computation changes, the following observers will be re-run:\\n    \" + joinStrings(observers) + \"\\n\");\n    };\n    return ComputedValue;\n}();\nComputedValue.prototype[primitiveSymbol()] = ComputedValue.prototype.valueOf;\nvar isComputedValue = createInstanceofPredicate(\"ComputedValue\", ComputedValue);\nvar IDerivationState;\n(function (IDerivationState) {\n    IDerivationState[IDerivationState[\"NOT_TRACKING\"] = -1] = \"NOT_TRACKING\";\n    IDerivationState[IDerivationState[\"UP_TO_DATE\"] = 0] = \"UP_TO_DATE\";\n    IDerivationState[IDerivationState[\"POSSIBLY_STALE\"] = 1] = \"POSSIBLY_STALE\";\n    IDerivationState[IDerivationState[\"STALE\"] = 2] = \"STALE\";\n})(IDerivationState || (IDerivationState = {}));\nexports.IDerivationState = IDerivationState;\nvar CaughtException = function () {\n    function CaughtException(cause) {\n        this.cause = cause;\n    }\n    return CaughtException;\n}();\nfunction isCaughtException(e) {\n    return e instanceof CaughtException;\n}\nfunction shouldCompute(derivation) {\n    switch (derivation.dependenciesState) {\n        case IDerivationState.UP_TO_DATE:\n            return false;\n        case IDerivationState.NOT_TRACKING:\n        case IDerivationState.STALE:\n            return true;\n        case IDerivationState.POSSIBLY_STALE:\n            {\n                var prevUntracked = untrackedStart();\n                var obs = derivation.observing,\n                    l = obs.length;\n                for (var i = 0; i < l; i++) {\n                    var obj = obs[i];\n                    if (isComputedValue(obj)) {\n                        try {\n                            obj.get();\n                        } catch (e) {\n                            untrackedEnd(prevUntracked);\n                            return true;\n                        }\n                        if (derivation.dependenciesState === IDerivationState.STALE) {\n                            untrackedEnd(prevUntracked);\n                            return true;\n                        }\n                    }\n                }\n                changeDependenciesStateTo0(derivation);\n                untrackedEnd(prevUntracked);\n                return false;\n            }\n    }\n}\nfunction isComputingDerivation() {\n    return globalState.trackingDerivation !== null;\n}\nfunction checkIfStateModificationsAreAllowed(atom) {\n    var hasObservers = atom.observers.length > 0;\n    if (globalState.computationDepth > 0 && hasObservers) fail(getMessage(\"m031\") + atom.name);\n    if (!globalState.allowStateChanges && hasObservers) fail(getMessage(globalState.strictMode ? \"m030a\" : \"m030b\") + atom.name);\n}\nfunction trackDerivedFunction(derivation, f, context) {\n    changeDependenciesStateTo0(derivation);\n    derivation.newObserving = new Array(derivation.observing.length + 100);\n    derivation.unboundDepsCount = 0;\n    derivation.runId = ++globalState.runId;\n    var prevTracking = globalState.trackingDerivation;\n    globalState.trackingDerivation = derivation;\n    var result;\n    try {\n        result = f.call(context);\n    } catch (e) {\n        result = new CaughtException(e);\n    }\n    globalState.trackingDerivation = prevTracking;\n    bindDependencies(derivation);\n    return result;\n}\nfunction bindDependencies(derivation) {\n    var prevObserving = derivation.observing;\n    var observing = derivation.observing = derivation.newObserving;\n    derivation.newObserving = null;\n    var i0 = 0,\n        l = derivation.unboundDepsCount;\n    for (var i = 0; i < l; i++) {\n        var dep = observing[i];\n        if (dep.diffValue === 0) {\n            dep.diffValue = 1;\n            if (i0 !== i) observing[i0] = dep;\n            i0++;\n        }\n    }\n    observing.length = i0;\n    l = prevObserving.length;\n    while (l--) {\n        var dep = prevObserving[l];\n        if (dep.diffValue === 0) {\n            removeObserver(dep, derivation);\n        }\n        dep.diffValue = 0;\n    }\n    while (i0--) {\n        var dep = observing[i0];\n        if (dep.diffValue === 1) {\n            dep.diffValue = 0;\n            addObserver(dep, derivation);\n        }\n    }\n}\nfunction clearObserving(derivation) {\n    var obs = derivation.observing;\n    var i = obs.length;\n    while (i--) {\n        removeObserver(obs[i], derivation);\n    }derivation.dependenciesState = IDerivationState.NOT_TRACKING;\n    obs.length = 0;\n}\nfunction untracked(action) {\n    var prev = untrackedStart();\n    var res = action();\n    untrackedEnd(prev);\n    return res;\n}\nexports.untracked = untracked;\nfunction untrackedStart() {\n    var prev = globalState.trackingDerivation;\n    globalState.trackingDerivation = null;\n    return prev;\n}\nfunction untrackedEnd(prev) {\n    globalState.trackingDerivation = prev;\n}\nfunction changeDependenciesStateTo0(derivation) {\n    if (derivation.dependenciesState === IDerivationState.UP_TO_DATE) return;\n    derivation.dependenciesState = IDerivationState.UP_TO_DATE;\n    var obs = derivation.observing;\n    var i = obs.length;\n    while (i--) {\n        obs[i].lowestObserverState = IDerivationState.UP_TO_DATE;\n    }\n}\nvar persistentKeys = [\"mobxGuid\", \"resetId\", \"spyListeners\", \"strictMode\", \"runId\"];\nvar MobXGlobals = function () {\n    function MobXGlobals() {\n        this.version = 5;\n        this.trackingDerivation = null;\n        this.computationDepth = 0;\n        this.runId = 0;\n        this.mobxGuid = 0;\n        this.inBatch = 0;\n        this.pendingUnobservations = [];\n        this.pendingReactions = [];\n        this.isRunningReactions = false;\n        this.allowStateChanges = true;\n        this.strictMode = false;\n        this.resetId = 0;\n        this.spyListeners = [];\n        this.globalReactionErrorHandlers = [];\n    }\n    return MobXGlobals;\n}();\nvar globalState = new MobXGlobals();\nfunction shareGlobalState() {\n    var global = getGlobal();\n    var ownState = globalState;\n    if (global.__mobservableTrackingStack || global.__mobservableViewStack) throw new Error(\"[mobx] An incompatible version of mobservable is already loaded.\");\n    if (global.__mobxGlobal && global.__mobxGlobal.version !== ownState.version) throw new Error(\"[mobx] An incompatible version of mobx is already loaded.\");\n    if (global.__mobxGlobal) globalState = global.__mobxGlobal;else global.__mobxGlobal = ownState;\n}\nfunction getGlobalState() {\n    return globalState;\n}\nfunction registerGlobals() {}\nfunction resetGlobalState() {\n    globalState.resetId++;\n    var defaultGlobals = new MobXGlobals();\n    for (var key in defaultGlobals) {\n        if (persistentKeys.indexOf(key) === -1) globalState[key] = defaultGlobals[key];\n    }globalState.allowStateChanges = !globalState.strictMode;\n}\nfunction hasObservers(observable) {\n    return observable.observers && observable.observers.length > 0;\n}\nfunction getObservers(observable) {\n    return observable.observers;\n}\nfunction invariantObservers(observable) {\n    var list = observable.observers;\n    var map = observable.observersIndexes;\n    var l = list.length;\n    for (var i = 0; i < l; i++) {\n        var id = list[i].__mapid;\n        if (i) {\n            invariant(map[id] === i, \"INTERNAL ERROR maps derivation.__mapid to index in list\");\n        } else {\n            invariant(!(id in map), \"INTERNAL ERROR observer on index 0 shouldnt be held in map.\");\n        }\n    }\n    invariant(list.length === 0 || Object.keys(map).length === list.length - 1, \"INTERNAL ERROR there is no junk in map\");\n}\nfunction addObserver(observable, node) {\n    var l = observable.observers.length;\n    if (l) {\n        observable.observersIndexes[node.__mapid] = l;\n    }\n    observable.observers[l] = node;\n    if (observable.lowestObserverState > node.dependenciesState) observable.lowestObserverState = node.dependenciesState;\n}\nfunction removeObserver(observable, node) {\n    if (observable.observers.length === 1) {\n        observable.observers.length = 0;\n        queueForUnobservation(observable);\n    } else {\n        var list = observable.observers;\n        var map_1 = observable.observersIndexes;\n        var filler = list.pop();\n        if (filler !== node) {\n            var index = map_1[node.__mapid] || 0;\n            if (index) {\n                map_1[filler.__mapid] = index;\n            } else {\n                delete map_1[filler.__mapid];\n            }\n            list[index] = filler;\n        }\n        delete map_1[node.__mapid];\n    }\n}\nfunction queueForUnobservation(observable) {\n    if (!observable.isPendingUnobservation) {\n        observable.isPendingUnobservation = true;\n        globalState.pendingUnobservations.push(observable);\n    }\n}\nfunction startBatch() {\n    globalState.inBatch++;\n}\nfunction endBatch() {\n    if (--globalState.inBatch === 0) {\n        runReactions();\n        var list = globalState.pendingUnobservations;\n        for (var i = 0; i < list.length; i++) {\n            var observable_1 = list[i];\n            observable_1.isPendingUnobservation = false;\n            if (observable_1.observers.length === 0) {\n                observable_1.onBecomeUnobserved();\n            }\n        }\n        globalState.pendingUnobservations = [];\n    }\n}\nfunction reportObserved(observable) {\n    var derivation = globalState.trackingDerivation;\n    if (derivation !== null) {\n        if (derivation.runId !== observable.lastAccessedBy) {\n            observable.lastAccessedBy = derivation.runId;\n            derivation.newObserving[derivation.unboundDepsCount++] = observable;\n        }\n    } else if (observable.observers.length === 0) {\n        queueForUnobservation(observable);\n    }\n}\nfunction invariantLOS(observable, msg) {\n    var min = getObservers(observable).reduce(function (a, b) {\n        return Math.min(a, b.dependenciesState);\n    }, 2);\n    if (min >= observable.lowestObserverState) return;\n    throw new Error(\"lowestObserverState is wrong for \" + msg + \" because \" + min + \" < \" + observable.lowestObserverState);\n}\nfunction propagateChanged(observable) {\n    if (observable.lowestObserverState === IDerivationState.STALE) return;\n    observable.lowestObserverState = IDerivationState.STALE;\n    var observers = observable.observers;\n    var i = observers.length;\n    while (i--) {\n        var d = observers[i];\n        if (d.dependenciesState === IDerivationState.UP_TO_DATE) d.onBecomeStale();\n        d.dependenciesState = IDerivationState.STALE;\n    }\n}\nfunction propagateChangeConfirmed(observable) {\n    if (observable.lowestObserverState === IDerivationState.STALE) return;\n    observable.lowestObserverState = IDerivationState.STALE;\n    var observers = observable.observers;\n    var i = observers.length;\n    while (i--) {\n        var d = observers[i];\n        if (d.dependenciesState === IDerivationState.POSSIBLY_STALE) d.dependenciesState = IDerivationState.STALE;else if (d.dependenciesState === IDerivationState.UP_TO_DATE) observable.lowestObserverState = IDerivationState.UP_TO_DATE;\n    }\n}\nfunction propagateMaybeChanged(observable) {\n    if (observable.lowestObserverState !== IDerivationState.UP_TO_DATE) return;\n    observable.lowestObserverState = IDerivationState.POSSIBLY_STALE;\n    var observers = observable.observers;\n    var i = observers.length;\n    while (i--) {\n        var d = observers[i];\n        if (d.dependenciesState === IDerivationState.UP_TO_DATE) {\n            d.dependenciesState = IDerivationState.POSSIBLY_STALE;\n            d.onBecomeStale();\n        }\n    }\n}\nvar Reaction = function () {\n    function Reaction(name, onInvalidate) {\n        if (name === void 0) {\n            name = \"Reaction@\" + getNextId();\n        }\n        this.name = name;\n        this.onInvalidate = onInvalidate;\n        this.observing = [];\n        this.newObserving = [];\n        this.dependenciesState = IDerivationState.NOT_TRACKING;\n        this.diffValue = 0;\n        this.runId = 0;\n        this.unboundDepsCount = 0;\n        this.__mapid = \"#\" + getNextId();\n        this.isDisposed = false;\n        this._isScheduled = false;\n        this._isTrackPending = false;\n        this._isRunning = false;\n    }\n    Reaction.prototype.onBecomeStale = function () {\n        this.schedule();\n    };\n    Reaction.prototype.schedule = function () {\n        if (!this._isScheduled) {\n            this._isScheduled = true;\n            globalState.pendingReactions.push(this);\n            runReactions();\n        }\n    };\n    Reaction.prototype.isScheduled = function () {\n        return this._isScheduled;\n    };\n    Reaction.prototype.runReaction = function () {\n        if (!this.isDisposed) {\n            startBatch();\n            this._isScheduled = false;\n            if (shouldCompute(this)) {\n                this._isTrackPending = true;\n                this.onInvalidate();\n                if (this._isTrackPending && isSpyEnabled()) {\n                    spyReport({\n                        object: this,\n                        type: \"scheduled-reaction\"\n                    });\n                }\n            }\n            endBatch();\n        }\n    };\n    Reaction.prototype.track = function (fn) {\n        startBatch();\n        var notify = isSpyEnabled();\n        var startTime;\n        if (notify) {\n            startTime = Date.now();\n            spyReportStart({\n                object: this,\n                type: \"reaction\",\n                fn: fn\n            });\n        }\n        this._isRunning = true;\n        var result = trackDerivedFunction(this, fn, undefined);\n        this._isRunning = false;\n        this._isTrackPending = false;\n        if (this.isDisposed) {\n            clearObserving(this);\n        }\n        if (isCaughtException(result)) this.reportExceptionInDerivation(result.cause);\n        if (notify) {\n            spyReportEnd({\n                time: Date.now() - startTime\n            });\n        }\n        endBatch();\n    };\n    Reaction.prototype.reportExceptionInDerivation = function (error) {\n        var _this = this;\n        if (this.errorHandler) {\n            this.errorHandler(error, this);\n            return;\n        }\n        var message = \"[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '\" + this;\n        var messageToUser = getMessage(\"m037\");\n        console.error(message || messageToUser, error);\n        if (isSpyEnabled()) {\n            spyReport({\n                type: \"error\",\n                message: message,\n                error: error,\n                object: this\n            });\n        }\n        globalState.globalReactionErrorHandlers.forEach(function (f) {\n            return f(error, _this);\n        });\n    };\n    Reaction.prototype.dispose = function () {\n        if (!this.isDisposed) {\n            this.isDisposed = true;\n            if (!this._isRunning) {\n                startBatch();\n                clearObserving(this);\n                endBatch();\n            }\n        }\n    };\n    Reaction.prototype.getDisposer = function () {\n        var r = this.dispose.bind(this);\n        r.$mobx = this;\n        r.onError = registerErrorHandler;\n        return r;\n    };\n    Reaction.prototype.toString = function () {\n        return \"Reaction[\" + this.name + \"]\";\n    };\n    Reaction.prototype.whyRun = function () {\n        var observing = unique(this._isRunning ? this.newObserving : this.observing).map(function (dep) {\n            return dep.name;\n        });\n        return \"\\nWhyRun? reaction '\" + this.name + \"':\\n * Status: [\" + (this.isDisposed ? \"stopped\" : this._isRunning ? \"running\" : this.isScheduled() ? \"scheduled\" : \"idle\") + \"]\\n * This reaction will re-run if any of the following observables changes:\\n    \" + joinStrings(observing) + \"\\n    \" + (this._isRunning ? \" (... or any observable accessed during the remainder of the current run)\" : \"\") + \"\\n\\t\" + getMessage(\"m038\") + \"\\n\";\n    };\n    return Reaction;\n}();\nexports.Reaction = Reaction;\nfunction registerErrorHandler(handler) {\n    invariant(this && this.$mobx && isReaction(this.$mobx), \"Invalid `this`\");\n    invariant(!this.$mobx.errorHandler, \"Only one onErrorHandler can be registered\");\n    this.$mobx.errorHandler = handler;\n}\nfunction onReactionError(handler) {\n    globalState.globalReactionErrorHandlers.push(handler);\n    return function () {\n        var idx = globalState.globalReactionErrorHandlers.indexOf(handler);\n        if (idx >= 0) globalState.globalReactionErrorHandlers.splice(idx, 1);\n    };\n}\nvar MAX_REACTION_ITERATIONS = 100;\nvar reactionScheduler = function reactionScheduler(f) {\n    return f();\n};\nfunction runReactions() {\n    if (globalState.inBatch > 0 || globalState.isRunningReactions) return;\n    reactionScheduler(runReactionsHelper);\n}\nfunction runReactionsHelper() {\n    globalState.isRunningReactions = true;\n    var allReactions = globalState.pendingReactions;\n    var iterations = 0;\n    while (allReactions.length > 0) {\n        if (++iterations === MAX_REACTION_ITERATIONS) {\n            console.error(\"Reaction doesn't converge to a stable state after \" + MAX_REACTION_ITERATIONS + \" iterations.\" + (\" Probably there is a cycle in the reactive function: \" + allReactions[0]));\n            allReactions.splice(0);\n        }\n        var remainingReactions = allReactions.splice(0);\n        for (var i = 0, l = remainingReactions.length; i < l; i++) {\n            remainingReactions[i].runReaction();\n        }\n    }\n    globalState.isRunningReactions = false;\n}\nvar isReaction = createInstanceofPredicate(\"Reaction\", Reaction);\nfunction setReactionScheduler(fn) {\n    var baseScheduler = reactionScheduler;\n    reactionScheduler = function reactionScheduler(f) {\n        return fn(function () {\n            return baseScheduler(f);\n        });\n    };\n}\nfunction isSpyEnabled() {\n    return !!globalState.spyListeners.length;\n}\nfunction spyReport(event) {\n    if (!globalState.spyListeners.length) return;\n    var listeners = globalState.spyListeners;\n    for (var i = 0, l = listeners.length; i < l; i++) {\n        listeners[i](event);\n    }\n}\nfunction spyReportStart(event) {\n    var change = objectAssign({}, event, { spyReportStart: true });\n    spyReport(change);\n}\nvar END_EVENT = { spyReportEnd: true };\nfunction spyReportEnd(change) {\n    if (change) spyReport(objectAssign({}, change, END_EVENT));else spyReport(END_EVENT);\n}\nfunction spy(listener) {\n    globalState.spyListeners.push(listener);\n    return once(function () {\n        var idx = globalState.spyListeners.indexOf(listener);\n        if (idx !== -1) globalState.spyListeners.splice(idx, 1);\n    });\n}\nexports.spy = spy;\nfunction hasInterceptors(interceptable) {\n    return interceptable.interceptors && interceptable.interceptors.length > 0;\n}\nfunction registerInterceptor(interceptable, handler) {\n    var interceptors = interceptable.interceptors || (interceptable.interceptors = []);\n    interceptors.push(handler);\n    return once(function () {\n        var idx = interceptors.indexOf(handler);\n        if (idx !== -1) interceptors.splice(idx, 1);\n    });\n}\nfunction interceptChange(interceptable, change) {\n    var prevU = untrackedStart();\n    try {\n        var interceptors = interceptable.interceptors;\n        if (interceptors) for (var i = 0, l = interceptors.length; i < l; i++) {\n            change = interceptors[i](change);\n            invariant(!change || change.type, \"Intercept handlers should return nothing or a change object\");\n            if (!change) break;\n        }\n        return change;\n    } finally {\n        untrackedEnd(prevU);\n    }\n}\nfunction hasListeners(listenable) {\n    return listenable.changeListeners && listenable.changeListeners.length > 0;\n}\nfunction registerListener(listenable, handler) {\n    var listeners = listenable.changeListeners || (listenable.changeListeners = []);\n    listeners.push(handler);\n    return once(function () {\n        var idx = listeners.indexOf(handler);\n        if (idx !== -1) listeners.splice(idx, 1);\n    });\n}\nfunction notifyListeners(listenable, change) {\n    var prevU = untrackedStart();\n    var listeners = listenable.changeListeners;\n    if (!listeners) return;\n    listeners = listeners.slice();\n    for (var i = 0, l = listeners.length; i < l; i++) {\n        listeners[i](change);\n    }\n    untrackedEnd(prevU);\n}\nfunction asReference(value) {\n    deprecated(\"asReference is deprecated, use observable.ref instead\");\n    return observable.ref(value);\n}\nexports.asReference = asReference;\nfunction asStructure(value) {\n    deprecated(\"asStructure is deprecated. Use observable.struct, computed.struct or reaction options instead.\");\n    return observable.struct(value);\n}\nexports.asStructure = asStructure;\nfunction asFlat(value) {\n    deprecated(\"asFlat is deprecated, use observable.shallow instead\");\n    return observable.shallow(value);\n}\nexports.asFlat = asFlat;\nfunction asMap(data) {\n    deprecated(\"asMap is deprecated, use observable.map or observable.shallowMap instead\");\n    return observable.map(data || {});\n}\nexports.asMap = asMap;\nfunction isModifierDescriptor(thing) {\n    return (typeof thing === \"undefined\" ? \"undefined\" : _typeof(thing)) === \"object\" && thing !== null && thing.isMobxModifierDescriptor === true;\n}\nexports.isModifierDescriptor = isModifierDescriptor;\nfunction createModifierDescriptor(enhancer, initialValue) {\n    invariant(!isModifierDescriptor(initialValue), \"Modifiers cannot be nested\");\n    return {\n        isMobxModifierDescriptor: true,\n        initialValue: initialValue,\n        enhancer: enhancer\n    };\n}\nfunction deepEnhancer(v, _, name) {\n    if (isModifierDescriptor(v)) fail(\"You tried to assign a modifier wrapped value to a collection, please define modifiers when creating the collection, not when modifying it\");\n    if (isObservable(v)) return v;\n    if (Array.isArray(v)) return observable.array(v, name);\n    if (isPlainObject(v)) return observable.object(v, name);\n    if (isES6Map(v)) return observable.map(v, name);\n    return v;\n}\nfunction shallowEnhancer(v, _, name) {\n    if (isModifierDescriptor(v)) fail(\"You tried to assign a modifier wrapped value to a collection, please define modifiers when creating the collection, not when modifying it\");\n    if (v === undefined || v === null) return v;\n    if (isObservableObject(v) || isObservableArray(v) || isObservableMap(v)) return v;\n    if (Array.isArray(v)) return observable.shallowArray(v, name);\n    if (isPlainObject(v)) return observable.shallowObject(v, name);\n    if (isES6Map(v)) return observable.shallowMap(v, name);\n    return fail(\"The shallow modifier / decorator can only used in combination with arrays, objects and maps\");\n}\nfunction referenceEnhancer(newValue) {\n    return newValue;\n}\nfunction deepStructEnhancer(v, oldValue, name) {\n    if (deepEqual(v, oldValue)) return oldValue;\n    if (isObservable(v)) return v;\n    if (Array.isArray(v)) return new ObservableArray(v, deepStructEnhancer, name);\n    if (isES6Map(v)) return new ObservableMap(v, deepStructEnhancer, name);\n    if (isPlainObject(v)) {\n        var res = {};\n        asObservableObject(res, name);\n        extendObservableHelper(res, deepStructEnhancer, [v]);\n        return res;\n    }\n    return v;\n}\nfunction refStructEnhancer(v, oldValue, name) {\n    if (deepEqual(v, oldValue)) return oldValue;\n    return v;\n}\nvar MAX_SPLICE_SIZE = 10000;\nvar safariPrototypeSetterInheritanceBug = function () {\n    var v = false;\n    var p = {};\n    Object.defineProperty(p, \"0\", { set: function set() {\n            v = true;\n        } });\n    Object.create(p)[\"0\"] = 1;\n    return v === false;\n}();\nvar OBSERVABLE_ARRAY_BUFFER_SIZE = 0;\nvar StubArray = function () {\n    function StubArray() {}\n    return StubArray;\n}();\nStubArray.prototype = [];\nvar ObservableArrayAdministration = function () {\n    function ObservableArrayAdministration(name, enhancer, array, owned) {\n        this.array = array;\n        this.owned = owned;\n        this.lastKnownLength = 0;\n        this.interceptors = null;\n        this.changeListeners = null;\n        this.atom = new BaseAtom(name || \"ObservableArray@\" + getNextId());\n        this.enhancer = function (newV, oldV) {\n            return enhancer(newV, oldV, name + \"[..]\");\n        };\n    }\n    ObservableArrayAdministration.prototype.intercept = function (handler) {\n        return registerInterceptor(this, handler);\n    };\n    ObservableArrayAdministration.prototype.observe = function (listener, fireImmediately) {\n        if (fireImmediately === void 0) {\n            fireImmediately = false;\n        }\n        if (fireImmediately) {\n            listener({\n                object: this.array,\n                type: \"splice\",\n                index: 0,\n                added: this.values.slice(),\n                addedCount: this.values.length,\n                removed: [],\n                removedCount: 0\n            });\n        }\n        return registerListener(this, listener);\n    };\n    ObservableArrayAdministration.prototype.getArrayLength = function () {\n        this.atom.reportObserved();\n        return this.values.length;\n    };\n    ObservableArrayAdministration.prototype.setArrayLength = function (newLength) {\n        if (typeof newLength !== \"number\" || newLength < 0) throw new Error(\"[mobx.array] Out of range: \" + newLength);\n        var currentLength = this.values.length;\n        if (newLength === currentLength) return;else if (newLength > currentLength) {\n            var newItems = new Array(newLength - currentLength);\n            for (var i = 0; i < newLength - currentLength; i++) {\n                newItems[i] = undefined;\n            }this.spliceWithArray(currentLength, 0, newItems);\n        } else this.spliceWithArray(newLength, currentLength - newLength);\n    };\n    ObservableArrayAdministration.prototype.updateArrayLength = function (oldLength, delta) {\n        if (oldLength !== this.lastKnownLength) throw new Error(\"[mobx] Modification exception: the internal structure of an observable array was changed. Did you use peek() to change it?\");\n        this.lastKnownLength += delta;\n        if (delta > 0 && oldLength + delta + 1 > OBSERVABLE_ARRAY_BUFFER_SIZE) reserveArrayBuffer(oldLength + delta + 1);\n    };\n    ObservableArrayAdministration.prototype.spliceWithArray = function (index, deleteCount, newItems) {\n        var _this = this;\n        checkIfStateModificationsAreAllowed(this.atom);\n        var length = this.values.length;\n        if (index === undefined) index = 0;else if (index > length) index = length;else if (index < 0) index = Math.max(0, length + index);\n        if (arguments.length === 1) deleteCount = length - index;else if (deleteCount === undefined || deleteCount === null) deleteCount = 0;else deleteCount = Math.max(0, Math.min(deleteCount, length - index));\n        if (newItems === undefined) newItems = [];\n        if (hasInterceptors(this)) {\n            var change = interceptChange(this, {\n                object: this.array,\n                type: \"splice\",\n                index: index,\n                removedCount: deleteCount,\n                added: newItems\n            });\n            if (!change) return EMPTY_ARRAY;\n            deleteCount = change.removedCount;\n            newItems = change.added;\n        }\n        newItems = newItems.map(function (v) {\n            return _this.enhancer(v, undefined);\n        });\n        var lengthDelta = newItems.length - deleteCount;\n        this.updateArrayLength(length, lengthDelta);\n        var res = this.spliceItemsIntoValues(index, deleteCount, newItems);\n        if (deleteCount !== 0 || newItems.length !== 0) this.notifyArraySplice(index, newItems, res);\n        return res;\n    };\n    ObservableArrayAdministration.prototype.spliceItemsIntoValues = function (index, deleteCount, newItems) {\n        if (newItems.length < MAX_SPLICE_SIZE) {\n            return (_a = this.values).splice.apply(_a, [index, deleteCount].concat(newItems));\n        } else {\n            var res = this.values.slice(index, index + deleteCount);\n            this.values = this.values.slice(0, index).concat(newItems, this.values.slice(index + deleteCount));\n            return res;\n        }\n        var _a;\n    };\n    ObservableArrayAdministration.prototype.notifyArrayChildUpdate = function (index, newValue, oldValue) {\n        var notifySpy = !this.owned && isSpyEnabled();\n        var notify = hasListeners(this);\n        var change = notify || notifySpy ? {\n            object: this.array,\n            type: \"update\",\n            index: index, newValue: newValue, oldValue: oldValue\n        } : null;\n        if (notifySpy) spyReportStart(change);\n        this.atom.reportChanged();\n        if (notify) notifyListeners(this, change);\n        if (notifySpy) spyReportEnd();\n    };\n    ObservableArrayAdministration.prototype.notifyArraySplice = function (index, added, removed) {\n        var notifySpy = !this.owned && isSpyEnabled();\n        var notify = hasListeners(this);\n        var change = notify || notifySpy ? {\n            object: this.array,\n            type: \"splice\",\n            index: index, removed: removed, added: added,\n            removedCount: removed.length,\n            addedCount: added.length\n        } : null;\n        if (notifySpy) spyReportStart(change);\n        this.atom.reportChanged();\n        if (notify) notifyListeners(this, change);\n        if (notifySpy) spyReportEnd();\n    };\n    return ObservableArrayAdministration;\n}();\nvar ObservableArray = function (_super) {\n    __extends(ObservableArray, _super);\n    function ObservableArray(initialValues, enhancer, name, owned) {\n        if (name === void 0) {\n            name = \"ObservableArray@\" + getNextId();\n        }\n        if (owned === void 0) {\n            owned = false;\n        }\n        var _this = _super.call(this) || this;\n        var adm = new ObservableArrayAdministration(name, enhancer, _this, owned);\n        addHiddenFinalProp(_this, \"$mobx\", adm);\n        if (initialValues && initialValues.length) {\n            adm.updateArrayLength(0, initialValues.length);\n            adm.values = initialValues.map(function (v) {\n                return enhancer(v, undefined, name + \"[..]\");\n            });\n            adm.notifyArraySplice(0, adm.values.slice(), EMPTY_ARRAY);\n        } else {\n            adm.values = [];\n        }\n        if (safariPrototypeSetterInheritanceBug) {\n            Object.defineProperty(adm.array, \"0\", ENTRY_0);\n        }\n        return _this;\n    }\n    ObservableArray.prototype.intercept = function (handler) {\n        return this.$mobx.intercept(handler);\n    };\n    ObservableArray.prototype.observe = function (listener, fireImmediately) {\n        if (fireImmediately === void 0) {\n            fireImmediately = false;\n        }\n        return this.$mobx.observe(listener, fireImmediately);\n    };\n    ObservableArray.prototype.clear = function () {\n        return this.splice(0);\n    };\n    ObservableArray.prototype.concat = function () {\n        var arrays = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            arrays[_i] = arguments[_i];\n        }\n        this.$mobx.atom.reportObserved();\n        return Array.prototype.concat.apply(this.peek(), arrays.map(function (a) {\n            return isObservableArray(a) ? a.peek() : a;\n        }));\n    };\n    ObservableArray.prototype.replace = function (newItems) {\n        return this.$mobx.spliceWithArray(0, this.$mobx.values.length, newItems);\n    };\n    ObservableArray.prototype.toJS = function () {\n        return this.slice();\n    };\n    ObservableArray.prototype.toJSON = function () {\n        return this.toJS();\n    };\n    ObservableArray.prototype.peek = function () {\n        return this.$mobx.values;\n    };\n    ObservableArray.prototype.find = function (predicate, thisArg, fromIndex) {\n        if (fromIndex === void 0) {\n            fromIndex = 0;\n        }\n        this.$mobx.atom.reportObserved();\n        var items = this.$mobx.values,\n            l = items.length;\n        for (var i = fromIndex; i < l; i++) {\n            if (predicate.call(thisArg, items[i], i, this)) return items[i];\n        }return undefined;\n    };\n    ObservableArray.prototype.splice = function (index, deleteCount) {\n        var newItems = [];\n        for (var _i = 2; _i < arguments.length; _i++) {\n            newItems[_i - 2] = arguments[_i];\n        }\n        switch (arguments.length) {\n            case 0:\n                return [];\n            case 1:\n                return this.$mobx.spliceWithArray(index);\n            case 2:\n                return this.$mobx.spliceWithArray(index, deleteCount);\n        }\n        return this.$mobx.spliceWithArray(index, deleteCount, newItems);\n    };\n    ObservableArray.prototype.spliceWithArray = function (index, deleteCount, newItems) {\n        return this.$mobx.spliceWithArray(index, deleteCount, newItems);\n    };\n    ObservableArray.prototype.push = function () {\n        var items = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            items[_i] = arguments[_i];\n        }\n        var adm = this.$mobx;\n        adm.spliceWithArray(adm.values.length, 0, items);\n        return adm.values.length;\n    };\n    ObservableArray.prototype.pop = function () {\n        return this.splice(Math.max(this.$mobx.values.length - 1, 0), 1)[0];\n    };\n    ObservableArray.prototype.shift = function () {\n        return this.splice(0, 1)[0];\n    };\n    ObservableArray.prototype.unshift = function () {\n        var items = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            items[_i] = arguments[_i];\n        }\n        var adm = this.$mobx;\n        adm.spliceWithArray(0, 0, items);\n        return adm.values.length;\n    };\n    ObservableArray.prototype.reverse = function () {\n        this.$mobx.atom.reportObserved();\n        var clone = this.slice();\n        return clone.reverse.apply(clone, arguments);\n    };\n    ObservableArray.prototype.sort = function (compareFn) {\n        this.$mobx.atom.reportObserved();\n        var clone = this.slice();\n        return clone.sort.apply(clone, arguments);\n    };\n    ObservableArray.prototype.remove = function (value) {\n        var idx = this.$mobx.values.indexOf(value);\n        if (idx > -1) {\n            this.splice(idx, 1);\n            return true;\n        }\n        return false;\n    };\n    ObservableArray.prototype.move = function (fromIndex, toIndex) {\n        function checkIndex(index) {\n            if (index < 0) {\n                throw new Error(\"[mobx.array] Index out of bounds: \" + index + \" is negative\");\n            }\n            var length = this.$mobx.values.length;\n            if (index >= length) {\n                throw new Error(\"[mobx.array] Index out of bounds: \" + index + \" is not smaller than \" + length);\n            }\n        }\n        checkIndex.call(this, fromIndex);\n        checkIndex.call(this, toIndex);\n        if (fromIndex === toIndex) {\n            return;\n        }\n        var oldItems = this.$mobx.values;\n        var newItems;\n        if (fromIndex < toIndex) {\n            newItems = oldItems.slice(0, fromIndex).concat(oldItems.slice(fromIndex + 1, toIndex + 1), [oldItems[fromIndex]], oldItems.slice(toIndex + 1));\n        } else {\n            newItems = oldItems.slice(0, toIndex).concat([oldItems[fromIndex]], oldItems.slice(toIndex, fromIndex), oldItems.slice(fromIndex + 1));\n        }\n        this.replace(newItems);\n    };\n    ObservableArray.prototype.toString = function () {\n        this.$mobx.atom.reportObserved();\n        return Array.prototype.toString.apply(this.$mobx.values, arguments);\n    };\n    ObservableArray.prototype.toLocaleString = function () {\n        this.$mobx.atom.reportObserved();\n        return Array.prototype.toLocaleString.apply(this.$mobx.values, arguments);\n    };\n    return ObservableArray;\n}(StubArray);\ndeclareIterator(ObservableArray.prototype, function () {\n    return arrayAsIterator(this.slice());\n});\nmakeNonEnumerable(ObservableArray.prototype, [\"constructor\", \"intercept\", \"observe\", \"clear\", \"concat\", \"replace\", \"toJS\", \"toJSON\", \"peek\", \"find\", \"splice\", \"spliceWithArray\", \"push\", \"pop\", \"shift\", \"unshift\", \"reverse\", \"sort\", \"remove\", \"move\", \"toString\", \"toLocaleString\"]);\nObject.defineProperty(ObservableArray.prototype, \"length\", {\n    enumerable: false,\n    configurable: true,\n    get: function get() {\n        return this.$mobx.getArrayLength();\n    },\n    set: function set(newLength) {\n        this.$mobx.setArrayLength(newLength);\n    }\n});\n[\"every\", \"filter\", \"forEach\", \"indexOf\", \"join\", \"lastIndexOf\", \"map\", \"reduce\", \"reduceRight\", \"slice\", \"some\"].forEach(function (funcName) {\n    var baseFunc = Array.prototype[funcName];\n    invariant(typeof baseFunc === \"function\", \"Base function not defined on Array prototype: '\" + funcName + \"'\");\n    addHiddenProp(ObservableArray.prototype, funcName, function () {\n        this.$mobx.atom.reportObserved();\n        return baseFunc.apply(this.$mobx.values, arguments);\n    });\n});\nvar ENTRY_0 = {\n    configurable: true,\n    enumerable: false,\n    set: createArraySetter(0),\n    get: createArrayGetter(0)\n};\nfunction createArrayBufferItem(index) {\n    var set = createArraySetter(index);\n    var get = createArrayGetter(index);\n    Object.defineProperty(ObservableArray.prototype, \"\" + index, {\n        enumerable: false,\n        configurable: true,\n        set: set, get: get\n    });\n}\nfunction createArraySetter(index) {\n    return function (newValue) {\n        var adm = this.$mobx;\n        var values = adm.values;\n        if (index < values.length) {\n            checkIfStateModificationsAreAllowed(adm.atom);\n            var oldValue = values[index];\n            if (hasInterceptors(adm)) {\n                var change = interceptChange(adm, {\n                    type: \"update\",\n                    object: adm.array,\n                    index: index, newValue: newValue\n                });\n                if (!change) return;\n                newValue = change.newValue;\n            }\n            newValue = adm.enhancer(newValue, oldValue);\n            var changed = newValue !== oldValue;\n            if (changed) {\n                values[index] = newValue;\n                adm.notifyArrayChildUpdate(index, newValue, oldValue);\n            }\n        } else if (index === values.length) {\n            adm.spliceWithArray(index, 0, [newValue]);\n        } else throw new Error(\"[mobx.array] Index out of bounds, \" + index + \" is larger than \" + values.length);\n    };\n}\nfunction createArrayGetter(index) {\n    return function () {\n        var impl = this.$mobx;\n        if (impl) {\n            if (index < impl.values.length) {\n                impl.atom.reportObserved();\n                return impl.values[index];\n            }\n            console.warn(\"[mobx.array] Attempt to read an array index (\" + index + \") that is out of bounds (\" + impl.values.length + \"). Please check length first. Out of bound indices will not be tracked by MobX\");\n        }\n        return undefined;\n    };\n}\nfunction reserveArrayBuffer(max) {\n    for (var index = OBSERVABLE_ARRAY_BUFFER_SIZE; index < max; index++) {\n        createArrayBufferItem(index);\n    }OBSERVABLE_ARRAY_BUFFER_SIZE = max;\n}\nreserveArrayBuffer(1000);\nvar isObservableArrayAdministration = createInstanceofPredicate(\"ObservableArrayAdministration\", ObservableArrayAdministration);\nfunction isObservableArray(thing) {\n    return isObject(thing) && isObservableArrayAdministration(thing.$mobx);\n}\nexports.isObservableArray = isObservableArray;\nvar ObservableMapMarker = {};\nvar ObservableMap = function () {\n    function ObservableMap(initialData, enhancer, name) {\n        if (enhancer === void 0) {\n            enhancer = deepEnhancer;\n        }\n        if (name === void 0) {\n            name = \"ObservableMap@\" + getNextId();\n        }\n        this.enhancer = enhancer;\n        this.name = name;\n        this.$mobx = ObservableMapMarker;\n        this._data = {};\n        this._hasMap = {};\n        this._keys = new ObservableArray(undefined, referenceEnhancer, this.name + \".keys()\", true);\n        this.interceptors = null;\n        this.changeListeners = null;\n        this.merge(initialData);\n    }\n    ObservableMap.prototype._has = function (key) {\n        return typeof this._data[key] !== \"undefined\";\n    };\n    ObservableMap.prototype.has = function (key) {\n        if (!this.isValidKey(key)) return false;\n        key = \"\" + key;\n        if (this._hasMap[key]) return this._hasMap[key].get();\n        return this._updateHasMapEntry(key, false).get();\n    };\n    ObservableMap.prototype.set = function (key, value) {\n        this.assertValidKey(key);\n        key = \"\" + key;\n        var hasKey = this._has(key);\n        if (hasInterceptors(this)) {\n            var change = interceptChange(this, {\n                type: hasKey ? \"update\" : \"add\",\n                object: this,\n                newValue: value,\n                name: key\n            });\n            if (!change) return this;\n            value = change.newValue;\n        }\n        if (hasKey) {\n            this._updateValue(key, value);\n        } else {\n            this._addValue(key, value);\n        }\n        return this;\n    };\n    ObservableMap.prototype.delete = function (key) {\n        var _this = this;\n        this.assertValidKey(key);\n        key = \"\" + key;\n        if (hasInterceptors(this)) {\n            var change = interceptChange(this, {\n                type: \"delete\",\n                object: this,\n                name: key\n            });\n            if (!change) return false;\n        }\n        if (this._has(key)) {\n            var notifySpy = isSpyEnabled();\n            var notify = hasListeners(this);\n            var change = notify || notifySpy ? {\n                type: \"delete\",\n                object: this,\n                oldValue: this._data[key].value,\n                name: key\n            } : null;\n            if (notifySpy) spyReportStart(change);\n            runInTransaction(function () {\n                _this._keys.remove(key);\n                _this._updateHasMapEntry(key, false);\n                var observable = _this._data[key];\n                observable.setNewValue(undefined);\n                _this._data[key] = undefined;\n            });\n            if (notify) notifyListeners(this, change);\n            if (notifySpy) spyReportEnd();\n            return true;\n        }\n        return false;\n    };\n    ObservableMap.prototype._updateHasMapEntry = function (key, value) {\n        var entry = this._hasMap[key];\n        if (entry) {\n            entry.setNewValue(value);\n        } else {\n            entry = this._hasMap[key] = new ObservableValue(value, referenceEnhancer, this.name + \".\" + key + \"?\", false);\n        }\n        return entry;\n    };\n    ObservableMap.prototype._updateValue = function (name, newValue) {\n        var observable = this._data[name];\n        newValue = observable.prepareNewValue(newValue);\n        if (newValue !== UNCHANGED) {\n            var notifySpy = isSpyEnabled();\n            var notify = hasListeners(this);\n            var change = notify || notifySpy ? {\n                type: \"update\",\n                object: this,\n                oldValue: observable.value,\n                name: name, newValue: newValue\n            } : null;\n            if (notifySpy) spyReportStart(change);\n            observable.setNewValue(newValue);\n            if (notify) notifyListeners(this, change);\n            if (notifySpy) spyReportEnd();\n        }\n    };\n    ObservableMap.prototype._addValue = function (name, newValue) {\n        var _this = this;\n        runInTransaction(function () {\n            var observable = _this._data[name] = new ObservableValue(newValue, _this.enhancer, _this.name + \".\" + name, false);\n            newValue = observable.value;\n            _this._updateHasMapEntry(name, true);\n            _this._keys.push(name);\n        });\n        var notifySpy = isSpyEnabled();\n        var notify = hasListeners(this);\n        var change = notify || notifySpy ? {\n            type: \"add\",\n            object: this,\n            name: name, newValue: newValue\n        } : null;\n        if (notifySpy) spyReportStart(change);\n        if (notify) notifyListeners(this, change);\n        if (notifySpy) spyReportEnd();\n    };\n    ObservableMap.prototype.get = function (key) {\n        key = \"\" + key;\n        if (this.has(key)) return this._data[key].get();\n        return undefined;\n    };\n    ObservableMap.prototype.keys = function () {\n        return arrayAsIterator(this._keys.slice());\n    };\n    ObservableMap.prototype.values = function () {\n        return arrayAsIterator(this._keys.map(this.get, this));\n    };\n    ObservableMap.prototype.entries = function () {\n        var _this = this;\n        return arrayAsIterator(this._keys.map(function (key) {\n            return [key, _this.get(key)];\n        }));\n    };\n    ObservableMap.prototype.forEach = function (callback, thisArg) {\n        var _this = this;\n        this.keys().forEach(function (key) {\n            return callback.call(thisArg, _this.get(key), key, _this);\n        });\n    };\n    ObservableMap.prototype.merge = function (other) {\n        var _this = this;\n        if (isObservableMap(other)) {\n            other = other.toJS();\n        }\n        runInTransaction(function () {\n            if (isPlainObject(other)) Object.keys(other).forEach(function (key) {\n                return _this.set(key, other[key]);\n            });else if (Array.isArray(other)) other.forEach(function (_a) {\n                var key = _a[0],\n                    value = _a[1];\n                return _this.set(key, value);\n            });else if (isES6Map(other)) other.forEach(function (value, key) {\n                return _this.set(key, value);\n            });else if (other !== null && other !== undefined) fail(\"Cannot initialize map from \" + other);\n        });\n        return this;\n    };\n    ObservableMap.prototype.clear = function () {\n        var _this = this;\n        runInTransaction(function () {\n            untracked(function () {\n                _this.keys().forEach(_this.delete, _this);\n            });\n        });\n    };\n    ObservableMap.prototype.replace = function (values) {\n        var _this = this;\n        runInTransaction(function () {\n            _this.clear();\n            _this.merge(values);\n        });\n        return this;\n    };\n    Object.defineProperty(ObservableMap.prototype, \"size\", {\n        get: function get() {\n            return this._keys.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ObservableMap.prototype.toJS = function () {\n        var _this = this;\n        var res = {};\n        this.keys().forEach(function (key) {\n            return res[key] = _this.get(key);\n        });\n        return res;\n    };\n    ObservableMap.prototype.toJSON = function () {\n        return this.toJS();\n    };\n    ObservableMap.prototype.isValidKey = function (key) {\n        if (key === null || key === undefined) return false;\n        if (typeof key === \"string\" || typeof key === \"number\" || typeof key === \"boolean\") return true;\n        return false;\n    };\n    ObservableMap.prototype.assertValidKey = function (key) {\n        if (!this.isValidKey(key)) throw new Error(\"[mobx.map] Invalid key: '\" + key + \"', only strings, numbers and booleans are accepted as key in observable maps.\");\n    };\n    ObservableMap.prototype.toString = function () {\n        var _this = this;\n        return this.name + \"[{ \" + this.keys().map(function (key) {\n            return key + \": \" + (\"\" + _this.get(key));\n        }).join(\", \") + \" }]\";\n    };\n    ObservableMap.prototype.observe = function (listener, fireImmediately) {\n        invariant(fireImmediately !== true, getMessage(\"m033\"));\n        return registerListener(this, listener);\n    };\n    ObservableMap.prototype.intercept = function (handler) {\n        return registerInterceptor(this, handler);\n    };\n    return ObservableMap;\n}();\nexports.ObservableMap = ObservableMap;\ndeclareIterator(ObservableMap.prototype, function () {\n    return this.entries();\n});\nfunction map(initialValues) {\n    deprecated(\"`mobx.map` is deprecated, use `new ObservableMap` or `mobx.observable.map` instead\");\n    return observable.map(initialValues);\n}\nexports.map = map;\nvar isObservableMap = createInstanceofPredicate(\"ObservableMap\", ObservableMap);\nexports.isObservableMap = isObservableMap;\nvar ObservableObjectAdministration = function () {\n    function ObservableObjectAdministration(target, name) {\n        this.target = target;\n        this.name = name;\n        this.values = {};\n        this.changeListeners = null;\n        this.interceptors = null;\n    }\n    ObservableObjectAdministration.prototype.observe = function (callback, fireImmediately) {\n        invariant(fireImmediately !== true, \"`observe` doesn't support the fire immediately property for observable objects.\");\n        return registerListener(this, callback);\n    };\n    ObservableObjectAdministration.prototype.intercept = function (handler) {\n        return registerInterceptor(this, handler);\n    };\n    return ObservableObjectAdministration;\n}();\nfunction asObservableObject(target, name) {\n    if (isObservableObject(target)) return target.$mobx;\n    invariant(Object.isExtensible(target), getMessage(\"m035\"));\n    if (!isPlainObject(target)) name = (target.constructor.name || \"ObservableObject\") + \"@\" + getNextId();\n    if (!name) name = \"ObservableObject@\" + getNextId();\n    var adm = new ObservableObjectAdministration(target, name);\n    addHiddenFinalProp(target, \"$mobx\", adm);\n    return adm;\n}\nfunction defineObservablePropertyFromDescriptor(adm, propName, descriptor, defaultEnhancer) {\n    if (adm.values[propName]) {\n        invariant(\"value\" in descriptor, \"The property \" + propName + \" in \" + adm.name + \" is already observable, cannot redefine it as computed property\");\n        adm.target[propName] = descriptor.value;\n        return;\n    }\n    if (\"value\" in descriptor) {\n        if (isModifierDescriptor(descriptor.value)) {\n            var modifierDescriptor = descriptor.value;\n            defineObservableProperty(adm, propName, modifierDescriptor.initialValue, modifierDescriptor.enhancer);\n        } else if (isAction(descriptor.value) && descriptor.value.autoBind === true) {\n            defineBoundAction(adm.target, propName, descriptor.value.originalFn);\n        } else if (isComputedValue(descriptor.value)) {\n            defineComputedPropertyFromComputedValue(adm, propName, descriptor.value);\n        } else {\n            defineObservableProperty(adm, propName, descriptor.value, defaultEnhancer);\n        }\n    } else {\n        defineComputedProperty(adm, propName, descriptor.get, descriptor.set, false, true);\n    }\n}\nfunction defineObservableProperty(adm, propName, newValue, enhancer) {\n    assertPropertyConfigurable(adm.target, propName);\n    if (hasInterceptors(adm)) {\n        var change = interceptChange(adm, {\n            object: adm.target,\n            name: propName,\n            type: \"add\",\n            newValue: newValue\n        });\n        if (!change) return;\n        newValue = change.newValue;\n    }\n    var observable = adm.values[propName] = new ObservableValue(newValue, enhancer, adm.name + \".\" + propName, false);\n    newValue = observable.value;\n    Object.defineProperty(adm.target, propName, generateObservablePropConfig(propName));\n    notifyPropertyAddition(adm, adm.target, propName, newValue);\n}\nfunction defineComputedProperty(adm, propName, getter, setter, compareStructural, asInstanceProperty) {\n    if (asInstanceProperty) assertPropertyConfigurable(adm.target, propName);\n    adm.values[propName] = new ComputedValue(getter, adm.target, compareStructural, adm.name + \".\" + propName, setter);\n    if (asInstanceProperty) {\n        Object.defineProperty(adm.target, propName, generateComputedPropConfig(propName));\n    }\n}\nfunction defineComputedPropertyFromComputedValue(adm, propName, computedValue) {\n    var name = adm.name + \".\" + propName;\n    computedValue.name = name;\n    if (!computedValue.scope) computedValue.scope = adm.target;\n    adm.values[propName] = computedValue;\n    Object.defineProperty(adm.target, propName, generateComputedPropConfig(propName));\n}\nvar observablePropertyConfigs = {};\nvar computedPropertyConfigs = {};\nfunction generateObservablePropConfig(propName) {\n    return observablePropertyConfigs[propName] || (observablePropertyConfigs[propName] = {\n        configurable: true,\n        enumerable: true,\n        get: function get() {\n            return this.$mobx.values[propName].get();\n        },\n        set: function set(v) {\n            setPropertyValue(this, propName, v);\n        }\n    });\n}\nfunction generateComputedPropConfig(propName) {\n    return computedPropertyConfigs[propName] || (computedPropertyConfigs[propName] = {\n        configurable: true,\n        enumerable: false,\n        get: function get() {\n            return this.$mobx.values[propName].get();\n        },\n        set: function set(v) {\n            return this.$mobx.values[propName].set(v);\n        }\n    });\n}\nfunction setPropertyValue(instance, name, newValue) {\n    var adm = instance.$mobx;\n    var observable = adm.values[name];\n    if (hasInterceptors(adm)) {\n        var change = interceptChange(adm, {\n            type: \"update\",\n            object: instance,\n            name: name, newValue: newValue\n        });\n        if (!change) return;\n        newValue = change.newValue;\n    }\n    newValue = observable.prepareNewValue(newValue);\n    if (newValue !== UNCHANGED) {\n        var notify = hasListeners(adm);\n        var notifySpy = isSpyEnabled();\n        var change = notify || notifySpy ? {\n            type: \"update\",\n            object: instance,\n            oldValue: observable.value,\n            name: name, newValue: newValue\n        } : null;\n        if (notifySpy) spyReportStart(change);\n        observable.setNewValue(newValue);\n        if (notify) notifyListeners(adm, change);\n        if (notifySpy) spyReportEnd();\n    }\n}\nfunction notifyPropertyAddition(adm, object, name, newValue) {\n    var notify = hasListeners(adm);\n    var notifySpy = isSpyEnabled();\n    var change = notify || notifySpy ? {\n        type: \"add\",\n        object: object, name: name, newValue: newValue\n    } : null;\n    if (notifySpy) spyReportStart(change);\n    if (notify) notifyListeners(adm, change);\n    if (notifySpy) spyReportEnd();\n}\nvar isObservableObjectAdministration = createInstanceofPredicate(\"ObservableObjectAdministration\", ObservableObjectAdministration);\nfunction isObservableObject(thing) {\n    if (isObject(thing)) {\n        runLazyInitializers(thing);\n        return isObservableObjectAdministration(thing.$mobx);\n    }\n    return false;\n}\nexports.isObservableObject = isObservableObject;\nvar UNCHANGED = {};\nvar ObservableValue = function (_super) {\n    __extends(ObservableValue, _super);\n    function ObservableValue(value, enhancer, name, notifySpy) {\n        if (name === void 0) {\n            name = \"ObservableValue@\" + getNextId();\n        }\n        if (notifySpy === void 0) {\n            notifySpy = true;\n        }\n        var _this = _super.call(this, name) || this;\n        _this.enhancer = enhancer;\n        _this.hasUnreportedChange = false;\n        _this.value = enhancer(value, undefined, name);\n        if (notifySpy && isSpyEnabled()) {\n            spyReport({ type: \"create\", object: _this, newValue: _this.value });\n        }\n        return _this;\n    }\n    ObservableValue.prototype.set = function (newValue) {\n        var oldValue = this.value;\n        newValue = this.prepareNewValue(newValue);\n        if (newValue !== UNCHANGED) {\n            var notifySpy = isSpyEnabled();\n            if (notifySpy) {\n                spyReportStart({\n                    type: \"update\",\n                    object: this,\n                    newValue: newValue, oldValue: oldValue\n                });\n            }\n            this.setNewValue(newValue);\n            if (notifySpy) spyReportEnd();\n        }\n    };\n    ObservableValue.prototype.prepareNewValue = function (newValue) {\n        checkIfStateModificationsAreAllowed(this);\n        if (hasInterceptors(this)) {\n            var change = interceptChange(this, { object: this, type: \"update\", newValue: newValue });\n            if (!change) return UNCHANGED;\n            newValue = change.newValue;\n        }\n        newValue = this.enhancer(newValue, this.value, this.name);\n        return this.value !== newValue ? newValue : UNCHANGED;\n    };\n    ObservableValue.prototype.setNewValue = function (newValue) {\n        var oldValue = this.value;\n        this.value = newValue;\n        this.reportChanged();\n        if (hasListeners(this)) {\n            notifyListeners(this, {\n                type: \"update\",\n                object: this,\n                newValue: newValue,\n                oldValue: oldValue\n            });\n        }\n    };\n    ObservableValue.prototype.get = function () {\n        this.reportObserved();\n        return this.value;\n    };\n    ObservableValue.prototype.intercept = function (handler) {\n        return registerInterceptor(this, handler);\n    };\n    ObservableValue.prototype.observe = function (listener, fireImmediately) {\n        if (fireImmediately) listener({\n            object: this,\n            type: \"update\",\n            newValue: this.value,\n            oldValue: undefined\n        });\n        return registerListener(this, listener);\n    };\n    ObservableValue.prototype.toJSON = function () {\n        return this.get();\n    };\n    ObservableValue.prototype.toString = function () {\n        return this.name + \"[\" + this.value + \"]\";\n    };\n    ObservableValue.prototype.valueOf = function () {\n        return toPrimitive(this.get());\n    };\n    return ObservableValue;\n}(BaseAtom);\nObservableValue.prototype[primitiveSymbol()] = ObservableValue.prototype.valueOf;\nvar isObservableValue = createInstanceofPredicate(\"ObservableValue\", ObservableValue);\nexports.isBoxedObservable = isObservableValue;\nfunction getAtom(thing, property) {\n    if ((typeof thing === \"undefined\" ? \"undefined\" : _typeof(thing)) === \"object\" && thing !== null) {\n        if (isObservableArray(thing)) {\n            invariant(property === undefined, getMessage(\"m036\"));\n            return thing.$mobx.atom;\n        }\n        if (isObservableMap(thing)) {\n            var anyThing = thing;\n            if (property === undefined) return getAtom(anyThing._keys);\n            var observable_2 = anyThing._data[property] || anyThing._hasMap[property];\n            invariant(!!observable_2, \"the entry '\" + property + \"' does not exist in the observable map '\" + getDebugName(thing) + \"'\");\n            return observable_2;\n        }\n        runLazyInitializers(thing);\n        if (isObservableObject(thing)) {\n            if (!property) return fail(\"please specify a property\");\n            var observable_3 = thing.$mobx.values[property];\n            invariant(!!observable_3, \"no observable property '\" + property + \"' found on the observable object '\" + getDebugName(thing) + \"'\");\n            return observable_3;\n        }\n        if (isAtom(thing) || isComputedValue(thing) || isReaction(thing)) {\n            return thing;\n        }\n    } else if (typeof thing === \"function\") {\n        if (isReaction(thing.$mobx)) {\n            return thing.$mobx;\n        }\n    }\n    return fail(\"Cannot obtain atom from \" + thing);\n}\nfunction getAdministration(thing, property) {\n    invariant(thing, \"Expecting some object\");\n    if (property !== undefined) return getAdministration(getAtom(thing, property));\n    if (isAtom(thing) || isComputedValue(thing) || isReaction(thing)) return thing;\n    if (isObservableMap(thing)) return thing;\n    runLazyInitializers(thing);\n    if (thing.$mobx) return thing.$mobx;\n    invariant(false, \"Cannot obtain administration from \" + thing);\n}\nfunction getDebugName(thing, property) {\n    var named;\n    if (property !== undefined) named = getAtom(thing, property);else if (isObservableObject(thing) || isObservableMap(thing)) named = getAdministration(thing);else named = getAtom(thing);\n    return named.name;\n}\nfunction createClassPropertyDecorator(onInitialize, _get, _set, enumerable, allowCustomArguments) {\n    function classPropertyDecorator(target, key, descriptor, customArgs, argLen) {\n        if (argLen === void 0) {\n            argLen = 0;\n        }\n        invariant(allowCustomArguments || quacksLikeADecorator(arguments), \"This function is a decorator, but it wasn't invoked like a decorator\");\n        if (!descriptor) {\n            var newDescriptor = {\n                enumerable: enumerable,\n                configurable: true,\n                get: function get() {\n                    if (!this.__mobxInitializedProps || this.__mobxInitializedProps[key] !== true) typescriptInitializeProperty(this, key, undefined, onInitialize, customArgs, descriptor);\n                    return _get.call(this, key);\n                },\n                set: function set(v) {\n                    if (!this.__mobxInitializedProps || this.__mobxInitializedProps[key] !== true) {\n                        typescriptInitializeProperty(this, key, v, onInitialize, customArgs, descriptor);\n                    } else {\n                        _set.call(this, key, v);\n                    }\n                }\n            };\n            if (arguments.length < 3 || arguments.length === 5 && argLen < 3) {\n                Object.defineProperty(target, key, newDescriptor);\n            }\n            return newDescriptor;\n        } else {\n            if (!hasOwnProperty(target, \"__mobxLazyInitializers\")) {\n                addHiddenProp(target, \"__mobxLazyInitializers\", target.__mobxLazyInitializers && target.__mobxLazyInitializers.slice() || []);\n            }\n            var value_1 = descriptor.value,\n                initializer_1 = descriptor.initializer;\n            target.__mobxLazyInitializers.push(function (instance) {\n                onInitialize(instance, key, initializer_1 ? initializer_1.call(instance) : value_1, customArgs, descriptor);\n            });\n            return {\n                enumerable: enumerable, configurable: true,\n                get: function get() {\n                    if (this.__mobxDidRunLazyInitializers !== true) runLazyInitializers(this);\n                    return _get.call(this, key);\n                },\n                set: function set(v) {\n                    if (this.__mobxDidRunLazyInitializers !== true) runLazyInitializers(this);\n                    _set.call(this, key, v);\n                }\n            };\n        }\n    }\n    if (allowCustomArguments) {\n        return function () {\n            if (quacksLikeADecorator(arguments)) return classPropertyDecorator.apply(null, arguments);\n            var outerArgs = arguments;\n            var argLen = arguments.length;\n            return function (target, key, descriptor) {\n                return classPropertyDecorator(target, key, descriptor, outerArgs, argLen);\n            };\n        };\n    }\n    return classPropertyDecorator;\n}\nfunction typescriptInitializeProperty(instance, key, v, onInitialize, customArgs, baseDescriptor) {\n    if (!hasOwnProperty(instance, \"__mobxInitializedProps\")) addHiddenProp(instance, \"__mobxInitializedProps\", {});\n    instance.__mobxInitializedProps[key] = true;\n    onInitialize(instance, key, v, customArgs, baseDescriptor);\n}\nfunction runLazyInitializers(instance) {\n    if (instance.__mobxDidRunLazyInitializers === true) return;\n    if (instance.__mobxLazyInitializers) {\n        addHiddenProp(instance, \"__mobxDidRunLazyInitializers\", true);\n        instance.__mobxDidRunLazyInitializers && instance.__mobxLazyInitializers.forEach(function (initializer) {\n            return initializer(instance);\n        });\n    }\n}\nfunction quacksLikeADecorator(args) {\n    return (args.length === 2 || args.length === 3) && typeof args[1] === \"string\";\n}\nfunction iteratorSymbol() {\n    return typeof Symbol === \"function\" && Symbol.iterator || \"@@iterator\";\n}\nvar IS_ITERATING_MARKER = \"__$$iterating\";\nfunction arrayAsIterator(array) {\n    invariant(array[IS_ITERATING_MARKER] !== true, \"Illegal state: cannot recycle array as iterator\");\n    addHiddenFinalProp(array, IS_ITERATING_MARKER, true);\n    var idx = -1;\n    addHiddenFinalProp(array, \"next\", function next() {\n        idx++;\n        return {\n            done: idx >= this.length,\n            value: idx < this.length ? this[idx] : undefined\n        };\n    });\n    return array;\n}\nfunction declareIterator(prototType, iteratorFactory) {\n    addHiddenFinalProp(prototType, iteratorSymbol(), iteratorFactory);\n}\nvar messages = {\n    \"m001\": \"It is not allowed to assign new values to @action fields\",\n    \"m002\": \"`runInAction` expects a function\",\n    \"m003\": \"`runInAction` expects a function without arguments\",\n    \"m004\": \"autorun expects a function\",\n    \"m005\": \"Warning: attempted to pass an action to autorun. Actions are untracked and will not trigger on state changes. Use `reaction` or wrap only your state modification code in an action.\",\n    \"m006\": \"Warning: attempted to pass an action to autorunAsync. Actions are untracked and will not trigger on state changes. Use `reaction` or wrap only your state modification code in an action.\",\n    \"m007\": \"reaction only accepts 2 or 3 arguments. If migrating from MobX 2, please provide an options object\",\n    \"m008\": \"wrapping reaction expression in `asReference` is no longer supported, use options object instead\",\n    \"m009\": \"@computed can only be used on getter functions, like: '@computed get myProps() { return ...; }'. It looks like it was used on a property.\",\n    \"m010\": \"@computed can only be used on getter functions, like: '@computed get myProps() { return ...; }'\",\n    \"m011\": \"First argument to `computed` should be an expression. If using computed as decorator, don't pass it arguments\",\n    \"m012\": \"computed takes one or two arguments if used as function\",\n    \"m013\": \"[mobx.expr] 'expr' should only be used inside other reactive functions.\",\n    \"m014\": \"extendObservable expected 2 or more arguments\",\n    \"m015\": \"extendObservable expects an object as first argument\",\n    \"m016\": \"extendObservable should not be used on maps, use map.merge instead\",\n    \"m017\": \"all arguments of extendObservable should be objects\",\n    \"m018\": \"extending an object with another observable (object) is not supported. Please construct an explicit propertymap, using `toJS` if need. See issue #540\",\n    \"m019\": \"[mobx.isObservable] isObservable(object, propertyName) is not supported for arrays and maps. Use map.has or array.length instead.\",\n    \"m020\": \"modifiers can only be used for individual object properties\",\n    \"m021\": \"observable expects zero or one arguments\",\n    \"m022\": \"@observable can not be used on getters, use @computed instead\",\n    \"m023\": \"Using `transaction` is deprecated, use `runInAction` or `(@)action` instead.\",\n    \"m024\": \"whyRun() can only be used if a derivation is active, or by passing an computed value / reaction explicitly. If you invoked whyRun from inside a computation; the computation is currently suspended but re-evaluating because somebody requested its value.\",\n    \"m025\": \"whyRun can only be used on reactions and computed values\",\n    \"m026\": \"`action` can only be invoked on functions\",\n    \"m028\": \"It is not allowed to set `useStrict` when a derivation is running\",\n    \"m029\": \"INTERNAL ERROR only onBecomeUnobserved shouldn't be called twice in a row\",\n    \"m030a\": \"Since strict-mode is enabled, changing observed observable values outside actions is not allowed. Please wrap the code in an `action` if this change is intended. Tried to modify: \",\n    \"m030b\": \"Side effects like changing state are not allowed at this point. Are you trying to modify state from, for example, the render function of a React component? Tried to modify: \",\n    \"m031\": \"Computed values are not allowed to not cause side effects by changing observables that are already being observed. Tried to modify: \",\n    \"m032\": \"* This computation is suspended (not in use by any reaction) and won't run automatically.\\n\tDidn't expect this computation to be suspended at this point?\\n\t  1. Make sure this computation is used by a reaction (reaction, autorun, observer).\\n\t  2. Check whether you are using this computation synchronously (in the same stack as they reaction that needs it).\",\n    \"m033\": \"`observe` doesn't support the fire immediately property for observable maps.\",\n    \"m034\": \"`mobx.map` is deprecated, use `new ObservableMap` or `mobx.observable.map` instead\",\n    \"m035\": \"Cannot make the designated object observable; it is not extensible\",\n    \"m036\": \"It is not possible to get index atoms from arrays\",\n    \"m037\": \"Hi there! I'm sorry you have just run into an exception.\\nIf your debugger ends up here, know that some reaction (like the render() of an observer component, autorun or reaction)\\nthrew an exception and that mobx caught it, to avoid that it brings the rest of your application down.\\nThe original cause of the exception (the code that caused this reaction to run (again)), is still in the stack.\\n\\nHowever, more interesting is the actual stack trace of the error itself.\\nHopefully the error is an instanceof Error, because in that case you can inspect the original stack of the error from where it was thrown.\\nSee `error.stack` property, or press the very subtle \\\"(...)\\\" link you see near the console.error message that probably brought you here.\\nThat stack is more interesting than the stack of this console.error itself.\\n\\nIf the exception you see is an exception you created yourself, make sure to use `throw new Error(\\\"Oops\\\")` instead of `throw \\\"Oops\\\"`,\\nbecause the javascript environment will only preserve the original stack trace in the first form.\\n\\nYou can also make sure the debugger pauses the next time this very same exception is thrown by enabling \\\"Pause on caught exception\\\".\\n(Note that it might pause on many other, unrelated exception as well).\\n\\nIf that all doesn't help you out, feel free to open an issue https://github.com/mobxjs/mobx/issues!\\n\",\n    \"m038\": \"Missing items in this list?\\n    1. Check whether all used values are properly marked as observable (use isObservable to verify)\\n    2. Make sure you didn't dereference values too early. MobX observes props, not primitives. E.g: use 'person.name' instead of 'name' in your computation.\\n\"\n};\nfunction getMessage(id) {\n    return messages[id];\n}\nvar EMPTY_ARRAY = [];\nObject.freeze(EMPTY_ARRAY);\nfunction getGlobal() {\n    return global;\n}\nfunction getNextId() {\n    return ++globalState.mobxGuid;\n}\nfunction fail(message, thing) {\n    invariant(false, message, thing);\n    throw \"X\";\n}\nfunction invariant(check, message, thing) {\n    if (!check) throw new Error(\"[mobx] Invariant failed: \" + message + (thing ? \" in '\" + thing + \"'\" : \"\"));\n}\nvar deprecatedMessages = [];\nfunction deprecated(msg) {\n    if (deprecatedMessages.indexOf(msg) !== -1) return false;\n    deprecatedMessages.push(msg);\n    console.error(\"[mobx] Deprecated: \" + msg);\n    return true;\n}\nfunction once(func) {\n    var invoked = false;\n    return function () {\n        if (invoked) return;\n        invoked = true;\n        return func.apply(this, arguments);\n    };\n}\nvar noop = function noop() {};\nfunction unique(list) {\n    var res = [];\n    list.forEach(function (item) {\n        if (res.indexOf(item) === -1) res.push(item);\n    });\n    return res;\n}\nfunction joinStrings(things, limit, separator) {\n    if (limit === void 0) {\n        limit = 100;\n    }\n    if (separator === void 0) {\n        separator = \" - \";\n    }\n    if (!things) return \"\";\n    var sliced = things.slice(0, limit);\n    return \"\" + sliced.join(separator) + (things.length > limit ? \" (... and \" + (things.length - limit) + \"more)\" : \"\");\n}\nfunction isObject(value) {\n    return value !== null && (typeof value === \"undefined\" ? \"undefined\" : _typeof(value)) === \"object\";\n}\nfunction isPlainObject(value) {\n    if (value === null || (typeof value === \"undefined\" ? \"undefined\" : _typeof(value)) !== \"object\") return false;\n    var proto = Object.getPrototypeOf(value);\n    return proto === Object.prototype || proto === null;\n}\nfunction objectAssign() {\n    var res = arguments[0];\n    for (var i = 1, l = arguments.length; i < l; i++) {\n        var source = arguments[i];\n        for (var key in source) {\n            if (hasOwnProperty(source, key)) {\n                res[key] = source[key];\n            }\n        }\n    }\n    return res;\n}\nfunction valueDidChange(compareStructural, oldValue, newValue) {\n    if (typeof oldValue === 'number' && isNaN(oldValue)) {\n        return typeof newValue !== 'number' || !isNaN(newValue);\n    }\n    return compareStructural ? !deepEqual(oldValue, newValue) : oldValue !== newValue;\n}\nvar prototypeHasOwnProperty = Object.prototype.hasOwnProperty;\nfunction hasOwnProperty(object, propName) {\n    return prototypeHasOwnProperty.call(object, propName);\n}\nfunction makeNonEnumerable(object, propNames) {\n    for (var i = 0; i < propNames.length; i++) {\n        addHiddenProp(object, propNames[i], object[propNames[i]]);\n    }\n}\nfunction addHiddenProp(object, propName, value) {\n    Object.defineProperty(object, propName, {\n        enumerable: false,\n        writable: true,\n        configurable: true,\n        value: value\n    });\n}\nfunction addHiddenFinalProp(object, propName, value) {\n    Object.defineProperty(object, propName, {\n        enumerable: false,\n        writable: false,\n        configurable: true,\n        value: value\n    });\n}\nfunction isPropertyConfigurable(object, prop) {\n    var descriptor = Object.getOwnPropertyDescriptor(object, prop);\n    return !descriptor || descriptor.configurable !== false && descriptor.writable !== false;\n}\nfunction assertPropertyConfigurable(object, prop) {\n    invariant(isPropertyConfigurable(object, prop), \"Cannot make property '\" + prop + \"' observable, it is not configurable and writable in the target object\");\n}\nfunction getEnumerableKeys(obj) {\n    var res = [];\n    for (var key in obj) {\n        res.push(key);\n    }return res;\n}\nfunction deepEqual(a, b) {\n    if (a === null && b === null) return true;\n    if (a === undefined && b === undefined) return true;\n    if ((typeof a === \"undefined\" ? \"undefined\" : _typeof(a)) !== \"object\") return a === b;\n    var aIsArray = isArrayLike(a);\n    var aIsMap = isMapLike(a);\n    if (aIsArray !== isArrayLike(b)) {\n        return false;\n    } else if (aIsMap !== isMapLike(b)) {\n        return false;\n    } else if (aIsArray) {\n        if (a.length !== b.length) return false;\n        for (var i = a.length - 1; i >= 0; i--) {\n            if (!deepEqual(a[i], b[i])) return false;\n        }return true;\n    } else if (aIsMap) {\n        if (a.size !== b.size) return false;\n        var equals_1 = true;\n        a.forEach(function (value, key) {\n            equals_1 = equals_1 && deepEqual(b.get(key), value);\n        });\n        return equals_1;\n    } else if ((typeof a === \"undefined\" ? \"undefined\" : _typeof(a)) === \"object\" && (typeof b === \"undefined\" ? \"undefined\" : _typeof(b)) === \"object\") {\n        if (a === null || b === null) return false;\n        if (isMapLike(a) && isMapLike(b)) {\n            if (a.size !== b.size) return false;\n            return deepEqual(observable.shallowMap(a).entries(), observable.shallowMap(b).entries());\n        }\n        if (getEnumerableKeys(a).length !== getEnumerableKeys(b).length) return false;\n        for (var prop in a) {\n            if (!(prop in b)) return false;\n            if (!deepEqual(a[prop], b[prop])) return false;\n        }\n        return true;\n    }\n    return false;\n}\nfunction createInstanceofPredicate(name, clazz) {\n    var propName = \"isMobX\" + name;\n    clazz.prototype[propName] = true;\n    return function (x) {\n        return isObject(x) && x[propName] === true;\n    };\n}\nfunction isArrayLike(x) {\n    return Array.isArray(x) || isObservableArray(x);\n}\nexports.isArrayLike = isArrayLike;\nfunction isMapLike(x) {\n    return isES6Map(x) || isObservableMap(x);\n}\nfunction isES6Map(thing) {\n    if (getGlobal().Map !== undefined && thing instanceof getGlobal().Map) return true;\n    return false;\n}\nfunction primitiveSymbol() {\n    return typeof Symbol === \"function\" && Symbol.toPrimitive || \"@@toPrimitive\";\n}\nfunction toPrimitive(value) {\n    return value === null ? null : (typeof value === \"undefined\" ? \"undefined\" : _typeof(value)) === \"object\" ? \"\" + value : value;\n}\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(4)))\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _icons = __webpack_require__(6);\n\nvar _constants = __webpack_require__(0);\n\nfunction renderHeader(_ref, instance) {\n  var meta = _ref.meta,\n      user = _ref.user,\n      reactions = _ref.reactions;\n\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-header-container';\n\n  var likeButton = document.createElement('span');\n  var likedReaction = reactions.find(function (reaction) {\n    return reaction.content === 'heart' && reaction.user.login === user.login;\n  });\n  likeButton.className = 'gitment-header-like-btn';\n  likeButton.innerHTML = '\\n    ' + _icons.heart + '\\n    ' + (likedReaction ? 'Unlike' : 'Like') + '\\n    ' + (meta.reactions && meta.reactions.heart ? ' \\u2022 <strong>' + meta.reactions.heart + '</strong> Liked' : '') + '\\n  ';\n\n  if (likedReaction) {\n    likeButton.classList.add('liked');\n    likeButton.onclick = function () {\n      return instance.unlike();\n    };\n  } else {\n    likeButton.classList.remove('liked');\n    likeButton.onclick = function () {\n      return instance.like();\n    };\n  }\n  container.appendChild(likeButton);\n\n  var commentsCount = document.createElement('span');\n  commentsCount.innerHTML = '\\n    ' + (meta.comments ? ' \\u2022 <strong>' + meta.comments + '</strong> Comments' : '') + '\\n  ';\n  container.appendChild(commentsCount);\n\n  var issueLink = document.createElement('a');\n  issueLink.className = 'gitment-header-issue-link';\n  issueLink.href = meta.html_url;\n  issueLink.target = '_blank';\n  issueLink.innerText = 'Issue Page';\n  container.appendChild(issueLink);\n\n  return container;\n}\n\nfunction renderComments(_ref2, instance) {\n  var meta = _ref2.meta,\n      comments = _ref2.comments,\n      commentReactions = _ref2.commentReactions,\n      currentPage = _ref2.currentPage,\n      user = _ref2.user,\n      error = _ref2.error;\n\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-comments-container';\n\n  if (error) {\n    var errorBlock = document.createElement('div');\n    errorBlock.className = 'gitment-comments-error';\n\n    if (error === _constants.NOT_INITIALIZED_ERROR && user.login && user.login.toLowerCase() === instance.owner.toLowerCase()) {\n      var initHint = document.createElement('div');\n      var initButton = document.createElement('button');\n      initButton.className = 'gitment-comments-init-btn';\n      initButton.onclick = function () {\n        initButton.setAttribute('disabled', true);\n        instance.init().catch(function (e) {\n          initButton.removeAttribute('disabled');\n          alert(e);\n        });\n      };\n      initButton.innerText = 'Initialize Comments';\n      initHint.appendChild(initButton);\n      errorBlock.appendChild(initHint);\n    } else {\n      errorBlock.innerText = error;\n    }\n    container.appendChild(errorBlock);\n    return container;\n  } else if (comments === undefined) {\n    var loading = document.createElement('div');\n    loading.innerText = 'Loading comments...';\n    loading.className = 'gitment-comments-loading';\n    container.appendChild(loading);\n    return container;\n  } else if (!comments.length) {\n    var emptyBlock = document.createElement('div');\n    emptyBlock.className = 'gitment-comments-empty';\n    emptyBlock.innerText = 'No Comment Yet';\n    container.appendChild(emptyBlock);\n    return container;\n  }\n\n  var commentsList = document.createElement('ul');\n  commentsList.className = 'gitment-comments-list';\n\n  comments.forEach(function (comment) {\n    var createDate = new Date(comment.created_at);\n    var updateDate = new Date(comment.updated_at);\n    var commentItem = document.createElement('li');\n    commentItem.className = 'gitment-comment';\n    commentItem.innerHTML = '\\n      <a class=\"gitment-comment-avatar\" href=\"' + comment.user.html_url + '\" target=\"_blank\">\\n        <img class=\"gitment-comment-avatar-img\" src=\"/js/' + comment.user.avatar_url + '\">\\n      </a>\\n      <div class=\"gitment-comment-main\">\\n        <div class=\"gitment-comment-header\">\\n          <a class=\"gitment-comment-name\" href=\"' + comment.user.html_url + '\" target=\"_blank\">\\n            ' + comment.user.login + '\\n          </a>\\n          commented on\\n          <span title=\"' + createDate + '\">' + createDate.toDateString() + '</span>\\n          ' + (createDate.toString() !== updateDate.toString() ? ' \\u2022 <span title=\"comment was edited at ' + updateDate + '\">edited</span>' : '') + '\\n          <div class=\"gitment-comment-like-btn\">' + _icons.heart + ' ' + (comment.reactions.heart || '') + '</div>\\n        </div>\\n        <div class=\"gitment-comment-body gitment-markdown\">' + comment.body_html + '</div>\\n      </div>\\n    ';\n    var likeButton = commentItem.querySelector('.gitment-comment-like-btn');\n    var likedReaction = commentReactions[comment.id] && commentReactions[comment.id].find(function (reaction) {\n      return reaction.content === 'heart' && reaction.user.login === user.login;\n    });\n    if (likedReaction) {\n      likeButton.classList.add('liked');\n      likeButton.onclick = function () {\n        return instance.unlikeAComment(comment.id);\n      };\n    } else {\n      likeButton.classList.remove('liked');\n      likeButton.onclick = function () {\n        return instance.likeAComment(comment.id);\n      };\n    }\n\n    // dirty\n    // use a blank image to trigger height calculating when element rendered\n    var imgTrigger = document.createElement('img');\n    var markdownBody = commentItem.querySelector('.gitment-comment-body');\n    imgTrigger.className = 'gitment-hidden';\n    imgTrigger.src = \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\";\n    imgTrigger.onload = function () {\n      if (markdownBody.clientHeight > instance.maxCommentHeight) {\n        markdownBody.classList.add('gitment-comment-body-folded');\n        markdownBody.style.maxHeight = instance.maxCommentHeight + 'px';\n        markdownBody.title = 'Click to Expand';\n        markdownBody.onclick = function () {\n          markdownBody.classList.remove('gitment-comment-body-folded');\n          markdownBody.style.maxHeight = '';\n          markdownBody.title = '';\n          markdownBody.onclick = null;\n        };\n      }\n    };\n    commentItem.appendChild(imgTrigger);\n\n    commentsList.appendChild(commentItem);\n  });\n\n  container.appendChild(commentsList);\n\n  if (meta) {\n    var pageCount = Math.ceil(meta.comments / instance.perPage);\n    if (pageCount > 1) {\n      var pagination = document.createElement('ul');\n      pagination.className = 'gitment-comments-pagination';\n\n      if (currentPage > 1) {\n        var previousButton = document.createElement('li');\n        previousButton.className = 'gitment-comments-page-item';\n        previousButton.innerText = 'Previous';\n        previousButton.onclick = function () {\n          return instance.goto(currentPage - 1);\n        };\n        pagination.appendChild(previousButton);\n      }\n\n      var _loop = function _loop(i) {\n        var pageItem = document.createElement('li');\n        pageItem.className = 'gitment-comments-page-item';\n        pageItem.innerText = i;\n        pageItem.onclick = function () {\n          return instance.goto(i);\n        };\n        if (currentPage === i) pageItem.classList.add('gitment-selected');\n        pagination.appendChild(pageItem);\n      };\n\n      for (var i = 1; i <= pagecount;=\"\" i++)=\"\" {=\"\" _loop(i);=\"\" }=\"\" if=\"\" (currentpage=\"\" <=\"\" pagecount)=\"\" var=\"\" nextbutton=\"document.createElement('li');\" nextbutton.classname=\"gitment-comments-page-item\" ;=\"\" nextbutton.innertext=\"Next\" nextbutton.onclick=\"function\" ()=\"\" return=\"\" instance.goto(currentpage=\"\" +=\"\" 1);=\"\" };=\"\" pagination.appendchild(nextbutton);=\"\" container.appendchild(pagination);=\"\" container;=\"\" function=\"\" rendereditor(_ref3,=\"\" instance)=\"\" user=\"_ref3.user,\" error=\"_ref3.error;\" container=\"document.createElement('div');\" container.lang=\"en-US\" container.classname=\"gitment-container gitment-editor-container\" shoulddisable=\"user.login\" &&=\"\" !error=\"\" ?=\"\" ''=\"\" :=\"\" 'disabled';=\"\" disabledtip=\"user.login\" 'login=\"\" to=\"\" comment';=\"\" container.innerhtml=\"\\n      \" (user.login=\"\" '<a=\"\" class=\"gitment-editor-avatar\" href=\"' + user.html_url + '\" target=\"_blank\">\\n            <img class=\"gitment-editor-avatar-img\" src=\"/js/' + user.avatar_url + '\">\\n          ' : user.isLoggingIn ? '<div class=\"gitment-editor-avatar\">' + _icons.spinner + '</div>' : '<a class=\"gitment-editor-avatar\" href=\"' + instance.loginLink + '\" title=\"login with GitHub\">\\n              ' + _icons.github + '\\n            </a>') + '\\n    \\n    <div class=\"gitment-editor-main\">\\n      <div class=\"gitment-editor-header\">\\n        <nav class=\"gitment-editor-tabs\">\\n          <button class=\"gitment-editor-tab gitment-selected\">Write</button>\\n          <button class=\"gitment-editor-tab\">Preview</button>\\n        </nav>\\n        <div class=\"gitment-editor-login\">\\n          ' + (user.login ? '<a class=\"gitment-editor-logout-link\">Logout</a>' : user.isLoggingIn ? 'Logging in...' : '<a class=\"gitment-editor-login-link\" href=\"' + instance.loginLink + '\">Login</a> with GitHub') + '\\n        </div>\\n      </div>\\n      <div class=\"gitment-editor-body\">\\n        <div class=\"gitment-editor-write-field\">\\n          <textarea placeholder=\"Leave a comment\" title=\"' + disabledTip + '\" '=\"\" +=\"\" shoulddisable=\"\"></textarea>\\n        </div>\\n        <div class=\"gitment-editor-preview-field gitment-hidden\">\\n          <div class=\"gitment-editor-preview gitment-markdown\"></div>\\n        </div>\\n      </div>\\n    </div>\\n    <div class=\"gitment-editor-footer\">\\n      <a class=\"gitment-editor-footer-tip\" href=\"https://guides.github.com/features/mastering-markdown/\" target=\"_blank\">\\n        Styling with Markdown is supported\\n      </a>\\n      <button class=\"gitment-editor-submit\" title=\"' + disabledTip + '\" '=\"\" +=\"\" shoulddisable=\"\">Comment</button>\\n    </div>\\n  ';\n  if (user.login) {\n    container.querySelector('.gitment-editor-logout-link').onclick = function () {\n      return instance.logout();\n    };\n  }\n\n  var writeField = container.querySelector('.gitment-editor-write-field');\n  var previewField = container.querySelector('.gitment-editor-preview-field');\n\n  var textarea = writeField.querySelector('textarea');\n  textarea.oninput = function () {\n    textarea.style.height = 'auto';\n    var style = window.getComputedStyle(textarea, null);\n    var height = parseInt(style.height, 10);\n    var clientHeight = textarea.clientHeight;\n    var scrollHeight = textarea.scrollHeight;\n    if (clientHeight < scrollHeight) {\n      textarea.style.height = height + scrollHeight - clientHeight + 'px';\n    }\n  };\n\n  var _container$querySelec = container.querySelectorAll('.gitment-editor-tab'),\n      _container$querySelec2 = _slicedToArray(_container$querySelec, 2),\n      writeTab = _container$querySelec2[0],\n      previewTab = _container$querySelec2[1];\n\n  writeTab.onclick = function () {\n    writeTab.classList.add('gitment-selected');\n    previewTab.classList.remove('gitment-selected');\n    writeField.classList.remove('gitment-hidden');\n    previewField.classList.add('gitment-hidden');\n\n    textarea.focus();\n  };\n  previewTab.onclick = function () {\n    previewTab.classList.add('gitment-selected');\n    writeTab.classList.remove('gitment-selected');\n    previewField.classList.remove('gitment-hidden');\n    writeField.classList.add('gitment-hidden');\n\n    var preview = previewField.querySelector('.gitment-editor-preview');\n    var content = textarea.value.trim();\n    if (!content) {\n      preview.innerText = 'Nothing to preview';\n      return;\n    }\n\n    preview.innerText = 'Loading preview...';\n    instance.markdown(content).then(function (html) {\n      return preview.innerHTML = html;\n    });\n  };\n\n  var submitButton = container.querySelector('.gitment-editor-submit');\n  submitButton.onclick = function () {\n    submitButton.innerText = 'Submitting...';\n    submitButton.setAttribute('disabled', true);\n    instance.post(textarea.value.trim()).then(function (data) {\n      textarea.value = '';\n      textarea.style.height = 'auto';\n      submitButton.removeAttribute('disabled');\n      submitButton.innerText = 'Comment';\n    }).catch(function (e) {\n      alert(e);\n      submitButton.removeAttribute('disabled');\n      submitButton.innerText = 'Comment';\n    });\n  };\n\n  return container;\n}\n\nfunction renderFooter() {\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-footer-container';\n  container.innerHTML = '\\n    Powered by\\n    <a class=\"gitment-footer-project-link\" href=\"https://github.com/imsun/gitment\" target=\"_blank\">\\n      Gitment\\n    </a>\\n  ';\n  return container;\n}\n\nfunction render(state, instance) {\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-root-container';\n  container.appendChild(instance.renderHeader(state, instance));\n  container.appendChild(instance.renderComments(state, instance));\n  container.appendChild(instance.renderEditor(state, instance));\n  container.appendChild(instance.renderFooter(state, instance));\n  return container;\n}\n\nexports.default = { render: render, renderHeader: renderHeader, renderComments: renderComments, renderEditor: renderEditor, renderFooter: renderFooter };\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.http = exports.Query = exports.isString = undefined;\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nexports.getTargetContainer = getTargetContainer;\n\nvar _constants = __webpack_require__(0);\n\nvar isString = exports.isString = function isString(s) {\n  return toString.call(s) === '[object String]';\n};\n\nfunction getTargetContainer(container) {\n  var targetContainer = void 0;\n  if (container instanceof Element) {\n    targetContainer = container;\n  } else if (isString(container)) {\n    targetContainer = document.getElementById(container);\n  } else {\n    targetContainer = document.createElement('div');\n  }\n\n  return targetContainer;\n}\n\nvar Query = exports.Query = {\n  parse: function parse() {\n    var search = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : window.location.search;\n\n    if (!search) return {};\n    var queryString = search[0] === '?' ? search.substring(1) : search;\n    var query = {};\n    queryString.split('&').forEach(function (queryStr) {\n      var _queryStr$split = queryStr.split('='),\n          _queryStr$split2 = _slicedToArray(_queryStr$split, 2),\n          key = _queryStr$split2[0],\n          value = _queryStr$split2[1];\n\n      if (key) query[key] = value;\n    });\n\n    return query;\n  },\n  stringify: function stringify(query) {\n    var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '?';\n\n    var queryString = Object.keys(query).map(function (key) {\n      return key + '=' + encodeURIComponent(query[key] || '');\n    }).join('&');\n    return queryString ? prefix + queryString : '';\n  }\n};\n\nfunction ajaxFactory(method) {\n  return function (apiPath) {\n    var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var base = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'https://api.github.com';\n\n    var req = new XMLHttpRequest();\n    var token = localStorage.getItem(_constants.LS_ACCESS_TOKEN_KEY);\n\n    var url = '' + base + apiPath;\n    var body = null;\n    if (method === 'GET' || method === 'DELETE') {\n      url += Query.stringify(data);\n    }\n\n    var p = new Promise(function (resolve, reject) {\n      req.addEventListener('load', function () {\n        var contentType = req.getResponseHeader('content-type');\n        var res = req.responseText;\n        if (!/json/.test(contentType)) {\n          resolve(res);\n          return;\n        }\n        var data = req.responseText ? JSON.parse(res) : {};\n        if (data.message) {\n          reject(new Error(data.message));\n        } else {\n          resolve(data);\n        }\n      });\n      req.addEventListener('error', function (error) {\n        return reject(error);\n      });\n    });\n    req.open(method, url, true);\n\n    req.setRequestHeader('Accept', 'application/vnd.github.squirrel-girl-preview, application/vnd.github.html+json');\n    if (token) {\n      req.setRequestHeader('Authorization', 'token ' + token);\n    }\n    if (method !== 'GET' && method !== 'DELETE') {\n      body = JSON.stringify(data);\n      req.setRequestHeader('Content-Type', 'application/json');\n    }\n\n    req.send(body);\n    return p;\n  };\n}\n\nvar http = exports.http = {\n  get: ajaxFactory('GET'),\n  post: ajaxFactory('POST'),\n  delete: ajaxFactory('DELETE'),\n  put: ajaxFactory('PUT')\n};\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar g;\n\n// This works in non-strict mode\ng = function () {\n\treturn this;\n}();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || Function(\"return this\")() || (1, eval)(\"this\");\n} catch (e) {\n\t// This works if the window reference is available\n\tif ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _mobx = __webpack_require__(1);\n\nvar _constants = __webpack_require__(0);\n\nvar _utils = __webpack_require__(3);\n\nvar _default = __webpack_require__(2);\n\nvar _default2 = _interopRequireDefault(_default);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar scope = 'public_repo';\n\nfunction extendRenderer(instance, renderer) {\n  instance[renderer] = function (container) {\n    var targetContainer = (0, _utils.getTargetContainer)(container);\n    var render = instance.theme[renderer] || instance.defaultTheme[renderer];\n\n    (0, _mobx.autorun)(function () {\n      var e = render(instance.state, instance);\n      if (targetContainer.firstChild) {\n        targetContainer.replaceChild(e, targetContainer.firstChild);\n      } else {\n        targetContainer.appendChild(e);\n      }\n    });\n\n    return targetContainer;\n  };\n}\n\nvar Gitment = function () {\n  _createClass(Gitment, [{\n    key: 'accessToken',\n    get: function get() {\n      return localStorage.getItem(_constants.LS_ACCESS_TOKEN_KEY);\n    },\n    set: function set(token) {\n      localStorage.setItem(_constants.LS_ACCESS_TOKEN_KEY, token);\n    }\n  }, {\n    key: 'loginLink',\n    get: function get() {\n      var oauthUri = 'https://github.com/login/oauth/authorize';\n      var redirect_uri = this.oauth.redirect_uri || window.location.href;\n\n      var oauthParams = Object.assign({\n        scope: scope,\n        redirect_uri: redirect_uri\n      }, this.oauth);\n\n      return '' + oauthUri + _utils.Query.stringify(oauthParams);\n    }\n  }]);\n\n  function Gitment() {\n    var _this = this;\n\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, Gitment);\n\n    this.defaultTheme = _default2.default;\n    this.useTheme(_default2.default);\n\n    Object.assign(this, {\n      id: window.location.href,\n      title: window.document.title,\n      link: window.location.href,\n      desc: '',\n      labels: [],\n      theme: _default2.default,\n      oauth: {},\n      perPage: 20,\n      maxCommentHeight: 250\n    }, options);\n\n    this.useTheme(this.theme);\n\n    var user = {};\n    try {\n      var userInfo = localStorage.getItem(_constants.LS_USER_KEY);\n      if (this.accessToken && userInfo) {\n        Object.assign(user, JSON.parse(userInfo), {\n          fromCache: true\n        });\n      }\n    } catch (e) {\n      localStorage.removeItem(_constants.LS_USER_KEY);\n    }\n\n    this.state = (0, _mobx.observable)({\n      user: user,\n      error: null,\n      meta: {},\n      comments: undefined,\n      reactions: [],\n      commentReactions: {},\n      currentPage: 1\n    });\n\n    var query = _utils.Query.parse();\n    if (query.code) {\n      var _oauth = this.oauth,\n          client_id = _oauth.client_id,\n          client_secret = _oauth.client_secret;\n\n      var code = query.code;\n      delete query.code;\n      var search = _utils.Query.stringify(query);\n      var replacedUrl = '' + window.location.origin + window.location.pathname + search + window.location.hash;\n      history.replaceState({}, '', replacedUrl);\n\n      Object.assign(this, {\n        id: replacedUrl,\n        link: replacedUrl\n      }, options);\n\n      this.state.user.isLoggingIn = true;\n      _utils.http.post('https://gh-oauth.imsun.net', {\n        code: code,\n        client_id: client_id,\n        client_secret: client_secret\n      }, '').then(function (data) {\n        _this.accessToken = data.access_token;\n        _this.update();\n      }).catch(function (e) {\n        _this.state.user.isLoggingIn = false;\n        alert(e);\n      });\n    } else {\n      this.update();\n    }\n  }\n\n  _createClass(Gitment, [{\n    key: 'init',\n    value: function init() {\n      var _this2 = this;\n\n      return this.createIssue().then(function () {\n        return _this2.loadComments();\n      }).then(function (comments) {\n        _this2.state.error = null;\n        return comments;\n      });\n    }\n  }, {\n    key: 'useTheme',\n    value: function useTheme() {\n      var _this3 = this;\n\n      var theme = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      this.theme = theme;\n\n      var renderers = Object.keys(this.theme);\n      renderers.forEach(function (renderer) {\n        return extendRenderer(_this3, renderer);\n      });\n    }\n  }, {\n    key: 'update',\n    value: function update() {\n      var _this4 = this;\n\n      return Promise.all([this.loadMeta(), this.loadUserInfo()]).then(function () {\n        return Promise.all([_this4.loadComments().then(function () {\n          return _this4.loadCommentReactions();\n        }), _this4.loadReactions()]);\n      }).catch(function (e) {\n        return _this4.state.error = e;\n      });\n    }\n  }, {\n    key: 'markdown',\n    value: function markdown(text) {\n      return _utils.http.post('/markdown', {\n        text: text,\n        mode: 'gfm'\n      });\n    }\n  }, {\n    key: 'createIssue',\n    value: function createIssue() {\n      var _this5 = this;\n\n      var id = this.id,\n          owner = this.owner,\n          repo = this.repo,\n          title = this.title,\n          link = this.link,\n          desc = this.desc,\n          labels = this.labels;\n\n\n      return _utils.http.post('/repos/' + owner + '/' + repo + '/issues', {\n        title: title,\n        labels: labels.concat(['gitment', id]),\n        body: link + '\\n\\n' + desc\n      }).then(function (meta) {\n        _this5.state.meta = meta;\n        return meta;\n      });\n    }\n  }, {\n    key: 'getIssue',\n    value: function getIssue() {\n      if (this.state.meta.id) return Promise.resolve(this.state.meta);\n\n      return this.loadMeta();\n    }\n  }, {\n    key: 'post',\n    value: function post(body) {\n      var _this6 = this;\n\n      return this.getIssue().then(function (issue) {\n        return _utils.http.post(issue.comments_url, { body: body }, '');\n      }).then(function (data) {\n        _this6.state.meta.comments++;\n        var pageCount = Math.ceil(_this6.state.meta.comments / _this6.perPage);\n        if (_this6.state.currentPage === pageCount) {\n          _this6.state.comments.push(data);\n        }\n        return data;\n      });\n    }\n  }, {\n    key: 'loadMeta',\n    value: function loadMeta() {\n      var _this7 = this;\n\n      var id = this.id,\n          owner = this.owner,\n          repo = this.repo;\n\n      return _utils.http.get('/repos/' + owner + '/' + repo + '/issues', {\n        creator: owner,\n        labels: id\n      }).then(function (issues) {\n        if (!issues.length) return Promise.reject(_constants.NOT_INITIALIZED_ERROR);\n        _this7.state.meta = issues[0];\n        return issues[0];\n      });\n    }\n  }, {\n    key: 'loadComments',\n    value: function loadComments() {\n      var _this8 = this;\n\n      var page = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.state.currentPage;\n\n      return this.getIssue().then(function (issue) {\n        return _utils.http.get(issue.comments_url, { page: page, per_page: _this8.perPage }, '');\n      }).then(function (comments) {\n        _this8.state.comments = comments;\n        return comments;\n      });\n    }\n  }, {\n    key: 'loadUserInfo',\n    value: function loadUserInfo() {\n      var _this9 = this;\n\n      if (!this.accessToken) {\n        this.logout();\n        return Promise.resolve({});\n      }\n\n      return _utils.http.get('/user').then(function (user) {\n        _this9.state.user = user;\n        localStorage.setItem(_constants.LS_USER_KEY, JSON.stringify(user));\n        return user;\n      });\n    }\n  }, {\n    key: 'loadReactions',\n    value: function loadReactions() {\n      var _this10 = this;\n\n      if (!this.accessToken) {\n        this.state.reactions = [];\n        return Promise.resolve([]);\n      }\n\n      return this.getIssue().then(function (issue) {\n        if (!issue.reactions.total_count) return [];\n        return _utils.http.get(issue.reactions.url, {}, '');\n      }).then(function (reactions) {\n        _this10.state.reactions = reactions;\n        return reactions;\n      });\n    }\n  }, {\n    key: 'loadCommentReactions',\n    value: function loadCommentReactions() {\n      var _this11 = this;\n\n      if (!this.accessToken) {\n        this.state.commentReactions = {};\n        return Promise.resolve([]);\n      }\n\n      var comments = this.state.comments;\n      var comentReactions = {};\n\n      return Promise.all(comments.map(function (comment) {\n        if (!comment.reactions.total_count) return [];\n\n        var owner = _this11.owner,\n            repo = _this11.repo;\n\n        return _utils.http.get('/repos/' + owner + '/' + repo + '/issues/comments/' + comment.id + '/reactions', {});\n      })).then(function (reactionsArray) {\n        comments.forEach(function (comment, index) {\n          comentReactions[comment.id] = reactionsArray[index];\n        });\n        _this11.state.commentReactions = comentReactions;\n\n        return comentReactions;\n      });\n    }\n  }, {\n    key: 'login',\n    value: function login() {\n      window.location.href = this.loginLink;\n    }\n  }, {\n    key: 'logout',\n    value: function logout() {\n      localStorage.removeItem(_constants.LS_ACCESS_TOKEN_KEY);\n      localStorage.removeItem(_constants.LS_USER_KEY);\n      this.state.user = {};\n    }\n  }, {\n    key: 'goto',\n    value: function goto(page) {\n      this.state.currentPage = page;\n      this.state.comments = undefined;\n      return this.loadComments(page);\n    }\n  }, {\n    key: 'like',\n    value: function like() {\n      var _this12 = this;\n\n      if (!this.accessToken) {\n        alert('Login to Like');\n        return Promise.reject();\n      }\n\n      var owner = this.owner,\n          repo = this.repo;\n\n\n      return _utils.http.post('/repos/' + owner + '/' + repo + '/issues/' + this.state.meta.number + '/reactions', {\n        content: 'heart'\n      }).then(function (reaction) {\n        _this12.state.reactions.push(reaction);\n        _this12.state.meta.reactions.heart++;\n      });\n    }\n  }, {\n    key: 'unlike',\n    value: function unlike() {\n      var _this13 = this;\n\n      if (!this.accessToken) return Promise.reject();\n\n      var _state = this.state,\n          user = _state.user,\n          reactions = _state.reactions;\n\n      var index = reactions.findIndex(function (reaction) {\n        return reaction.user.login === user.login;\n      });\n      return _utils.http.delete('/reactions/' + reactions[index].id).then(function () {\n        reactions.splice(index, 1);\n        _this13.state.meta.reactions.heart--;\n      });\n    }\n  }, {\n    key: 'likeAComment',\n    value: function likeAComment(commentId) {\n      var _this14 = this;\n\n      if (!this.accessToken) {\n        alert('Login to Like');\n        return Promise.reject();\n      }\n\n      var owner = this.owner,\n          repo = this.repo;\n\n      var comment = this.state.comments.find(function (comment) {\n        return comment.id === commentId;\n      });\n\n      return _utils.http.post('/repos/' + owner + '/' + repo + '/issues/comments/' + commentId + '/reactions', {\n        content: 'heart'\n      }).then(function (reaction) {\n        _this14.state.commentReactions[commentId].push(reaction);\n        comment.reactions.heart++;\n      });\n    }\n  }, {\n    key: 'unlikeAComment',\n    value: function unlikeAComment(commentId) {\n      if (!this.accessToken) return Promise.reject();\n\n      var reactions = this.state.commentReactions[commentId];\n      var comment = this.state.comments.find(function (comment) {\n        return comment.id === commentId;\n      });\n      var user = this.state.user;\n\n      var index = reactions.findIndex(function (reaction) {\n        return reaction.user.login === user.login;\n      });\n\n      return _utils.http.delete('/reactions/' + reactions[index].id).then(function () {\n        reactions.splice(index, 1);\n        comment.reactions.heart--;\n      });\n    }\n  }]);\n\n  return Gitment;\n}();\n\nmodule.exports = Gitment;\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/**\n * Modified from https://github.com/evil-icons/evil-icons\n */\n\nvar close = exports.close = '<svg class=\"gitment-close-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewbox=\"0 0 50 50\"><path d=\"M37.304 11.282l1.414 1.414-26.022 26.02-1.414-1.413z\"/><path d=\"M12.696 11.282l26.022 26.02-1.414 1.415-26.022-26.02z\"/></svg>';\nvar github = exports.github = '<svg class=\"gitment-github-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewbox=\"0 0 50 50\"><path d=\"M25 10c-8.3 0-15 6.7-15 15 0 6.6 4.3 12.2 10.3 14.2.8.1 1-.3 1-.7v-2.6c-4.2.9-5.1-2-5.1-2-.7-1.7-1.7-2.2-1.7-2.2-1.4-.9.1-.9.1-.9 1.5.1 2.3 1.5 2.3 1.5 1.3 2.3 3.5 1.6 4.4 1.2.1-1 .5-1.6 1-2-3.3-.4-6.8-1.7-6.8-7.4 0-1.6.6-3 1.5-4-.2-.4-.7-1.9.1-4 0 0 1.3-.4 4.1 1.5 1.2-.3 2.5-.5 3.8-.5 1.3 0 2.6.2 3.8.5 2.9-1.9 4.1-1.5 4.1-1.5.8 2.1.3 3.6.1 4 1 1 1.5 2.4 1.5 4 0 5.8-3.5 7-6.8 7.4.5.5 1 1.4 1 2.8v4.1c0 .4.3.9 1 .7 6-2 10.2-7.6 10.2-14.2C40 16.7 33.3 10 25 10z\"/></svg>';\nvar heart = exports.heart = '<svg class=\"gitment-heart-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewbox=\"0 0 50 50\"><path d=\"M25 39.7l-.6-.5C11.5 28.7 8 25 8 19c0-5 4-9 9-9 4.1 0 6.4 2.3 8 4.1 1.6-1.8 3.9-4.1 8-4.1 5 0 9 4 9 9 0 6-3.5 9.7-16.4 20.2l-.6.5zM17 12c-3.9 0-7 3.1-7 7 0 5.1 3.2 8.5 15 18.1 11.8-9.6 15-13 15-18.1 0-3.9-3.1-7-7-7-3.5 0-5.4 2.1-6.9 3.8L25 17.1l-1.1-1.3C22.4 14.1 20.5 12 17 12z\"/></svg>';\nvar spinner = exports.spinner = '<svg class=\"gitment-spinner-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewbox=\"0 0 50 50\"><path d=\"M25 18c-.6 0-1-.4-1-1V9c0-.6.4-1 1-1s1 .4 1 1v8c0 .6-.4 1-1 1z\"/><path opacity=\".3\" d=\"M25 42c-.6 0-1-.4-1-1v-8c0-.6.4-1 1-1s1 .4 1 1v8c0 .6-.4 1-1 1z\"/><path opacity=\".3\" d=\"M29 19c-.2 0-.3 0-.5-.1-.4-.3-.6-.8-.3-1.3l4-6.9c.3-.4.8-.6 1.3-.3.4.3.6.8.3 1.3l-4 6.9c-.2.2-.5.4-.8.4z\"/><path opacity=\".3\" d=\"M17 39.8c-.2 0-.3 0-.5-.1-.4-.3-.6-.8-.3-1.3l4-6.9c.3-.4.8-.6 1.3-.3.4.3.6.8.3 1.3l-4 6.9c-.2.2-.5.4-.8.4z\"/><path opacity=\".93\" d=\"M21 19c-.3 0-.6-.2-.8-.5l-4-6.9c-.3-.4-.1-1 .3-1.3.4-.3 1-.1 1.3.3l4 6.9c.3.4.1 1-.3 1.3-.2.2-.3.2-.5.2z\"/><path opacity=\".3\" d=\"M33 39.8c-.3 0-.6-.2-.8-.5l-4-6.9c-.3-.4-.1-1 .3-1.3.4-.3 1-.1 1.3.3l4 6.9c.3.4.1 1-.3 1.3-.2.1-.3.2-.5.2z\"/><path opacity=\".65\" d=\"M17 26H9c-.6 0-1-.4-1-1s.4-1 1-1h8c.6 0 1 .4 1 1s-.4 1-1 1z\"/><path opacity=\".3\" d=\"M41 26h-8c-.6 0-1-.4-1-1s.4-1 1-1h8c.6 0 1 .4 1 1s-.4 1-1 1z\"/><path opacity=\".86\" d=\"M18.1 21.9c-.2 0-.3 0-.5-.1l-6.9-4c-.4-.3-.6-.8-.3-1.3.3-.4.8-.6 1.3-.3l6.9 4c.4.3.6.8.3 1.3-.2.3-.5.4-.8.4z\"/><path opacity=\".3\" d=\"M38.9 33.9c-.2 0-.3 0-.5-.1l-6.9-4c-.4-.3-.6-.8-.3-1.3.3-.4.8-.6 1.3-.3l6.9 4c.4.3.6.8.3 1.3-.2.3-.5.4-.8.4z\"/><path opacity=\".44\" d=\"M11.1 33.9c-.3 0-.6-.2-.8-.5-.3-.4-.1-1 .3-1.3l6.9-4c.4-.3 1-.1 1.3.3.3.4.1 1-.3 1.3l-6.9 4c-.1.2-.3.2-.5.2z\"/><path opacity=\".3\" d=\"M31.9 21.9c-.3 0-.6-.2-.8-.5-.3-.4-.1-1 .3-1.3l6.9-4c.4-.3 1-.1 1.3.3.3.4.1 1-.3 1.3l-6.9 4c-.2.2-.3.2-.5.2z\"/></svg>';\n\n/***/ })\n/******/ ]);\n//# sourceMappingURL=gitment.browser.js.map</=></=></unnamed></not></unnamed></unnamed>","site":{"data":{}},"excerpt":"","more":"var Gitment =\n/******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\ti: moduleId,\n/******/ \t\t\tl: false,\n/******/ \t\t\texports: {}\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.l = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// identity function for calling harmony imports with the correct context\n/******/ \t__webpack_require__.i = function(value) { return value; };\n/******/\n/******/ \t// define getter function for harmony exports\n/******/ \t__webpack_require__.d = function(exports, name, getter) {\n/******/ \t\tif(!__webpack_require__.o(exports, name)) {\n/******/ \t\t\tObject.defineProperty(exports, name, {\n/******/ \t\t\t\tconfigurable: false,\n/******/ \t\t\t\tenumerable: true,\n/******/ \t\t\t\tget: getter\n/******/ \t\t\t});\n/******/ \t\t}\n/******/ \t};\n/******/\n/******/ \t// getDefaultExport function for compatibility with non-harmony modules\n/******/ \t__webpack_require__.n = function(module) {\n/******/ \t\tvar getter = module && module.__esModule ?\n/******/ \t\t\tfunction getDefault() { return module['default']; } :\n/******/ \t\t\tfunction getModuleExports() { return module; };\n/******/ \t\t__webpack_require__.d(getter, 'a', getter);\n/******/ \t\treturn getter;\n/******/ \t};\n/******/\n/******/ \t// Object.prototype.hasOwnProperty.call\n/******/ \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(__webpack_require__.s = 5);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nvar LS_ACCESS_TOKEN_KEY = exports.LS_ACCESS_TOKEN_KEY = 'gitment-comments-token';\nvar LS_USER_KEY = exports.LS_USER_KEY = 'gitment-user-info';\n\nvar NOT_INITIALIZED_ERROR = exports.NOT_INITIALIZED_ERROR = new Error('Comments Not Initialized');\n\n/***/ }),\n/* 1 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global) {\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar __extends = undefined && undefined.__extends || function () {\n    var extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (d, b) {\n        d.__proto__ = b;\n    } || function (d, b) {\n        for (var p in b) {\n            if (b.hasOwnProperty(p)) d[p] = b[p];\n        }\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() {\n            this.constructor = d;\n        }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n}();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nregisterGlobals();\nexports.extras = {\n    allowStateChanges: allowStateChanges,\n    deepEqual: deepEqual,\n    getAtom: getAtom,\n    getDebugName: getDebugName,\n    getDependencyTree: getDependencyTree,\n    getAdministration: getAdministration,\n    getGlobalState: getGlobalState,\n    getObserverTree: getObserverTree,\n    isComputingDerivation: isComputingDerivation,\n    isSpyEnabled: isSpyEnabled,\n    onReactionError: onReactionError,\n    resetGlobalState: resetGlobalState,\n    shareGlobalState: shareGlobalState,\n    spyReport: spyReport,\n    spyReportEnd: spyReportEnd,\n    spyReportStart: spyReportStart,\n    setReactionScheduler: setReactionScheduler\n};\nif ((typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__ === \"undefined\" ? \"undefined\" : _typeof(__MOBX_DEVTOOLS_GLOBAL_HOOK__)) === \"object\") {\n    __MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx(module.exports);\n}\nmodule.exports.default = module.exports;\nvar actionFieldDecorator = createClassPropertyDecorator(function (target, key, value, args, originalDescriptor) {\n    var actionName = args && args.length === 1 ? args[0] : value.name || key || \"<unnamed action=\"\">\";\n    var wrappedAction = action(actionName, value);\n    addHiddenProp(target, key, wrappedAction);\n}, function (key) {\n    return this[key];\n}, function () {\n    invariant(false, getMessage(\"m001\"));\n}, false, true);\nvar boundActionDecorator = createClassPropertyDecorator(function (target, key, value) {\n    defineBoundAction(target, key, value);\n}, function (key) {\n    return this[key];\n}, function () {\n    invariant(false, getMessage(\"m001\"));\n}, false, false);\nvar action = function action(arg1, arg2, arg3, arg4) {\n    if (arguments.length === 1 && typeof arg1 === \"function\") return createAction(arg1.name || \"<unnamed action=\"\">\", arg1);\n    if (arguments.length === 2 && typeof arg2 === \"function\") return createAction(arg1, arg2);\n    if (arguments.length === 1 && typeof arg1 === \"string\") return namedActionDecorator(arg1);\n    return namedActionDecorator(arg2).apply(null, arguments);\n};\nexports.action = action;\naction.bound = function boundAction(arg1, arg2, arg3) {\n    if (typeof arg1 === \"function\") {\n        var action_1 = createAction(\"<not yet=\"\" bound=\"\" action=\"\">\", arg1);\n        action_1.autoBind = true;\n        return action_1;\n    }\n    return boundActionDecorator.apply(null, arguments);\n};\nfunction namedActionDecorator(name) {\n    return function (target, prop, descriptor) {\n        if (descriptor && typeof descriptor.value === \"function\") {\n            descriptor.value = createAction(name, descriptor.value);\n            descriptor.enumerable = false;\n            descriptor.configurable = true;\n            return descriptor;\n        }\n        return actionFieldDecorator(name).apply(this, arguments);\n    };\n}\nfunction runInAction(arg1, arg2, arg3) {\n    var actionName = typeof arg1 === \"string\" ? arg1 : arg1.name || \"<unnamed action=\"\">\";\n    var fn = typeof arg1 === \"function\" ? arg1 : arg2;\n    var scope = typeof arg1 === \"function\" ? arg2 : arg3;\n    invariant(typeof fn === \"function\", getMessage(\"m002\"));\n    invariant(fn.length === 0, getMessage(\"m003\"));\n    invariant(typeof actionName === \"string\" && actionName.length > 0, \"actions should have valid names, got: '\" + actionName + \"'\");\n    return executeAction(actionName, fn, scope, undefined);\n}\nexports.runInAction = runInAction;\nfunction isAction(thing) {\n    return typeof thing === \"function\" && thing.isMobxAction === true;\n}\nexports.isAction = isAction;\nfunction defineBoundAction(target, propertyName, fn) {\n    var res = function res() {\n        return executeAction(propertyName, fn, target, arguments);\n    };\n    res.isMobxAction = true;\n    addHiddenProp(target, propertyName, res);\n}\nfunction autorun(arg1, arg2, arg3) {\n    var name, view, scope;\n    if (typeof arg1 === \"string\") {\n        name = arg1;\n        view = arg2;\n        scope = arg3;\n    } else {\n        name = arg1.name || \"Autorun@\" + getNextId();\n        view = arg1;\n        scope = arg2;\n    }\n    invariant(typeof view === \"function\", getMessage(\"m004\"));\n    invariant(isAction(view) === false, getMessage(\"m005\"));\n    if (scope) view = view.bind(scope);\n    var reaction = new Reaction(name, function () {\n        this.track(reactionRunner);\n    });\n    function reactionRunner() {\n        view(reaction);\n    }\n    reaction.schedule();\n    return reaction.getDisposer();\n}\nexports.autorun = autorun;\nfunction when(arg1, arg2, arg3, arg4) {\n    var name, predicate, effect, scope;\n    if (typeof arg1 === \"string\") {\n        name = arg1;\n        predicate = arg2;\n        effect = arg3;\n        scope = arg4;\n    } else {\n        name = \"When@\" + getNextId();\n        predicate = arg1;\n        effect = arg2;\n        scope = arg3;\n    }\n    var disposer = autorun(name, function (r) {\n        if (predicate.call(scope)) {\n            r.dispose();\n            var prevUntracked = untrackedStart();\n            effect.call(scope);\n            untrackedEnd(prevUntracked);\n        }\n    });\n    return disposer;\n}\nexports.when = when;\nfunction autorunAsync(arg1, arg2, arg3, arg4) {\n    var name, func, delay, scope;\n    if (typeof arg1 === \"string\") {\n        name = arg1;\n        func = arg2;\n        delay = arg3;\n        scope = arg4;\n    } else {\n        name = arg1.name || \"AutorunAsync@\" + getNextId();\n        func = arg1;\n        delay = arg2;\n        scope = arg3;\n    }\n    invariant(isAction(func) === false, getMessage(\"m006\"));\n    if (delay === void 0) delay = 1;\n    if (scope) func = func.bind(scope);\n    var isScheduled = false;\n    var r = new Reaction(name, function () {\n        if (!isScheduled) {\n            isScheduled = true;\n            setTimeout(function () {\n                isScheduled = false;\n                if (!r.isDisposed) r.track(reactionRunner);\n            }, delay);\n        }\n    });\n    function reactionRunner() {\n        func(r);\n    }\n    r.schedule();\n    return r.getDisposer();\n}\nexports.autorunAsync = autorunAsync;\nfunction reaction(expression, effect, arg3) {\n    if (arguments.length > 3) {\n        fail(getMessage(\"m007\"));\n    }\n    if (isModifierDescriptor(expression)) {\n        fail(getMessage(\"m008\"));\n    }\n    var opts;\n    if ((typeof arg3 === \"undefined\" ? \"undefined\" : _typeof(arg3)) === \"object\") {\n        opts = arg3;\n    } else {\n        opts = {};\n    }\n    opts.name = opts.name || expression.name || effect.name || \"Reaction@\" + getNextId();\n    opts.fireImmediately = arg3 === true || opts.fireImmediately === true;\n    opts.delay = opts.delay || 0;\n    opts.compareStructural = opts.compareStructural || opts.struct || false;\n    effect = action(opts.name, opts.context ? effect.bind(opts.context) : effect);\n    if (opts.context) {\n        expression = expression.bind(opts.context);\n    }\n    var firstTime = true;\n    var isScheduled = false;\n    var nextValue;\n    var r = new Reaction(opts.name, function () {\n        if (firstTime || opts.delay < 1) {\n            reactionRunner();\n        } else if (!isScheduled) {\n            isScheduled = true;\n            setTimeout(function () {\n                isScheduled = false;\n                reactionRunner();\n            }, opts.delay);\n        }\n    });\n    function reactionRunner() {\n        if (r.isDisposed) return;\n        var changed = false;\n        r.track(function () {\n            var v = expression(r);\n            changed = valueDidChange(opts.compareStructural, nextValue, v);\n            nextValue = v;\n        });\n        if (firstTime && opts.fireImmediately) effect(nextValue, r);\n        if (!firstTime && changed === true) effect(nextValue, r);\n        if (firstTime) firstTime = false;\n    }\n    r.schedule();\n    return r.getDisposer();\n}\nexports.reaction = reaction;\nfunction createComputedDecorator(compareStructural) {\n    return createClassPropertyDecorator(function (target, name, _, __, originalDescriptor) {\n        invariant(typeof originalDescriptor !== \"undefined\", getMessage(\"m009\"));\n        invariant(typeof originalDescriptor.get === \"function\", getMessage(\"m010\"));\n        var adm = asObservableObject(target, \"\");\n        defineComputedProperty(adm, name, originalDescriptor.get, originalDescriptor.set, compareStructural, false);\n    }, function (name) {\n        var observable = this.$mobx.values[name];\n        if (observable === undefined) return undefined;\n        return observable.get();\n    }, function (name, value) {\n        this.$mobx.values[name].set(value);\n    }, false, false);\n}\nvar computedDecorator = createComputedDecorator(false);\nvar computedStructDecorator = createComputedDecorator(true);\nvar computed = function computed(arg1, arg2, arg3) {\n    if (typeof arg2 === \"string\") {\n        return computedDecorator.apply(null, arguments);\n    }\n    invariant(typeof arg1 === \"function\", getMessage(\"m011\"));\n    invariant(arguments.length < 3, getMessage(\"m012\"));\n    var opts = (typeof arg2 === \"undefined\" ? \"undefined\" : _typeof(arg2)) === \"object\" ? arg2 : {};\n    opts.setter = typeof arg2 === \"function\" ? arg2 : opts.setter;\n    return new ComputedValue(arg1, opts.context, opts.compareStructural || opts.struct || false, opts.name || arg1.name || \"\", opts.setter);\n};\nexports.computed = computed;\ncomputed.struct = computedStructDecorator;\nfunction createTransformer(transformer, onCleanup) {\n    invariant(typeof transformer === \"function\" && transformer.length < 2, \"createTransformer expects a function that accepts one argument\");\n    var objectCache = {};\n    var resetId = globalState.resetId;\n    var Transformer = function (_super) {\n        __extends(Transformer, _super);\n        function Transformer(sourceIdentifier, sourceObject) {\n            var _this = _super.call(this, function () {\n                return transformer(sourceObject);\n            }, undefined, false, \"Transformer-\" + transformer.name + \"-\" + sourceIdentifier, undefined) || this;\n            _this.sourceIdentifier = sourceIdentifier;\n            _this.sourceObject = sourceObject;\n            return _this;\n        }\n        Transformer.prototype.onBecomeUnobserved = function () {\n            var lastValue = this.value;\n            _super.prototype.onBecomeUnobserved.call(this);\n            delete objectCache[this.sourceIdentifier];\n            if (onCleanup) onCleanup(lastValue, this.sourceObject);\n        };\n        return Transformer;\n    }(ComputedValue);\n    return function (object) {\n        if (resetId !== globalState.resetId) {\n            objectCache = {};\n            resetId = globalState.resetId;\n        }\n        var identifier = getMemoizationId(object);\n        var reactiveTransformer = objectCache[identifier];\n        if (reactiveTransformer) return reactiveTransformer.get();\n        reactiveTransformer = objectCache[identifier] = new Transformer(identifier, object);\n        return reactiveTransformer.get();\n    };\n}\nexports.createTransformer = createTransformer;\nfunction getMemoizationId(object) {\n    if (object === null || (typeof object === \"undefined\" ? \"undefined\" : _typeof(object)) !== \"object\") throw new Error(\"[mobx] transform expected some kind of object, got: \" + object);\n    var tid = object.$transformId;\n    if (tid === undefined) {\n        tid = getNextId();\n        addHiddenProp(object, \"$transformId\", tid);\n    }\n    return tid;\n}\nfunction expr(expr, scope) {\n    if (!isComputingDerivation()) console.warn(getMessage(\"m013\"));\n    return computed(expr, { context: scope }).get();\n}\nexports.expr = expr;\nfunction extendObservable(target) {\n    var properties = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        properties[_i - 1] = arguments[_i];\n    }\n    return extendObservableHelper(target, deepEnhancer, properties);\n}\nexports.extendObservable = extendObservable;\nfunction extendShallowObservable(target) {\n    var properties = [];\n    for (var _i = 1; _i < arguments.length; _i++) {\n        properties[_i - 1] = arguments[_i];\n    }\n    return extendObservableHelper(target, referenceEnhancer, properties);\n}\nexports.extendShallowObservable = extendShallowObservable;\nfunction extendObservableHelper(target, defaultEnhancer, properties) {\n    invariant(arguments.length >= 2, getMessage(\"m014\"));\n    invariant((typeof target === \"undefined\" ? \"undefined\" : _typeof(target)) === \"object\", getMessage(\"m015\"));\n    invariant(!isObservableMap(target), getMessage(\"m016\"));\n    properties.forEach(function (propSet) {\n        invariant((typeof propSet === \"undefined\" ? \"undefined\" : _typeof(propSet)) === \"object\", getMessage(\"m017\"));\n        invariant(!isObservable(propSet), getMessage(\"m018\"));\n    });\n    var adm = asObservableObject(target);\n    var definedProps = {};\n    for (var i = properties.length - 1; i >= 0; i--) {\n        var propSet = properties[i];\n        for (var key in propSet) {\n            if (definedProps[key] !== true && hasOwnProperty(propSet, key)) {\n                definedProps[key] = true;\n                if (target === propSet && !isPropertyConfigurable(target, key)) continue;\n                var descriptor = Object.getOwnPropertyDescriptor(propSet, key);\n                defineObservablePropertyFromDescriptor(adm, key, descriptor, defaultEnhancer);\n            }\n        }\n    }\n    return target;\n}\nfunction getDependencyTree(thing, property) {\n    return nodeToDependencyTree(getAtom(thing, property));\n}\nfunction nodeToDependencyTree(node) {\n    var result = {\n        name: node.name\n    };\n    if (node.observing && node.observing.length > 0) result.dependencies = unique(node.observing).map(nodeToDependencyTree);\n    return result;\n}\nfunction getObserverTree(thing, property) {\n    return nodeToObserverTree(getAtom(thing, property));\n}\nfunction nodeToObserverTree(node) {\n    var result = {\n        name: node.name\n    };\n    if (hasObservers(node)) result.observers = getObservers(node).map(nodeToObserverTree);\n    return result;\n}\nfunction intercept(thing, propOrHandler, handler) {\n    if (typeof handler === \"function\") return interceptProperty(thing, propOrHandler, handler);else return interceptInterceptable(thing, propOrHandler);\n}\nexports.intercept = intercept;\nfunction interceptInterceptable(thing, handler) {\n    return getAdministration(thing).intercept(handler);\n}\nfunction interceptProperty(thing, property, handler) {\n    return getAdministration(thing, property).intercept(handler);\n}\nfunction isComputed(value, property) {\n    if (value === null || value === undefined) return false;\n    if (property !== undefined) {\n        if (isObservableObject(value) === false) return false;\n        var atom = getAtom(value, property);\n        return isComputedValue(atom);\n    }\n    return isComputedValue(value);\n}\nexports.isComputed = isComputed;\nfunction isObservable(value, property) {\n    if (value === null || value === undefined) return false;\n    if (property !== undefined) {\n        if (isObservableArray(value) || isObservableMap(value)) throw new Error(getMessage(\"m019\"));else if (isObservableObject(value)) {\n            var o = value.$mobx;\n            return o.values && !!o.values[property];\n        }\n        return false;\n    }\n    return isObservableObject(value) || !!value.$mobx || isAtom(value) || isReaction(value) || isComputedValue(value);\n}\nexports.isObservable = isObservable;\nvar deepDecorator = createDecoratorForEnhancer(deepEnhancer);\nvar shallowDecorator = createDecoratorForEnhancer(shallowEnhancer);\nvar refDecorator = createDecoratorForEnhancer(referenceEnhancer);\nvar deepStructDecorator = createDecoratorForEnhancer(deepStructEnhancer);\nvar refStructDecorator = createDecoratorForEnhancer(refStructEnhancer);\nfunction createObservable(v) {\n    if (v === void 0) {\n        v = undefined;\n    }\n    if (typeof arguments[1] === \"string\") return deepDecorator.apply(null, arguments);\n    invariant(arguments.length <= 1,=\"\" getmessage(\"m021\"));=\"\" invariant(!ismodifierdescriptor(v),=\"\" getmessage(\"m020\"));=\"\" if=\"\" (isobservable(v))=\"\" return=\"\" v;=\"\" var=\"\" res=\"deepEnhancer(v,\" undefined,=\"\" undefined);=\"\" (res=\"\" !=\"=\" v)=\"\" res;=\"\" observable.box(v);=\"\" }=\"\" iobservablefactories=\"function\" ()=\"\" {=\"\" function=\"\" iobservablefactories()=\"\" {}=\"\" iobservablefactories.prototype.box=\"function\" (value,=\"\" name)=\"\" (arguments.length=\"\"> 2) incorrectlyUsedAsDecorator(\"box\");\n        return new ObservableValue(value, deepEnhancer, name);\n    };\n    IObservableFactories.prototype.shallowBox = function (value, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"shallowBox\");\n        return new ObservableValue(value, referenceEnhancer, name);\n    };\n    IObservableFactories.prototype.array = function (initialValues, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"array\");\n        return new ObservableArray(initialValues, deepEnhancer, name);\n    };\n    IObservableFactories.prototype.shallowArray = function (initialValues, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"shallowArray\");\n        return new ObservableArray(initialValues, referenceEnhancer, name);\n    };\n    IObservableFactories.prototype.map = function (initialValues, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"map\");\n        return new ObservableMap(initialValues, deepEnhancer, name);\n    };\n    IObservableFactories.prototype.shallowMap = function (initialValues, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"shallowMap\");\n        return new ObservableMap(initialValues, referenceEnhancer, name);\n    };\n    IObservableFactories.prototype.object = function (props, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"object\");\n        var res = {};\n        asObservableObject(res, name);\n        extendObservable(res, props);\n        return res;\n    };\n    IObservableFactories.prototype.shallowObject = function (props, name) {\n        if (arguments.length > 2) incorrectlyUsedAsDecorator(\"shallowObject\");\n        var res = {};\n        asObservableObject(res, name);\n        extendShallowObservable(res, props);\n        return res;\n    };\n    IObservableFactories.prototype.ref = function () {\n        if (arguments.length < 2) {\n            return createModifierDescriptor(referenceEnhancer, arguments[0]);\n        } else {\n            return refDecorator.apply(null, arguments);\n        }\n    };\n    IObservableFactories.prototype.shallow = function () {\n        if (arguments.length < 2) {\n            return createModifierDescriptor(shallowEnhancer, arguments[0]);\n        } else {\n            return shallowDecorator.apply(null, arguments);\n        }\n    };\n    IObservableFactories.prototype.deep = function () {\n        if (arguments.length < 2) {\n            return createModifierDescriptor(deepEnhancer, arguments[0]);\n        } else {\n            return deepDecorator.apply(null, arguments);\n        }\n    };\n    IObservableFactories.prototype.struct = function () {\n        if (arguments.length < 2) {\n            return createModifierDescriptor(deepStructEnhancer, arguments[0]);\n        } else {\n            return deepStructDecorator.apply(null, arguments);\n        }\n    };\n    return IObservableFactories;\n}();\nexports.IObservableFactories = IObservableFactories;\nvar observable = createObservable;\nexports.observable = observable;\nObject.keys(IObservableFactories.prototype).forEach(function (key) {\n    return observable[key] = IObservableFactories.prototype[key];\n});\nobservable.deep.struct = observable.struct;\nobservable.ref.struct = function () {\n    if (arguments.length < 2) {\n        return createModifierDescriptor(refStructEnhancer, arguments[0]);\n    } else {\n        return refStructDecorator.apply(null, arguments);\n    }\n};\nfunction incorrectlyUsedAsDecorator(methodName) {\n    fail(\"Expected one or two arguments to observable.\" + methodName + \". Did you accidentally try to use observable.\" + methodName + \" as decorator?\");\n}\nfunction createDecoratorForEnhancer(enhancer) {\n    invariant(!!enhancer, \":(\");\n    return createClassPropertyDecorator(function (target, name, baseValue, _, baseDescriptor) {\n        assertPropertyConfigurable(target, name);\n        invariant(!baseDescriptor || !baseDescriptor.get, getMessage(\"m022\"));\n        var adm = asObservableObject(target, undefined);\n        defineObservableProperty(adm, name, baseValue, enhancer);\n    }, function (name) {\n        var observable = this.$mobx.values[name];\n        if (observable === undefined) return undefined;\n        return observable.get();\n    }, function (name, value) {\n        setPropertyValue(this, name, value);\n    }, true, false);\n}\nfunction observe(thing, propOrCb, cbOrFire, fireImmediately) {\n    if (typeof cbOrFire === \"function\") return observeObservableProperty(thing, propOrCb, cbOrFire, fireImmediately);else return observeObservable(thing, propOrCb, cbOrFire);\n}\nexports.observe = observe;\nfunction observeObservable(thing, listener, fireImmediately) {\n    return getAdministration(thing).observe(listener, fireImmediately);\n}\nfunction observeObservableProperty(thing, property, listener, fireImmediately) {\n    return getAdministration(thing, property).observe(listener, fireImmediately);\n}\nfunction toJS(source, detectCycles, __alreadySeen) {\n    if (detectCycles === void 0) {\n        detectCycles = true;\n    }\n    if (__alreadySeen === void 0) {\n        __alreadySeen = [];\n    }\n    function cache(value) {\n        if (detectCycles) __alreadySeen.push([source, value]);\n        return value;\n    }\n    if (isObservable(source)) {\n        if (detectCycles && __alreadySeen === null) __alreadySeen = [];\n        if (detectCycles && source !== null && (typeof source === \"undefined\" ? \"undefined\" : _typeof(source)) === \"object\") {\n            for (var i = 0, l = __alreadySeen.length; i < l; i++) {\n                if (__alreadySeen[i][0] === source) return __alreadySeen[i][1];\n            }\n        }\n        if (isObservableArray(source)) {\n            var res = cache([]);\n            var toAdd = source.map(function (value) {\n                return toJS(value, detectCycles, __alreadySeen);\n            });\n            res.length = toAdd.length;\n            for (var i = 0, l = toAdd.length; i < l; i++) {\n                res[i] = toAdd[i];\n            }return res;\n        }\n        if (isObservableObject(source)) {\n            var res = cache({});\n            for (var key in source) {\n                res[key] = toJS(source[key], detectCycles, __alreadySeen);\n            }return res;\n        }\n        if (isObservableMap(source)) {\n            var res_1 = cache({});\n            source.forEach(function (value, key) {\n                return res_1[key] = toJS(value, detectCycles, __alreadySeen);\n            });\n            return res_1;\n        }\n        if (isObservableValue(source)) return toJS(source.get(), detectCycles, __alreadySeen);\n    }\n    return source;\n}\nexports.toJS = toJS;\nfunction transaction(action, thisArg) {\n    if (thisArg === void 0) {\n        thisArg = undefined;\n    }\n    deprecated(getMessage(\"m023\"));\n    return runInTransaction.apply(undefined, arguments);\n}\nexports.transaction = transaction;\nfunction runInTransaction(action, thisArg) {\n    if (thisArg === void 0) {\n        thisArg = undefined;\n    }\n    return executeAction(\"\", action);\n}\nfunction log(msg) {\n    console.log(msg);\n    return msg;\n}\nfunction whyRun(thing, prop) {\n    switch (arguments.length) {\n        case 0:\n            thing = globalState.trackingDerivation;\n            if (!thing) return log(getMessage(\"m024\"));\n            break;\n        case 2:\n            thing = getAtom(thing, prop);\n            break;\n    }\n    thing = getAtom(thing);\n    if (isComputedValue(thing)) return log(thing.whyRun());else if (isReaction(thing)) return log(thing.whyRun());\n    return fail(getMessage(\"m025\"));\n}\nexports.whyRun = whyRun;\nfunction createAction(actionName, fn) {\n    invariant(typeof fn === \"function\", getMessage(\"m026\"));\n    invariant(typeof actionName === \"string\" && actionName.length > 0, \"actions should have valid names, got: '\" + actionName + \"'\");\n    var res = function res() {\n        return executeAction(actionName, fn, this, arguments);\n    };\n    res.originalFn = fn;\n    res.isMobxAction = true;\n    return res;\n}\nfunction executeAction(actionName, fn, scope, args) {\n    var runInfo = startAction(actionName, fn, scope, args);\n    try {\n        return fn.apply(scope, args);\n    } finally {\n        endAction(runInfo);\n    }\n}\nfunction startAction(actionName, fn, scope, args) {\n    var notifySpy = isSpyEnabled() && !!actionName;\n    var startTime = 0;\n    if (notifySpy) {\n        startTime = Date.now();\n        var l = args && args.length || 0;\n        var flattendArgs = new Array(l);\n        if (l > 0) for (var i = 0; i < l; i++) {\n            flattendArgs[i] = args[i];\n        }spyReportStart({\n            type: \"action\",\n            name: actionName,\n            fn: fn,\n            object: scope,\n            arguments: flattendArgs\n        });\n    }\n    var prevDerivation = untrackedStart();\n    startBatch();\n    var prevAllowStateChanges = allowStateChangesStart(true);\n    return {\n        prevDerivation: prevDerivation,\n        prevAllowStateChanges: prevAllowStateChanges,\n        notifySpy: notifySpy,\n        startTime: startTime\n    };\n}\nfunction endAction(runInfo) {\n    allowStateChangesEnd(runInfo.prevAllowStateChanges);\n    endBatch();\n    untrackedEnd(runInfo.prevDerivation);\n    if (runInfo.notifySpy) spyReportEnd({ time: Date.now() - runInfo.startTime });\n}\nfunction useStrict(strict) {\n    invariant(globalState.trackingDerivation === null, getMessage(\"m028\"));\n    globalState.strictMode = strict;\n    globalState.allowStateChanges = !strict;\n}\nexports.useStrict = useStrict;\nfunction isStrictModeEnabled() {\n    return globalState.strictMode;\n}\nexports.isStrictModeEnabled = isStrictModeEnabled;\nfunction allowStateChanges(allowStateChanges, func) {\n    var prev = allowStateChangesStart(allowStateChanges);\n    var res;\n    try {\n        res = func();\n    } finally {\n        allowStateChangesEnd(prev);\n    }\n    return res;\n}\nfunction allowStateChangesStart(allowStateChanges) {\n    var prev = globalState.allowStateChanges;\n    globalState.allowStateChanges = allowStateChanges;\n    return prev;\n}\nfunction allowStateChangesEnd(prev) {\n    globalState.allowStateChanges = prev;\n}\nvar BaseAtom = function () {\n    function BaseAtom(name) {\n        if (name === void 0) {\n            name = \"Atom@\" + getNextId();\n        }\n        this.name = name;\n        this.isPendingUnobservation = true;\n        this.observers = [];\n        this.observersIndexes = {};\n        this.diffValue = 0;\n        this.lastAccessedBy = 0;\n        this.lowestObserverState = IDerivationState.NOT_TRACKING;\n    }\n    BaseAtom.prototype.onBecomeUnobserved = function () {};\n    BaseAtom.prototype.reportObserved = function () {\n        reportObserved(this);\n    };\n    BaseAtom.prototype.reportChanged = function () {\n        startBatch();\n        propagateChanged(this);\n        endBatch();\n    };\n    BaseAtom.prototype.toString = function () {\n        return this.name;\n    };\n    return BaseAtom;\n}();\nexports.BaseAtom = BaseAtom;\nvar Atom = function (_super) {\n    __extends(Atom, _super);\n    function Atom(name, onBecomeObservedHandler, onBecomeUnobservedHandler) {\n        if (name === void 0) {\n            name = \"Atom@\" + getNextId();\n        }\n        if (onBecomeObservedHandler === void 0) {\n            onBecomeObservedHandler = noop;\n        }\n        if (onBecomeUnobservedHandler === void 0) {\n            onBecomeUnobservedHandler = noop;\n        }\n        var _this = _super.call(this, name) || this;\n        _this.name = name;\n        _this.onBecomeObservedHandler = onBecomeObservedHandler;\n        _this.onBecomeUnobservedHandler = onBecomeUnobservedHandler;\n        _this.isPendingUnobservation = false;\n        _this.isBeingTracked = false;\n        return _this;\n    }\n    Atom.prototype.reportObserved = function () {\n        startBatch();\n        _super.prototype.reportObserved.call(this);\n        if (!this.isBeingTracked) {\n            this.isBeingTracked = true;\n            this.onBecomeObservedHandler();\n        }\n        endBatch();\n        return !!globalState.trackingDerivation;\n    };\n    Atom.prototype.onBecomeUnobserved = function () {\n        this.isBeingTracked = false;\n        this.onBecomeUnobservedHandler();\n    };\n    return Atom;\n}(BaseAtom);\nexports.Atom = Atom;\nvar isAtom = createInstanceofPredicate(\"Atom\", BaseAtom);\nvar ComputedValue = function () {\n    function ComputedValue(derivation, scope, compareStructural, name, setter) {\n        this.derivation = derivation;\n        this.scope = scope;\n        this.compareStructural = compareStructural;\n        this.dependenciesState = IDerivationState.NOT_TRACKING;\n        this.observing = [];\n        this.newObserving = null;\n        this.isPendingUnobservation = false;\n        this.observers = [];\n        this.observersIndexes = {};\n        this.diffValue = 0;\n        this.runId = 0;\n        this.lastAccessedBy = 0;\n        this.lowestObserverState = IDerivationState.UP_TO_DATE;\n        this.unboundDepsCount = 0;\n        this.__mapid = \"#\" + getNextId();\n        this.value = undefined;\n        this.isComputing = false;\n        this.isRunningSetter = false;\n        this.name = name || \"ComputedValue@\" + getNextId();\n        if (setter) this.setter = createAction(name + \"-setter\", setter);\n    }\n    ComputedValue.prototype.onBecomeStale = function () {\n        propagateMaybeChanged(this);\n    };\n    ComputedValue.prototype.onBecomeUnobserved = function () {\n        invariant(this.dependenciesState !== IDerivationState.NOT_TRACKING, getMessage(\"m029\"));\n        clearObserving(this);\n        this.value = undefined;\n    };\n    ComputedValue.prototype.get = function () {\n        invariant(!this.isComputing, \"Cycle detected in computation \" + this.name, this.derivation);\n        if (globalState.inBatch === 0) {\n            startBatch();\n            if (shouldCompute(this)) this.value = this.computeValue(false);\n            endBatch();\n        } else {\n            reportObserved(this);\n            if (shouldCompute(this)) if (this.trackAndCompute()) propagateChangeConfirmed(this);\n        }\n        var result = this.value;\n        if (isCaughtException(result)) throw result.cause;\n        return result;\n    };\n    ComputedValue.prototype.peek = function () {\n        var res = this.computeValue(false);\n        if (isCaughtException(res)) throw res.cause;\n        return res;\n    };\n    ComputedValue.prototype.set = function (value) {\n        if (this.setter) {\n            invariant(!this.isRunningSetter, \"The setter of computed value '\" + this.name + \"' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?\");\n            this.isRunningSetter = true;\n            try {\n                this.setter.call(this.scope, value);\n            } finally {\n                this.isRunningSetter = false;\n            }\n        } else invariant(false, \"[ComputedValue '\" + this.name + \"'] It is not possible to assign a new value to a computed value.\");\n    };\n    ComputedValue.prototype.trackAndCompute = function () {\n        if (isSpyEnabled()) {\n            spyReport({\n                object: this.scope,\n                type: \"compute\",\n                fn: this.derivation\n            });\n        }\n        var oldValue = this.value;\n        var newValue = this.value = this.computeValue(true);\n        return isCaughtException(newValue) || valueDidChange(this.compareStructural, newValue, oldValue);\n    };\n    ComputedValue.prototype.computeValue = function (track) {\n        this.isComputing = true;\n        globalState.computationDepth++;\n        var res;\n        if (track) {\n            res = trackDerivedFunction(this, this.derivation, this.scope);\n        } else {\n            try {\n                res = this.derivation.call(this.scope);\n            } catch (e) {\n                res = new CaughtException(e);\n            }\n        }\n        globalState.computationDepth--;\n        this.isComputing = false;\n        return res;\n    };\n    ;\n    ComputedValue.prototype.observe = function (listener, fireImmediately) {\n        var _this = this;\n        var firstTime = true;\n        var prevValue = undefined;\n        return autorun(function () {\n            var newValue = _this.get();\n            if (!firstTime || fireImmediately) {\n                var prevU = untrackedStart();\n                listener({\n                    type: \"update\",\n                    object: _this,\n                    newValue: newValue,\n                    oldValue: prevValue\n                });\n                untrackedEnd(prevU);\n            }\n            firstTime = false;\n            prevValue = newValue;\n        });\n    };\n    ComputedValue.prototype.toJSON = function () {\n        return this.get();\n    };\n    ComputedValue.prototype.toString = function () {\n        return this.name + \"[\" + this.derivation.toString() + \"]\";\n    };\n    ComputedValue.prototype.valueOf = function () {\n        return toPrimitive(this.get());\n    };\n    ;\n    ComputedValue.prototype.whyRun = function () {\n        var isTracking = Boolean(globalState.trackingDerivation);\n        var observing = unique(this.isComputing ? this.newObserving : this.observing).map(function (dep) {\n            return dep.name;\n        });\n        var observers = unique(getObservers(this).map(function (dep) {\n            return dep.name;\n        }));\n        return \"\\nWhyRun? computation '\" + this.name + \"':\\n * Running because: \" + (isTracking ? \"[active] the value of this computation is needed by a reaction\" : this.isComputing ? \"[get] The value of this computed was requested outside a reaction\" : \"[idle] not running at the moment\") + \"\\n\" + (this.dependenciesState === IDerivationState.NOT_TRACKING ? getMessage(\"m032\") : \" * This computation will re-run if any of the following observables changes:\\n    \" + joinStrings(observing) + \"\\n    \" + (this.isComputing && isTracking ? \" (... or any observable accessed during the remainder of the current run)\" : \"\") + \"\\n\\t\" + getMessage(\"m038\") + \"\\n\\n  * If the outcome of this computation changes, the following observers will be re-run:\\n    \" + joinStrings(observers) + \"\\n\");\n    };\n    return ComputedValue;\n}();\nComputedValue.prototype[primitiveSymbol()] = ComputedValue.prototype.valueOf;\nvar isComputedValue = createInstanceofPredicate(\"ComputedValue\", ComputedValue);\nvar IDerivationState;\n(function (IDerivationState) {\n    IDerivationState[IDerivationState[\"NOT_TRACKING\"] = -1] = \"NOT_TRACKING\";\n    IDerivationState[IDerivationState[\"UP_TO_DATE\"] = 0] = \"UP_TO_DATE\";\n    IDerivationState[IDerivationState[\"POSSIBLY_STALE\"] = 1] = \"POSSIBLY_STALE\";\n    IDerivationState[IDerivationState[\"STALE\"] = 2] = \"STALE\";\n})(IDerivationState || (IDerivationState = {}));\nexports.IDerivationState = IDerivationState;\nvar CaughtException = function () {\n    function CaughtException(cause) {\n        this.cause = cause;\n    }\n    return CaughtException;\n}();\nfunction isCaughtException(e) {\n    return e instanceof CaughtException;\n}\nfunction shouldCompute(derivation) {\n    switch (derivation.dependenciesState) {\n        case IDerivationState.UP_TO_DATE:\n            return false;\n        case IDerivationState.NOT_TRACKING:\n        case IDerivationState.STALE:\n            return true;\n        case IDerivationState.POSSIBLY_STALE:\n            {\n                var prevUntracked = untrackedStart();\n                var obs = derivation.observing,\n                    l = obs.length;\n                for (var i = 0; i < l; i++) {\n                    var obj = obs[i];\n                    if (isComputedValue(obj)) {\n                        try {\n                            obj.get();\n                        } catch (e) {\n                            untrackedEnd(prevUntracked);\n                            return true;\n                        }\n                        if (derivation.dependenciesState === IDerivationState.STALE) {\n                            untrackedEnd(prevUntracked);\n                            return true;\n                        }\n                    }\n                }\n                changeDependenciesStateTo0(derivation);\n                untrackedEnd(prevUntracked);\n                return false;\n            }\n    }\n}\nfunction isComputingDerivation() {\n    return globalState.trackingDerivation !== null;\n}\nfunction checkIfStateModificationsAreAllowed(atom) {\n    var hasObservers = atom.observers.length > 0;\n    if (globalState.computationDepth > 0 && hasObservers) fail(getMessage(\"m031\") + atom.name);\n    if (!globalState.allowStateChanges && hasObservers) fail(getMessage(globalState.strictMode ? \"m030a\" : \"m030b\") + atom.name);\n}\nfunction trackDerivedFunction(derivation, f, context) {\n    changeDependenciesStateTo0(derivation);\n    derivation.newObserving = new Array(derivation.observing.length + 100);\n    derivation.unboundDepsCount = 0;\n    derivation.runId = ++globalState.runId;\n    var prevTracking = globalState.trackingDerivation;\n    globalState.trackingDerivation = derivation;\n    var result;\n    try {\n        result = f.call(context);\n    } catch (e) {\n        result = new CaughtException(e);\n    }\n    globalState.trackingDerivation = prevTracking;\n    bindDependencies(derivation);\n    return result;\n}\nfunction bindDependencies(derivation) {\n    var prevObserving = derivation.observing;\n    var observing = derivation.observing = derivation.newObserving;\n    derivation.newObserving = null;\n    var i0 = 0,\n        l = derivation.unboundDepsCount;\n    for (var i = 0; i < l; i++) {\n        var dep = observing[i];\n        if (dep.diffValue === 0) {\n            dep.diffValue = 1;\n            if (i0 !== i) observing[i0] = dep;\n            i0++;\n        }\n    }\n    observing.length = i0;\n    l = prevObserving.length;\n    while (l--) {\n        var dep = prevObserving[l];\n        if (dep.diffValue === 0) {\n            removeObserver(dep, derivation);\n        }\n        dep.diffValue = 0;\n    }\n    while (i0--) {\n        var dep = observing[i0];\n        if (dep.diffValue === 1) {\n            dep.diffValue = 0;\n            addObserver(dep, derivation);\n        }\n    }\n}\nfunction clearObserving(derivation) {\n    var obs = derivation.observing;\n    var i = obs.length;\n    while (i--) {\n        removeObserver(obs[i], derivation);\n    }derivation.dependenciesState = IDerivationState.NOT_TRACKING;\n    obs.length = 0;\n}\nfunction untracked(action) {\n    var prev = untrackedStart();\n    var res = action();\n    untrackedEnd(prev);\n    return res;\n}\nexports.untracked = untracked;\nfunction untrackedStart() {\n    var prev = globalState.trackingDerivation;\n    globalState.trackingDerivation = null;\n    return prev;\n}\nfunction untrackedEnd(prev) {\n    globalState.trackingDerivation = prev;\n}\nfunction changeDependenciesStateTo0(derivation) {\n    if (derivation.dependenciesState === IDerivationState.UP_TO_DATE) return;\n    derivation.dependenciesState = IDerivationState.UP_TO_DATE;\n    var obs = derivation.observing;\n    var i = obs.length;\n    while (i--) {\n        obs[i].lowestObserverState = IDerivationState.UP_TO_DATE;\n    }\n}\nvar persistentKeys = [\"mobxGuid\", \"resetId\", \"spyListeners\", \"strictMode\", \"runId\"];\nvar MobXGlobals = function () {\n    function MobXGlobals() {\n        this.version = 5;\n        this.trackingDerivation = null;\n        this.computationDepth = 0;\n        this.runId = 0;\n        this.mobxGuid = 0;\n        this.inBatch = 0;\n        this.pendingUnobservations = [];\n        this.pendingReactions = [];\n        this.isRunningReactions = false;\n        this.allowStateChanges = true;\n        this.strictMode = false;\n        this.resetId = 0;\n        this.spyListeners = [];\n        this.globalReactionErrorHandlers = [];\n    }\n    return MobXGlobals;\n}();\nvar globalState = new MobXGlobals();\nfunction shareGlobalState() {\n    var global = getGlobal();\n    var ownState = globalState;\n    if (global.__mobservableTrackingStack || global.__mobservableViewStack) throw new Error(\"[mobx] An incompatible version of mobservable is already loaded.\");\n    if (global.__mobxGlobal && global.__mobxGlobal.version !== ownState.version) throw new Error(\"[mobx] An incompatible version of mobx is already loaded.\");\n    if (global.__mobxGlobal) globalState = global.__mobxGlobal;else global.__mobxGlobal = ownState;\n}\nfunction getGlobalState() {\n    return globalState;\n}\nfunction registerGlobals() {}\nfunction resetGlobalState() {\n    globalState.resetId++;\n    var defaultGlobals = new MobXGlobals();\n    for (var key in defaultGlobals) {\n        if (persistentKeys.indexOf(key) === -1) globalState[key] = defaultGlobals[key];\n    }globalState.allowStateChanges = !globalState.strictMode;\n}\nfunction hasObservers(observable) {\n    return observable.observers && observable.observers.length > 0;\n}\nfunction getObservers(observable) {\n    return observable.observers;\n}\nfunction invariantObservers(observable) {\n    var list = observable.observers;\n    var map = observable.observersIndexes;\n    var l = list.length;\n    for (var i = 0; i < l; i++) {\n        var id = list[i].__mapid;\n        if (i) {\n            invariant(map[id] === i, \"INTERNAL ERROR maps derivation.__mapid to index in list\");\n        } else {\n            invariant(!(id in map), \"INTERNAL ERROR observer on index 0 shouldnt be held in map.\");\n        }\n    }\n    invariant(list.length === 0 || Object.keys(map).length === list.length - 1, \"INTERNAL ERROR there is no junk in map\");\n}\nfunction addObserver(observable, node) {\n    var l = observable.observers.length;\n    if (l) {\n        observable.observersIndexes[node.__mapid] = l;\n    }\n    observable.observers[l] = node;\n    if (observable.lowestObserverState > node.dependenciesState) observable.lowestObserverState = node.dependenciesState;\n}\nfunction removeObserver(observable, node) {\n    if (observable.observers.length === 1) {\n        observable.observers.length = 0;\n        queueForUnobservation(observable);\n    } else {\n        var list = observable.observers;\n        var map_1 = observable.observersIndexes;\n        var filler = list.pop();\n        if (filler !== node) {\n            var index = map_1[node.__mapid] || 0;\n            if (index) {\n                map_1[filler.__mapid] = index;\n            } else {\n                delete map_1[filler.__mapid];\n            }\n            list[index] = filler;\n        }\n        delete map_1[node.__mapid];\n    }\n}\nfunction queueForUnobservation(observable) {\n    if (!observable.isPendingUnobservation) {\n        observable.isPendingUnobservation = true;\n        globalState.pendingUnobservations.push(observable);\n    }\n}\nfunction startBatch() {\n    globalState.inBatch++;\n}\nfunction endBatch() {\n    if (--globalState.inBatch === 0) {\n        runReactions();\n        var list = globalState.pendingUnobservations;\n        for (var i = 0; i < list.length; i++) {\n            var observable_1 = list[i];\n            observable_1.isPendingUnobservation = false;\n            if (observable_1.observers.length === 0) {\n                observable_1.onBecomeUnobserved();\n            }\n        }\n        globalState.pendingUnobservations = [];\n    }\n}\nfunction reportObserved(observable) {\n    var derivation = globalState.trackingDerivation;\n    if (derivation !== null) {\n        if (derivation.runId !== observable.lastAccessedBy) {\n            observable.lastAccessedBy = derivation.runId;\n            derivation.newObserving[derivation.unboundDepsCount++] = observable;\n        }\n    } else if (observable.observers.length === 0) {\n        queueForUnobservation(observable);\n    }\n}\nfunction invariantLOS(observable, msg) {\n    var min = getObservers(observable).reduce(function (a, b) {\n        return Math.min(a, b.dependenciesState);\n    }, 2);\n    if (min >= observable.lowestObserverState) return;\n    throw new Error(\"lowestObserverState is wrong for \" + msg + \" because \" + min + \" < \" + observable.lowestObserverState);\n}\nfunction propagateChanged(observable) {\n    if (observable.lowestObserverState === IDerivationState.STALE) return;\n    observable.lowestObserverState = IDerivationState.STALE;\n    var observers = observable.observers;\n    var i = observers.length;\n    while (i--) {\n        var d = observers[i];\n        if (d.dependenciesState === IDerivationState.UP_TO_DATE) d.onBecomeStale();\n        d.dependenciesState = IDerivationState.STALE;\n    }\n}\nfunction propagateChangeConfirmed(observable) {\n    if (observable.lowestObserverState === IDerivationState.STALE) return;\n    observable.lowestObserverState = IDerivationState.STALE;\n    var observers = observable.observers;\n    var i = observers.length;\n    while (i--) {\n        var d = observers[i];\n        if (d.dependenciesState === IDerivationState.POSSIBLY_STALE) d.dependenciesState = IDerivationState.STALE;else if (d.dependenciesState === IDerivationState.UP_TO_DATE) observable.lowestObserverState = IDerivationState.UP_TO_DATE;\n    }\n}\nfunction propagateMaybeChanged(observable) {\n    if (observable.lowestObserverState !== IDerivationState.UP_TO_DATE) return;\n    observable.lowestObserverState = IDerivationState.POSSIBLY_STALE;\n    var observers = observable.observers;\n    var i = observers.length;\n    while (i--) {\n        var d = observers[i];\n        if (d.dependenciesState === IDerivationState.UP_TO_DATE) {\n            d.dependenciesState = IDerivationState.POSSIBLY_STALE;\n            d.onBecomeStale();\n        }\n    }\n}\nvar Reaction = function () {\n    function Reaction(name, onInvalidate) {\n        if (name === void 0) {\n            name = \"Reaction@\" + getNextId();\n        }\n        this.name = name;\n        this.onInvalidate = onInvalidate;\n        this.observing = [];\n        this.newObserving = [];\n        this.dependenciesState = IDerivationState.NOT_TRACKING;\n        this.diffValue = 0;\n        this.runId = 0;\n        this.unboundDepsCount = 0;\n        this.__mapid = \"#\" + getNextId();\n        this.isDisposed = false;\n        this._isScheduled = false;\n        this._isTrackPending = false;\n        this._isRunning = false;\n    }\n    Reaction.prototype.onBecomeStale = function () {\n        this.schedule();\n    };\n    Reaction.prototype.schedule = function () {\n        if (!this._isScheduled) {\n            this._isScheduled = true;\n            globalState.pendingReactions.push(this);\n            runReactions();\n        }\n    };\n    Reaction.prototype.isScheduled = function () {\n        return this._isScheduled;\n    };\n    Reaction.prototype.runReaction = function () {\n        if (!this.isDisposed) {\n            startBatch();\n            this._isScheduled = false;\n            if (shouldCompute(this)) {\n                this._isTrackPending = true;\n                this.onInvalidate();\n                if (this._isTrackPending && isSpyEnabled()) {\n                    spyReport({\n                        object: this,\n                        type: \"scheduled-reaction\"\n                    });\n                }\n            }\n            endBatch();\n        }\n    };\n    Reaction.prototype.track = function (fn) {\n        startBatch();\n        var notify = isSpyEnabled();\n        var startTime;\n        if (notify) {\n            startTime = Date.now();\n            spyReportStart({\n                object: this,\n                type: \"reaction\",\n                fn: fn\n            });\n        }\n        this._isRunning = true;\n        var result = trackDerivedFunction(this, fn, undefined);\n        this._isRunning = false;\n        this._isTrackPending = false;\n        if (this.isDisposed) {\n            clearObserving(this);\n        }\n        if (isCaughtException(result)) this.reportExceptionInDerivation(result.cause);\n        if (notify) {\n            spyReportEnd({\n                time: Date.now() - startTime\n            });\n        }\n        endBatch();\n    };\n    Reaction.prototype.reportExceptionInDerivation = function (error) {\n        var _this = this;\n        if (this.errorHandler) {\n            this.errorHandler(error, this);\n            return;\n        }\n        var message = \"[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '\" + this;\n        var messageToUser = getMessage(\"m037\");\n        console.error(message || messageToUser, error);\n        if (isSpyEnabled()) {\n            spyReport({\n                type: \"error\",\n                message: message,\n                error: error,\n                object: this\n            });\n        }\n        globalState.globalReactionErrorHandlers.forEach(function (f) {\n            return f(error, _this);\n        });\n    };\n    Reaction.prototype.dispose = function () {\n        if (!this.isDisposed) {\n            this.isDisposed = true;\n            if (!this._isRunning) {\n                startBatch();\n                clearObserving(this);\n                endBatch();\n            }\n        }\n    };\n    Reaction.prototype.getDisposer = function () {\n        var r = this.dispose.bind(this);\n        r.$mobx = this;\n        r.onError = registerErrorHandler;\n        return r;\n    };\n    Reaction.prototype.toString = function () {\n        return \"Reaction[\" + this.name + \"]\";\n    };\n    Reaction.prototype.whyRun = function () {\n        var observing = unique(this._isRunning ? this.newObserving : this.observing).map(function (dep) {\n            return dep.name;\n        });\n        return \"\\nWhyRun? reaction '\" + this.name + \"':\\n * Status: [\" + (this.isDisposed ? \"stopped\" : this._isRunning ? \"running\" : this.isScheduled() ? \"scheduled\" : \"idle\") + \"]\\n * This reaction will re-run if any of the following observables changes:\\n    \" + joinStrings(observing) + \"\\n    \" + (this._isRunning ? \" (... or any observable accessed during the remainder of the current run)\" : \"\") + \"\\n\\t\" + getMessage(\"m038\") + \"\\n\";\n    };\n    return Reaction;\n}();\nexports.Reaction = Reaction;\nfunction registerErrorHandler(handler) {\n    invariant(this && this.$mobx && isReaction(this.$mobx), \"Invalid `this`\");\n    invariant(!this.$mobx.errorHandler, \"Only one onErrorHandler can be registered\");\n    this.$mobx.errorHandler = handler;\n}\nfunction onReactionError(handler) {\n    globalState.globalReactionErrorHandlers.push(handler);\n    return function () {\n        var idx = globalState.globalReactionErrorHandlers.indexOf(handler);\n        if (idx >= 0) globalState.globalReactionErrorHandlers.splice(idx, 1);\n    };\n}\nvar MAX_REACTION_ITERATIONS = 100;\nvar reactionScheduler = function reactionScheduler(f) {\n    return f();\n};\nfunction runReactions() {\n    if (globalState.inBatch > 0 || globalState.isRunningReactions) return;\n    reactionScheduler(runReactionsHelper);\n}\nfunction runReactionsHelper() {\n    globalState.isRunningReactions = true;\n    var allReactions = globalState.pendingReactions;\n    var iterations = 0;\n    while (allReactions.length > 0) {\n        if (++iterations === MAX_REACTION_ITERATIONS) {\n            console.error(\"Reaction doesn't converge to a stable state after \" + MAX_REACTION_ITERATIONS + \" iterations.\" + (\" Probably there is a cycle in the reactive function: \" + allReactions[0]));\n            allReactions.splice(0);\n        }\n        var remainingReactions = allReactions.splice(0);\n        for (var i = 0, l = remainingReactions.length; i < l; i++) {\n            remainingReactions[i].runReaction();\n        }\n    }\n    globalState.isRunningReactions = false;\n}\nvar isReaction = createInstanceofPredicate(\"Reaction\", Reaction);\nfunction setReactionScheduler(fn) {\n    var baseScheduler = reactionScheduler;\n    reactionScheduler = function reactionScheduler(f) {\n        return fn(function () {\n            return baseScheduler(f);\n        });\n    };\n}\nfunction isSpyEnabled() {\n    return !!globalState.spyListeners.length;\n}\nfunction spyReport(event) {\n    if (!globalState.spyListeners.length) return;\n    var listeners = globalState.spyListeners;\n    for (var i = 0, l = listeners.length; i < l; i++) {\n        listeners[i](event);\n    }\n}\nfunction spyReportStart(event) {\n    var change = objectAssign({}, event, { spyReportStart: true });\n    spyReport(change);\n}\nvar END_EVENT = { spyReportEnd: true };\nfunction spyReportEnd(change) {\n    if (change) spyReport(objectAssign({}, change, END_EVENT));else spyReport(END_EVENT);\n}\nfunction spy(listener) {\n    globalState.spyListeners.push(listener);\n    return once(function () {\n        var idx = globalState.spyListeners.indexOf(listener);\n        if (idx !== -1) globalState.spyListeners.splice(idx, 1);\n    });\n}\nexports.spy = spy;\nfunction hasInterceptors(interceptable) {\n    return interceptable.interceptors && interceptable.interceptors.length > 0;\n}\nfunction registerInterceptor(interceptable, handler) {\n    var interceptors = interceptable.interceptors || (interceptable.interceptors = []);\n    interceptors.push(handler);\n    return once(function () {\n        var idx = interceptors.indexOf(handler);\n        if (idx !== -1) interceptors.splice(idx, 1);\n    });\n}\nfunction interceptChange(interceptable, change) {\n    var prevU = untrackedStart();\n    try {\n        var interceptors = interceptable.interceptors;\n        if (interceptors) for (var i = 0, l = interceptors.length; i < l; i++) {\n            change = interceptors[i](change);\n            invariant(!change || change.type, \"Intercept handlers should return nothing or a change object\");\n            if (!change) break;\n        }\n        return change;\n    } finally {\n        untrackedEnd(prevU);\n    }\n}\nfunction hasListeners(listenable) {\n    return listenable.changeListeners && listenable.changeListeners.length > 0;\n}\nfunction registerListener(listenable, handler) {\n    var listeners = listenable.changeListeners || (listenable.changeListeners = []);\n    listeners.push(handler);\n    return once(function () {\n        var idx = listeners.indexOf(handler);\n        if (idx !== -1) listeners.splice(idx, 1);\n    });\n}\nfunction notifyListeners(listenable, change) {\n    var prevU = untrackedStart();\n    var listeners = listenable.changeListeners;\n    if (!listeners) return;\n    listeners = listeners.slice();\n    for (var i = 0, l = listeners.length; i < l; i++) {\n        listeners[i](change);\n    }\n    untrackedEnd(prevU);\n}\nfunction asReference(value) {\n    deprecated(\"asReference is deprecated, use observable.ref instead\");\n    return observable.ref(value);\n}\nexports.asReference = asReference;\nfunction asStructure(value) {\n    deprecated(\"asStructure is deprecated. Use observable.struct, computed.struct or reaction options instead.\");\n    return observable.struct(value);\n}\nexports.asStructure = asStructure;\nfunction asFlat(value) {\n    deprecated(\"asFlat is deprecated, use observable.shallow instead\");\n    return observable.shallow(value);\n}\nexports.asFlat = asFlat;\nfunction asMap(data) {\n    deprecated(\"asMap is deprecated, use observable.map or observable.shallowMap instead\");\n    return observable.map(data || {});\n}\nexports.asMap = asMap;\nfunction isModifierDescriptor(thing) {\n    return (typeof thing === \"undefined\" ? \"undefined\" : _typeof(thing)) === \"object\" && thing !== null && thing.isMobxModifierDescriptor === true;\n}\nexports.isModifierDescriptor = isModifierDescriptor;\nfunction createModifierDescriptor(enhancer, initialValue) {\n    invariant(!isModifierDescriptor(initialValue), \"Modifiers cannot be nested\");\n    return {\n        isMobxModifierDescriptor: true,\n        initialValue: initialValue,\n        enhancer: enhancer\n    };\n}\nfunction deepEnhancer(v, _, name) {\n    if (isModifierDescriptor(v)) fail(\"You tried to assign a modifier wrapped value to a collection, please define modifiers when creating the collection, not when modifying it\");\n    if (isObservable(v)) return v;\n    if (Array.isArray(v)) return observable.array(v, name);\n    if (isPlainObject(v)) return observable.object(v, name);\n    if (isES6Map(v)) return observable.map(v, name);\n    return v;\n}\nfunction shallowEnhancer(v, _, name) {\n    if (isModifierDescriptor(v)) fail(\"You tried to assign a modifier wrapped value to a collection, please define modifiers when creating the collection, not when modifying it\");\n    if (v === undefined || v === null) return v;\n    if (isObservableObject(v) || isObservableArray(v) || isObservableMap(v)) return v;\n    if (Array.isArray(v)) return observable.shallowArray(v, name);\n    if (isPlainObject(v)) return observable.shallowObject(v, name);\n    if (isES6Map(v)) return observable.shallowMap(v, name);\n    return fail(\"The shallow modifier / decorator can only used in combination with arrays, objects and maps\");\n}\nfunction referenceEnhancer(newValue) {\n    return newValue;\n}\nfunction deepStructEnhancer(v, oldValue, name) {\n    if (deepEqual(v, oldValue)) return oldValue;\n    if (isObservable(v)) return v;\n    if (Array.isArray(v)) return new ObservableArray(v, deepStructEnhancer, name);\n    if (isES6Map(v)) return new ObservableMap(v, deepStructEnhancer, name);\n    if (isPlainObject(v)) {\n        var res = {};\n        asObservableObject(res, name);\n        extendObservableHelper(res, deepStructEnhancer, [v]);\n        return res;\n    }\n    return v;\n}\nfunction refStructEnhancer(v, oldValue, name) {\n    if (deepEqual(v, oldValue)) return oldValue;\n    return v;\n}\nvar MAX_SPLICE_SIZE = 10000;\nvar safariPrototypeSetterInheritanceBug = function () {\n    var v = false;\n    var p = {};\n    Object.defineProperty(p, \"0\", { set: function set() {\n            v = true;\n        } });\n    Object.create(p)[\"0\"] = 1;\n    return v === false;\n}();\nvar OBSERVABLE_ARRAY_BUFFER_SIZE = 0;\nvar StubArray = function () {\n    function StubArray() {}\n    return StubArray;\n}();\nStubArray.prototype = [];\nvar ObservableArrayAdministration = function () {\n    function ObservableArrayAdministration(name, enhancer, array, owned) {\n        this.array = array;\n        this.owned = owned;\n        this.lastKnownLength = 0;\n        this.interceptors = null;\n        this.changeListeners = null;\n        this.atom = new BaseAtom(name || \"ObservableArray@\" + getNextId());\n        this.enhancer = function (newV, oldV) {\n            return enhancer(newV, oldV, name + \"[..]\");\n        };\n    }\n    ObservableArrayAdministration.prototype.intercept = function (handler) {\n        return registerInterceptor(this, handler);\n    };\n    ObservableArrayAdministration.prototype.observe = function (listener, fireImmediately) {\n        if (fireImmediately === void 0) {\n            fireImmediately = false;\n        }\n        if (fireImmediately) {\n            listener({\n                object: this.array,\n                type: \"splice\",\n                index: 0,\n                added: this.values.slice(),\n                addedCount: this.values.length,\n                removed: [],\n                removedCount: 0\n            });\n        }\n        return registerListener(this, listener);\n    };\n    ObservableArrayAdministration.prototype.getArrayLength = function () {\n        this.atom.reportObserved();\n        return this.values.length;\n    };\n    ObservableArrayAdministration.prototype.setArrayLength = function (newLength) {\n        if (typeof newLength !== \"number\" || newLength < 0) throw new Error(\"[mobx.array] Out of range: \" + newLength);\n        var currentLength = this.values.length;\n        if (newLength === currentLength) return;else if (newLength > currentLength) {\n            var newItems = new Array(newLength - currentLength);\n            for (var i = 0; i < newLength - currentLength; i++) {\n                newItems[i] = undefined;\n            }this.spliceWithArray(currentLength, 0, newItems);\n        } else this.spliceWithArray(newLength, currentLength - newLength);\n    };\n    ObservableArrayAdministration.prototype.updateArrayLength = function (oldLength, delta) {\n        if (oldLength !== this.lastKnownLength) throw new Error(\"[mobx] Modification exception: the internal structure of an observable array was changed. Did you use peek() to change it?\");\n        this.lastKnownLength += delta;\n        if (delta > 0 && oldLength + delta + 1 > OBSERVABLE_ARRAY_BUFFER_SIZE) reserveArrayBuffer(oldLength + delta + 1);\n    };\n    ObservableArrayAdministration.prototype.spliceWithArray = function (index, deleteCount, newItems) {\n        var _this = this;\n        checkIfStateModificationsAreAllowed(this.atom);\n        var length = this.values.length;\n        if (index === undefined) index = 0;else if (index > length) index = length;else if (index < 0) index = Math.max(0, length + index);\n        if (arguments.length === 1) deleteCount = length - index;else if (deleteCount === undefined || deleteCount === null) deleteCount = 0;else deleteCount = Math.max(0, Math.min(deleteCount, length - index));\n        if (newItems === undefined) newItems = [];\n        if (hasInterceptors(this)) {\n            var change = interceptChange(this, {\n                object: this.array,\n                type: \"splice\",\n                index: index,\n                removedCount: deleteCount,\n                added: newItems\n            });\n            if (!change) return EMPTY_ARRAY;\n            deleteCount = change.removedCount;\n            newItems = change.added;\n        }\n        newItems = newItems.map(function (v) {\n            return _this.enhancer(v, undefined);\n        });\n        var lengthDelta = newItems.length - deleteCount;\n        this.updateArrayLength(length, lengthDelta);\n        var res = this.spliceItemsIntoValues(index, deleteCount, newItems);\n        if (deleteCount !== 0 || newItems.length !== 0) this.notifyArraySplice(index, newItems, res);\n        return res;\n    };\n    ObservableArrayAdministration.prototype.spliceItemsIntoValues = function (index, deleteCount, newItems) {\n        if (newItems.length < MAX_SPLICE_SIZE) {\n            return (_a = this.values).splice.apply(_a, [index, deleteCount].concat(newItems));\n        } else {\n            var res = this.values.slice(index, index + deleteCount);\n            this.values = this.values.slice(0, index).concat(newItems, this.values.slice(index + deleteCount));\n            return res;\n        }\n        var _a;\n    };\n    ObservableArrayAdministration.prototype.notifyArrayChildUpdate = function (index, newValue, oldValue) {\n        var notifySpy = !this.owned && isSpyEnabled();\n        var notify = hasListeners(this);\n        var change = notify || notifySpy ? {\n            object: this.array,\n            type: \"update\",\n            index: index, newValue: newValue, oldValue: oldValue\n        } : null;\n        if (notifySpy) spyReportStart(change);\n        this.atom.reportChanged();\n        if (notify) notifyListeners(this, change);\n        if (notifySpy) spyReportEnd();\n    };\n    ObservableArrayAdministration.prototype.notifyArraySplice = function (index, added, removed) {\n        var notifySpy = !this.owned && isSpyEnabled();\n        var notify = hasListeners(this);\n        var change = notify || notifySpy ? {\n            object: this.array,\n            type: \"splice\",\n            index: index, removed: removed, added: added,\n            removedCount: removed.length,\n            addedCount: added.length\n        } : null;\n        if (notifySpy) spyReportStart(change);\n        this.atom.reportChanged();\n        if (notify) notifyListeners(this, change);\n        if (notifySpy) spyReportEnd();\n    };\n    return ObservableArrayAdministration;\n}();\nvar ObservableArray = function (_super) {\n    __extends(ObservableArray, _super);\n    function ObservableArray(initialValues, enhancer, name, owned) {\n        if (name === void 0) {\n            name = \"ObservableArray@\" + getNextId();\n        }\n        if (owned === void 0) {\n            owned = false;\n        }\n        var _this = _super.call(this) || this;\n        var adm = new ObservableArrayAdministration(name, enhancer, _this, owned);\n        addHiddenFinalProp(_this, \"$mobx\", adm);\n        if (initialValues && initialValues.length) {\n            adm.updateArrayLength(0, initialValues.length);\n            adm.values = initialValues.map(function (v) {\n                return enhancer(v, undefined, name + \"[..]\");\n            });\n            adm.notifyArraySplice(0, adm.values.slice(), EMPTY_ARRAY);\n        } else {\n            adm.values = [];\n        }\n        if (safariPrototypeSetterInheritanceBug) {\n            Object.defineProperty(adm.array, \"0\", ENTRY_0);\n        }\n        return _this;\n    }\n    ObservableArray.prototype.intercept = function (handler) {\n        return this.$mobx.intercept(handler);\n    };\n    ObservableArray.prototype.observe = function (listener, fireImmediately) {\n        if (fireImmediately === void 0) {\n            fireImmediately = false;\n        }\n        return this.$mobx.observe(listener, fireImmediately);\n    };\n    ObservableArray.prototype.clear = function () {\n        return this.splice(0);\n    };\n    ObservableArray.prototype.concat = function () {\n        var arrays = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            arrays[_i] = arguments[_i];\n        }\n        this.$mobx.atom.reportObserved();\n        return Array.prototype.concat.apply(this.peek(), arrays.map(function (a) {\n            return isObservableArray(a) ? a.peek() : a;\n        }));\n    };\n    ObservableArray.prototype.replace = function (newItems) {\n        return this.$mobx.spliceWithArray(0, this.$mobx.values.length, newItems);\n    };\n    ObservableArray.prototype.toJS = function () {\n        return this.slice();\n    };\n    ObservableArray.prototype.toJSON = function () {\n        return this.toJS();\n    };\n    ObservableArray.prototype.peek = function () {\n        return this.$mobx.values;\n    };\n    ObservableArray.prototype.find = function (predicate, thisArg, fromIndex) {\n        if (fromIndex === void 0) {\n            fromIndex = 0;\n        }\n        this.$mobx.atom.reportObserved();\n        var items = this.$mobx.values,\n            l = items.length;\n        for (var i = fromIndex; i < l; i++) {\n            if (predicate.call(thisArg, items[i], i, this)) return items[i];\n        }return undefined;\n    };\n    ObservableArray.prototype.splice = function (index, deleteCount) {\n        var newItems = [];\n        for (var _i = 2; _i < arguments.length; _i++) {\n            newItems[_i - 2] = arguments[_i];\n        }\n        switch (arguments.length) {\n            case 0:\n                return [];\n            case 1:\n                return this.$mobx.spliceWithArray(index);\n            case 2:\n                return this.$mobx.spliceWithArray(index, deleteCount);\n        }\n        return this.$mobx.spliceWithArray(index, deleteCount, newItems);\n    };\n    ObservableArray.prototype.spliceWithArray = function (index, deleteCount, newItems) {\n        return this.$mobx.spliceWithArray(index, deleteCount, newItems);\n    };\n    ObservableArray.prototype.push = function () {\n        var items = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            items[_i] = arguments[_i];\n        }\n        var adm = this.$mobx;\n        adm.spliceWithArray(adm.values.length, 0, items);\n        return adm.values.length;\n    };\n    ObservableArray.prototype.pop = function () {\n        return this.splice(Math.max(this.$mobx.values.length - 1, 0), 1)[0];\n    };\n    ObservableArray.prototype.shift = function () {\n        return this.splice(0, 1)[0];\n    };\n    ObservableArray.prototype.unshift = function () {\n        var items = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            items[_i] = arguments[_i];\n        }\n        var adm = this.$mobx;\n        adm.spliceWithArray(0, 0, items);\n        return adm.values.length;\n    };\n    ObservableArray.prototype.reverse = function () {\n        this.$mobx.atom.reportObserved();\n        var clone = this.slice();\n        return clone.reverse.apply(clone, arguments);\n    };\n    ObservableArray.prototype.sort = function (compareFn) {\n        this.$mobx.atom.reportObserved();\n        var clone = this.slice();\n        return clone.sort.apply(clone, arguments);\n    };\n    ObservableArray.prototype.remove = function (value) {\n        var idx = this.$mobx.values.indexOf(value);\n        if (idx > -1) {\n            this.splice(idx, 1);\n            return true;\n        }\n        return false;\n    };\n    ObservableArray.prototype.move = function (fromIndex, toIndex) {\n        function checkIndex(index) {\n            if (index < 0) {\n                throw new Error(\"[mobx.array] Index out of bounds: \" + index + \" is negative\");\n            }\n            var length = this.$mobx.values.length;\n            if (index >= length) {\n                throw new Error(\"[mobx.array] Index out of bounds: \" + index + \" is not smaller than \" + length);\n            }\n        }\n        checkIndex.call(this, fromIndex);\n        checkIndex.call(this, toIndex);\n        if (fromIndex === toIndex) {\n            return;\n        }\n        var oldItems = this.$mobx.values;\n        var newItems;\n        if (fromIndex < toIndex) {\n            newItems = oldItems.slice(0, fromIndex).concat(oldItems.slice(fromIndex + 1, toIndex + 1), [oldItems[fromIndex]], oldItems.slice(toIndex + 1));\n        } else {\n            newItems = oldItems.slice(0, toIndex).concat([oldItems[fromIndex]], oldItems.slice(toIndex, fromIndex), oldItems.slice(fromIndex + 1));\n        }\n        this.replace(newItems);\n    };\n    ObservableArray.prototype.toString = function () {\n        this.$mobx.atom.reportObserved();\n        return Array.prototype.toString.apply(this.$mobx.values, arguments);\n    };\n    ObservableArray.prototype.toLocaleString = function () {\n        this.$mobx.atom.reportObserved();\n        return Array.prototype.toLocaleString.apply(this.$mobx.values, arguments);\n    };\n    return ObservableArray;\n}(StubArray);\ndeclareIterator(ObservableArray.prototype, function () {\n    return arrayAsIterator(this.slice());\n});\nmakeNonEnumerable(ObservableArray.prototype, [\"constructor\", \"intercept\", \"observe\", \"clear\", \"concat\", \"replace\", \"toJS\", \"toJSON\", \"peek\", \"find\", \"splice\", \"spliceWithArray\", \"push\", \"pop\", \"shift\", \"unshift\", \"reverse\", \"sort\", \"remove\", \"move\", \"toString\", \"toLocaleString\"]);\nObject.defineProperty(ObservableArray.prototype, \"length\", {\n    enumerable: false,\n    configurable: true,\n    get: function get() {\n        return this.$mobx.getArrayLength();\n    },\n    set: function set(newLength) {\n        this.$mobx.setArrayLength(newLength);\n    }\n});\n[\"every\", \"filter\", \"forEach\", \"indexOf\", \"join\", \"lastIndexOf\", \"map\", \"reduce\", \"reduceRight\", \"slice\", \"some\"].forEach(function (funcName) {\n    var baseFunc = Array.prototype[funcName];\n    invariant(typeof baseFunc === \"function\", \"Base function not defined on Array prototype: '\" + funcName + \"'\");\n    addHiddenProp(ObservableArray.prototype, funcName, function () {\n        this.$mobx.atom.reportObserved();\n        return baseFunc.apply(this.$mobx.values, arguments);\n    });\n});\nvar ENTRY_0 = {\n    configurable: true,\n    enumerable: false,\n    set: createArraySetter(0),\n    get: createArrayGetter(0)\n};\nfunction createArrayBufferItem(index) {\n    var set = createArraySetter(index);\n    var get = createArrayGetter(index);\n    Object.defineProperty(ObservableArray.prototype, \"\" + index, {\n        enumerable: false,\n        configurable: true,\n        set: set, get: get\n    });\n}\nfunction createArraySetter(index) {\n    return function (newValue) {\n        var adm = this.$mobx;\n        var values = adm.values;\n        if (index < values.length) {\n            checkIfStateModificationsAreAllowed(adm.atom);\n            var oldValue = values[index];\n            if (hasInterceptors(adm)) {\n                var change = interceptChange(adm, {\n                    type: \"update\",\n                    object: adm.array,\n                    index: index, newValue: newValue\n                });\n                if (!change) return;\n                newValue = change.newValue;\n            }\n            newValue = adm.enhancer(newValue, oldValue);\n            var changed = newValue !== oldValue;\n            if (changed) {\n                values[index] = newValue;\n                adm.notifyArrayChildUpdate(index, newValue, oldValue);\n            }\n        } else if (index === values.length) {\n            adm.spliceWithArray(index, 0, [newValue]);\n        } else throw new Error(\"[mobx.array] Index out of bounds, \" + index + \" is larger than \" + values.length);\n    };\n}\nfunction createArrayGetter(index) {\n    return function () {\n        var impl = this.$mobx;\n        if (impl) {\n            if (index < impl.values.length) {\n                impl.atom.reportObserved();\n                return impl.values[index];\n            }\n            console.warn(\"[mobx.array] Attempt to read an array index (\" + index + \") that is out of bounds (\" + impl.values.length + \"). Please check length first. Out of bound indices will not be tracked by MobX\");\n        }\n        return undefined;\n    };\n}\nfunction reserveArrayBuffer(max) {\n    for (var index = OBSERVABLE_ARRAY_BUFFER_SIZE; index < max; index++) {\n        createArrayBufferItem(index);\n    }OBSERVABLE_ARRAY_BUFFER_SIZE = max;\n}\nreserveArrayBuffer(1000);\nvar isObservableArrayAdministration = createInstanceofPredicate(\"ObservableArrayAdministration\", ObservableArrayAdministration);\nfunction isObservableArray(thing) {\n    return isObject(thing) && isObservableArrayAdministration(thing.$mobx);\n}\nexports.isObservableArray = isObservableArray;\nvar ObservableMapMarker = {};\nvar ObservableMap = function () {\n    function ObservableMap(initialData, enhancer, name) {\n        if (enhancer === void 0) {\n            enhancer = deepEnhancer;\n        }\n        if (name === void 0) {\n            name = \"ObservableMap@\" + getNextId();\n        }\n        this.enhancer = enhancer;\n        this.name = name;\n        this.$mobx = ObservableMapMarker;\n        this._data = {};\n        this._hasMap = {};\n        this._keys = new ObservableArray(undefined, referenceEnhancer, this.name + \".keys()\", true);\n        this.interceptors = null;\n        this.changeListeners = null;\n        this.merge(initialData);\n    }\n    ObservableMap.prototype._has = function (key) {\n        return typeof this._data[key] !== \"undefined\";\n    };\n    ObservableMap.prototype.has = function (key) {\n        if (!this.isValidKey(key)) return false;\n        key = \"\" + key;\n        if (this._hasMap[key]) return this._hasMap[key].get();\n        return this._updateHasMapEntry(key, false).get();\n    };\n    ObservableMap.prototype.set = function (key, value) {\n        this.assertValidKey(key);\n        key = \"\" + key;\n        var hasKey = this._has(key);\n        if (hasInterceptors(this)) {\n            var change = interceptChange(this, {\n                type: hasKey ? \"update\" : \"add\",\n                object: this,\n                newValue: value,\n                name: key\n            });\n            if (!change) return this;\n            value = change.newValue;\n        }\n        if (hasKey) {\n            this._updateValue(key, value);\n        } else {\n            this._addValue(key, value);\n        }\n        return this;\n    };\n    ObservableMap.prototype.delete = function (key) {\n        var _this = this;\n        this.assertValidKey(key);\n        key = \"\" + key;\n        if (hasInterceptors(this)) {\n            var change = interceptChange(this, {\n                type: \"delete\",\n                object: this,\n                name: key\n            });\n            if (!change) return false;\n        }\n        if (this._has(key)) {\n            var notifySpy = isSpyEnabled();\n            var notify = hasListeners(this);\n            var change = notify || notifySpy ? {\n                type: \"delete\",\n                object: this,\n                oldValue: this._data[key].value,\n                name: key\n            } : null;\n            if (notifySpy) spyReportStart(change);\n            runInTransaction(function () {\n                _this._keys.remove(key);\n                _this._updateHasMapEntry(key, false);\n                var observable = _this._data[key];\n                observable.setNewValue(undefined);\n                _this._data[key] = undefined;\n            });\n            if (notify) notifyListeners(this, change);\n            if (notifySpy) spyReportEnd();\n            return true;\n        }\n        return false;\n    };\n    ObservableMap.prototype._updateHasMapEntry = function (key, value) {\n        var entry = this._hasMap[key];\n        if (entry) {\n            entry.setNewValue(value);\n        } else {\n            entry = this._hasMap[key] = new ObservableValue(value, referenceEnhancer, this.name + \".\" + key + \"?\", false);\n        }\n        return entry;\n    };\n    ObservableMap.prototype._updateValue = function (name, newValue) {\n        var observable = this._data[name];\n        newValue = observable.prepareNewValue(newValue);\n        if (newValue !== UNCHANGED) {\n            var notifySpy = isSpyEnabled();\n            var notify = hasListeners(this);\n            var change = notify || notifySpy ? {\n                type: \"update\",\n                object: this,\n                oldValue: observable.value,\n                name: name, newValue: newValue\n            } : null;\n            if (notifySpy) spyReportStart(change);\n            observable.setNewValue(newValue);\n            if (notify) notifyListeners(this, change);\n            if (notifySpy) spyReportEnd();\n        }\n    };\n    ObservableMap.prototype._addValue = function (name, newValue) {\n        var _this = this;\n        runInTransaction(function () {\n            var observable = _this._data[name] = new ObservableValue(newValue, _this.enhancer, _this.name + \".\" + name, false);\n            newValue = observable.value;\n            _this._updateHasMapEntry(name, true);\n            _this._keys.push(name);\n        });\n        var notifySpy = isSpyEnabled();\n        var notify = hasListeners(this);\n        var change = notify || notifySpy ? {\n            type: \"add\",\n            object: this,\n            name: name, newValue: newValue\n        } : null;\n        if (notifySpy) spyReportStart(change);\n        if (notify) notifyListeners(this, change);\n        if (notifySpy) spyReportEnd();\n    };\n    ObservableMap.prototype.get = function (key) {\n        key = \"\" + key;\n        if (this.has(key)) return this._data[key].get();\n        return undefined;\n    };\n    ObservableMap.prototype.keys = function () {\n        return arrayAsIterator(this._keys.slice());\n    };\n    ObservableMap.prototype.values = function () {\n        return arrayAsIterator(this._keys.map(this.get, this));\n    };\n    ObservableMap.prototype.entries = function () {\n        var _this = this;\n        return arrayAsIterator(this._keys.map(function (key) {\n            return [key, _this.get(key)];\n        }));\n    };\n    ObservableMap.prototype.forEach = function (callback, thisArg) {\n        var _this = this;\n        this.keys().forEach(function (key) {\n            return callback.call(thisArg, _this.get(key), key, _this);\n        });\n    };\n    ObservableMap.prototype.merge = function (other) {\n        var _this = this;\n        if (isObservableMap(other)) {\n            other = other.toJS();\n        }\n        runInTransaction(function () {\n            if (isPlainObject(other)) Object.keys(other).forEach(function (key) {\n                return _this.set(key, other[key]);\n            });else if (Array.isArray(other)) other.forEach(function (_a) {\n                var key = _a[0],\n                    value = _a[1];\n                return _this.set(key, value);\n            });else if (isES6Map(other)) other.forEach(function (value, key) {\n                return _this.set(key, value);\n            });else if (other !== null && other !== undefined) fail(\"Cannot initialize map from \" + other);\n        });\n        return this;\n    };\n    ObservableMap.prototype.clear = function () {\n        var _this = this;\n        runInTransaction(function () {\n            untracked(function () {\n                _this.keys().forEach(_this.delete, _this);\n            });\n        });\n    };\n    ObservableMap.prototype.replace = function (values) {\n        var _this = this;\n        runInTransaction(function () {\n            _this.clear();\n            _this.merge(values);\n        });\n        return this;\n    };\n    Object.defineProperty(ObservableMap.prototype, \"size\", {\n        get: function get() {\n            return this._keys.length;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    ObservableMap.prototype.toJS = function () {\n        var _this = this;\n        var res = {};\n        this.keys().forEach(function (key) {\n            return res[key] = _this.get(key);\n        });\n        return res;\n    };\n    ObservableMap.prototype.toJSON = function () {\n        return this.toJS();\n    };\n    ObservableMap.prototype.isValidKey = function (key) {\n        if (key === null || key === undefined) return false;\n        if (typeof key === \"string\" || typeof key === \"number\" || typeof key === \"boolean\") return true;\n        return false;\n    };\n    ObservableMap.prototype.assertValidKey = function (key) {\n        if (!this.isValidKey(key)) throw new Error(\"[mobx.map] Invalid key: '\" + key + \"', only strings, numbers and booleans are accepted as key in observable maps.\");\n    };\n    ObservableMap.prototype.toString = function () {\n        var _this = this;\n        return this.name + \"[{ \" + this.keys().map(function (key) {\n            return key + \": \" + (\"\" + _this.get(key));\n        }).join(\", \") + \" }]\";\n    };\n    ObservableMap.prototype.observe = function (listener, fireImmediately) {\n        invariant(fireImmediately !== true, getMessage(\"m033\"));\n        return registerListener(this, listener);\n    };\n    ObservableMap.prototype.intercept = function (handler) {\n        return registerInterceptor(this, handler);\n    };\n    return ObservableMap;\n}();\nexports.ObservableMap = ObservableMap;\ndeclareIterator(ObservableMap.prototype, function () {\n    return this.entries();\n});\nfunction map(initialValues) {\n    deprecated(\"`mobx.map` is deprecated, use `new ObservableMap` or `mobx.observable.map` instead\");\n    return observable.map(initialValues);\n}\nexports.map = map;\nvar isObservableMap = createInstanceofPredicate(\"ObservableMap\", ObservableMap);\nexports.isObservableMap = isObservableMap;\nvar ObservableObjectAdministration = function () {\n    function ObservableObjectAdministration(target, name) {\n        this.target = target;\n        this.name = name;\n        this.values = {};\n        this.changeListeners = null;\n        this.interceptors = null;\n    }\n    ObservableObjectAdministration.prototype.observe = function (callback, fireImmediately) {\n        invariant(fireImmediately !== true, \"`observe` doesn't support the fire immediately property for observable objects.\");\n        return registerListener(this, callback);\n    };\n    ObservableObjectAdministration.prototype.intercept = function (handler) {\n        return registerInterceptor(this, handler);\n    };\n    return ObservableObjectAdministration;\n}();\nfunction asObservableObject(target, name) {\n    if (isObservableObject(target)) return target.$mobx;\n    invariant(Object.isExtensible(target), getMessage(\"m035\"));\n    if (!isPlainObject(target)) name = (target.constructor.name || \"ObservableObject\") + \"@\" + getNextId();\n    if (!name) name = \"ObservableObject@\" + getNextId();\n    var adm = new ObservableObjectAdministration(target, name);\n    addHiddenFinalProp(target, \"$mobx\", adm);\n    return adm;\n}\nfunction defineObservablePropertyFromDescriptor(adm, propName, descriptor, defaultEnhancer) {\n    if (adm.values[propName]) {\n        invariant(\"value\" in descriptor, \"The property \" + propName + \" in \" + adm.name + \" is already observable, cannot redefine it as computed property\");\n        adm.target[propName] = descriptor.value;\n        return;\n    }\n    if (\"value\" in descriptor) {\n        if (isModifierDescriptor(descriptor.value)) {\n            var modifierDescriptor = descriptor.value;\n            defineObservableProperty(adm, propName, modifierDescriptor.initialValue, modifierDescriptor.enhancer);\n        } else if (isAction(descriptor.value) && descriptor.value.autoBind === true) {\n            defineBoundAction(adm.target, propName, descriptor.value.originalFn);\n        } else if (isComputedValue(descriptor.value)) {\n            defineComputedPropertyFromComputedValue(adm, propName, descriptor.value);\n        } else {\n            defineObservableProperty(adm, propName, descriptor.value, defaultEnhancer);\n        }\n    } else {\n        defineComputedProperty(adm, propName, descriptor.get, descriptor.set, false, true);\n    }\n}\nfunction defineObservableProperty(adm, propName, newValue, enhancer) {\n    assertPropertyConfigurable(adm.target, propName);\n    if (hasInterceptors(adm)) {\n        var change = interceptChange(adm, {\n            object: adm.target,\n            name: propName,\n            type: \"add\",\n            newValue: newValue\n        });\n        if (!change) return;\n        newValue = change.newValue;\n    }\n    var observable = adm.values[propName] = new ObservableValue(newValue, enhancer, adm.name + \".\" + propName, false);\n    newValue = observable.value;\n    Object.defineProperty(adm.target, propName, generateObservablePropConfig(propName));\n    notifyPropertyAddition(adm, adm.target, propName, newValue);\n}\nfunction defineComputedProperty(adm, propName, getter, setter, compareStructural, asInstanceProperty) {\n    if (asInstanceProperty) assertPropertyConfigurable(adm.target, propName);\n    adm.values[propName] = new ComputedValue(getter, adm.target, compareStructural, adm.name + \".\" + propName, setter);\n    if (asInstanceProperty) {\n        Object.defineProperty(adm.target, propName, generateComputedPropConfig(propName));\n    }\n}\nfunction defineComputedPropertyFromComputedValue(adm, propName, computedValue) {\n    var name = adm.name + \".\" + propName;\n    computedValue.name = name;\n    if (!computedValue.scope) computedValue.scope = adm.target;\n    adm.values[propName] = computedValue;\n    Object.defineProperty(adm.target, propName, generateComputedPropConfig(propName));\n}\nvar observablePropertyConfigs = {};\nvar computedPropertyConfigs = {};\nfunction generateObservablePropConfig(propName) {\n    return observablePropertyConfigs[propName] || (observablePropertyConfigs[propName] = {\n        configurable: true,\n        enumerable: true,\n        get: function get() {\n            return this.$mobx.values[propName].get();\n        },\n        set: function set(v) {\n            setPropertyValue(this, propName, v);\n        }\n    });\n}\nfunction generateComputedPropConfig(propName) {\n    return computedPropertyConfigs[propName] || (computedPropertyConfigs[propName] = {\n        configurable: true,\n        enumerable: false,\n        get: function get() {\n            return this.$mobx.values[propName].get();\n        },\n        set: function set(v) {\n            return this.$mobx.values[propName].set(v);\n        }\n    });\n}\nfunction setPropertyValue(instance, name, newValue) {\n    var adm = instance.$mobx;\n    var observable = adm.values[name];\n    if (hasInterceptors(adm)) {\n        var change = interceptChange(adm, {\n            type: \"update\",\n            object: instance,\n            name: name, newValue: newValue\n        });\n        if (!change) return;\n        newValue = change.newValue;\n    }\n    newValue = observable.prepareNewValue(newValue);\n    if (newValue !== UNCHANGED) {\n        var notify = hasListeners(adm);\n        var notifySpy = isSpyEnabled();\n        var change = notify || notifySpy ? {\n            type: \"update\",\n            object: instance,\n            oldValue: observable.value,\n            name: name, newValue: newValue\n        } : null;\n        if (notifySpy) spyReportStart(change);\n        observable.setNewValue(newValue);\n        if (notify) notifyListeners(adm, change);\n        if (notifySpy) spyReportEnd();\n    }\n}\nfunction notifyPropertyAddition(adm, object, name, newValue) {\n    var notify = hasListeners(adm);\n    var notifySpy = isSpyEnabled();\n    var change = notify || notifySpy ? {\n        type: \"add\",\n        object: object, name: name, newValue: newValue\n    } : null;\n    if (notifySpy) spyReportStart(change);\n    if (notify) notifyListeners(adm, change);\n    if (notifySpy) spyReportEnd();\n}\nvar isObservableObjectAdministration = createInstanceofPredicate(\"ObservableObjectAdministration\", ObservableObjectAdministration);\nfunction isObservableObject(thing) {\n    if (isObject(thing)) {\n        runLazyInitializers(thing);\n        return isObservableObjectAdministration(thing.$mobx);\n    }\n    return false;\n}\nexports.isObservableObject = isObservableObject;\nvar UNCHANGED = {};\nvar ObservableValue = function (_super) {\n    __extends(ObservableValue, _super);\n    function ObservableValue(value, enhancer, name, notifySpy) {\n        if (name === void 0) {\n            name = \"ObservableValue@\" + getNextId();\n        }\n        if (notifySpy === void 0) {\n            notifySpy = true;\n        }\n        var _this = _super.call(this, name) || this;\n        _this.enhancer = enhancer;\n        _this.hasUnreportedChange = false;\n        _this.value = enhancer(value, undefined, name);\n        if (notifySpy && isSpyEnabled()) {\n            spyReport({ type: \"create\", object: _this, newValue: _this.value });\n        }\n        return _this;\n    }\n    ObservableValue.prototype.set = function (newValue) {\n        var oldValue = this.value;\n        newValue = this.prepareNewValue(newValue);\n        if (newValue !== UNCHANGED) {\n            var notifySpy = isSpyEnabled();\n            if (notifySpy) {\n                spyReportStart({\n                    type: \"update\",\n                    object: this,\n                    newValue: newValue, oldValue: oldValue\n                });\n            }\n            this.setNewValue(newValue);\n            if (notifySpy) spyReportEnd();\n        }\n    };\n    ObservableValue.prototype.prepareNewValue = function (newValue) {\n        checkIfStateModificationsAreAllowed(this);\n        if (hasInterceptors(this)) {\n            var change = interceptChange(this, { object: this, type: \"update\", newValue: newValue });\n            if (!change) return UNCHANGED;\n            newValue = change.newValue;\n        }\n        newValue = this.enhancer(newValue, this.value, this.name);\n        return this.value !== newValue ? newValue : UNCHANGED;\n    };\n    ObservableValue.prototype.setNewValue = function (newValue) {\n        var oldValue = this.value;\n        this.value = newValue;\n        this.reportChanged();\n        if (hasListeners(this)) {\n            notifyListeners(this, {\n                type: \"update\",\n                object: this,\n                newValue: newValue,\n                oldValue: oldValue\n            });\n        }\n    };\n    ObservableValue.prototype.get = function () {\n        this.reportObserved();\n        return this.value;\n    };\n    ObservableValue.prototype.intercept = function (handler) {\n        return registerInterceptor(this, handler);\n    };\n    ObservableValue.prototype.observe = function (listener, fireImmediately) {\n        if (fireImmediately) listener({\n            object: this,\n            type: \"update\",\n            newValue: this.value,\n            oldValue: undefined\n        });\n        return registerListener(this, listener);\n    };\n    ObservableValue.prototype.toJSON = function () {\n        return this.get();\n    };\n    ObservableValue.prototype.toString = function () {\n        return this.name + \"[\" + this.value + \"]\";\n    };\n    ObservableValue.prototype.valueOf = function () {\n        return toPrimitive(this.get());\n    };\n    return ObservableValue;\n}(BaseAtom);\nObservableValue.prototype[primitiveSymbol()] = ObservableValue.prototype.valueOf;\nvar isObservableValue = createInstanceofPredicate(\"ObservableValue\", ObservableValue);\nexports.isBoxedObservable = isObservableValue;\nfunction getAtom(thing, property) {\n    if ((typeof thing === \"undefined\" ? \"undefined\" : _typeof(thing)) === \"object\" && thing !== null) {\n        if (isObservableArray(thing)) {\n            invariant(property === undefined, getMessage(\"m036\"));\n            return thing.$mobx.atom;\n        }\n        if (isObservableMap(thing)) {\n            var anyThing = thing;\n            if (property === undefined) return getAtom(anyThing._keys);\n            var observable_2 = anyThing._data[property] || anyThing._hasMap[property];\n            invariant(!!observable_2, \"the entry '\" + property + \"' does not exist in the observable map '\" + getDebugName(thing) + \"'\");\n            return observable_2;\n        }\n        runLazyInitializers(thing);\n        if (isObservableObject(thing)) {\n            if (!property) return fail(\"please specify a property\");\n            var observable_3 = thing.$mobx.values[property];\n            invariant(!!observable_3, \"no observable property '\" + property + \"' found on the observable object '\" + getDebugName(thing) + \"'\");\n            return observable_3;\n        }\n        if (isAtom(thing) || isComputedValue(thing) || isReaction(thing)) {\n            return thing;\n        }\n    } else if (typeof thing === \"function\") {\n        if (isReaction(thing.$mobx)) {\n            return thing.$mobx;\n        }\n    }\n    return fail(\"Cannot obtain atom from \" + thing);\n}\nfunction getAdministration(thing, property) {\n    invariant(thing, \"Expecting some object\");\n    if (property !== undefined) return getAdministration(getAtom(thing, property));\n    if (isAtom(thing) || isComputedValue(thing) || isReaction(thing)) return thing;\n    if (isObservableMap(thing)) return thing;\n    runLazyInitializers(thing);\n    if (thing.$mobx) return thing.$mobx;\n    invariant(false, \"Cannot obtain administration from \" + thing);\n}\nfunction getDebugName(thing, property) {\n    var named;\n    if (property !== undefined) named = getAtom(thing, property);else if (isObservableObject(thing) || isObservableMap(thing)) named = getAdministration(thing);else named = getAtom(thing);\n    return named.name;\n}\nfunction createClassPropertyDecorator(onInitialize, _get, _set, enumerable, allowCustomArguments) {\n    function classPropertyDecorator(target, key, descriptor, customArgs, argLen) {\n        if (argLen === void 0) {\n            argLen = 0;\n        }\n        invariant(allowCustomArguments || quacksLikeADecorator(arguments), \"This function is a decorator, but it wasn't invoked like a decorator\");\n        if (!descriptor) {\n            var newDescriptor = {\n                enumerable: enumerable,\n                configurable: true,\n                get: function get() {\n                    if (!this.__mobxInitializedProps || this.__mobxInitializedProps[key] !== true) typescriptInitializeProperty(this, key, undefined, onInitialize, customArgs, descriptor);\n                    return _get.call(this, key);\n                },\n                set: function set(v) {\n                    if (!this.__mobxInitializedProps || this.__mobxInitializedProps[key] !== true) {\n                        typescriptInitializeProperty(this, key, v, onInitialize, customArgs, descriptor);\n                    } else {\n                        _set.call(this, key, v);\n                    }\n                }\n            };\n            if (arguments.length < 3 || arguments.length === 5 && argLen < 3) {\n                Object.defineProperty(target, key, newDescriptor);\n            }\n            return newDescriptor;\n        } else {\n            if (!hasOwnProperty(target, \"__mobxLazyInitializers\")) {\n                addHiddenProp(target, \"__mobxLazyInitializers\", target.__mobxLazyInitializers && target.__mobxLazyInitializers.slice() || []);\n            }\n            var value_1 = descriptor.value,\n                initializer_1 = descriptor.initializer;\n            target.__mobxLazyInitializers.push(function (instance) {\n                onInitialize(instance, key, initializer_1 ? initializer_1.call(instance) : value_1, customArgs, descriptor);\n            });\n            return {\n                enumerable: enumerable, configurable: true,\n                get: function get() {\n                    if (this.__mobxDidRunLazyInitializers !== true) runLazyInitializers(this);\n                    return _get.call(this, key);\n                },\n                set: function set(v) {\n                    if (this.__mobxDidRunLazyInitializers !== true) runLazyInitializers(this);\n                    _set.call(this, key, v);\n                }\n            };\n        }\n    }\n    if (allowCustomArguments) {\n        return function () {\n            if (quacksLikeADecorator(arguments)) return classPropertyDecorator.apply(null, arguments);\n            var outerArgs = arguments;\n            var argLen = arguments.length;\n            return function (target, key, descriptor) {\n                return classPropertyDecorator(target, key, descriptor, outerArgs, argLen);\n            };\n        };\n    }\n    return classPropertyDecorator;\n}\nfunction typescriptInitializeProperty(instance, key, v, onInitialize, customArgs, baseDescriptor) {\n    if (!hasOwnProperty(instance, \"__mobxInitializedProps\")) addHiddenProp(instance, \"__mobxInitializedProps\", {});\n    instance.__mobxInitializedProps[key] = true;\n    onInitialize(instance, key, v, customArgs, baseDescriptor);\n}\nfunction runLazyInitializers(instance) {\n    if (instance.__mobxDidRunLazyInitializers === true) return;\n    if (instance.__mobxLazyInitializers) {\n        addHiddenProp(instance, \"__mobxDidRunLazyInitializers\", true);\n        instance.__mobxDidRunLazyInitializers && instance.__mobxLazyInitializers.forEach(function (initializer) {\n            return initializer(instance);\n        });\n    }\n}\nfunction quacksLikeADecorator(args) {\n    return (args.length === 2 || args.length === 3) && typeof args[1] === \"string\";\n}\nfunction iteratorSymbol() {\n    return typeof Symbol === \"function\" && Symbol.iterator || \"@@iterator\";\n}\nvar IS_ITERATING_MARKER = \"__$$iterating\";\nfunction arrayAsIterator(array) {\n    invariant(array[IS_ITERATING_MARKER] !== true, \"Illegal state: cannot recycle array as iterator\");\n    addHiddenFinalProp(array, IS_ITERATING_MARKER, true);\n    var idx = -1;\n    addHiddenFinalProp(array, \"next\", function next() {\n        idx++;\n        return {\n            done: idx >= this.length,\n            value: idx < this.length ? this[idx] : undefined\n        };\n    });\n    return array;\n}\nfunction declareIterator(prototType, iteratorFactory) {\n    addHiddenFinalProp(prototType, iteratorSymbol(), iteratorFactory);\n}\nvar messages = {\n    \"m001\": \"It is not allowed to assign new values to @action fields\",\n    \"m002\": \"`runInAction` expects a function\",\n    \"m003\": \"`runInAction` expects a function without arguments\",\n    \"m004\": \"autorun expects a function\",\n    \"m005\": \"Warning: attempted to pass an action to autorun. Actions are untracked and will not trigger on state changes. Use `reaction` or wrap only your state modification code in an action.\",\n    \"m006\": \"Warning: attempted to pass an action to autorunAsync. Actions are untracked and will not trigger on state changes. Use `reaction` or wrap only your state modification code in an action.\",\n    \"m007\": \"reaction only accepts 2 or 3 arguments. If migrating from MobX 2, please provide an options object\",\n    \"m008\": \"wrapping reaction expression in `asReference` is no longer supported, use options object instead\",\n    \"m009\": \"@computed can only be used on getter functions, like: '@computed get myProps() { return ...; }'. It looks like it was used on a property.\",\n    \"m010\": \"@computed can only be used on getter functions, like: '@computed get myProps() { return ...; }'\",\n    \"m011\": \"First argument to `computed` should be an expression. If using computed as decorator, don't pass it arguments\",\n    \"m012\": \"computed takes one or two arguments if used as function\",\n    \"m013\": \"[mobx.expr] 'expr' should only be used inside other reactive functions.\",\n    \"m014\": \"extendObservable expected 2 or more arguments\",\n    \"m015\": \"extendObservable expects an object as first argument\",\n    \"m016\": \"extendObservable should not be used on maps, use map.merge instead\",\n    \"m017\": \"all arguments of extendObservable should be objects\",\n    \"m018\": \"extending an object with another observable (object) is not supported. Please construct an explicit propertymap, using `toJS` if need. See issue #540\",\n    \"m019\": \"[mobx.isObservable] isObservable(object, propertyName) is not supported for arrays and maps. Use map.has or array.length instead.\",\n    \"m020\": \"modifiers can only be used for individual object properties\",\n    \"m021\": \"observable expects zero or one arguments\",\n    \"m022\": \"@observable can not be used on getters, use @computed instead\",\n    \"m023\": \"Using `transaction` is deprecated, use `runInAction` or `(@)action` instead.\",\n    \"m024\": \"whyRun() can only be used if a derivation is active, or by passing an computed value / reaction explicitly. If you invoked whyRun from inside a computation; the computation is currently suspended but re-evaluating because somebody requested its value.\",\n    \"m025\": \"whyRun can only be used on reactions and computed values\",\n    \"m026\": \"`action` can only be invoked on functions\",\n    \"m028\": \"It is not allowed to set `useStrict` when a derivation is running\",\n    \"m029\": \"INTERNAL ERROR only onBecomeUnobserved shouldn't be called twice in a row\",\n    \"m030a\": \"Since strict-mode is enabled, changing observed observable values outside actions is not allowed. Please wrap the code in an `action` if this change is intended. Tried to modify: \",\n    \"m030b\": \"Side effects like changing state are not allowed at this point. Are you trying to modify state from, for example, the render function of a React component? Tried to modify: \",\n    \"m031\": \"Computed values are not allowed to not cause side effects by changing observables that are already being observed. Tried to modify: \",\n    \"m032\": \"* This computation is suspended (not in use by any reaction) and won't run automatically.\\n\tDidn't expect this computation to be suspended at this point?\\n\t  1. Make sure this computation is used by a reaction (reaction, autorun, observer).\\n\t  2. Check whether you are using this computation synchronously (in the same stack as they reaction that needs it).\",\n    \"m033\": \"`observe` doesn't support the fire immediately property for observable maps.\",\n    \"m034\": \"`mobx.map` is deprecated, use `new ObservableMap` or `mobx.observable.map` instead\",\n    \"m035\": \"Cannot make the designated object observable; it is not extensible\",\n    \"m036\": \"It is not possible to get index atoms from arrays\",\n    \"m037\": \"Hi there! I'm sorry you have just run into an exception.\\nIf your debugger ends up here, know that some reaction (like the render() of an observer component, autorun or reaction)\\nthrew an exception and that mobx caught it, to avoid that it brings the rest of your application down.\\nThe original cause of the exception (the code that caused this reaction to run (again)), is still in the stack.\\n\\nHowever, more interesting is the actual stack trace of the error itself.\\nHopefully the error is an instanceof Error, because in that case you can inspect the original stack of the error from where it was thrown.\\nSee `error.stack` property, or press the very subtle \\\"(...)\\\" link you see near the console.error message that probably brought you here.\\nThat stack is more interesting than the stack of this console.error itself.\\n\\nIf the exception you see is an exception you created yourself, make sure to use `throw new Error(\\\"Oops\\\")` instead of `throw \\\"Oops\\\"`,\\nbecause the javascript environment will only preserve the original stack trace in the first form.\\n\\nYou can also make sure the debugger pauses the next time this very same exception is thrown by enabling \\\"Pause on caught exception\\\".\\n(Note that it might pause on many other, unrelated exception as well).\\n\\nIf that all doesn't help you out, feel free to open an issue https://github.com/mobxjs/mobx/issues!\\n\",\n    \"m038\": \"Missing items in this list?\\n    1. Check whether all used values are properly marked as observable (use isObservable to verify)\\n    2. Make sure you didn't dereference values too early. MobX observes props, not primitives. E.g: use 'person.name' instead of 'name' in your computation.\\n\"\n};\nfunction getMessage(id) {\n    return messages[id];\n}\nvar EMPTY_ARRAY = [];\nObject.freeze(EMPTY_ARRAY);\nfunction getGlobal() {\n    return global;\n}\nfunction getNextId() {\n    return ++globalState.mobxGuid;\n}\nfunction fail(message, thing) {\n    invariant(false, message, thing);\n    throw \"X\";\n}\nfunction invariant(check, message, thing) {\n    if (!check) throw new Error(\"[mobx] Invariant failed: \" + message + (thing ? \" in '\" + thing + \"'\" : \"\"));\n}\nvar deprecatedMessages = [];\nfunction deprecated(msg) {\n    if (deprecatedMessages.indexOf(msg) !== -1) return false;\n    deprecatedMessages.push(msg);\n    console.error(\"[mobx] Deprecated: \" + msg);\n    return true;\n}\nfunction once(func) {\n    var invoked = false;\n    return function () {\n        if (invoked) return;\n        invoked = true;\n        return func.apply(this, arguments);\n    };\n}\nvar noop = function noop() {};\nfunction unique(list) {\n    var res = [];\n    list.forEach(function (item) {\n        if (res.indexOf(item) === -1) res.push(item);\n    });\n    return res;\n}\nfunction joinStrings(things, limit, separator) {\n    if (limit === void 0) {\n        limit = 100;\n    }\n    if (separator === void 0) {\n        separator = \" - \";\n    }\n    if (!things) return \"\";\n    var sliced = things.slice(0, limit);\n    return \"\" + sliced.join(separator) + (things.length > limit ? \" (... and \" + (things.length - limit) + \"more)\" : \"\");\n}\nfunction isObject(value) {\n    return value !== null && (typeof value === \"undefined\" ? \"undefined\" : _typeof(value)) === \"object\";\n}\nfunction isPlainObject(value) {\n    if (value === null || (typeof value === \"undefined\" ? \"undefined\" : _typeof(value)) !== \"object\") return false;\n    var proto = Object.getPrototypeOf(value);\n    return proto === Object.prototype || proto === null;\n}\nfunction objectAssign() {\n    var res = arguments[0];\n    for (var i = 1, l = arguments.length; i < l; i++) {\n        var source = arguments[i];\n        for (var key in source) {\n            if (hasOwnProperty(source, key)) {\n                res[key] = source[key];\n            }\n        }\n    }\n    return res;\n}\nfunction valueDidChange(compareStructural, oldValue, newValue) {\n    if (typeof oldValue === 'number' && isNaN(oldValue)) {\n        return typeof newValue !== 'number' || !isNaN(newValue);\n    }\n    return compareStructural ? !deepEqual(oldValue, newValue) : oldValue !== newValue;\n}\nvar prototypeHasOwnProperty = Object.prototype.hasOwnProperty;\nfunction hasOwnProperty(object, propName) {\n    return prototypeHasOwnProperty.call(object, propName);\n}\nfunction makeNonEnumerable(object, propNames) {\n    for (var i = 0; i < propNames.length; i++) {\n        addHiddenProp(object, propNames[i], object[propNames[i]]);\n    }\n}\nfunction addHiddenProp(object, propName, value) {\n    Object.defineProperty(object, propName, {\n        enumerable: false,\n        writable: true,\n        configurable: true,\n        value: value\n    });\n}\nfunction addHiddenFinalProp(object, propName, value) {\n    Object.defineProperty(object, propName, {\n        enumerable: false,\n        writable: false,\n        configurable: true,\n        value: value\n    });\n}\nfunction isPropertyConfigurable(object, prop) {\n    var descriptor = Object.getOwnPropertyDescriptor(object, prop);\n    return !descriptor || descriptor.configurable !== false && descriptor.writable !== false;\n}\nfunction assertPropertyConfigurable(object, prop) {\n    invariant(isPropertyConfigurable(object, prop), \"Cannot make property '\" + prop + \"' observable, it is not configurable and writable in the target object\");\n}\nfunction getEnumerableKeys(obj) {\n    var res = [];\n    for (var key in obj) {\n        res.push(key);\n    }return res;\n}\nfunction deepEqual(a, b) {\n    if (a === null && b === null) return true;\n    if (a === undefined && b === undefined) return true;\n    if ((typeof a === \"undefined\" ? \"undefined\" : _typeof(a)) !== \"object\") return a === b;\n    var aIsArray = isArrayLike(a);\n    var aIsMap = isMapLike(a);\n    if (aIsArray !== isArrayLike(b)) {\n        return false;\n    } else if (aIsMap !== isMapLike(b)) {\n        return false;\n    } else if (aIsArray) {\n        if (a.length !== b.length) return false;\n        for (var i = a.length - 1; i >= 0; i--) {\n            if (!deepEqual(a[i], b[i])) return false;\n        }return true;\n    } else if (aIsMap) {\n        if (a.size !== b.size) return false;\n        var equals_1 = true;\n        a.forEach(function (value, key) {\n            equals_1 = equals_1 && deepEqual(b.get(key), value);\n        });\n        return equals_1;\n    } else if ((typeof a === \"undefined\" ? \"undefined\" : _typeof(a)) === \"object\" && (typeof b === \"undefined\" ? \"undefined\" : _typeof(b)) === \"object\") {\n        if (a === null || b === null) return false;\n        if (isMapLike(a) && isMapLike(b)) {\n            if (a.size !== b.size) return false;\n            return deepEqual(observable.shallowMap(a).entries(), observable.shallowMap(b).entries());\n        }\n        if (getEnumerableKeys(a).length !== getEnumerableKeys(b).length) return false;\n        for (var prop in a) {\n            if (!(prop in b)) return false;\n            if (!deepEqual(a[prop], b[prop])) return false;\n        }\n        return true;\n    }\n    return false;\n}\nfunction createInstanceofPredicate(name, clazz) {\n    var propName = \"isMobX\" + name;\n    clazz.prototype[propName] = true;\n    return function (x) {\n        return isObject(x) && x[propName] === true;\n    };\n}\nfunction isArrayLike(x) {\n    return Array.isArray(x) || isObservableArray(x);\n}\nexports.isArrayLike = isArrayLike;\nfunction isMapLike(x) {\n    return isES6Map(x) || isObservableMap(x);\n}\nfunction isES6Map(thing) {\n    if (getGlobal().Map !== undefined && thing instanceof getGlobal().Map) return true;\n    return false;\n}\nfunction primitiveSymbol() {\n    return typeof Symbol === \"function\" && Symbol.toPrimitive || \"@@toPrimitive\";\n}\nfunction toPrimitive(value) {\n    return value === null ? null : (typeof value === \"undefined\" ? \"undefined\" : _typeof(value)) === \"object\" ? \"\" + value : value;\n}\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(4)))\n\n/***/ }),\n/* 2 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nvar _icons = __webpack_require__(6);\n\nvar _constants = __webpack_require__(0);\n\nfunction renderHeader(_ref, instance) {\n  var meta = _ref.meta,\n      user = _ref.user,\n      reactions = _ref.reactions;\n\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-header-container';\n\n  var likeButton = document.createElement('span');\n  var likedReaction = reactions.find(function (reaction) {\n    return reaction.content === 'heart' && reaction.user.login === user.login;\n  });\n  likeButton.className = 'gitment-header-like-btn';\n  likeButton.innerHTML = '\\n    ' + _icons.heart + '\\n    ' + (likedReaction ? 'Unlike' : 'Like') + '\\n    ' + (meta.reactions && meta.reactions.heart ? ' \\u2022 <strong>' + meta.reactions.heart + '</strong> Liked' : '') + '\\n  ';\n\n  if (likedReaction) {\n    likeButton.classList.add('liked');\n    likeButton.onclick = function () {\n      return instance.unlike();\n    };\n  } else {\n    likeButton.classList.remove('liked');\n    likeButton.onclick = function () {\n      return instance.like();\n    };\n  }\n  container.appendChild(likeButton);\n\n  var commentsCount = document.createElement('span');\n  commentsCount.innerHTML = '\\n    ' + (meta.comments ? ' \\u2022 <strong>' + meta.comments + '</strong> Comments' : '') + '\\n  ';\n  container.appendChild(commentsCount);\n\n  var issueLink = document.createElement('a');\n  issueLink.className = 'gitment-header-issue-link';\n  issueLink.href = meta.html_url;\n  issueLink.target = '_blank';\n  issueLink.innerText = 'Issue Page';\n  container.appendChild(issueLink);\n\n  return container;\n}\n\nfunction renderComments(_ref2, instance) {\n  var meta = _ref2.meta,\n      comments = _ref2.comments,\n      commentReactions = _ref2.commentReactions,\n      currentPage = _ref2.currentPage,\n      user = _ref2.user,\n      error = _ref2.error;\n\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-comments-container';\n\n  if (error) {\n    var errorBlock = document.createElement('div');\n    errorBlock.className = 'gitment-comments-error';\n\n    if (error === _constants.NOT_INITIALIZED_ERROR && user.login && user.login.toLowerCase() === instance.owner.toLowerCase()) {\n      var initHint = document.createElement('div');\n      var initButton = document.createElement('button');\n      initButton.className = 'gitment-comments-init-btn';\n      initButton.onclick = function () {\n        initButton.setAttribute('disabled', true);\n        instance.init().catch(function (e) {\n          initButton.removeAttribute('disabled');\n          alert(e);\n        });\n      };\n      initButton.innerText = 'Initialize Comments';\n      initHint.appendChild(initButton);\n      errorBlock.appendChild(initHint);\n    } else {\n      errorBlock.innerText = error;\n    }\n    container.appendChild(errorBlock);\n    return container;\n  } else if (comments === undefined) {\n    var loading = document.createElement('div');\n    loading.innerText = 'Loading comments...';\n    loading.className = 'gitment-comments-loading';\n    container.appendChild(loading);\n    return container;\n  } else if (!comments.length) {\n    var emptyBlock = document.createElement('div');\n    emptyBlock.className = 'gitment-comments-empty';\n    emptyBlock.innerText = 'No Comment Yet';\n    container.appendChild(emptyBlock);\n    return container;\n  }\n\n  var commentsList = document.createElement('ul');\n  commentsList.className = 'gitment-comments-list';\n\n  comments.forEach(function (comment) {\n    var createDate = new Date(comment.created_at);\n    var updateDate = new Date(comment.updated_at);\n    var commentItem = document.createElement('li');\n    commentItem.className = 'gitment-comment';\n    commentItem.innerHTML = '\\n      <a class=\"gitment-comment-avatar\" href=\"' + comment.user.html_url + '\" target=\"_blank\">\\n        <img class=\"gitment-comment-avatar-img\" src=\"/js/' + comment.user.avatar_url + '\">\\n      </a>\\n      <div class=\"gitment-comment-main\">\\n        <div class=\"gitment-comment-header\">\\n          <a class=\"gitment-comment-name\" href=\"' + comment.user.html_url + '\" target=\"_blank\">\\n            ' + comment.user.login + '\\n          </a>\\n          commented on\\n          <span title=\"' + createDate + '\">' + createDate.toDateString() + '</span>\\n          ' + (createDate.toString() !== updateDate.toString() ? ' \\u2022 <span title=\"comment was edited at ' + updateDate + '\">edited</span>' : '') + '\\n          <div class=\"gitment-comment-like-btn\">' + _icons.heart + ' ' + (comment.reactions.heart || '') + '</div>\\n        </div>\\n        <div class=\"gitment-comment-body gitment-markdown\">' + comment.body_html + '</div>\\n      </div>\\n    ';\n    var likeButton = commentItem.querySelector('.gitment-comment-like-btn');\n    var likedReaction = commentReactions[comment.id] && commentReactions[comment.id].find(function (reaction) {\n      return reaction.content === 'heart' && reaction.user.login === user.login;\n    });\n    if (likedReaction) {\n      likeButton.classList.add('liked');\n      likeButton.onclick = function () {\n        return instance.unlikeAComment(comment.id);\n      };\n    } else {\n      likeButton.classList.remove('liked');\n      likeButton.onclick = function () {\n        return instance.likeAComment(comment.id);\n      };\n    }\n\n    // dirty\n    // use a blank image to trigger height calculating when element rendered\n    var imgTrigger = document.createElement('img');\n    var markdownBody = commentItem.querySelector('.gitment-comment-body');\n    imgTrigger.className = 'gitment-hidden';\n    imgTrigger.src = \"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\";\n    imgTrigger.onload = function () {\n      if (markdownBody.clientHeight > instance.maxCommentHeight) {\n        markdownBody.classList.add('gitment-comment-body-folded');\n        markdownBody.style.maxHeight = instance.maxCommentHeight + 'px';\n        markdownBody.title = 'Click to Expand';\n        markdownBody.onclick = function () {\n          markdownBody.classList.remove('gitment-comment-body-folded');\n          markdownBody.style.maxHeight = '';\n          markdownBody.title = '';\n          markdownBody.onclick = null;\n        };\n      }\n    };\n    commentItem.appendChild(imgTrigger);\n\n    commentsList.appendChild(commentItem);\n  });\n\n  container.appendChild(commentsList);\n\n  if (meta) {\n    var pageCount = Math.ceil(meta.comments / instance.perPage);\n    if (pageCount > 1) {\n      var pagination = document.createElement('ul');\n      pagination.className = 'gitment-comments-pagination';\n\n      if (currentPage > 1) {\n        var previousButton = document.createElement('li');\n        previousButton.className = 'gitment-comments-page-item';\n        previousButton.innerText = 'Previous';\n        previousButton.onclick = function () {\n          return instance.goto(currentPage - 1);\n        };\n        pagination.appendChild(previousButton);\n      }\n\n      var _loop = function _loop(i) {\n        var pageItem = document.createElement('li');\n        pageItem.className = 'gitment-comments-page-item';\n        pageItem.innerText = i;\n        pageItem.onclick = function () {\n          return instance.goto(i);\n        };\n        if (currentPage === i) pageItem.classList.add('gitment-selected');\n        pagination.appendChild(pageItem);\n      };\n\n      for (var i = 1; i <= pagecount;=\"\" i++)=\"\" {=\"\" _loop(i);=\"\" }=\"\" if=\"\" (currentpage=\"\" <=\"\" pagecount)=\"\" var=\"\" nextbutton=\"document.createElement('li');\" nextbutton.classname=\"gitment-comments-page-item\" ;=\"\" nextbutton.innertext=\"Next\" nextbutton.onclick=\"function\" ()=\"\" return=\"\" instance.goto(currentpage=\"\" +=\"\" 1);=\"\" };=\"\" pagination.appendchild(nextbutton);=\"\" container.appendchild(pagination);=\"\" container;=\"\" function=\"\" rendereditor(_ref3,=\"\" instance)=\"\" user=\"_ref3.user,\" error=\"_ref3.error;\" container=\"document.createElement('div');\" container.lang=\"en-US\" container.classname=\"gitment-container gitment-editor-container\" shoulddisable=\"user.login\" &&=\"\" !error=\"\" ?=\"\" ''=\"\" :=\"\" 'disabled';=\"\" disabledtip=\"user.login\" 'login=\"\" to=\"\" comment';=\"\" container.innerhtml=\"\\n      \" (user.login=\"\" '<a=\"\" class=\"gitment-editor-avatar\" href=\"' + user.html_url + '\" target=\"_blank\">\\n            <img class=\"gitment-editor-avatar-img\" src=\"/js/' + user.avatar_url + '\">\\n          ' : user.isLoggingIn ? '<div class=\"gitment-editor-avatar\">' + _icons.spinner + '</div>' : '<a class=\"gitment-editor-avatar\" href=\"' + instance.loginLink + '\" title=\"login with GitHub\">\\n              ' + _icons.github + '\\n            </a>') + '\\n    \\n    <div class=\"gitment-editor-main\">\\n      <div class=\"gitment-editor-header\">\\n        <nav class=\"gitment-editor-tabs\">\\n          <button class=\"gitment-editor-tab gitment-selected\">Write</button>\\n          <button class=\"gitment-editor-tab\">Preview</button>\\n        </nav>\\n        <div class=\"gitment-editor-login\">\\n          ' + (user.login ? '<a class=\"gitment-editor-logout-link\">Logout</a>' : user.isLoggingIn ? 'Logging in...' : '<a class=\"gitment-editor-login-link\" href=\"' + instance.loginLink + '\">Login</a> with GitHub') + '\\n        </div>\\n      </div>\\n      <div class=\"gitment-editor-body\">\\n        <div class=\"gitment-editor-write-field\">\\n          <textarea placeholder=\"Leave a comment\" title=\"' + disabledTip + '\" '=\"\" +=\"\" shoulddisable=\"\"></textarea>\\n        </div>\\n        <div class=\"gitment-editor-preview-field gitment-hidden\">\\n          <div class=\"gitment-editor-preview gitment-markdown\"></div>\\n        </div>\\n      </div>\\n    </div>\\n    <div class=\"gitment-editor-footer\">\\n      <a class=\"gitment-editor-footer-tip\" href=\"https://guides.github.com/features/mastering-markdown/\" target=\"_blank\">\\n        Styling with Markdown is supported\\n      </a>\\n      <button class=\"gitment-editor-submit\" title=\"' + disabledTip + '\" '=\"\" +=\"\" shoulddisable=\"\">Comment</button>\\n    </div>\\n  ';\n  if (user.login) {\n    container.querySelector('.gitment-editor-logout-link').onclick = function () {\n      return instance.logout();\n    };\n  }\n\n  var writeField = container.querySelector('.gitment-editor-write-field');\n  var previewField = container.querySelector('.gitment-editor-preview-field');\n\n  var textarea = writeField.querySelector('textarea');\n  textarea.oninput = function () {\n    textarea.style.height = 'auto';\n    var style = window.getComputedStyle(textarea, null);\n    var height = parseInt(style.height, 10);\n    var clientHeight = textarea.clientHeight;\n    var scrollHeight = textarea.scrollHeight;\n    if (clientHeight < scrollHeight) {\n      textarea.style.height = height + scrollHeight - clientHeight + 'px';\n    }\n  };\n\n  var _container$querySelec = container.querySelectorAll('.gitment-editor-tab'),\n      _container$querySelec2 = _slicedToArray(_container$querySelec, 2),\n      writeTab = _container$querySelec2[0],\n      previewTab = _container$querySelec2[1];\n\n  writeTab.onclick = function () {\n    writeTab.classList.add('gitment-selected');\n    previewTab.classList.remove('gitment-selected');\n    writeField.classList.remove('gitment-hidden');\n    previewField.classList.add('gitment-hidden');\n\n    textarea.focus();\n  };\n  previewTab.onclick = function () {\n    previewTab.classList.add('gitment-selected');\n    writeTab.classList.remove('gitment-selected');\n    previewField.classList.remove('gitment-hidden');\n    writeField.classList.add('gitment-hidden');\n\n    var preview = previewField.querySelector('.gitment-editor-preview');\n    var content = textarea.value.trim();\n    if (!content) {\n      preview.innerText = 'Nothing to preview';\n      return;\n    }\n\n    preview.innerText = 'Loading preview...';\n    instance.markdown(content).then(function (html) {\n      return preview.innerHTML = html;\n    });\n  };\n\n  var submitButton = container.querySelector('.gitment-editor-submit');\n  submitButton.onclick = function () {\n    submitButton.innerText = 'Submitting...';\n    submitButton.setAttribute('disabled', true);\n    instance.post(textarea.value.trim()).then(function (data) {\n      textarea.value = '';\n      textarea.style.height = 'auto';\n      submitButton.removeAttribute('disabled');\n      submitButton.innerText = 'Comment';\n    }).catch(function (e) {\n      alert(e);\n      submitButton.removeAttribute('disabled');\n      submitButton.innerText = 'Comment';\n    });\n  };\n\n  return container;\n}\n\nfunction renderFooter() {\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-footer-container';\n  container.innerHTML = '\\n    Powered by\\n    <a class=\"gitment-footer-project-link\" href=\"https://github.com/imsun/gitment\" target=\"_blank\">\\n      Gitment\\n    </a>\\n  ';\n  return container;\n}\n\nfunction render(state, instance) {\n  var container = document.createElement('div');\n  container.lang = \"en-US\";\n  container.className = 'gitment-container gitment-root-container';\n  container.appendChild(instance.renderHeader(state, instance));\n  container.appendChild(instance.renderComments(state, instance));\n  container.appendChild(instance.renderEditor(state, instance));\n  container.appendChild(instance.renderFooter(state, instance));\n  return container;\n}\n\nexports.default = { render: render, renderHeader: renderHeader, renderComments: renderComments, renderEditor: renderEditor, renderFooter: renderFooter };\n\n/***/ }),\n/* 3 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.http = exports.Query = exports.isString = undefined;\n\nvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\nexports.getTargetContainer = getTargetContainer;\n\nvar _constants = __webpack_require__(0);\n\nvar isString = exports.isString = function isString(s) {\n  return toString.call(s) === '[object String]';\n};\n\nfunction getTargetContainer(container) {\n  var targetContainer = void 0;\n  if (container instanceof Element) {\n    targetContainer = container;\n  } else if (isString(container)) {\n    targetContainer = document.getElementById(container);\n  } else {\n    targetContainer = document.createElement('div');\n  }\n\n  return targetContainer;\n}\n\nvar Query = exports.Query = {\n  parse: function parse() {\n    var search = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : window.location.search;\n\n    if (!search) return {};\n    var queryString = search[0] === '?' ? search.substring(1) : search;\n    var query = {};\n    queryString.split('&').forEach(function (queryStr) {\n      var _queryStr$split = queryStr.split('='),\n          _queryStr$split2 = _slicedToArray(_queryStr$split, 2),\n          key = _queryStr$split2[0],\n          value = _queryStr$split2[1];\n\n      if (key) query[key] = value;\n    });\n\n    return query;\n  },\n  stringify: function stringify(query) {\n    var prefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '?';\n\n    var queryString = Object.keys(query).map(function (key) {\n      return key + '=' + encodeURIComponent(query[key] || '');\n    }).join('&');\n    return queryString ? prefix + queryString : '';\n  }\n};\n\nfunction ajaxFactory(method) {\n  return function (apiPath) {\n    var data = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    var base = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'https://api.github.com';\n\n    var req = new XMLHttpRequest();\n    var token = localStorage.getItem(_constants.LS_ACCESS_TOKEN_KEY);\n\n    var url = '' + base + apiPath;\n    var body = null;\n    if (method === 'GET' || method === 'DELETE') {\n      url += Query.stringify(data);\n    }\n\n    var p = new Promise(function (resolve, reject) {\n      req.addEventListener('load', function () {\n        var contentType = req.getResponseHeader('content-type');\n        var res = req.responseText;\n        if (!/json/.test(contentType)) {\n          resolve(res);\n          return;\n        }\n        var data = req.responseText ? JSON.parse(res) : {};\n        if (data.message) {\n          reject(new Error(data.message));\n        } else {\n          resolve(data);\n        }\n      });\n      req.addEventListener('error', function (error) {\n        return reject(error);\n      });\n    });\n    req.open(method, url, true);\n\n    req.setRequestHeader('Accept', 'application/vnd.github.squirrel-girl-preview, application/vnd.github.html+json');\n    if (token) {\n      req.setRequestHeader('Authorization', 'token ' + token);\n    }\n    if (method !== 'GET' && method !== 'DELETE') {\n      body = JSON.stringify(data);\n      req.setRequestHeader('Content-Type', 'application/json');\n    }\n\n    req.send(body);\n    return p;\n  };\n}\n\nvar http = exports.http = {\n  get: ajaxFactory('GET'),\n  post: ajaxFactory('POST'),\n  delete: ajaxFactory('DELETE'),\n  put: ajaxFactory('PUT')\n};\n\n/***/ }),\n/* 4 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj; };\n\nvar g;\n\n// This works in non-strict mode\ng = function () {\n\treturn this;\n}();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || Function(\"return this\")() || (1, eval)(\"this\");\n} catch (e) {\n\t// This works if the window reference is available\n\tif ((typeof window === \"undefined\" ? \"undefined\" : _typeof(window)) === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n\n/***/ }),\n/* 5 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _mobx = __webpack_require__(1);\n\nvar _constants = __webpack_require__(0);\n\nvar _utils = __webpack_require__(3);\n\nvar _default = __webpack_require__(2);\n\nvar _default2 = _interopRequireDefault(_default);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar scope = 'public_repo';\n\nfunction extendRenderer(instance, renderer) {\n  instance[renderer] = function (container) {\n    var targetContainer = (0, _utils.getTargetContainer)(container);\n    var render = instance.theme[renderer] || instance.defaultTheme[renderer];\n\n    (0, _mobx.autorun)(function () {\n      var e = render(instance.state, instance);\n      if (targetContainer.firstChild) {\n        targetContainer.replaceChild(e, targetContainer.firstChild);\n      } else {\n        targetContainer.appendChild(e);\n      }\n    });\n\n    return targetContainer;\n  };\n}\n\nvar Gitment = function () {\n  _createClass(Gitment, [{\n    key: 'accessToken',\n    get: function get() {\n      return localStorage.getItem(_constants.LS_ACCESS_TOKEN_KEY);\n    },\n    set: function set(token) {\n      localStorage.setItem(_constants.LS_ACCESS_TOKEN_KEY, token);\n    }\n  }, {\n    key: 'loginLink',\n    get: function get() {\n      var oauthUri = 'https://github.com/login/oauth/authorize';\n      var redirect_uri = this.oauth.redirect_uri || window.location.href;\n\n      var oauthParams = Object.assign({\n        scope: scope,\n        redirect_uri: redirect_uri\n      }, this.oauth);\n\n      return '' + oauthUri + _utils.Query.stringify(oauthParams);\n    }\n  }]);\n\n  function Gitment() {\n    var _this = this;\n\n    var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n    _classCallCheck(this, Gitment);\n\n    this.defaultTheme = _default2.default;\n    this.useTheme(_default2.default);\n\n    Object.assign(this, {\n      id: window.location.href,\n      title: window.document.title,\n      link: window.location.href,\n      desc: '',\n      labels: [],\n      theme: _default2.default,\n      oauth: {},\n      perPage: 20,\n      maxCommentHeight: 250\n    }, options);\n\n    this.useTheme(this.theme);\n\n    var user = {};\n    try {\n      var userInfo = localStorage.getItem(_constants.LS_USER_KEY);\n      if (this.accessToken && userInfo) {\n        Object.assign(user, JSON.parse(userInfo), {\n          fromCache: true\n        });\n      }\n    } catch (e) {\n      localStorage.removeItem(_constants.LS_USER_KEY);\n    }\n\n    this.state = (0, _mobx.observable)({\n      user: user,\n      error: null,\n      meta: {},\n      comments: undefined,\n      reactions: [],\n      commentReactions: {},\n      currentPage: 1\n    });\n\n    var query = _utils.Query.parse();\n    if (query.code) {\n      var _oauth = this.oauth,\n          client_id = _oauth.client_id,\n          client_secret = _oauth.client_secret;\n\n      var code = query.code;\n      delete query.code;\n      var search = _utils.Query.stringify(query);\n      var replacedUrl = '' + window.location.origin + window.location.pathname + search + window.location.hash;\n      history.replaceState({}, '', replacedUrl);\n\n      Object.assign(this, {\n        id: replacedUrl,\n        link: replacedUrl\n      }, options);\n\n      this.state.user.isLoggingIn = true;\n      _utils.http.post('https://gh-oauth.imsun.net', {\n        code: code,\n        client_id: client_id,\n        client_secret: client_secret\n      }, '').then(function (data) {\n        _this.accessToken = data.access_token;\n        _this.update();\n      }).catch(function (e) {\n        _this.state.user.isLoggingIn = false;\n        alert(e);\n      });\n    } else {\n      this.update();\n    }\n  }\n\n  _createClass(Gitment, [{\n    key: 'init',\n    value: function init() {\n      var _this2 = this;\n\n      return this.createIssue().then(function () {\n        return _this2.loadComments();\n      }).then(function (comments) {\n        _this2.state.error = null;\n        return comments;\n      });\n    }\n  }, {\n    key: 'useTheme',\n    value: function useTheme() {\n      var _this3 = this;\n\n      var theme = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n      this.theme = theme;\n\n      var renderers = Object.keys(this.theme);\n      renderers.forEach(function (renderer) {\n        return extendRenderer(_this3, renderer);\n      });\n    }\n  }, {\n    key: 'update',\n    value: function update() {\n      var _this4 = this;\n\n      return Promise.all([this.loadMeta(), this.loadUserInfo()]).then(function () {\n        return Promise.all([_this4.loadComments().then(function () {\n          return _this4.loadCommentReactions();\n        }), _this4.loadReactions()]);\n      }).catch(function (e) {\n        return _this4.state.error = e;\n      });\n    }\n  }, {\n    key: 'markdown',\n    value: function markdown(text) {\n      return _utils.http.post('/markdown', {\n        text: text,\n        mode: 'gfm'\n      });\n    }\n  }, {\n    key: 'createIssue',\n    value: function createIssue() {\n      var _this5 = this;\n\n      var id = this.id,\n          owner = this.owner,\n          repo = this.repo,\n          title = this.title,\n          link = this.link,\n          desc = this.desc,\n          labels = this.labels;\n\n\n      return _utils.http.post('/repos/' + owner + '/' + repo + '/issues', {\n        title: title,\n        labels: labels.concat(['gitment', id]),\n        body: link + '\\n\\n' + desc\n      }).then(function (meta) {\n        _this5.state.meta = meta;\n        return meta;\n      });\n    }\n  }, {\n    key: 'getIssue',\n    value: function getIssue() {\n      if (this.state.meta.id) return Promise.resolve(this.state.meta);\n\n      return this.loadMeta();\n    }\n  }, {\n    key: 'post',\n    value: function post(body) {\n      var _this6 = this;\n\n      return this.getIssue().then(function (issue) {\n        return _utils.http.post(issue.comments_url, { body: body }, '');\n      }).then(function (data) {\n        _this6.state.meta.comments++;\n        var pageCount = Math.ceil(_this6.state.meta.comments / _this6.perPage);\n        if (_this6.state.currentPage === pageCount) {\n          _this6.state.comments.push(data);\n        }\n        return data;\n      });\n    }\n  }, {\n    key: 'loadMeta',\n    value: function loadMeta() {\n      var _this7 = this;\n\n      var id = this.id,\n          owner = this.owner,\n          repo = this.repo;\n\n      return _utils.http.get('/repos/' + owner + '/' + repo + '/issues', {\n        creator: owner,\n        labels: id\n      }).then(function (issues) {\n        if (!issues.length) return Promise.reject(_constants.NOT_INITIALIZED_ERROR);\n        _this7.state.meta = issues[0];\n        return issues[0];\n      });\n    }\n  }, {\n    key: 'loadComments',\n    value: function loadComments() {\n      var _this8 = this;\n\n      var page = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.state.currentPage;\n\n      return this.getIssue().then(function (issue) {\n        return _utils.http.get(issue.comments_url, { page: page, per_page: _this8.perPage }, '');\n      }).then(function (comments) {\n        _this8.state.comments = comments;\n        return comments;\n      });\n    }\n  }, {\n    key: 'loadUserInfo',\n    value: function loadUserInfo() {\n      var _this9 = this;\n\n      if (!this.accessToken) {\n        this.logout();\n        return Promise.resolve({});\n      }\n\n      return _utils.http.get('/user').then(function (user) {\n        _this9.state.user = user;\n        localStorage.setItem(_constants.LS_USER_KEY, JSON.stringify(user));\n        return user;\n      });\n    }\n  }, {\n    key: 'loadReactions',\n    value: function loadReactions() {\n      var _this10 = this;\n\n      if (!this.accessToken) {\n        this.state.reactions = [];\n        return Promise.resolve([]);\n      }\n\n      return this.getIssue().then(function (issue) {\n        if (!issue.reactions.total_count) return [];\n        return _utils.http.get(issue.reactions.url, {}, '');\n      }).then(function (reactions) {\n        _this10.state.reactions = reactions;\n        return reactions;\n      });\n    }\n  }, {\n    key: 'loadCommentReactions',\n    value: function loadCommentReactions() {\n      var _this11 = this;\n\n      if (!this.accessToken) {\n        this.state.commentReactions = {};\n        return Promise.resolve([]);\n      }\n\n      var comments = this.state.comments;\n      var comentReactions = {};\n\n      return Promise.all(comments.map(function (comment) {\n        if (!comment.reactions.total_count) return [];\n\n        var owner = _this11.owner,\n            repo = _this11.repo;\n\n        return _utils.http.get('/repos/' + owner + '/' + repo + '/issues/comments/' + comment.id + '/reactions', {});\n      })).then(function (reactionsArray) {\n        comments.forEach(function (comment, index) {\n          comentReactions[comment.id] = reactionsArray[index];\n        });\n        _this11.state.commentReactions = comentReactions;\n\n        return comentReactions;\n      });\n    }\n  }, {\n    key: 'login',\n    value: function login() {\n      window.location.href = this.loginLink;\n    }\n  }, {\n    key: 'logout',\n    value: function logout() {\n      localStorage.removeItem(_constants.LS_ACCESS_TOKEN_KEY);\n      localStorage.removeItem(_constants.LS_USER_KEY);\n      this.state.user = {};\n    }\n  }, {\n    key: 'goto',\n    value: function goto(page) {\n      this.state.currentPage = page;\n      this.state.comments = undefined;\n      return this.loadComments(page);\n    }\n  }, {\n    key: 'like',\n    value: function like() {\n      var _this12 = this;\n\n      if (!this.accessToken) {\n        alert('Login to Like');\n        return Promise.reject();\n      }\n\n      var owner = this.owner,\n          repo = this.repo;\n\n\n      return _utils.http.post('/repos/' + owner + '/' + repo + '/issues/' + this.state.meta.number + '/reactions', {\n        content: 'heart'\n      }).then(function (reaction) {\n        _this12.state.reactions.push(reaction);\n        _this12.state.meta.reactions.heart++;\n      });\n    }\n  }, {\n    key: 'unlike',\n    value: function unlike() {\n      var _this13 = this;\n\n      if (!this.accessToken) return Promise.reject();\n\n      var _state = this.state,\n          user = _state.user,\n          reactions = _state.reactions;\n\n      var index = reactions.findIndex(function (reaction) {\n        return reaction.user.login === user.login;\n      });\n      return _utils.http.delete('/reactions/' + reactions[index].id).then(function () {\n        reactions.splice(index, 1);\n        _this13.state.meta.reactions.heart--;\n      });\n    }\n  }, {\n    key: 'likeAComment',\n    value: function likeAComment(commentId) {\n      var _this14 = this;\n\n      if (!this.accessToken) {\n        alert('Login to Like');\n        return Promise.reject();\n      }\n\n      var owner = this.owner,\n          repo = this.repo;\n\n      var comment = this.state.comments.find(function (comment) {\n        return comment.id === commentId;\n      });\n\n      return _utils.http.post('/repos/' + owner + '/' + repo + '/issues/comments/' + commentId + '/reactions', {\n        content: 'heart'\n      }).then(function (reaction) {\n        _this14.state.commentReactions[commentId].push(reaction);\n        comment.reactions.heart++;\n      });\n    }\n  }, {\n    key: 'unlikeAComment',\n    value: function unlikeAComment(commentId) {\n      if (!this.accessToken) return Promise.reject();\n\n      var reactions = this.state.commentReactions[commentId];\n      var comment = this.state.comments.find(function (comment) {\n        return comment.id === commentId;\n      });\n      var user = this.state.user;\n\n      var index = reactions.findIndex(function (reaction) {\n        return reaction.user.login === user.login;\n      });\n\n      return _utils.http.delete('/reactions/' + reactions[index].id).then(function () {\n        reactions.splice(index, 1);\n        comment.reactions.heart--;\n      });\n    }\n  }]);\n\n  return Gitment;\n}();\n\nmodule.exports = Gitment;\n\n/***/ }),\n/* 6 */\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/**\n * Modified from https://github.com/evil-icons/evil-icons\n */\n\nvar close = exports.close = '<svg class=\"gitment-close-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewbox=\"0 0 50 50\"><path d=\"M37.304 11.282l1.414 1.414-26.022 26.02-1.414-1.413z\"/><path d=\"M12.696 11.282l26.022 26.02-1.414 1.415-26.022-26.02z\"/></svg>';\nvar github = exports.github = '<svg class=\"gitment-github-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewbox=\"0 0 50 50\"><path d=\"M25 10c-8.3 0-15 6.7-15 15 0 6.6 4.3 12.2 10.3 14.2.8.1 1-.3 1-.7v-2.6c-4.2.9-5.1-2-5.1-2-.7-1.7-1.7-2.2-1.7-2.2-1.4-.9.1-.9.1-.9 1.5.1 2.3 1.5 2.3 1.5 1.3 2.3 3.5 1.6 4.4 1.2.1-1 .5-1.6 1-2-3.3-.4-6.8-1.7-6.8-7.4 0-1.6.6-3 1.5-4-.2-.4-.7-1.9.1-4 0 0 1.3-.4 4.1 1.5 1.2-.3 2.5-.5 3.8-.5 1.3 0 2.6.2 3.8.5 2.9-1.9 4.1-1.5 4.1-1.5.8 2.1.3 3.6.1 4 1 1 1.5 2.4 1.5 4 0 5.8-3.5 7-6.8 7.4.5.5 1 1.4 1 2.8v4.1c0 .4.3.9 1 .7 6-2 10.2-7.6 10.2-14.2C40 16.7 33.3 10 25 10z\"/></svg>';\nvar heart = exports.heart = '<svg class=\"gitment-heart-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewbox=\"0 0 50 50\"><path d=\"M25 39.7l-.6-.5C11.5 28.7 8 25 8 19c0-5 4-9 9-9 4.1 0 6.4 2.3 8 4.1 1.6-1.8 3.9-4.1 8-4.1 5 0 9 4 9 9 0 6-3.5 9.7-16.4 20.2l-.6.5zM17 12c-3.9 0-7 3.1-7 7 0 5.1 3.2 8.5 15 18.1 11.8-9.6 15-13 15-18.1 0-3.9-3.1-7-7-7-3.5 0-5.4 2.1-6.9 3.8L25 17.1l-1.1-1.3C22.4 14.1 20.5 12 17 12z\"/></svg>';\nvar spinner = exports.spinner = '<svg class=\"gitment-spinner-icon\" xmlns=\"http://www.w3.org/2000/svg\" viewbox=\"0 0 50 50\"><path d=\"M25 18c-.6 0-1-.4-1-1V9c0-.6.4-1 1-1s1 .4 1 1v8c0 .6-.4 1-1 1z\"/><path opacity=\".3\" d=\"M25 42c-.6 0-1-.4-1-1v-8c0-.6.4-1 1-1s1 .4 1 1v8c0 .6-.4 1-1 1z\"/><path opacity=\".3\" d=\"M29 19c-.2 0-.3 0-.5-.1-.4-.3-.6-.8-.3-1.3l4-6.9c.3-.4.8-.6 1.3-.3.4.3.6.8.3 1.3l-4 6.9c-.2.2-.5.4-.8.4z\"/><path opacity=\".3\" d=\"M17 39.8c-.2 0-.3 0-.5-.1-.4-.3-.6-.8-.3-1.3l4-6.9c.3-.4.8-.6 1.3-.3.4.3.6.8.3 1.3l-4 6.9c-.2.2-.5.4-.8.4z\"/><path opacity=\".93\" d=\"M21 19c-.3 0-.6-.2-.8-.5l-4-6.9c-.3-.4-.1-1 .3-1.3.4-.3 1-.1 1.3.3l4 6.9c.3.4.1 1-.3 1.3-.2.2-.3.2-.5.2z\"/><path opacity=\".3\" d=\"M33 39.8c-.3 0-.6-.2-.8-.5l-4-6.9c-.3-.4-.1-1 .3-1.3.4-.3 1-.1 1.3.3l4 6.9c.3.4.1 1-.3 1.3-.2.1-.3.2-.5.2z\"/><path opacity=\".65\" d=\"M17 26H9c-.6 0-1-.4-1-1s.4-1 1-1h8c.6 0 1 .4 1 1s-.4 1-1 1z\"/><path opacity=\".3\" d=\"M41 26h-8c-.6 0-1-.4-1-1s.4-1 1-1h8c.6 0 1 .4 1 1s-.4 1-1 1z\"/><path opacity=\".86\" d=\"M18.1 21.9c-.2 0-.3 0-.5-.1l-6.9-4c-.4-.3-.6-.8-.3-1.3.3-.4.8-.6 1.3-.3l6.9 4c.4.3.6.8.3 1.3-.2.3-.5.4-.8.4z\"/><path opacity=\".3\" d=\"M38.9 33.9c-.2 0-.3 0-.5-.1l-6.9-4c-.4-.3-.6-.8-.3-1.3.3-.4.8-.6 1.3-.3l6.9 4c.4.3.6.8.3 1.3-.2.3-.5.4-.8.4z\"/><path opacity=\".44\" d=\"M11.1 33.9c-.3 0-.6-.2-.8-.5-.3-.4-.1-1 .3-1.3l6.9-4c.4-.3 1-.1 1.3.3.3.4.1 1-.3 1.3l-6.9 4c-.1.2-.3.2-.5.2z\"/><path opacity=\".3\" d=\"M31.9 21.9c-.3 0-.6-.2-.8-.5-.3-.4-.1-1 .3-1.3l6.9-4c.4-.3 1-.1 1.3.3.3.4.1 1-.3 1.3l-6.9 4c-.2.2-.3.2-.5.2z\"/></svg>';\n\n/***/ })\n/******/ ]);\n//# sourceMappingURL=gitment.browser.js.map</=></=></unnamed></not></unnamed></unnamed>"}],"Post":[{"title":"3分钟搞懂CSS3 Transform属性","date":"2018-01-17T06:59:34.000Z","picture":"transform.png","description":"transform是CSS3中非常有用的一个属性，今天我们就来挑战一下3分钟能否搞懂transform的基本用途吧~","_content":"\n欢迎光临我的博客[拓跋的前端客栈](http://tuobaye.com)，这个是[原文地址](http://tuobaye.com/2018/01/17/3%E5%88%86%E9%92%9F%E6%90%9E%E6%87%82CSS3-transform%E5%B1%9E%E6%80%A7/)。如果您发现我文章中存在错误，请尽情向我吐槽，大家一起学习一起进步φ(>ω<*)\n\n***\n\n> CSS transform 属性允许你修改CSS视觉格式模型的坐标空间。使用它，元素可以被转换（translate）、旋转（rotate）、缩放（scale）、倾斜（skew）。\n\n首先有个直观的印象，接下来放大招了~\n\n![transform转换](transform转换.png)\n\n怎么样，是不是很直观？如果图片不清晰，在图片上点击右键-“在新标签页中打开图片”，然后在图片上点放大镜就可以查看原图了。\n\n接下来有更直观的，我手写了一个简单的transform体验器，自己尝试一下吧：\n\n[transform体验器](http://tuobaye.com/demo/transform)\n\n不知道你搞懂了吗？\n\nPS:\n\n- transform是一个理解上很简单，使用起来却很有难度的属性。短时间内能理解80%就不错了，想完全掌握还需要多多练习。\n- 本例中为了尽可能缩短篇幅，没有涉及到transform中matrix部分和rotate3d的部分，想要继续深入的话可以自行查找资料学习。\n- translateZ()是一个很特别的属性，需要结合perspective(透视)来理解。perspective可以简单理解为视点与屏幕之间的距离。当未设置perspective属性时，translateZ()的变化不会有任何影响。而设置perspective以后，translateZ()就符合“近大远小”的规律，Z轴上离你越近，图形显示越大。直到大过perspective值的时候，你就看不见了，这时候你就可以理解为元素到你“脑后”去了，人理所当然的看不见脑后的东西。\n- skew比较难搞懂，直接在图里用文字很难描述清楚。这里引用[知乎-css3中-webkit-transform 的 skew 如何使用？](https://www.zhihu.com/question/21725826)中Kori Lee的回复比较容易理解\n\n![skew](skew.png)","source":"_posts/3分钟搞懂CSS3-transform属性.md","raw":"---\ntitle: 3分钟搞懂CSS3 transform属性\ndate: 2018-01-17 14:59:34\ntags: CSS\npicture: transform.png\ndescription: transform是CSS3中非常有用的一个属性，今天我们就来挑战一下3分钟能否搞懂transform的基本用途吧~\n---\n\n欢迎光临我的博客[拓跋的前端客栈](http://tuobaye.com)，这个是[原文地址](http://tuobaye.com/2018/01/17/3%E5%88%86%E9%92%9F%E6%90%9E%E6%87%82CSS3-transform%E5%B1%9E%E6%80%A7/)。如果您发现我文章中存在错误，请尽情向我吐槽，大家一起学习一起进步φ(>ω<*)\n\n***\n\n> CSS transform 属性允许你修改CSS视觉格式模型的坐标空间。使用它，元素可以被转换（translate）、旋转（rotate）、缩放（scale）、倾斜（skew）。\n\n首先有个直观的印象，接下来放大招了~\n\n![transform转换](transform转换.png)\n\n怎么样，是不是很直观？如果图片不清晰，在图片上点击右键-“在新标签页中打开图片”，然后在图片上点放大镜就可以查看原图了。\n\n接下来有更直观的，我手写了一个简单的transform体验器，自己尝试一下吧：\n\n[transform体验器](http://tuobaye.com/demo/transform)\n\n不知道你搞懂了吗？\n\nPS:\n\n- transform是一个理解上很简单，使用起来却很有难度的属性。短时间内能理解80%就不错了，想完全掌握还需要多多练习。\n- 本例中为了尽可能缩短篇幅，没有涉及到transform中matrix部分和rotate3d的部分，想要继续深入的话可以自行查找资料学习。\n- translateZ()是一个很特别的属性，需要结合perspective(透视)来理解。perspective可以简单理解为视点与屏幕之间的距离。当未设置perspective属性时，translateZ()的变化不会有任何影响。而设置perspective以后，translateZ()就符合“近大远小”的规律，Z轴上离你越近，图形显示越大。直到大过perspective值的时候，你就看不见了，这时候你就可以理解为元素到你“脑后”去了，人理所当然的看不见脑后的东西。\n- skew比较难搞懂，直接在图里用文字很难描述清楚。这里引用[知乎-css3中-webkit-transform 的 skew 如何使用？](https://www.zhihu.com/question/21725826)中Kori Lee的回复比较容易理解\n\n![skew](skew.png)","slug":"3分钟搞懂CSS3-transform属性","published":1,"updated":"2018-03-04T15:08:12.766Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk698hx60001znzwnvdh4rvr","content":"<p>欢迎光临我的博客<a href=\"http://tuobaye.com\" target=\"_blank\" rel=\"noopener\">拓跋的前端客栈</a>，这个是<a href=\"http://tuobaye.com/2018/01/17/3%E5%88%86%E9%92%9F%E6%90%9E%E6%87%82CSS3-transform%E5%B1%9E%E6%80%A7/\" target=\"_blank\" rel=\"noopener\">原文地址</a>。如果您发现我文章中存在错误，请尽情向我吐槽，大家一起学习一起进步φ(&gt;ω&lt;*)</p>\n<hr>\n<blockquote>\n<p>CSS transform 属性允许你修改CSS视觉格式模型的坐标空间。使用它，元素可以被转换（translate）、旋转（rotate）、缩放（scale）、倾斜（skew）。</p>\n</blockquote>\n<p>首先有个直观的印象，接下来放大招了~</p>\n<p><img src=\"/2018/01/17/3分钟搞懂CSS3-transform属性/transform转换.png\" alt=\"transform转换\"></p>\n<p>怎么样，是不是很直观？如果图片不清晰，在图片上点击右键-“在新标签页中打开图片”，然后在图片上点放大镜就可以查看原图了。</p>\n<p>接下来有更直观的，我手写了一个简单的transform体验器，自己尝试一下吧：</p>\n<p><a href=\"http://tuobaye.com/demo/transform\" target=\"_blank\" rel=\"noopener\">transform体验器</a></p>\n<p>不知道你搞懂了吗？</p>\n<p>PS:</p>\n<ul>\n<li>transform是一个理解上很简单，使用起来却很有难度的属性。短时间内能理解80%就不错了，想完全掌握还需要多多练习。</li>\n<li>本例中为了尽可能缩短篇幅，没有涉及到transform中matrix部分和rotate3d的部分，想要继续深入的话可以自行查找资料学习。</li>\n<li>translateZ()是一个很特别的属性，需要结合perspective(透视)来理解。perspective可以简单理解为视点与屏幕之间的距离。当未设置perspective属性时，translateZ()的变化不会有任何影响。而设置perspective以后，translateZ()就符合“近大远小”的规律，Z轴上离你越近，图形显示越大。直到大过perspective值的时候，你就看不见了，这时候你就可以理解为元素到你“脑后”去了，人理所当然的看不见脑后的东西。</li>\n<li>skew比较难搞懂，直接在图里用文字很难描述清楚。这里引用<a href=\"https://www.zhihu.com/question/21725826\" target=\"_blank\" rel=\"noopener\">知乎-css3中-webkit-transform 的 skew 如何使用？</a>中Kori Lee的回复比较容易理解</li>\n</ul>\n<p><img src=\"/2018/01/17/3分钟搞懂CSS3-transform属性/skew.png\" alt=\"skew\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>欢迎光临我的博客<a href=\"http://tuobaye.com\" target=\"_blank\" rel=\"noopener\">拓跋的前端客栈</a>，这个是<a href=\"http://tuobaye.com/2018/01/17/3%E5%88%86%E9%92%9F%E6%90%9E%E6%87%82CSS3-transform%E5%B1%9E%E6%80%A7/\" target=\"_blank\" rel=\"noopener\">原文地址</a>。如果您发现我文章中存在错误，请尽情向我吐槽，大家一起学习一起进步φ(&gt;ω&lt;*)</p>\n<hr>\n<blockquote>\n<p>CSS transform 属性允许你修改CSS视觉格式模型的坐标空间。使用它，元素可以被转换（translate）、旋转（rotate）、缩放（scale）、倾斜（skew）。</p>\n</blockquote>\n<p>首先有个直观的印象，接下来放大招了~</p>\n<p><img src=\"/2018/01/17/3分钟搞懂CSS3-transform属性/transform转换.png\" alt=\"transform转换\"></p>\n<p>怎么样，是不是很直观？如果图片不清晰，在图片上点击右键-“在新标签页中打开图片”，然后在图片上点放大镜就可以查看原图了。</p>\n<p>接下来有更直观的，我手写了一个简单的transform体验器，自己尝试一下吧：</p>\n<p><a href=\"http://tuobaye.com/demo/transform\" target=\"_blank\" rel=\"noopener\">transform体验器</a></p>\n<p>不知道你搞懂了吗？</p>\n<p>PS:</p>\n<ul>\n<li>transform是一个理解上很简单，使用起来却很有难度的属性。短时间内能理解80%就不错了，想完全掌握还需要多多练习。</li>\n<li>本例中为了尽可能缩短篇幅，没有涉及到transform中matrix部分和rotate3d的部分，想要继续深入的话可以自行查找资料学习。</li>\n<li>translateZ()是一个很特别的属性，需要结合perspective(透视)来理解。perspective可以简单理解为视点与屏幕之间的距离。当未设置perspective属性时，translateZ()的变化不会有任何影响。而设置perspective以后，translateZ()就符合“近大远小”的规律，Z轴上离你越近，图形显示越大。直到大过perspective值的时候，你就看不见了，这时候你就可以理解为元素到你“脑后”去了，人理所当然的看不见脑后的东西。</li>\n<li>skew比较难搞懂，直接在图里用文字很难描述清楚。这里引用<a href=\"https://www.zhihu.com/question/21725826\" target=\"_blank\" rel=\"noopener\">知乎-css3中-webkit-transform 的 skew 如何使用？</a>中Kori Lee的回复比较容易理解</li>\n</ul>\n<p><img src=\"/2018/01/17/3分钟搞懂CSS3-transform属性/skew.png\" alt=\"skew\"></p>\n"},{"title":"Nginx 配置指南","date":"2017-11-11T02:50:50.000Z","description":"Nginx是最初由Igor Sysoev编写的HTTP和反向代理服务器，邮件代理服务器和通用TCP/UDP代理服务器。很长时间以来，它一直在许多重负荷的俄罗斯网站上运行，包括Yandex，Mail.Ru，VK和Rambler。根据Netcraft，2017年10月，Nginx服务或代理了29.43％最繁忙的站点。下面是一些成功案例：Dropbox，Netflix，Wordpress.com，FastMail.FM。这篇文章可以帮你快速入门Nginx，了解Nginx的优势所在，并可以尝试搭建静态服务器和简单的反向代理服务器。","picture":"nginx.png","_content":"\n## 什么是Nginx？\n\n***\n\n![Nginx](nginx.png)\n\n没有什么文档比直接从[Nginx官网]()来的更准确清晰了。\n\n> Nginx [engine x] is an HTTP and reverse proxy server, a mail proxy server, and a generic TCP/UDP proxy server, originally written by Igor Sysoev. For a long time, it has been running on many heavily loaded Russian sites including Yandex, Mail.Ru, VK, and Rambler. According to Netcraft, Nginx served or proxied 29.43% busiest sites in October 2017. Here are some of the success stories: Dropbox, Netflix, Wordpress.com, FastMail.FM.\n\nNginx [engine x]是最初由Igor Sysoev编写的HTTP和反向代理服务器，邮件代理服务器和通用TCP/UDP代理服务器。很长时间以来，它一直在许多重负荷的俄罗斯网站上运行，包括Yandex，Mail.Ru，VK和Rambler。根据Netcraft，2017年10月，Nginx服务或代理了 29.43％最繁忙的站点。下面是一些成功案例： Dropbox， Netflix， Wordpress.com， FastMail.FM。\n\nNginx的主要特性：\n- Basic HTTP server features(基本的HTTP服务器功能)\n- Other HTTP server features(其他HTTP服务器功能)\n- Mail proxy server features(邮件代理服务器功能)\n- TCP/UDP proxy server features(TCP/UDP代理服务器功能)\n- Architecture and scalability(架构和可扩展性)\n\n## 为什么要使用Nginx，跟以前用的tomcat有什么区别？\n\n***\n\n虽然大家都叫web server，但是Nginx和tomcat有本质的不同。\n\nNginx常用来做静态内容服务器和代理服务器，用来放置静态资源或者转发请求给后面的应用服务；而tomcat常用来做应用容器，让java app在其中运行。\n\n因此，严格来说，Nginx应该叫<span style=\"color:red\">HTTP Server</span>，而tomcat则是一个<span style=\"color:red\">Application Server</span>\n\n一个 HTTP Server关心的是HTTP协议层面的传输和访问控制，所以在Nginx上你可以看到代理、负载均衡等功能。客户端通过HTTP Server 访问服务器上存储的资源（HTML 文件、图片文件等等）。通过CGI技术，也可以将处理过的内容通过HTTP Server分发，但是一个HTTP Server始终只是把服务器上的文件如实的通过HTTP协议传输给客户端。\n\n而应用服务器，则是一个应用执行的容器。它首先需要支持开发语言的 Runtime（对于 Tomcat 来说，就是 Java），保证应用能够在应用服务器上正常运行。其次，需要支持应用相关的规范，例如类库、安全方面的特性。对于 Tomcat 来说，就是需要提供 JSP/Sevlet 运行需要的标准类库、Interface 等。为了方便，应用服务器往往也会集成 HTTP Server 的功能，但是不如专业的 HTTP Server 那么强大，所以应用服务器往往是运行在 HTTP Server 的背后，执行应用，将动态的内容转化为静态的内容之后，通过 HTTP Server 分发到客户端。\n\n于我个人来说，选择Nginx主要是因为其占用资源低的优点，比起tomcat，选择Nginx能给我释放大量的系统内存，供我其他IDE和chrome使用。\n\n## nginx.conf配置文件指南\n\n***\n\nNginx的安装，启动，关闭等步骤的教程在这里我们就不做赘述了，我们来主要谈一谈nginx.conf文件应该如何配置，这是nginx的灵魂所在。\n\n### Nginx配置文件结构\n\nnginx包含由配置文件中指定的指令控制的模块。指令分为**简单指令**和**块指令**。\n\n一个简单的指令由**名称**和**参数**组成，以空格分隔，并以分号（;）结束:\n\n{% codeblock lang:javascript %}\n    root /data/www;\n{% endcodeblock %}\n\n一个block指令和一个简单的指令有相同的结构，但是**不是以分号结尾，而是用一系列由大括号（{和}）包围的附加指令来结束**。如果一个block指令在大括号内可以有其他的指令，它就被称为一个context（上下文，例如：events，http，server和location）:\n\n{% codeblock lang:javascript %}\n    http {\n        server {\n            #location / {\n                 proxy_pass   http://127.0.0.1:8090/;\n                 proxy_redirect  http://127.0.0.1:8090/ /;\n                 proxy_connect_timeout 600s;\n                 proxy_read_timeout 600s;\n                 proxy_send_timeout 600s;\n            }\n        }\n    }\n{% endcodeblock %}\n\n置于任何context之外的配置文件中的指令被认为是在main context中。在*events*和*http*指令驻留在main content中，*server*是在*http*中，*location*则在*server*中。\n\n#后面的部分是注释：\n\n{% codeblock lang:javascript %}\n    # 这是一段注释\n{% endcodeblock %}\n\n### Nginx作为静态服务器使用\n\n作为一个Web服务器，其最主要的任务是作为静态服务器使用。\n\n你需要将静态网页和文件放到一个目录（例如/data/www），将图片等文件放到另一个目录（例如/data/images），然后在nginx.conf中进行配置。这需要在*http*模块下的*server*模块内新建两个*location*模块：\n\n{% codeblock lang:nginx %}\n    http {\n        server {\n            location / {\n                root /data/www;\n            }\n            location /images/ {\n                root /data;\n            }\n        }\n    }\n{% endcodeblock %}\n\n看起来很好理解吧~也可以直接把文件放到一块，直接location配置绝对路径：\n\n{% codeblock lang:nginx %}\n    location / {\n        root   F:\\webapp\\portal;\n    }\n{% endcodeblock %}\n\nNginx在未配置监听端口的情况下默认监听80端口，因此，你可以通过在本地访问 http://localhost/ 或者 http://127.0.0.1/ 来访问你的网站。\n\n怎么样？赶紧启动一下Nginx吧，你的静态网站已经可以在本地运行了！修改配置后重启Nginx的命令是：\n\n{% codeblock lang:javascript %}\n    nginx -s reload\n{% endcodeblock %}\n\n如果您的Nginx无法启动或者出现其他错误，您可以尝试在 */usr/local/nginx/logs* 或者 */var/log/nginx* 中的 *access.log* 以及 *error.log* 中查找原因\n\n### 搭建简单的代理服务器\n\nNginx经常作为反向代理服务器来使用，这意味着Nginx服务器接收请求，将其传递给被代理服务器，从中检索响应并将其发送给客户端。\n\n> 反向代理（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。通过在网络各处放置反向代理节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络，CDN系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。\n\n下面，我们将配置一个基本的代理服务器，它会处理本地图片文件的请求并返回其他的请求给被代理的服务器。在这个例子中，两个服务器将在一个Nginx实例上定义。\n\n首先，在nginx的配置文件中增加一个server块来定义代理服务器，其中包含以下内容：\n\n{% codeblock lang:nginx %}\n    server {\n        listen 8080;\n        root /data/up1;\n        location / {\n        }\n    }\n{% endcodeblock %}\n\n这将是一个简单的服务器，它监听8080端口。（如果不定义listen值的话，默认监听80端口）并将所有请求映射到本地文件系统上的目录/data/up1。创建这个目录并把index.html文件放进去。请注意，该root指令放置在server context中。当响应请求的 location 区块中，没有自己的 root 指令，上述的 root 指令才会被使用。\n\n接下来，使用上一节中的服务器配置并对其进行修改，使其成为代理服务器配置。在第一个location块中，设置proxy_pass 指令，并在参数中配置指定的代理服务器的协议、名称和端口号（在我们的例子中是这样 http://localhost:8080）：\n\n{% codeblock lang:nginx %}\n    server {\n        location / {\n            proxy_pass http://localhost:8080;\n        }\n        location /images/ {\n            root /data;\n        }\n    }\n{% endcodeblock %}\n\n我们将修改第二个location块，它将当前带有/images/前缀的请求映射到/data/images目录下，使其与具有典型文件扩展名的图像请求匹配。修改的location块如下所示：\n\n{% codeblock lang:nginx %}\n    location ~ \\.(gif|jpg|png)$ {\n        root /data/images;\n    }\n{% endcodeblock %}\n\n该参数是一个正则表达式，它会匹配所有以.gif、.jpg 或者.png结尾的URI。一个正则表达式需要以~开头。匹配到的请求会被映射到/data/images目录下。\n\n当Nginx通过location去响应一个请求时，它会先检测带有前缀的location指令，兽先是检测带有**最长**前缀的 location，其次检测正则表达式。如果被正则的匹配的规则匹配成功，Nginx会选择使用该location的规则，否则，会选择之前缓存的规则。\n\n最终，一个代理服务器的配置结果如下：\n\n{% codeblock lang:nginx %}\n    server {\n        location / {\n            proxy_pass http://localhost:8080/;\n        }\n        location ~ \\.(gif|jpg|png)$ {\n            root /data/images;\n        }\n    }\n{% endcodeblock %}\n\n该服务器将过滤以.gif、.jpg或者.png结尾的请求，并将它们映射到/data/images目录（通过添加URI到root指令的参数），并将所有其他请求传递给上述代理服务器。\n\n要应用新配置，请保存修改后的配置文件，并nginx -s reload一下。\n\n更多Nginx代理配置指令，尽在[ngx_http_proxy_module](https://nginx.org/en/docs/http/ngx_http_proxy_module.html)\n\n## 参考文献","source":"_posts/Nginx 配置指南.md","raw":"---\ntitle: Nginx 配置指南\ndate: 2017-11-11 10:50:50\ntags: Nginx\ndescription: Nginx是最初由Igor Sysoev编写的HTTP和反向代理服务器，邮件代理服务器和通用TCP/UDP代理服务器。很长时间以来，它一直在许多重负荷的俄罗斯网站上运行，包括Yandex，Mail.Ru，VK和Rambler。根据Netcraft，2017年10月，Nginx服务或代理了29.43％最繁忙的站点。下面是一些成功案例：Dropbox，Netflix，Wordpress.com，FastMail.FM。这篇文章可以帮你快速入门Nginx，了解Nginx的优势所在，并可以尝试搭建静态服务器和简单的反向代理服务器。\npicture: nginx.png\n---\n\n## 什么是Nginx？\n\n***\n\n![Nginx](nginx.png)\n\n没有什么文档比直接从[Nginx官网]()来的更准确清晰了。\n\n> Nginx [engine x] is an HTTP and reverse proxy server, a mail proxy server, and a generic TCP/UDP proxy server, originally written by Igor Sysoev. For a long time, it has been running on many heavily loaded Russian sites including Yandex, Mail.Ru, VK, and Rambler. According to Netcraft, Nginx served or proxied 29.43% busiest sites in October 2017. Here are some of the success stories: Dropbox, Netflix, Wordpress.com, FastMail.FM.\n\nNginx [engine x]是最初由Igor Sysoev编写的HTTP和反向代理服务器，邮件代理服务器和通用TCP/UDP代理服务器。很长时间以来，它一直在许多重负荷的俄罗斯网站上运行，包括Yandex，Mail.Ru，VK和Rambler。根据Netcraft，2017年10月，Nginx服务或代理了 29.43％最繁忙的站点。下面是一些成功案例： Dropbox， Netflix， Wordpress.com， FastMail.FM。\n\nNginx的主要特性：\n- Basic HTTP server features(基本的HTTP服务器功能)\n- Other HTTP server features(其他HTTP服务器功能)\n- Mail proxy server features(邮件代理服务器功能)\n- TCP/UDP proxy server features(TCP/UDP代理服务器功能)\n- Architecture and scalability(架构和可扩展性)\n\n## 为什么要使用Nginx，跟以前用的tomcat有什么区别？\n\n***\n\n虽然大家都叫web server，但是Nginx和tomcat有本质的不同。\n\nNginx常用来做静态内容服务器和代理服务器，用来放置静态资源或者转发请求给后面的应用服务；而tomcat常用来做应用容器，让java app在其中运行。\n\n因此，严格来说，Nginx应该叫<span style=\"color:red\">HTTP Server</span>，而tomcat则是一个<span style=\"color:red\">Application Server</span>\n\n一个 HTTP Server关心的是HTTP协议层面的传输和访问控制，所以在Nginx上你可以看到代理、负载均衡等功能。客户端通过HTTP Server 访问服务器上存储的资源（HTML 文件、图片文件等等）。通过CGI技术，也可以将处理过的内容通过HTTP Server分发，但是一个HTTP Server始终只是把服务器上的文件如实的通过HTTP协议传输给客户端。\n\n而应用服务器，则是一个应用执行的容器。它首先需要支持开发语言的 Runtime（对于 Tomcat 来说，就是 Java），保证应用能够在应用服务器上正常运行。其次，需要支持应用相关的规范，例如类库、安全方面的特性。对于 Tomcat 来说，就是需要提供 JSP/Sevlet 运行需要的标准类库、Interface 等。为了方便，应用服务器往往也会集成 HTTP Server 的功能，但是不如专业的 HTTP Server 那么强大，所以应用服务器往往是运行在 HTTP Server 的背后，执行应用，将动态的内容转化为静态的内容之后，通过 HTTP Server 分发到客户端。\n\n于我个人来说，选择Nginx主要是因为其占用资源低的优点，比起tomcat，选择Nginx能给我释放大量的系统内存，供我其他IDE和chrome使用。\n\n## nginx.conf配置文件指南\n\n***\n\nNginx的安装，启动，关闭等步骤的教程在这里我们就不做赘述了，我们来主要谈一谈nginx.conf文件应该如何配置，这是nginx的灵魂所在。\n\n### Nginx配置文件结构\n\nnginx包含由配置文件中指定的指令控制的模块。指令分为**简单指令**和**块指令**。\n\n一个简单的指令由**名称**和**参数**组成，以空格分隔，并以分号（;）结束:\n\n{% codeblock lang:javascript %}\n    root /data/www;\n{% endcodeblock %}\n\n一个block指令和一个简单的指令有相同的结构，但是**不是以分号结尾，而是用一系列由大括号（{和}）包围的附加指令来结束**。如果一个block指令在大括号内可以有其他的指令，它就被称为一个context（上下文，例如：events，http，server和location）:\n\n{% codeblock lang:javascript %}\n    http {\n        server {\n            #location / {\n                 proxy_pass   http://127.0.0.1:8090/;\n                 proxy_redirect  http://127.0.0.1:8090/ /;\n                 proxy_connect_timeout 600s;\n                 proxy_read_timeout 600s;\n                 proxy_send_timeout 600s;\n            }\n        }\n    }\n{% endcodeblock %}\n\n置于任何context之外的配置文件中的指令被认为是在main context中。在*events*和*http*指令驻留在main content中，*server*是在*http*中，*location*则在*server*中。\n\n#后面的部分是注释：\n\n{% codeblock lang:javascript %}\n    # 这是一段注释\n{% endcodeblock %}\n\n### Nginx作为静态服务器使用\n\n作为一个Web服务器，其最主要的任务是作为静态服务器使用。\n\n你需要将静态网页和文件放到一个目录（例如/data/www），将图片等文件放到另一个目录（例如/data/images），然后在nginx.conf中进行配置。这需要在*http*模块下的*server*模块内新建两个*location*模块：\n\n{% codeblock lang:nginx %}\n    http {\n        server {\n            location / {\n                root /data/www;\n            }\n            location /images/ {\n                root /data;\n            }\n        }\n    }\n{% endcodeblock %}\n\n看起来很好理解吧~也可以直接把文件放到一块，直接location配置绝对路径：\n\n{% codeblock lang:nginx %}\n    location / {\n        root   F:\\webapp\\portal;\n    }\n{% endcodeblock %}\n\nNginx在未配置监听端口的情况下默认监听80端口，因此，你可以通过在本地访问 http://localhost/ 或者 http://127.0.0.1/ 来访问你的网站。\n\n怎么样？赶紧启动一下Nginx吧，你的静态网站已经可以在本地运行了！修改配置后重启Nginx的命令是：\n\n{% codeblock lang:javascript %}\n    nginx -s reload\n{% endcodeblock %}\n\n如果您的Nginx无法启动或者出现其他错误，您可以尝试在 */usr/local/nginx/logs* 或者 */var/log/nginx* 中的 *access.log* 以及 *error.log* 中查找原因\n\n### 搭建简单的代理服务器\n\nNginx经常作为反向代理服务器来使用，这意味着Nginx服务器接收请求，将其传递给被代理服务器，从中检索响应并将其发送给客户端。\n\n> 反向代理（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。通过在网络各处放置反向代理节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络，CDN系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。\n\n下面，我们将配置一个基本的代理服务器，它会处理本地图片文件的请求并返回其他的请求给被代理的服务器。在这个例子中，两个服务器将在一个Nginx实例上定义。\n\n首先，在nginx的配置文件中增加一个server块来定义代理服务器，其中包含以下内容：\n\n{% codeblock lang:nginx %}\n    server {\n        listen 8080;\n        root /data/up1;\n        location / {\n        }\n    }\n{% endcodeblock %}\n\n这将是一个简单的服务器，它监听8080端口。（如果不定义listen值的话，默认监听80端口）并将所有请求映射到本地文件系统上的目录/data/up1。创建这个目录并把index.html文件放进去。请注意，该root指令放置在server context中。当响应请求的 location 区块中，没有自己的 root 指令，上述的 root 指令才会被使用。\n\n接下来，使用上一节中的服务器配置并对其进行修改，使其成为代理服务器配置。在第一个location块中，设置proxy_pass 指令，并在参数中配置指定的代理服务器的协议、名称和端口号（在我们的例子中是这样 http://localhost:8080）：\n\n{% codeblock lang:nginx %}\n    server {\n        location / {\n            proxy_pass http://localhost:8080;\n        }\n        location /images/ {\n            root /data;\n        }\n    }\n{% endcodeblock %}\n\n我们将修改第二个location块，它将当前带有/images/前缀的请求映射到/data/images目录下，使其与具有典型文件扩展名的图像请求匹配。修改的location块如下所示：\n\n{% codeblock lang:nginx %}\n    location ~ \\.(gif|jpg|png)$ {\n        root /data/images;\n    }\n{% endcodeblock %}\n\n该参数是一个正则表达式，它会匹配所有以.gif、.jpg 或者.png结尾的URI。一个正则表达式需要以~开头。匹配到的请求会被映射到/data/images目录下。\n\n当Nginx通过location去响应一个请求时，它会先检测带有前缀的location指令，兽先是检测带有**最长**前缀的 location，其次检测正则表达式。如果被正则的匹配的规则匹配成功，Nginx会选择使用该location的规则，否则，会选择之前缓存的规则。\n\n最终，一个代理服务器的配置结果如下：\n\n{% codeblock lang:nginx %}\n    server {\n        location / {\n            proxy_pass http://localhost:8080/;\n        }\n        location ~ \\.(gif|jpg|png)$ {\n            root /data/images;\n        }\n    }\n{% endcodeblock %}\n\n该服务器将过滤以.gif、.jpg或者.png结尾的请求，并将它们映射到/data/images目录（通过添加URI到root指令的参数），并将所有其他请求传递给上述代理服务器。\n\n要应用新配置，请保存修改后的配置文件，并nginx -s reload一下。\n\n更多Nginx代理配置指令，尽在[ngx_http_proxy_module](https://nginx.org/en/docs/http/ngx_http_proxy_module.html)\n\n## 参考文献","slug":"Nginx 配置指南","published":1,"updated":"2018-03-04T15:08:12.778Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk698hxb0003znzwtd86aj18","content":"<h2 id=\"什么是Nginx？\"><a href=\"#什么是Nginx？\" class=\"headerlink\" title=\"什么是Nginx？\"></a>什么是Nginx？</h2><hr>\n<p><img src=\"/2017/11/11/Nginx 配置指南/nginx.png\" alt=\"Nginx\"></p>\n<p>没有什么文档比直接从<a href=\"\">Nginx官网</a>来的更准确清晰了。</p>\n<blockquote>\n<p>Nginx [engine x] is an HTTP and reverse proxy server, a mail proxy server, and a generic TCP/UDP proxy server, originally written by Igor Sysoev. For a long time, it has been running on many heavily loaded Russian sites including Yandex, Mail.Ru, VK, and Rambler. According to Netcraft, Nginx served or proxied 29.43% busiest sites in October 2017. Here are some of the success stories: Dropbox, Netflix, Wordpress.com, FastMail.FM.</p>\n</blockquote>\n<p>Nginx [engine x]是最初由Igor Sysoev编写的HTTP和反向代理服务器，邮件代理服务器和通用TCP/UDP代理服务器。很长时间以来，它一直在许多重负荷的俄罗斯网站上运行，包括Yandex，Mail.Ru，VK和Rambler。根据Netcraft，2017年10月，Nginx服务或代理了 29.43％最繁忙的站点。下面是一些成功案例： Dropbox， Netflix， Wordpress.com， FastMail.FM。</p>\n<p>Nginx的主要特性：</p>\n<ul>\n<li>Basic HTTP server features(基本的HTTP服务器功能)</li>\n<li>Other HTTP server features(其他HTTP服务器功能)</li>\n<li>Mail proxy server features(邮件代理服务器功能)</li>\n<li>TCP/UDP proxy server features(TCP/UDP代理服务器功能)</li>\n<li>Architecture and scalability(架构和可扩展性)</li>\n</ul>\n<h2 id=\"为什么要使用Nginx，跟以前用的tomcat有什么区别？\"><a href=\"#为什么要使用Nginx，跟以前用的tomcat有什么区别？\" class=\"headerlink\" title=\"为什么要使用Nginx，跟以前用的tomcat有什么区别？\"></a>为什么要使用Nginx，跟以前用的tomcat有什么区别？</h2><hr>\n<p>虽然大家都叫web server，但是Nginx和tomcat有本质的不同。</p>\n<p>Nginx常用来做静态内容服务器和代理服务器，用来放置静态资源或者转发请求给后面的应用服务；而tomcat常用来做应用容器，让java app在其中运行。</p>\n<p>因此，严格来说，Nginx应该叫<span style=\"color:red\">HTTP Server</span>，而tomcat则是一个<span style=\"color:red\">Application Server</span></p>\n<p>一个 HTTP Server关心的是HTTP协议层面的传输和访问控制，所以在Nginx上你可以看到代理、负载均衡等功能。客户端通过HTTP Server 访问服务器上存储的资源（HTML 文件、图片文件等等）。通过CGI技术，也可以将处理过的内容通过HTTP Server分发，但是一个HTTP Server始终只是把服务器上的文件如实的通过HTTP协议传输给客户端。</p>\n<p>而应用服务器，则是一个应用执行的容器。它首先需要支持开发语言的 Runtime（对于 Tomcat 来说，就是 Java），保证应用能够在应用服务器上正常运行。其次，需要支持应用相关的规范，例如类库、安全方面的特性。对于 Tomcat 来说，就是需要提供 JSP/Sevlet 运行需要的标准类库、Interface 等。为了方便，应用服务器往往也会集成 HTTP Server 的功能，但是不如专业的 HTTP Server 那么强大，所以应用服务器往往是运行在 HTTP Server 的背后，执行应用，将动态的内容转化为静态的内容之后，通过 HTTP Server 分发到客户端。</p>\n<p>于我个人来说，选择Nginx主要是因为其占用资源低的优点，比起tomcat，选择Nginx能给我释放大量的系统内存，供我其他IDE和chrome使用。</p>\n<h2 id=\"nginx-conf配置文件指南\"><a href=\"#nginx-conf配置文件指南\" class=\"headerlink\" title=\"nginx.conf配置文件指南\"></a>nginx.conf配置文件指南</h2><hr>\n<p>Nginx的安装，启动，关闭等步骤的教程在这里我们就不做赘述了，我们来主要谈一谈nginx.conf文件应该如何配置，这是nginx的灵魂所在。</p>\n<h3 id=\"Nginx配置文件结构\"><a href=\"#Nginx配置文件结构\" class=\"headerlink\" title=\"Nginx配置文件结构\"></a>Nginx配置文件结构</h3><p>nginx包含由配置文件中指定的指令控制的模块。指令分为<strong>简单指令</strong>和<strong>块指令</strong>。</p>\n<p>一个简单的指令由<strong>名称</strong>和<strong>参数</strong>组成，以空格分隔，并以分号（;）结束:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root /data/www;</span><br></pre></td></tr></table></figure>\n<p>一个block指令和一个简单的指令有相同的结构，但是<strong>不是以分号结尾，而是用一系列由大括号（{和}）包围的附加指令来结束</strong>。如果一个block指令在大括号内可以有其他的指令，它就被称为一个context（上下文，例如：events，http，server和location）:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http &#123;</span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        #location / &#123;</span><br><span class=\"line\">             proxy_pass   http:<span class=\"comment\">//127.0.0.1:8090/;</span></span><br><span class=\"line\">             proxy_redirect  http:<span class=\"comment\">//127.0.0.1:8090/ /;</span></span><br><span class=\"line\">             proxy_connect_timeout <span class=\"number\">600</span>s;</span><br><span class=\"line\">             proxy_read_timeout <span class=\"number\">600</span>s;</span><br><span class=\"line\">             proxy_send_timeout <span class=\"number\">600</span>s;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>置于任何context之外的配置文件中的指令被认为是在main context中。在<em>events</em>和<em>http</em>指令驻留在main content中，<em>server</em>是在<em>http</em>中，<em>location</em>则在<em>server</em>中。</p>\n<p>#后面的部分是注释：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 这是一段注释</span><br></pre></td></tr></table></figure>\n<h3 id=\"Nginx作为静态服务器使用\"><a href=\"#Nginx作为静态服务器使用\" class=\"headerlink\" title=\"Nginx作为静态服务器使用\"></a>Nginx作为静态服务器使用</h3><p>作为一个Web服务器，其最主要的任务是作为静态服务器使用。</p>\n<p>你需要将静态网页和文件放到一个目录（例如/data/www），将图片等文件放到另一个目录（例如/data/images），然后在nginx.conf中进行配置。这需要在<em>http</em>模块下的<em>server</em>模块内新建两个<em>location</em>模块：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">http</span> &#123;</span><br><span class=\"line\">    <span class=\"section\">server</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">            <span class=\"attribute\">root</span> /data/www;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"attribute\">location</span> /images/ &#123;</span><br><span class=\"line\">            <span class=\"attribute\">root</span> /data;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>看起来很好理解吧~也可以直接把文件放到一块，直接location配置绝对路径：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">    <span class=\"attribute\">root</span>   F:\\webapp\\portal;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Nginx在未配置监听端口的情况下默认监听80端口，因此，你可以通过在本地访问 <a href=\"http://localhost/\" target=\"_blank\" rel=\"noopener\">http://localhost/</a> 或者 <a href=\"http://127.0.0.1/\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1/</a> 来访问你的网站。</p>\n<p>怎么样？赶紧启动一下Nginx吧，你的静态网站已经可以在本地运行了！修改配置后重启Nginx的命令是：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx -s reload</span><br></pre></td></tr></table></figure>\n<p>如果您的Nginx无法启动或者出现其他错误，您可以尝试在 <em>/usr/local/nginx/logs</em> 或者 <em>/var/log/nginx</em> 中的 <em>access.log</em> 以及 <em>error.log</em> 中查找原因</p>\n<h3 id=\"搭建简单的代理服务器\"><a href=\"#搭建简单的代理服务器\" class=\"headerlink\" title=\"搭建简单的代理服务器\"></a>搭建简单的代理服务器</h3><p>Nginx经常作为反向代理服务器来使用，这意味着Nginx服务器接收请求，将其传递给被代理服务器，从中检索响应并将其发送给客户端。</p>\n<blockquote>\n<p>反向代理（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。通过在网络各处放置反向代理节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络，CDN系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。</p>\n</blockquote>\n<p>下面，我们将配置一个基本的代理服务器，它会处理本地图片文件的请求并返回其他的请求给被代理的服务器。在这个例子中，两个服务器将在一个Nginx实例上定义。</p>\n<p>首先，在nginx的配置文件中增加一个server块来定义代理服务器，其中包含以下内容：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">listen</span> <span class=\"number\">8080</span>;</span><br><span class=\"line\">    <span class=\"attribute\">root</span> /data/up1;</span><br><span class=\"line\">    <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这将是一个简单的服务器，它监听8080端口。（如果不定义listen值的话，默认监听80端口）并将所有请求映射到本地文件系统上的目录/data/up1。创建这个目录并把index.html文件放进去。请注意，该root指令放置在server context中。当响应请求的 location 区块中，没有自己的 root 指令，上述的 root 指令才会被使用。</p>\n<p>接下来，使用上一节中的服务器配置并对其进行修改，使其成为代理服务器配置。在第一个location块中，设置proxy_pass 指令，并在参数中配置指定的代理服务器的协议、名称和端口号（在我们的例子中是这样 <a href=\"http://localhost:8080）：\" target=\"_blank\" rel=\"noopener\">http://localhost:8080）：</a></p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_pass</span> http://localhost:8080;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"attribute\">location</span> /images/ &#123;</span><br><span class=\"line\">        <span class=\"attribute\">root</span> /data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们将修改第二个location块，它将当前带有/images/前缀的请求映射到/data/images目录下，使其与具有典型文件扩展名的图像请求匹配。修改的location块如下所示：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">location</span> <span class=\"regexp\">~ \\.(gif|jpg|png)$</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">root</span> /data/images;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>该参数是一个正则表达式，它会匹配所有以.gif、.jpg 或者.png结尾的URI。一个正则表达式需要以~开头。匹配到的请求会被映射到/data/images目录下。</p>\n<p>当Nginx通过location去响应一个请求时，它会先检测带有前缀的location指令，兽先是检测带有<strong>最长</strong>前缀的 location，其次检测正则表达式。如果被正则的匹配的规则匹配成功，Nginx会选择使用该location的规则，否则，会选择之前缓存的规则。</p>\n<p>最终，一个代理服务器的配置结果如下：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_pass</span> http://localhost:8080/;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"attribute\">location</span> <span class=\"regexp\">~ \\.(gif|jpg|png)$</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">root</span> /data/images;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>该服务器将过滤以.gif、.jpg或者.png结尾的请求，并将它们映射到/data/images目录（通过添加URI到root指令的参数），并将所有其他请求传递给上述代理服务器。</p>\n<p>要应用新配置，请保存修改后的配置文件，并nginx -s reload一下。</p>\n<p>更多Nginx代理配置指令，尽在<a href=\"https://nginx.org/en/docs/http/ngx_http_proxy_module.html\" target=\"_blank\" rel=\"noopener\">ngx_http_proxy_module</a></p>\n<h2 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h2>","site":{"data":{}},"excerpt":"","more":"<h2 id=\"什么是Nginx？\"><a href=\"#什么是Nginx？\" class=\"headerlink\" title=\"什么是Nginx？\"></a>什么是Nginx？</h2><hr>\n<p><img src=\"/2017/11/11/Nginx 配置指南/nginx.png\" alt=\"Nginx\"></p>\n<p>没有什么文档比直接从<a href=\"\">Nginx官网</a>来的更准确清晰了。</p>\n<blockquote>\n<p>Nginx [engine x] is an HTTP and reverse proxy server, a mail proxy server, and a generic TCP/UDP proxy server, originally written by Igor Sysoev. For a long time, it has been running on many heavily loaded Russian sites including Yandex, Mail.Ru, VK, and Rambler. According to Netcraft, Nginx served or proxied 29.43% busiest sites in October 2017. Here are some of the success stories: Dropbox, Netflix, Wordpress.com, FastMail.FM.</p>\n</blockquote>\n<p>Nginx [engine x]是最初由Igor Sysoev编写的HTTP和反向代理服务器，邮件代理服务器和通用TCP/UDP代理服务器。很长时间以来，它一直在许多重负荷的俄罗斯网站上运行，包括Yandex，Mail.Ru，VK和Rambler。根据Netcraft，2017年10月，Nginx服务或代理了 29.43％最繁忙的站点。下面是一些成功案例： Dropbox， Netflix， Wordpress.com， FastMail.FM。</p>\n<p>Nginx的主要特性：</p>\n<ul>\n<li>Basic HTTP server features(基本的HTTP服务器功能)</li>\n<li>Other HTTP server features(其他HTTP服务器功能)</li>\n<li>Mail proxy server features(邮件代理服务器功能)</li>\n<li>TCP/UDP proxy server features(TCP/UDP代理服务器功能)</li>\n<li>Architecture and scalability(架构和可扩展性)</li>\n</ul>\n<h2 id=\"为什么要使用Nginx，跟以前用的tomcat有什么区别？\"><a href=\"#为什么要使用Nginx，跟以前用的tomcat有什么区别？\" class=\"headerlink\" title=\"为什么要使用Nginx，跟以前用的tomcat有什么区别？\"></a>为什么要使用Nginx，跟以前用的tomcat有什么区别？</h2><hr>\n<p>虽然大家都叫web server，但是Nginx和tomcat有本质的不同。</p>\n<p>Nginx常用来做静态内容服务器和代理服务器，用来放置静态资源或者转发请求给后面的应用服务；而tomcat常用来做应用容器，让java app在其中运行。</p>\n<p>因此，严格来说，Nginx应该叫<span style=\"color:red\">HTTP Server</span>，而tomcat则是一个<span style=\"color:red\">Application Server</span></p>\n<p>一个 HTTP Server关心的是HTTP协议层面的传输和访问控制，所以在Nginx上你可以看到代理、负载均衡等功能。客户端通过HTTP Server 访问服务器上存储的资源（HTML 文件、图片文件等等）。通过CGI技术，也可以将处理过的内容通过HTTP Server分发，但是一个HTTP Server始终只是把服务器上的文件如实的通过HTTP协议传输给客户端。</p>\n<p>而应用服务器，则是一个应用执行的容器。它首先需要支持开发语言的 Runtime（对于 Tomcat 来说，就是 Java），保证应用能够在应用服务器上正常运行。其次，需要支持应用相关的规范，例如类库、安全方面的特性。对于 Tomcat 来说，就是需要提供 JSP/Sevlet 运行需要的标准类库、Interface 等。为了方便，应用服务器往往也会集成 HTTP Server 的功能，但是不如专业的 HTTP Server 那么强大，所以应用服务器往往是运行在 HTTP Server 的背后，执行应用，将动态的内容转化为静态的内容之后，通过 HTTP Server 分发到客户端。</p>\n<p>于我个人来说，选择Nginx主要是因为其占用资源低的优点，比起tomcat，选择Nginx能给我释放大量的系统内存，供我其他IDE和chrome使用。</p>\n<h2 id=\"nginx-conf配置文件指南\"><a href=\"#nginx-conf配置文件指南\" class=\"headerlink\" title=\"nginx.conf配置文件指南\"></a>nginx.conf配置文件指南</h2><hr>\n<p>Nginx的安装，启动，关闭等步骤的教程在这里我们就不做赘述了，我们来主要谈一谈nginx.conf文件应该如何配置，这是nginx的灵魂所在。</p>\n<h3 id=\"Nginx配置文件结构\"><a href=\"#Nginx配置文件结构\" class=\"headerlink\" title=\"Nginx配置文件结构\"></a>Nginx配置文件结构</h3><p>nginx包含由配置文件中指定的指令控制的模块。指令分为<strong>简单指令</strong>和<strong>块指令</strong>。</p>\n<p>一个简单的指令由<strong>名称</strong>和<strong>参数</strong>组成，以空格分隔，并以分号（;）结束:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">root /data/www;</span><br></pre></td></tr></table></figure>\n<p>一个block指令和一个简单的指令有相同的结构，但是<strong>不是以分号结尾，而是用一系列由大括号（{和}）包围的附加指令来结束</strong>。如果一个block指令在大括号内可以有其他的指令，它就被称为一个context（上下文，例如：events，http，server和location）:</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">http &#123;</span><br><span class=\"line\">    server &#123;</span><br><span class=\"line\">        #location / &#123;</span><br><span class=\"line\">             proxy_pass   http:<span class=\"comment\">//127.0.0.1:8090/;</span></span><br><span class=\"line\">             proxy_redirect  http:<span class=\"comment\">//127.0.0.1:8090/ /;</span></span><br><span class=\"line\">             proxy_connect_timeout <span class=\"number\">600</span>s;</span><br><span class=\"line\">             proxy_read_timeout <span class=\"number\">600</span>s;</span><br><span class=\"line\">             proxy_send_timeout <span class=\"number\">600</span>s;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>置于任何context之外的配置文件中的指令被认为是在main context中。在<em>events</em>和<em>http</em>指令驻留在main content中，<em>server</em>是在<em>http</em>中，<em>location</em>则在<em>server</em>中。</p>\n<p>#后面的部分是注释：</p>\n<figure class=\"highlight\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 这是一段注释</span><br></pre></td></tr></table></figure>\n<h3 id=\"Nginx作为静态服务器使用\"><a href=\"#Nginx作为静态服务器使用\" class=\"headerlink\" title=\"Nginx作为静态服务器使用\"></a>Nginx作为静态服务器使用</h3><p>作为一个Web服务器，其最主要的任务是作为静态服务器使用。</p>\n<p>你需要将静态网页和文件放到一个目录（例如/data/www），将图片等文件放到另一个目录（例如/data/images），然后在nginx.conf中进行配置。这需要在<em>http</em>模块下的<em>server</em>模块内新建两个<em>location</em>模块：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">http</span> &#123;</span><br><span class=\"line\">    <span class=\"section\">server</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">            <span class=\"attribute\">root</span> /data/www;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"attribute\">location</span> /images/ &#123;</span><br><span class=\"line\">            <span class=\"attribute\">root</span> /data;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>看起来很好理解吧~也可以直接把文件放到一块，直接location配置绝对路径：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">    <span class=\"attribute\">root</span>   F:\\webapp\\portal;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>Nginx在未配置监听端口的情况下默认监听80端口，因此，你可以通过在本地访问 <a href=\"http://localhost/\" target=\"_blank\" rel=\"noopener\">http://localhost/</a> 或者 <a href=\"http://127.0.0.1/\" target=\"_blank\" rel=\"noopener\">http://127.0.0.1/</a> 来访问你的网站。</p>\n<p>怎么样？赶紧启动一下Nginx吧，你的静态网站已经可以在本地运行了！修改配置后重启Nginx的命令是：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">nginx -s reload</span><br></pre></td></tr></table></figure>\n<p>如果您的Nginx无法启动或者出现其他错误，您可以尝试在 <em>/usr/local/nginx/logs</em> 或者 <em>/var/log/nginx</em> 中的 <em>access.log</em> 以及 <em>error.log</em> 中查找原因</p>\n<h3 id=\"搭建简单的代理服务器\"><a href=\"#搭建简单的代理服务器\" class=\"headerlink\" title=\"搭建简单的代理服务器\"></a>搭建简单的代理服务器</h3><p>Nginx经常作为反向代理服务器来使用，这意味着Nginx服务器接收请求，将其传递给被代理服务器，从中检索响应并将其发送给客户端。</p>\n<blockquote>\n<p>反向代理（Reverse Proxy）方式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内部网络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器对外就表现为一个服务器。通过在网络各处放置反向代理节点服务器所构成的在现有的互联网基础之上的一层智能虚拟网络，CDN系统能够实时地根据网络流量和各节点的连接、负载状况以及到用户的距离和响应时间等综合信息将用户的请求重新导向离用户最近的服务节点上。</p>\n</blockquote>\n<p>下面，我们将配置一个基本的代理服务器，它会处理本地图片文件的请求并返回其他的请求给被代理的服务器。在这个例子中，两个服务器将在一个Nginx实例上定义。</p>\n<p>首先，在nginx的配置文件中增加一个server块来定义代理服务器，其中包含以下内容：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">listen</span> <span class=\"number\">8080</span>;</span><br><span class=\"line\">    <span class=\"attribute\">root</span> /data/up1;</span><br><span class=\"line\">    <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这将是一个简单的服务器，它监听8080端口。（如果不定义listen值的话，默认监听80端口）并将所有请求映射到本地文件系统上的目录/data/up1。创建这个目录并把index.html文件放进去。请注意，该root指令放置在server context中。当响应请求的 location 区块中，没有自己的 root 指令，上述的 root 指令才会被使用。</p>\n<p>接下来，使用上一节中的服务器配置并对其进行修改，使其成为代理服务器配置。在第一个location块中，设置proxy_pass 指令，并在参数中配置指定的代理服务器的协议、名称和端口号（在我们的例子中是这样 <a href=\"http://localhost:8080）：\" target=\"_blank\" rel=\"noopener\">http://localhost:8080）：</a></p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_pass</span> http://localhost:8080;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"attribute\">location</span> /images/ &#123;</span><br><span class=\"line\">        <span class=\"attribute\">root</span> /data;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们将修改第二个location块，它将当前带有/images/前缀的请求映射到/data/images目录下，使其与具有典型文件扩展名的图像请求匹配。修改的location块如下所示：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">location</span> <span class=\"regexp\">~ \\.(gif|jpg|png)$</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">root</span> /data/images;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>该参数是一个正则表达式，它会匹配所有以.gif、.jpg 或者.png结尾的URI。一个正则表达式需要以~开头。匹配到的请求会被映射到/data/images目录下。</p>\n<p>当Nginx通过location去响应一个请求时，它会先检测带有前缀的location指令，兽先是检测带有<strong>最长</strong>前缀的 location，其次检测正则表达式。如果被正则的匹配的规则匹配成功，Nginx会选择使用该location的规则，否则，会选择之前缓存的规则。</p>\n<p>最终，一个代理服务器的配置结果如下：</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">server</span> &#123;</span><br><span class=\"line\">    <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">        <span class=\"attribute\">proxy_pass</span> http://localhost:8080/;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"attribute\">location</span> <span class=\"regexp\">~ \\.(gif|jpg|png)$</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">root</span> /data/images;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>该服务器将过滤以.gif、.jpg或者.png结尾的请求，并将它们映射到/data/images目录（通过添加URI到root指令的参数），并将所有其他请求传递给上述代理服务器。</p>\n<p>要应用新配置，请保存修改后的配置文件，并nginx -s reload一下。</p>\n<p>更多Nginx代理配置指令，尽在<a href=\"https://nginx.org/en/docs/http/ngx_http_proxy_module.html\" target=\"_blank\" rel=\"noopener\">ngx_http_proxy_module</a></p>\n<h2 id=\"参考文献\"><a href=\"#参考文献\" class=\"headerlink\" title=\"参考文献\"></a>参考文献</h2>"},{"title":"Web超时配置总结","date":"2017-12-19T11:54:22.000Z","picture":"timeout.jpg","description":"前段时间做项目时，由于某个请求在后台要进行长时间的脚本处理，频频超出系统默认的超时时长，于是我就对超时时长进行了检查。由于超时的时候请求报错的提示信息并不明确，为了修改这玩意儿也查了一堆资料，忙活了半天，终于把超时问题解决了，分享在这里供大家参考。","_content":"\n## 引子\n\n***\n\n前段时间做项目时，由于某个请求在后台要进行长时间的脚本处理，频频超出系统默认的超时时长，于是我就对超时时长进行了检查。由于超时的时候请求报错的提示信息并不明确，为了修改这玩意儿也查了一堆资料，忙活了半天，终于把超时问题解决了，在这里做个记录。\n\n我的项目用的是web前台（这个无所谓用的什么框架，反正归根结底是js）+nginx代理+Node.js后台搭建的，我发现每一节都设了一道timeout超时的关卡，也就是说有**客户端超时**，**代理超时**，**服务端超时**三种情况。下面针对每种超时，我将进行分别讲解。\n\n![timeout!](timeout.jpg)\n\n## 客户端超时\n\n***\n\n### XMLHttpRequest的超时设置\n\n讲客户端超时，就要从XMLHttpRequest来谈起。\n\nXMLHttpRequest是一个API，它为客户端提供了在客户端和服务器之间传输数据的功能。它提供了一个通过URL来获取数据的简单方式，并且不会使整个页面刷新。这使得网页只更新一部分页面而不会打扰到用户。XMLHttpRequest在AJAX中被大量使用。\n\nXMLHttpRequest一开始只是微软浏览器提供的一个接口，后来各大浏览器纷纷效仿也提供了这个接口，再后来W3C对它进行了标准化，提出了XMLHttpRequest标准。XMLHttpRequest标准又分为Level 1和Level 2。\nXMLHttpRequest Level 1主要存在以下缺点：\n\n- 受同源策略的限制，不能发送跨域请求；\n- 不能发送二进制文件（如图片、视频、音频等），只能发送纯文本数据；\n- 在发送和获取数据的过程中，无法实时获取进度信息，只能判断是否完成；\n\n那么Level 2对Level 1 进行了改进，XMLHttpRequest Level 2中新增了以下功能：\n\n- 可以发送跨域请求，在服务端允许的情况下；\n- 支持发送和接收二进制数据；\n- 新增formData对象，支持发送表单数据；\n- 发送和获取数据时，可以获取进度信息；\n- 可以设置请求的超时时间；\n\n在Level 2版本的XMLHttpRequest对象，增加了timeout属性，可以设置HTTP请求的时限。\n\n{% codeblock lang:javascript %}\n    xhr.timeout = 60*1000;\n    xhr.ontimeout = function(event){\n　　　　alert('timeout！');\n　　}\n{% endcodeblock %}\n\n在上述代码中，请求超时时间被设为1分钟（xhr.timeout的单位是毫秒），如果超过1分钟的时限，则会自动停止http请求；同时，触发ontimeout事件，弹出“timeout！”的提示框。\n\n同时值得注意的一点是，超时时间的计算，是从调用xhr.send()开始，至xhr.loadend触发为止的这段时间。即时xhr.timeout的设置是在xhr.send()之后，timeout的计时起点仍为调用xhr.send()的时刻。\n\n### 其他超时设置\n\n其实会了XMLHttpRequest的超时设置，其他前端的框架啊、工具啊的超时设置都不再是问题，这就有点万法归宗的意思。因为我们常用的jQuery.ajax()方法实际上就是对浏览器提供的XMLHttpRequest对象的封装。而又有很多其他框架或者工具的请求模块是对jQuery.ajax()的封装。说到底，都是依赖的XMLHttpRequest对象。因此掌握了XMLHttpRequest，其他都很好学会。\n\n依jQuery.ajax()的超时设置为例：\n\n{% codeblock lang:javascript %}\n    $.ajax({\n        url: \"test.html\",\n        error: function(){\n            // will fire when timeout is reached\n        },\n        success: function(){\n            // do something\n        },\n        timeout: 60*1000 // sets timeout to 1 minute\n    });\n{% endcodeblock %}\n\n实在是简单，对不对？\n\n## 代理超时\n\n***\n\nnginx的超时设置主要分3种：\n\n- proxy_connect_timeout\n- proxy_read_timeout\n- proxy_send_timeout\n\n### proxy_connect_timeout\n\n> 语法: proxy_connect_timeout timeout_in_seconds\n> 上下文: http, server, location\n> 默认值: 60s\n\nproxy_connect_timeout是和后端建立连接的超时时间。需要记住的是，这个时间不能超过75秒。\n\n这个不是等待后端返回页面的时间，那是由proxy_read_timeout声明的。如果你的upstream服务器起来了，但是挂起了（例如，没有足够的线程处理请求，所以把你的请求放到请求池里稍后处理），那么这个声明是没有用的，由于与upstream服务器的连接已经建立了。\n\n\n### proxy_read_timeout\n\n> 语法: proxy_read_timeout the_time\n> 上下文: http, server, location\n> 默认值: 60s\n\nproxy_read_timeout是从后端读取数据的超时时间，两次读取操作的时间间隔如果大于这个值，和后端的连接会被关闭。如果一个请求时间时间非常大，要把这个值设大点。\n\n### proxy_send_timeout\n\n> 语法: proxy_send_timeout time\n> 上下文: http, server, location\n> 默认值: 60s\n\nproxy_send_timeout是向后端写数据的超时时间，两次写操作的时间间隔大于这个值，也就是过了这么长时间后端还是没有收到数据，连接会被关闭。\n\n## 服务端超时\n\n***\n\nNode.js做服务器时，默认的超时时长为2分钟。假设请求发送到服务端，在2分钟内没有响应返回给客户端，客户端的链接就会被重置。这个时长的设置是很必要的，因为过长的请求响应会阻塞IO，造成极差的用户体验。特别对于Node.js这种单线程应用来说，影响可以说是灾难性的，因此如何设置服务端的超时时间也是非常关键的。\n\n服务端超时设置也不是一刀切的，总体来说，有一个总开关，还可以对每个服务端的请求或者响应单独设置超时时长。\n\n我们后面的代码均以Node.js+Express搭建的后台为例。\n\n### 服务端超时总开关\n\n使用Node.js的http模块启动服务器，并设置超时时长：\n\n{% codeblock lang:javascript %}\n    const express = require('express');\n    const config = require(./config);\n\n    process.env.PORT = config.webport || 8888;\n\n    let app = express();\n    let server = app.listen(process.env.PORT);\n    server.setTimeout(60*1000);\n    server.on('timeout', function(){\n        console.log('timeout!')\n    })\n{% endcodeblock %}\n\nserver.setTimeout()是设置server的超时时间设置方法，单位是毫秒，一旦超过设置的超时时长，则触发server对象的'timeout'事件，并传入socket作为一个参数。\n\n### 设置Express中间件超时时间\n\n> Express是一个路由和中间件Web框架，其自身只具有最低程度的功能：Express应用程序基本上是一系列中间件函数调用。\n\n> 中间件函数能够访问请求对象 (req)、响应对象 (res) 以及应用程序的请求/响应循环中的下一个中间件函数。下一个中间件函数通常由名为 next 的变量来表示。\n\n> 中间件函数可以执行以下任务：\n\n> - 执行任何代码。\n> - 对请求和响应对象进行更改。\n> - 结束请求/响应循环。\n> - 调用堆栈中的下一个中间件函数。\n\n> 如果当前中间件函数没有结束请求/响应循环，那么它必须调用next()，以将控制权传递给下一个中间件函数。否则，请求将保持挂起状态。\n\n对于Express的中间件，我们可以在app.js里为每个路由及其处理程序函数的中间件设置请求的响应和超时时间，\n\n{% codeblock lang:javascript %}\n    app.get('/user/:id', function (req, res, next) {\n        // 设置该中间件下所有HTTP请求的超时时间\n        req.setTimeout(60*1000);\n        // 设置该中间件下所有HTTP请求的服务器响应超时时间\n        res.setTimeout(60*1000);\n        res.send('USER');\n    });\n{% endcodeblock %}\n\nExpress不仅可以针对中间件设置超时时间，还可以针对某个具体的接口设置请求和响应的超时时长：\n\n{% codeblock lang:javascript %}\n    router.get('/user/:id', function (req, res, next) {\n        // 设置该接口下所有HTTP请求的超时时间\n        req.setTimeout(60*1000);\n        // 设置该接口下所有HTTP请求的服务器响应超时时间\n        res.setTimeout(60*1000);\n        res.send('USER');\n    });\n{% endcodeblock %}\n\n## 小结\n\n全写完了以后，仔细想了想，发现还没有写全，比如说服务端也可以发请求，不管是用http.method还是用request模块，都可以发请求。由于Node.js在很多项目中都是作为中间层，不管是向JAVA后台请求数据，还是用作解决客户端跨域问题的请求中转层，发请求都是很常用的用法。但是只要读者能耐心读到这里，相信随手网上搜一下就知道怎么写了，因此我这里就不再赘述了。\n\n写这篇文章主要想分享一下我的感受，超时限制就像一道关卡，一个请求从客户端到服务端，再从服务端返回客户端的路上，要“过五关斩六将”。有的时候想要修改超时设置，可能不是简单修改某一处就能解决问题的，这时候一定要仔细检查，把这个系统理一遍，每一个地方的超时设置都看一看，才能解决问题~","source":"_posts/web超时配置总结.md","raw":"---\ntitle: web超时配置总结\ndate: 2017-12-19 19:54:22\ntags: [JavaScript,Nginx,Node.js]\npicture: timeout.jpg\ndescription: 前段时间做项目时，由于某个请求在后台要进行长时间的脚本处理，频频超出系统默认的超时时长，于是我就对超时时长进行了检查。由于超时的时候请求报错的提示信息并不明确，为了修改这玩意儿也查了一堆资料，忙活了半天，终于把超时问题解决了，分享在这里供大家参考。\n---\n\n## 引子\n\n***\n\n前段时间做项目时，由于某个请求在后台要进行长时间的脚本处理，频频超出系统默认的超时时长，于是我就对超时时长进行了检查。由于超时的时候请求报错的提示信息并不明确，为了修改这玩意儿也查了一堆资料，忙活了半天，终于把超时问题解决了，在这里做个记录。\n\n我的项目用的是web前台（这个无所谓用的什么框架，反正归根结底是js）+nginx代理+Node.js后台搭建的，我发现每一节都设了一道timeout超时的关卡，也就是说有**客户端超时**，**代理超时**，**服务端超时**三种情况。下面针对每种超时，我将进行分别讲解。\n\n![timeout!](timeout.jpg)\n\n## 客户端超时\n\n***\n\n### XMLHttpRequest的超时设置\n\n讲客户端超时，就要从XMLHttpRequest来谈起。\n\nXMLHttpRequest是一个API，它为客户端提供了在客户端和服务器之间传输数据的功能。它提供了一个通过URL来获取数据的简单方式，并且不会使整个页面刷新。这使得网页只更新一部分页面而不会打扰到用户。XMLHttpRequest在AJAX中被大量使用。\n\nXMLHttpRequest一开始只是微软浏览器提供的一个接口，后来各大浏览器纷纷效仿也提供了这个接口，再后来W3C对它进行了标准化，提出了XMLHttpRequest标准。XMLHttpRequest标准又分为Level 1和Level 2。\nXMLHttpRequest Level 1主要存在以下缺点：\n\n- 受同源策略的限制，不能发送跨域请求；\n- 不能发送二进制文件（如图片、视频、音频等），只能发送纯文本数据；\n- 在发送和获取数据的过程中，无法实时获取进度信息，只能判断是否完成；\n\n那么Level 2对Level 1 进行了改进，XMLHttpRequest Level 2中新增了以下功能：\n\n- 可以发送跨域请求，在服务端允许的情况下；\n- 支持发送和接收二进制数据；\n- 新增formData对象，支持发送表单数据；\n- 发送和获取数据时，可以获取进度信息；\n- 可以设置请求的超时时间；\n\n在Level 2版本的XMLHttpRequest对象，增加了timeout属性，可以设置HTTP请求的时限。\n\n{% codeblock lang:javascript %}\n    xhr.timeout = 60*1000;\n    xhr.ontimeout = function(event){\n　　　　alert('timeout！');\n　　}\n{% endcodeblock %}\n\n在上述代码中，请求超时时间被设为1分钟（xhr.timeout的单位是毫秒），如果超过1分钟的时限，则会自动停止http请求；同时，触发ontimeout事件，弹出“timeout！”的提示框。\n\n同时值得注意的一点是，超时时间的计算，是从调用xhr.send()开始，至xhr.loadend触发为止的这段时间。即时xhr.timeout的设置是在xhr.send()之后，timeout的计时起点仍为调用xhr.send()的时刻。\n\n### 其他超时设置\n\n其实会了XMLHttpRequest的超时设置，其他前端的框架啊、工具啊的超时设置都不再是问题，这就有点万法归宗的意思。因为我们常用的jQuery.ajax()方法实际上就是对浏览器提供的XMLHttpRequest对象的封装。而又有很多其他框架或者工具的请求模块是对jQuery.ajax()的封装。说到底，都是依赖的XMLHttpRequest对象。因此掌握了XMLHttpRequest，其他都很好学会。\n\n依jQuery.ajax()的超时设置为例：\n\n{% codeblock lang:javascript %}\n    $.ajax({\n        url: \"test.html\",\n        error: function(){\n            // will fire when timeout is reached\n        },\n        success: function(){\n            // do something\n        },\n        timeout: 60*1000 // sets timeout to 1 minute\n    });\n{% endcodeblock %}\n\n实在是简单，对不对？\n\n## 代理超时\n\n***\n\nnginx的超时设置主要分3种：\n\n- proxy_connect_timeout\n- proxy_read_timeout\n- proxy_send_timeout\n\n### proxy_connect_timeout\n\n> 语法: proxy_connect_timeout timeout_in_seconds\n> 上下文: http, server, location\n> 默认值: 60s\n\nproxy_connect_timeout是和后端建立连接的超时时间。需要记住的是，这个时间不能超过75秒。\n\n这个不是等待后端返回页面的时间，那是由proxy_read_timeout声明的。如果你的upstream服务器起来了，但是挂起了（例如，没有足够的线程处理请求，所以把你的请求放到请求池里稍后处理），那么这个声明是没有用的，由于与upstream服务器的连接已经建立了。\n\n\n### proxy_read_timeout\n\n> 语法: proxy_read_timeout the_time\n> 上下文: http, server, location\n> 默认值: 60s\n\nproxy_read_timeout是从后端读取数据的超时时间，两次读取操作的时间间隔如果大于这个值，和后端的连接会被关闭。如果一个请求时间时间非常大，要把这个值设大点。\n\n### proxy_send_timeout\n\n> 语法: proxy_send_timeout time\n> 上下文: http, server, location\n> 默认值: 60s\n\nproxy_send_timeout是向后端写数据的超时时间，两次写操作的时间间隔大于这个值，也就是过了这么长时间后端还是没有收到数据，连接会被关闭。\n\n## 服务端超时\n\n***\n\nNode.js做服务器时，默认的超时时长为2分钟。假设请求发送到服务端，在2分钟内没有响应返回给客户端，客户端的链接就会被重置。这个时长的设置是很必要的，因为过长的请求响应会阻塞IO，造成极差的用户体验。特别对于Node.js这种单线程应用来说，影响可以说是灾难性的，因此如何设置服务端的超时时间也是非常关键的。\n\n服务端超时设置也不是一刀切的，总体来说，有一个总开关，还可以对每个服务端的请求或者响应单独设置超时时长。\n\n我们后面的代码均以Node.js+Express搭建的后台为例。\n\n### 服务端超时总开关\n\n使用Node.js的http模块启动服务器，并设置超时时长：\n\n{% codeblock lang:javascript %}\n    const express = require('express');\n    const config = require(./config);\n\n    process.env.PORT = config.webport || 8888;\n\n    let app = express();\n    let server = app.listen(process.env.PORT);\n    server.setTimeout(60*1000);\n    server.on('timeout', function(){\n        console.log('timeout!')\n    })\n{% endcodeblock %}\n\nserver.setTimeout()是设置server的超时时间设置方法，单位是毫秒，一旦超过设置的超时时长，则触发server对象的'timeout'事件，并传入socket作为一个参数。\n\n### 设置Express中间件超时时间\n\n> Express是一个路由和中间件Web框架，其自身只具有最低程度的功能：Express应用程序基本上是一系列中间件函数调用。\n\n> 中间件函数能够访问请求对象 (req)、响应对象 (res) 以及应用程序的请求/响应循环中的下一个中间件函数。下一个中间件函数通常由名为 next 的变量来表示。\n\n> 中间件函数可以执行以下任务：\n\n> - 执行任何代码。\n> - 对请求和响应对象进行更改。\n> - 结束请求/响应循环。\n> - 调用堆栈中的下一个中间件函数。\n\n> 如果当前中间件函数没有结束请求/响应循环，那么它必须调用next()，以将控制权传递给下一个中间件函数。否则，请求将保持挂起状态。\n\n对于Express的中间件，我们可以在app.js里为每个路由及其处理程序函数的中间件设置请求的响应和超时时间，\n\n{% codeblock lang:javascript %}\n    app.get('/user/:id', function (req, res, next) {\n        // 设置该中间件下所有HTTP请求的超时时间\n        req.setTimeout(60*1000);\n        // 设置该中间件下所有HTTP请求的服务器响应超时时间\n        res.setTimeout(60*1000);\n        res.send('USER');\n    });\n{% endcodeblock %}\n\nExpress不仅可以针对中间件设置超时时间，还可以针对某个具体的接口设置请求和响应的超时时长：\n\n{% codeblock lang:javascript %}\n    router.get('/user/:id', function (req, res, next) {\n        // 设置该接口下所有HTTP请求的超时时间\n        req.setTimeout(60*1000);\n        // 设置该接口下所有HTTP请求的服务器响应超时时间\n        res.setTimeout(60*1000);\n        res.send('USER');\n    });\n{% endcodeblock %}\n\n## 小结\n\n全写完了以后，仔细想了想，发现还没有写全，比如说服务端也可以发请求，不管是用http.method还是用request模块，都可以发请求。由于Node.js在很多项目中都是作为中间层，不管是向JAVA后台请求数据，还是用作解决客户端跨域问题的请求中转层，发请求都是很常用的用法。但是只要读者能耐心读到这里，相信随手网上搜一下就知道怎么写了，因此我这里就不再赘述了。\n\n写这篇文章主要想分享一下我的感受，超时限制就像一道关卡，一个请求从客户端到服务端，再从服务端返回客户端的路上，要“过五关斩六将”。有的时候想要修改超时设置，可能不是简单修改某一处就能解决问题的，这时候一定要仔细检查，把这个系统理一遍，每一个地方的超时设置都看一看，才能解决问题~","slug":"web超时配置总结","published":1,"updated":"2018-03-04T15:08:12.778Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk698hxi0006znzwfynehrwo","content":"<h2 id=\"引子\"><a href=\"#引子\" class=\"headerlink\" title=\"引子\"></a>引子</h2><hr>\n<p>前段时间做项目时，由于某个请求在后台要进行长时间的脚本处理，频频超出系统默认的超时时长，于是我就对超时时长进行了检查。由于超时的时候请求报错的提示信息并不明确，为了修改这玩意儿也查了一堆资料，忙活了半天，终于把超时问题解决了，在这里做个记录。</p>\n<p>我的项目用的是web前台（这个无所谓用的什么框架，反正归根结底是js）+nginx代理+Node.js后台搭建的，我发现每一节都设了一道timeout超时的关卡，也就是说有<strong>客户端超时</strong>，<strong>代理超时</strong>，<strong>服务端超时</strong>三种情况。下面针对每种超时，我将进行分别讲解。</p>\n<p><img src=\"/2017/12/19/web超时配置总结/timeout.jpg\" alt=\"timeout!\"></p>\n<h2 id=\"客户端超时\"><a href=\"#客户端超时\" class=\"headerlink\" title=\"客户端超时\"></a>客户端超时</h2><hr>\n<h3 id=\"XMLHttpRequest的超时设置\"><a href=\"#XMLHttpRequest的超时设置\" class=\"headerlink\" title=\"XMLHttpRequest的超时设置\"></a>XMLHttpRequest的超时设置</h3><p>讲客户端超时，就要从XMLHttpRequest来谈起。</p>\n<p>XMLHttpRequest是一个API，它为客户端提供了在客户端和服务器之间传输数据的功能。它提供了一个通过URL来获取数据的简单方式，并且不会使整个页面刷新。这使得网页只更新一部分页面而不会打扰到用户。XMLHttpRequest在AJAX中被大量使用。</p>\n<p>XMLHttpRequest一开始只是微软浏览器提供的一个接口，后来各大浏览器纷纷效仿也提供了这个接口，再后来W3C对它进行了标准化，提出了XMLHttpRequest标准。XMLHttpRequest标准又分为Level 1和Level 2。<br>XMLHttpRequest Level 1主要存在以下缺点：</p>\n<ul>\n<li>受同源策略的限制，不能发送跨域请求；</li>\n<li>不能发送二进制文件（如图片、视频、音频等），只能发送纯文本数据；</li>\n<li>在发送和获取数据的过程中，无法实时获取进度信息，只能判断是否完成；</li>\n</ul>\n<p>那么Level 2对Level 1 进行了改进，XMLHttpRequest Level 2中新增了以下功能：</p>\n<ul>\n<li>可以发送跨域请求，在服务端允许的情况下；</li>\n<li>支持发送和接收二进制数据；</li>\n<li>新增formData对象，支持发送表单数据；</li>\n<li>发送和获取数据时，可以获取进度信息；</li>\n<li>可以设置请求的超时时间；</li>\n</ul>\n<p>在Level 2版本的XMLHttpRequest对象，增加了timeout属性，可以设置HTTP请求的时限。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xhr.timeout = <span class=\"number\">60</span>*<span class=\"number\">1000</span>;</span><br><span class=\"line\">xhr.ontimeout = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>)</span>&#123;</span><br><span class=\"line\">　　　　alert(<span class=\"string\">'timeout！'</span>);</span><br><span class=\"line\">　　&#125;</span><br></pre></td></tr></table></figure>\n<p>在上述代码中，请求超时时间被设为1分钟（xhr.timeout的单位是毫秒），如果超过1分钟的时限，则会自动停止http请求；同时，触发ontimeout事件，弹出“timeout！”的提示框。</p>\n<p>同时值得注意的一点是，超时时间的计算，是从调用xhr.send()开始，至xhr.loadend触发为止的这段时间。即时xhr.timeout的设置是在xhr.send()之后，timeout的计时起点仍为调用xhr.send()的时刻。</p>\n<h3 id=\"其他超时设置\"><a href=\"#其他超时设置\" class=\"headerlink\" title=\"其他超时设置\"></a>其他超时设置</h3><p>其实会了XMLHttpRequest的超时设置，其他前端的框架啊、工具啊的超时设置都不再是问题，这就有点万法归宗的意思。因为我们常用的jQuery.ajax()方法实际上就是对浏览器提供的XMLHttpRequest对象的封装。而又有很多其他框架或者工具的请求模块是对jQuery.ajax()的封装。说到底，都是依赖的XMLHttpRequest对象。因此掌握了XMLHttpRequest，其他都很好学会。</p>\n<p>依jQuery.ajax()的超时设置为例：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.ajax(&#123;</span><br><span class=\"line\">    url: <span class=\"string\">\"test.html\"</span>,</span><br><span class=\"line\">    error: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// will fire when timeout is reached</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// do something</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    timeout: <span class=\"number\">60</span>*<span class=\"number\">1000</span> <span class=\"comment\">// sets timeout to 1 minute</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>实在是简单，对不对？</p>\n<h2 id=\"代理超时\"><a href=\"#代理超时\" class=\"headerlink\" title=\"代理超时\"></a>代理超时</h2><hr>\n<p>nginx的超时设置主要分3种：</p>\n<ul>\n<li>proxy_connect_timeout</li>\n<li>proxy_read_timeout</li>\n<li>proxy_send_timeout</li>\n</ul>\n<h3 id=\"proxy-connect-timeout\"><a href=\"#proxy-connect-timeout\" class=\"headerlink\" title=\"proxy_connect_timeout\"></a>proxy_connect_timeout</h3><blockquote>\n<p>语法: proxy_connect_timeout timeout_in_seconds<br>上下文: http, server, location<br>默认值: 60s</p>\n</blockquote>\n<p>proxy_connect_timeout是和后端建立连接的超时时间。需要记住的是，这个时间不能超过75秒。</p>\n<p>这个不是等待后端返回页面的时间，那是由proxy_read_timeout声明的。如果你的upstream服务器起来了，但是挂起了（例如，没有足够的线程处理请求，所以把你的请求放到请求池里稍后处理），那么这个声明是没有用的，由于与upstream服务器的连接已经建立了。</p>\n<h3 id=\"proxy-read-timeout\"><a href=\"#proxy-read-timeout\" class=\"headerlink\" title=\"proxy_read_timeout\"></a>proxy_read_timeout</h3><blockquote>\n<p>语法: proxy_read_timeout the_time<br>上下文: http, server, location<br>默认值: 60s</p>\n</blockquote>\n<p>proxy_read_timeout是从后端读取数据的超时时间，两次读取操作的时间间隔如果大于这个值，和后端的连接会被关闭。如果一个请求时间时间非常大，要把这个值设大点。</p>\n<h3 id=\"proxy-send-timeout\"><a href=\"#proxy-send-timeout\" class=\"headerlink\" title=\"proxy_send_timeout\"></a>proxy_send_timeout</h3><blockquote>\n<p>语法: proxy_send_timeout time<br>上下文: http, server, location<br>默认值: 60s</p>\n</blockquote>\n<p>proxy_send_timeout是向后端写数据的超时时间，两次写操作的时间间隔大于这个值，也就是过了这么长时间后端还是没有收到数据，连接会被关闭。</p>\n<h2 id=\"服务端超时\"><a href=\"#服务端超时\" class=\"headerlink\" title=\"服务端超时\"></a>服务端超时</h2><hr>\n<p>Node.js做服务器时，默认的超时时长为2分钟。假设请求发送到服务端，在2分钟内没有响应返回给客户端，客户端的链接就会被重置。这个时长的设置是很必要的，因为过长的请求响应会阻塞IO，造成极差的用户体验。特别对于Node.js这种单线程应用来说，影响可以说是灾难性的，因此如何设置服务端的超时时间也是非常关键的。</p>\n<p>服务端超时设置也不是一刀切的，总体来说，有一个总开关，还可以对每个服务端的请求或者响应单独设置超时时长。</p>\n<p>我们后面的代码均以Node.js+Express搭建的后台为例。</p>\n<h3 id=\"服务端超时总开关\"><a href=\"#服务端超时总开关\" class=\"headerlink\" title=\"服务端超时总开关\"></a>服务端超时总开关</h3><p>使用Node.js的http模块启动服务器，并设置超时时长：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> config = <span class=\"built_in\">require</span>(./config);</span><br><span class=\"line\"></span><br><span class=\"line\">process.env.PORT = config.webport || <span class=\"number\">8888</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> app = express();</span><br><span class=\"line\"><span class=\"keyword\">let</span> server = app.listen(process.env.PORT);</span><br><span class=\"line\">server.setTimeout(<span class=\"number\">60</span>*<span class=\"number\">1000</span>);</span><br><span class=\"line\">server.on(<span class=\"string\">'timeout'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'timeout!'</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>server.setTimeout()是设置server的超时时间设置方法，单位是毫秒，一旦超过设置的超时时长，则触发server对象的’timeout’事件，并传入socket作为一个参数。</p>\n<h3 id=\"设置Express中间件超时时间\"><a href=\"#设置Express中间件超时时间\" class=\"headerlink\" title=\"设置Express中间件超时时间\"></a>设置Express中间件超时时间</h3><blockquote>\n<p>Express是一个路由和中间件Web框架，其自身只具有最低程度的功能：Express应用程序基本上是一系列中间件函数调用。</p>\n</blockquote>\n<blockquote>\n<p>中间件函数能够访问请求对象 (req)、响应对象 (res) 以及应用程序的请求/响应循环中的下一个中间件函数。下一个中间件函数通常由名为 next 的变量来表示。</p>\n</blockquote>\n<blockquote>\n<p>中间件函数可以执行以下任务：</p>\n</blockquote>\n<blockquote>\n<ul>\n<li>执行任何代码。</li>\n<li>对请求和响应对象进行更改。</li>\n<li>结束请求/响应循环。</li>\n<li>调用堆栈中的下一个中间件函数。</li>\n</ul>\n</blockquote>\n<blockquote>\n<p>如果当前中间件函数没有结束请求/响应循环，那么它必须调用next()，以将控制权传递给下一个中间件函数。否则，请求将保持挂起状态。</p>\n</blockquote>\n<p>对于Express的中间件，我们可以在app.js里为每个路由及其处理程序函数的中间件设置请求的响应和超时时间，</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.get(<span class=\"string\">'/user/:id'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 设置该中间件下所有HTTP请求的超时时间</span></span><br><span class=\"line\">    req.setTimeout(<span class=\"number\">60</span>*<span class=\"number\">1000</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 设置该中间件下所有HTTP请求的服务器响应超时时间</span></span><br><span class=\"line\">    res.setTimeout(<span class=\"number\">60</span>*<span class=\"number\">1000</span>);</span><br><span class=\"line\">    res.send(<span class=\"string\">'USER'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>Express不仅可以针对中间件设置超时时间，还可以针对某个具体的接口设置请求和响应的超时时长：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.get(<span class=\"string\">'/user/:id'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 设置该接口下所有HTTP请求的超时时间</span></span><br><span class=\"line\">    req.setTimeout(<span class=\"number\">60</span>*<span class=\"number\">1000</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 设置该接口下所有HTTP请求的服务器响应超时时间</span></span><br><span class=\"line\">    res.setTimeout(<span class=\"number\">60</span>*<span class=\"number\">1000</span>);</span><br><span class=\"line\">    res.send(<span class=\"string\">'USER'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>全写完了以后，仔细想了想，发现还没有写全，比如说服务端也可以发请求，不管是用http.method还是用request模块，都可以发请求。由于Node.js在很多项目中都是作为中间层，不管是向JAVA后台请求数据，还是用作解决客户端跨域问题的请求中转层，发请求都是很常用的用法。但是只要读者能耐心读到这里，相信随手网上搜一下就知道怎么写了，因此我这里就不再赘述了。</p>\n<p>写这篇文章主要想分享一下我的感受，超时限制就像一道关卡，一个请求从客户端到服务端，再从服务端返回客户端的路上，要“过五关斩六将”。有的时候想要修改超时设置，可能不是简单修改某一处就能解决问题的，这时候一定要仔细检查，把这个系统理一遍，每一个地方的超时设置都看一看，才能解决问题~</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"引子\"><a href=\"#引子\" class=\"headerlink\" title=\"引子\"></a>引子</h2><hr>\n<p>前段时间做项目时，由于某个请求在后台要进行长时间的脚本处理，频频超出系统默认的超时时长，于是我就对超时时长进行了检查。由于超时的时候请求报错的提示信息并不明确，为了修改这玩意儿也查了一堆资料，忙活了半天，终于把超时问题解决了，在这里做个记录。</p>\n<p>我的项目用的是web前台（这个无所谓用的什么框架，反正归根结底是js）+nginx代理+Node.js后台搭建的，我发现每一节都设了一道timeout超时的关卡，也就是说有<strong>客户端超时</strong>，<strong>代理超时</strong>，<strong>服务端超时</strong>三种情况。下面针对每种超时，我将进行分别讲解。</p>\n<p><img src=\"/2017/12/19/web超时配置总结/timeout.jpg\" alt=\"timeout!\"></p>\n<h2 id=\"客户端超时\"><a href=\"#客户端超时\" class=\"headerlink\" title=\"客户端超时\"></a>客户端超时</h2><hr>\n<h3 id=\"XMLHttpRequest的超时设置\"><a href=\"#XMLHttpRequest的超时设置\" class=\"headerlink\" title=\"XMLHttpRequest的超时设置\"></a>XMLHttpRequest的超时设置</h3><p>讲客户端超时，就要从XMLHttpRequest来谈起。</p>\n<p>XMLHttpRequest是一个API，它为客户端提供了在客户端和服务器之间传输数据的功能。它提供了一个通过URL来获取数据的简单方式，并且不会使整个页面刷新。这使得网页只更新一部分页面而不会打扰到用户。XMLHttpRequest在AJAX中被大量使用。</p>\n<p>XMLHttpRequest一开始只是微软浏览器提供的一个接口，后来各大浏览器纷纷效仿也提供了这个接口，再后来W3C对它进行了标准化，提出了XMLHttpRequest标准。XMLHttpRequest标准又分为Level 1和Level 2。<br>XMLHttpRequest Level 1主要存在以下缺点：</p>\n<ul>\n<li>受同源策略的限制，不能发送跨域请求；</li>\n<li>不能发送二进制文件（如图片、视频、音频等），只能发送纯文本数据；</li>\n<li>在发送和获取数据的过程中，无法实时获取进度信息，只能判断是否完成；</li>\n</ul>\n<p>那么Level 2对Level 1 进行了改进，XMLHttpRequest Level 2中新增了以下功能：</p>\n<ul>\n<li>可以发送跨域请求，在服务端允许的情况下；</li>\n<li>支持发送和接收二进制数据；</li>\n<li>新增formData对象，支持发送表单数据；</li>\n<li>发送和获取数据时，可以获取进度信息；</li>\n<li>可以设置请求的超时时间；</li>\n</ul>\n<p>在Level 2版本的XMLHttpRequest对象，增加了timeout属性，可以设置HTTP请求的时限。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">xhr.timeout = <span class=\"number\">60</span>*<span class=\"number\">1000</span>;</span><br><span class=\"line\">xhr.ontimeout = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">event</span>)</span>&#123;</span><br><span class=\"line\">　　　　alert(<span class=\"string\">'timeout！'</span>);</span><br><span class=\"line\">　　&#125;</span><br></pre></td></tr></table></figure>\n<p>在上述代码中，请求超时时间被设为1分钟（xhr.timeout的单位是毫秒），如果超过1分钟的时限，则会自动停止http请求；同时，触发ontimeout事件，弹出“timeout！”的提示框。</p>\n<p>同时值得注意的一点是，超时时间的计算，是从调用xhr.send()开始，至xhr.loadend触发为止的这段时间。即时xhr.timeout的设置是在xhr.send()之后，timeout的计时起点仍为调用xhr.send()的时刻。</p>\n<h3 id=\"其他超时设置\"><a href=\"#其他超时设置\" class=\"headerlink\" title=\"其他超时设置\"></a>其他超时设置</h3><p>其实会了XMLHttpRequest的超时设置，其他前端的框架啊、工具啊的超时设置都不再是问题，这就有点万法归宗的意思。因为我们常用的jQuery.ajax()方法实际上就是对浏览器提供的XMLHttpRequest对象的封装。而又有很多其他框架或者工具的请求模块是对jQuery.ajax()的封装。说到底，都是依赖的XMLHttpRequest对象。因此掌握了XMLHttpRequest，其他都很好学会。</p>\n<p>依jQuery.ajax()的超时设置为例：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.ajax(&#123;</span><br><span class=\"line\">    url: <span class=\"string\">\"test.html\"</span>,</span><br><span class=\"line\">    error: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// will fire when timeout is reached</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    success: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// do something</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    timeout: <span class=\"number\">60</span>*<span class=\"number\">1000</span> <span class=\"comment\">// sets timeout to 1 minute</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>实在是简单，对不对？</p>\n<h2 id=\"代理超时\"><a href=\"#代理超时\" class=\"headerlink\" title=\"代理超时\"></a>代理超时</h2><hr>\n<p>nginx的超时设置主要分3种：</p>\n<ul>\n<li>proxy_connect_timeout</li>\n<li>proxy_read_timeout</li>\n<li>proxy_send_timeout</li>\n</ul>\n<h3 id=\"proxy-connect-timeout\"><a href=\"#proxy-connect-timeout\" class=\"headerlink\" title=\"proxy_connect_timeout\"></a>proxy_connect_timeout</h3><blockquote>\n<p>语法: proxy_connect_timeout timeout_in_seconds<br>上下文: http, server, location<br>默认值: 60s</p>\n</blockquote>\n<p>proxy_connect_timeout是和后端建立连接的超时时间。需要记住的是，这个时间不能超过75秒。</p>\n<p>这个不是等待后端返回页面的时间，那是由proxy_read_timeout声明的。如果你的upstream服务器起来了，但是挂起了（例如，没有足够的线程处理请求，所以把你的请求放到请求池里稍后处理），那么这个声明是没有用的，由于与upstream服务器的连接已经建立了。</p>\n<h3 id=\"proxy-read-timeout\"><a href=\"#proxy-read-timeout\" class=\"headerlink\" title=\"proxy_read_timeout\"></a>proxy_read_timeout</h3><blockquote>\n<p>语法: proxy_read_timeout the_time<br>上下文: http, server, location<br>默认值: 60s</p>\n</blockquote>\n<p>proxy_read_timeout是从后端读取数据的超时时间，两次读取操作的时间间隔如果大于这个值，和后端的连接会被关闭。如果一个请求时间时间非常大，要把这个值设大点。</p>\n<h3 id=\"proxy-send-timeout\"><a href=\"#proxy-send-timeout\" class=\"headerlink\" title=\"proxy_send_timeout\"></a>proxy_send_timeout</h3><blockquote>\n<p>语法: proxy_send_timeout time<br>上下文: http, server, location<br>默认值: 60s</p>\n</blockquote>\n<p>proxy_send_timeout是向后端写数据的超时时间，两次写操作的时间间隔大于这个值，也就是过了这么长时间后端还是没有收到数据，连接会被关闭。</p>\n<h2 id=\"服务端超时\"><a href=\"#服务端超时\" class=\"headerlink\" title=\"服务端超时\"></a>服务端超时</h2><hr>\n<p>Node.js做服务器时，默认的超时时长为2分钟。假设请求发送到服务端，在2分钟内没有响应返回给客户端，客户端的链接就会被重置。这个时长的设置是很必要的，因为过长的请求响应会阻塞IO，造成极差的用户体验。特别对于Node.js这种单线程应用来说，影响可以说是灾难性的，因此如何设置服务端的超时时间也是非常关键的。</p>\n<p>服务端超时设置也不是一刀切的，总体来说，有一个总开关，还可以对每个服务端的请求或者响应单独设置超时时长。</p>\n<p>我们后面的代码均以Node.js+Express搭建的后台为例。</p>\n<h3 id=\"服务端超时总开关\"><a href=\"#服务端超时总开关\" class=\"headerlink\" title=\"服务端超时总开关\"></a>服务端超时总开关</h3><p>使用Node.js的http模块启动服务器，并设置超时时长：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> express = <span class=\"built_in\">require</span>(<span class=\"string\">'express'</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> config = <span class=\"built_in\">require</span>(./config);</span><br><span class=\"line\"></span><br><span class=\"line\">process.env.PORT = config.webport || <span class=\"number\">8888</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">let</span> app = express();</span><br><span class=\"line\"><span class=\"keyword\">let</span> server = app.listen(process.env.PORT);</span><br><span class=\"line\">server.setTimeout(<span class=\"number\">60</span>*<span class=\"number\">1000</span>);</span><br><span class=\"line\">server.on(<span class=\"string\">'timeout'</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'timeout!'</span>)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>server.setTimeout()是设置server的超时时间设置方法，单位是毫秒，一旦超过设置的超时时长，则触发server对象的’timeout’事件，并传入socket作为一个参数。</p>\n<h3 id=\"设置Express中间件超时时间\"><a href=\"#设置Express中间件超时时间\" class=\"headerlink\" title=\"设置Express中间件超时时间\"></a>设置Express中间件超时时间</h3><blockquote>\n<p>Express是一个路由和中间件Web框架，其自身只具有最低程度的功能：Express应用程序基本上是一系列中间件函数调用。</p>\n</blockquote>\n<blockquote>\n<p>中间件函数能够访问请求对象 (req)、响应对象 (res) 以及应用程序的请求/响应循环中的下一个中间件函数。下一个中间件函数通常由名为 next 的变量来表示。</p>\n</blockquote>\n<blockquote>\n<p>中间件函数可以执行以下任务：</p>\n</blockquote>\n<blockquote>\n<ul>\n<li>执行任何代码。</li>\n<li>对请求和响应对象进行更改。</li>\n<li>结束请求/响应循环。</li>\n<li>调用堆栈中的下一个中间件函数。</li>\n</ul>\n</blockquote>\n<blockquote>\n<p>如果当前中间件函数没有结束请求/响应循环，那么它必须调用next()，以将控制权传递给下一个中间件函数。否则，请求将保持挂起状态。</p>\n</blockquote>\n<p>对于Express的中间件，我们可以在app.js里为每个路由及其处理程序函数的中间件设置请求的响应和超时时间，</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">app.get(<span class=\"string\">'/user/:id'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 设置该中间件下所有HTTP请求的超时时间</span></span><br><span class=\"line\">    req.setTimeout(<span class=\"number\">60</span>*<span class=\"number\">1000</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 设置该中间件下所有HTTP请求的服务器响应超时时间</span></span><br><span class=\"line\">    res.setTimeout(<span class=\"number\">60</span>*<span class=\"number\">1000</span>);</span><br><span class=\"line\">    res.send(<span class=\"string\">'USER'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>Express不仅可以针对中间件设置超时时间，还可以针对某个具体的接口设置请求和响应的超时时长：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">router.get(<span class=\"string\">'/user/:id'</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">req, res, next</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 设置该接口下所有HTTP请求的超时时间</span></span><br><span class=\"line\">    req.setTimeout(<span class=\"number\">60</span>*<span class=\"number\">1000</span>);</span><br><span class=\"line\">    <span class=\"comment\">// 设置该接口下所有HTTP请求的服务器响应超时时间</span></span><br><span class=\"line\">    res.setTimeout(<span class=\"number\">60</span>*<span class=\"number\">1000</span>);</span><br><span class=\"line\">    res.send(<span class=\"string\">'USER'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><p>全写完了以后，仔细想了想，发现还没有写全，比如说服务端也可以发请求，不管是用http.method还是用request模块，都可以发请求。由于Node.js在很多项目中都是作为中间层，不管是向JAVA后台请求数据，还是用作解决客户端跨域问题的请求中转层，发请求都是很常用的用法。但是只要读者能耐心读到这里，相信随手网上搜一下就知道怎么写了，因此我这里就不再赘述了。</p>\n<p>写这篇文章主要想分享一下我的感受，超时限制就像一道关卡，一个请求从客户端到服务端，再从服务端返回客户端的路上，要“过五关斩六将”。有的时候想要修改超时设置，可能不是简单修改某一处就能解决问题的，这时候一定要仔细检查，把这个系统理一遍，每一个地方的超时设置都看一看，才能解决问题~</p>\n"},{"title":"【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面","date":"2017-12-26T09:16:00.000Z","picture":"wallpaper.jpg","description":"是不是看腻了自己博客的背景图片？赶紧来自己动手做一个吧！看完这篇文章，你将会从零开始学会写一个实用的小项目，然后在线上部署，在相当低成本的情况下将自己的接口暴露出去，造福自己，造福别人~","_content":"\n欢迎光临我的博客[拓跋的前端客栈](http://tuobaye.com)，这个是[原文地址](http://tuobaye.com/2017/12/26/%E3%80%90Node.js%E7%BA%BF%E4%B8%8A%E9%83%A8%E7%BD%B2%E5%B0%8F%E9%A1%B9%E7%9B%AE%E3%80%91%E8%AE%A9%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2%E6%AF%8F%E6%AC%A1%E6%89%93%E5%BC%80%E9%83%BD%E6%9C%89%E4%B8%8D%E5%90%8C%E7%9A%84%E5%B0%81%E9%9D%A2/)，这个是[项目地址](https://github.com/tuobaye0711/new-wallpaper-everyday)，这个是[线上部署地址](http://tuobaye.duapp.com/)。如果您发现我文章中存在错误，请尽情向我吐槽，大家一起学习一起进步φ(>ω<*)\n\n## 1、引子\n\n***\n\n为什么想做这个功能呢？起因很简单————我看腻了自己博客的封面(特地要提一下，封面是来自[huno](https://github.com/letiantian/huno))。\n\n![old cover](background-cover.jpg)\n\n虽然我的封面很好看的说，但是谁还没有个审美疲劳不是？\n\n毕竟再好看的图片都有看腻的一天，为了克服审美疲劳，最好能经常换换封面，每天都不一样就更好了！\n\n想到了就去做，动手~\n\n## 2、选图源\n\n***\n\n说起每天一张美图，那大伙第一个想到的肯定是[必应](https://www.bing.com)啦，必应的搜索引擎虽然大多数人用的不多——翻墙的用谷歌的多，不翻墙的用百度的多。但是必应搜索的首页真的很亮眼~就是因为每天都有不同的美图做背景，而且根据地理位置还有不同的图片：\n\n![bingcn](bingcn.png)\n![bingen](bingen.png)\n\n既美又高清，很适合做壁纸。就是他了！\n\n既然要做接，首先要抓取bing的api，emmm，打开bing主页，F12，点击Network-XHR，挨个找一下，很容易就能发现在哪里，看图~\n\n![xhr](xhr.png)\n\n很容易找到是哪条请求。其实这个bing的壁纸接口在网上一搜也能搜到了，[看这里](https://stackoverflow.com/questions/10639914/is-there-a-way-to-get-bings-photo-of-the-day)。\n \n 接口格式是这样的：\n \n> XML: http://www.bing.com/HPImageArchive.aspx?format=xml&idx=0&n=1&mkt=en-US\n> JSON: http://www.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1&mkt=en-US\n> RSS: http://www.bing.com/HPImageArchive.aspx?format=rss&idx=0&n=1&mkt=en-US\n\n- *format*表示返回格式，可选字段有xml、js（json）、rss\n- *idx*=x表示获取从第x天前开始的图片，最大值为7，n>7时返回的都是n=7的值\n- *n*=y表示获取从idx开始连续y天的图片，最大值为9，同时限制最多能获取15天以内的图片\n- *mkt*表示地区信息，已知的只有zh-CN和en-US，是否还有其他的我也不清楚\n\n返回值如下：\n\n{% codeblock lang:javascript %}\n    {\n        \"images\": [\n            {\n                \"startdate\": \"20171226\", \n                \"fullstartdate\": \"201712261600\", \n                \"enddate\": \"20171227\", \n                \"url\": \"/az/hprichbg/rb/CPNYSnow_ZH-CN13335620157_1920x1080.jpg\", \n                \"urlbase\": \"/az/hprichbg/rb/CPNYSnow_ZH-CN13335620157\", \n                \"copyright\": \"中央公园，美国纽约市 (© Nisian Hughes/Getty Images)\", \n                \"copyrightlink\": \"http://www.bing.com/search?q=%E4%B8%AD%E5%A4%AE%E5%85%AC%E5%9B%AD&form=hpcapt&mkt=zh-cn\", \n                \"quiz\": \"/search?q=Bing+homepage+quiz&filters=WQOskey:%22HPQuiz_20171226_CPNYSnow%22&FORM=HPQUIZ\",\n                \"wp\": true, \n                \"hsh\": \"381850a3d2d57acd0ded240e42ffec8e\", \n                \"drk\": 1, \n                \"top\": 1, \n                \"bot\": 1, \n                \"hs\": [ ]\n            }\n        ], \n        \"tooltips\": {\n            \"loading\": \"正在加载...\", \n            \"previous\": \"上一个图像\", \n            \"next\": \"下一个图像\", \n            \"walle\": \"此图片不能下载用作壁纸。\", \n            \"walls\": \"下载今日美图。仅限用作桌面壁纸。\"\n        }\n    }\n{% endcodeblock %}\n\n我们只要在 www.bing.com 后面拼上images[0].url就是我们想要的图片的链接了~还是1920x1080的高清图片呢，拿来做壁纸正合适~\n\n有了这些已知信息，我们终于可以愉快的撸代码了φ(>ω<*)\n\n## 3、撸代码\n\n***\n\n我选择采用Node.js+express来搭建我们的后台代码。并做一个规划，我们的接口要能返回当日的图片，能根据入参返回几天前的哪个地区的图片，哦对了，能随机返回图片，保证咱每次看到的都不一样。\n\n很简单，说干就干。\n\n关于怎么搭建一个Node.js+express服务我就不废话了，这几个接口都要用到请求uri，简单写个公共函数用来获取uri：\n\n{% codeblock lang:javascript %}\n    function getUri(start, number, mkt) {\n        return 'https://www.bing.com/HPImageArchive.aspx?format=js&idx=' + start + '&n=' + number + '&mkt=' + mkt\n    }\n{% endcodeblock %}\n\n另外由于获取随机图片和获取按参数指定的图片肯定是两个不同的接口，但是他们同时要用到一个请求并处理返回值的过程，为了代码好看，我们把他抽离出来：\n\n{% codeblock lang:javascript %}\n    function getWallpaper(res, days_ago, mkt) {\n        let uri;\n        if (days_ago <= 7){\n            uri = getUri(days_ago, 1, mkt)\n        }else {\n            uri = getUri(7, days_ago-6, mkt)\n        }\n        request(uri, function (error, response, body) {\n            if (!error && response.statusCode === 200) {\n                let data = JSON.parse(body);\n                let images = data.images;\n                res.redirect('https://www.bing.com'+images[images.length-1].url)\n            }else{\n                res.send('request error!')\n            }\n        })\n    }\n{% endcodeblock %}\n\n函数很简单，看一眼就明白了，至于为什么返回的时候使用res.redirect()，这跟我的目的有关系。\n\n我一开始就提到了，我要实现自己博客每天更换封面的效果，博客的封面使用的是CSS的background样式，这个样式虽然可以用本地图片也可以用线上图片，但是必须是图片！由于我们的服务自己不做存储，因此直接把要获取到的图片的根地址返回过去才是最优解，这就是我们选择使用res.redirect()的原因。\n\n还有随机接口，我们只要写个自定义范围的随机函数打乱就可以了：\n\n{% codeblock lang:javascript %}\n    function getRandomInteger(min, max) {\n        return Math.floor(Math.random() * (max - min + 1)) + min;\n    }\n{% endcodeblock %}\n\n函数getRandomInteger(min, max)返回min和max之间的任意整数。使用这个函数不仅可以随机获取0-15天内的某个天数，也可以使用ta获取随机的地区：\n\n{% codeblock lang:javascript %}\n    let mkt = getRandomInteger(0,1) ? 'zh-CN' : 'en-US';\n{% endcodeblock %}\n\n其他都没什么难度了，就是传参。可以自己去看[源码](https://github.com/tuobaye0711/new-wallpaper-everyday)~\n\n## 4、BAE线上部署\n\n***\n\n既然我们自己写的接口希望能用在自己的个人网站上，接口肯定不能只能在本地调用吧？我们接下来要做的就是把博客线上部署啦，这样我们就能把接口暴露在互联网上，造福自己，造福大家~\n\n因为我们的项目相当之轻量，不占存储，不占内存，基本上就是做一个转发的功能，因此不需要什么很高的服务器性能。为了这个项目还要自己租用一个云服务器那就得不偿失了~在你自己本身没有服务器的前提下，我推荐你使用百度的BAE进行线上部署(Baidu Application Engine)，一天只要两毛钱，用到天长地久（我都有点替百度心疼资源o(TωT)o ）。 \n\n### 部署步骤\n\n1. 首先登陆[百度云](https://console.bce.baidu.com)的首页，没有注册的注册一下，注册以后实名认证一下。这里不细说了~\n2. 点击左侧菜单栏的应用引擎BAE，界面如图所示，点击“添加部署”。![step2](step2.png)\n3. 界面如图所示，按你的需要选择配置，我选择的是这样的（请无视右侧的重叠框，滚动截图工具不支持position: fixed定位方式的锅）。其中，由于我要跑的是Node.js代码，因此类型选择Node能支持的最高版本。代码版本工具依靠个人喜好，我喜欢git。内存选最低，单元个数选最少，OK，一天只需要两毛钱~点击下一步。![step3](step3.png)\n4. 点击“去支付”即可，后付费方式，账号里没有余额也能支付成功。![step4](step4.png)\n5. OK,开通成功了，去控制台看看吧~![step5](step5.png)\n6. 在部署列表里，直接点名称进到里面，选择发布设置。这里可以看到git地址，我们这就可以通过git clone的方式把代码库同步到本地，然后把本地的代码放到里面，push上来，就大功告成啦~对了，最好把自动发布设置打开，这样每次更新代码都能自动在线上部署最新的版本咯。![step6-1](step6-1.png) ![step6-2](step6-2.png)\n7. 最后，调用一下我的接口试试吧：tuobaye.duapp.com\n\n### BAE部署过程中的几个坑\n\n1. BAE代码只能监听18080，要把原来的端口设置改为18080；\n2. BAE默认不支持ES6语法，所以原来你代码里的let/const什么的老老实实改成var吧，\n3. 我在上传的过程中，把node_modules省略了，然后在package.json里面写上了dependencies，但是报错了。我的解决办法是直接把node_modules上传，把package.json的dependencies删掉，只让他自动执行启动脚本，不管别的，就启动成功了。\n4. [BAE文档](https://cloud.baidu.com/doc/BAE/Nodejs.html)，有其他问题可以看看这个，有一定参考价值。\n\nOK，搞定啦\n\n## 5、修改背景，目的达成！\n\n我的博客是用hexo生成的，博客的背景图片在主题文件的样式里面。每个人都有自己的不同情况，但是只要找到这一行样式就行了。\n\n{% codeblock lang:css %}\n    .panel-cover {\n      display: block;\n      position: fixed;\n      z-index: 900;\n      width: 100%;\n      max-width: none;\n      height: 100%;\n      background: url(../images/background-cover.jpg) top left no-repeat #666666;\n      background-size: cover;\n    }\n{% endcodeblock %}\n\n把background改成我们自己的接口，这个接口可以获取当天的壁纸图片：\n\n{% codeblock lang:css %}\n    .panel-cover {\n      display: block;\n      position: fixed;\n      z-index: 900;\n      width: 100%;\n      max-width: none;\n      height: 100%;\n      background: url(http://tuobaye.duapp.com/wallpaper) top left no-repeat #666666;\n      background-size: cover;\n    }\n{% endcodeblock %}\n\n对比一下，是不是很有成就感~？\n\n![before](before.png)\n![after](after.png)\n\n如果把url换成 http://tuobaye.duapp.com/wallpaper/random ，就可以每刷新一次都是新的封面了~帅气！\n\nPS. 现在我有自己的服务器了，已经不用BAE了。BAE基础版好像马上就要下线了（貌似太便宜了赚不到钱...）。如果想调用我的api，只需把url换成[http://api.tuobaye.com:8888](http://api.tuobaye.com:8888)即可~\n\n## 6、小结\n\n***\n\n看完这篇文章，你将会从零开始学会写一个实用的小项目，然后在线上部署，在相当低成本的情况下将自己的接口暴露出去，造福自己，造福别人~\n\n从想到换封面的点子，到选图源，抓接口，撸代码，BAE部署到最后自己用上自己最新鲜的接口，实际的工作量一共也不超过一天时间，其中还有一大半时间都是在踩BAE的坑。\n\n很多时候，限制我们的并不是我们的技术，而是创意和实干的心。\n\n虽然项目简单，但是能对读到这里的读者一点启发作用，那我觉得就很知足了~\n\n想到就去做，Just do it!","source":"_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面.md","raw":"---\ntitle: 【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面\ndate: 2017-12-26 17:16:00\ntags: Node.js\npicture: wallpaper.jpg\ndescription: 是不是看腻了自己博客的背景图片？赶紧来自己动手做一个吧！看完这篇文章，你将会从零开始学会写一个实用的小项目，然后在线上部署，在相当低成本的情况下将自己的接口暴露出去，造福自己，造福别人~\n---\n\n欢迎光临我的博客[拓跋的前端客栈](http://tuobaye.com)，这个是[原文地址](http://tuobaye.com/2017/12/26/%E3%80%90Node.js%E7%BA%BF%E4%B8%8A%E9%83%A8%E7%BD%B2%E5%B0%8F%E9%A1%B9%E7%9B%AE%E3%80%91%E8%AE%A9%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2%E6%AF%8F%E6%AC%A1%E6%89%93%E5%BC%80%E9%83%BD%E6%9C%89%E4%B8%8D%E5%90%8C%E7%9A%84%E5%B0%81%E9%9D%A2/)，这个是[项目地址](https://github.com/tuobaye0711/new-wallpaper-everyday)，这个是[线上部署地址](http://tuobaye.duapp.com/)。如果您发现我文章中存在错误，请尽情向我吐槽，大家一起学习一起进步φ(>ω<*)\n\n## 1、引子\n\n***\n\n为什么想做这个功能呢？起因很简单————我看腻了自己博客的封面(特地要提一下，封面是来自[huno](https://github.com/letiantian/huno))。\n\n![old cover](background-cover.jpg)\n\n虽然我的封面很好看的说，但是谁还没有个审美疲劳不是？\n\n毕竟再好看的图片都有看腻的一天，为了克服审美疲劳，最好能经常换换封面，每天都不一样就更好了！\n\n想到了就去做，动手~\n\n## 2、选图源\n\n***\n\n说起每天一张美图，那大伙第一个想到的肯定是[必应](https://www.bing.com)啦，必应的搜索引擎虽然大多数人用的不多——翻墙的用谷歌的多，不翻墙的用百度的多。但是必应搜索的首页真的很亮眼~就是因为每天都有不同的美图做背景，而且根据地理位置还有不同的图片：\n\n![bingcn](bingcn.png)\n![bingen](bingen.png)\n\n既美又高清，很适合做壁纸。就是他了！\n\n既然要做接，首先要抓取bing的api，emmm，打开bing主页，F12，点击Network-XHR，挨个找一下，很容易就能发现在哪里，看图~\n\n![xhr](xhr.png)\n\n很容易找到是哪条请求。其实这个bing的壁纸接口在网上一搜也能搜到了，[看这里](https://stackoverflow.com/questions/10639914/is-there-a-way-to-get-bings-photo-of-the-day)。\n \n 接口格式是这样的：\n \n> XML: http://www.bing.com/HPImageArchive.aspx?format=xml&idx=0&n=1&mkt=en-US\n> JSON: http://www.bing.com/HPImageArchive.aspx?format=js&idx=0&n=1&mkt=en-US\n> RSS: http://www.bing.com/HPImageArchive.aspx?format=rss&idx=0&n=1&mkt=en-US\n\n- *format*表示返回格式，可选字段有xml、js（json）、rss\n- *idx*=x表示获取从第x天前开始的图片，最大值为7，n>7时返回的都是n=7的值\n- *n*=y表示获取从idx开始连续y天的图片，最大值为9，同时限制最多能获取15天以内的图片\n- *mkt*表示地区信息，已知的只有zh-CN和en-US，是否还有其他的我也不清楚\n\n返回值如下：\n\n{% codeblock lang:javascript %}\n    {\n        \"images\": [\n            {\n                \"startdate\": \"20171226\", \n                \"fullstartdate\": \"201712261600\", \n                \"enddate\": \"20171227\", \n                \"url\": \"/az/hprichbg/rb/CPNYSnow_ZH-CN13335620157_1920x1080.jpg\", \n                \"urlbase\": \"/az/hprichbg/rb/CPNYSnow_ZH-CN13335620157\", \n                \"copyright\": \"中央公园，美国纽约市 (© Nisian Hughes/Getty Images)\", \n                \"copyrightlink\": \"http://www.bing.com/search?q=%E4%B8%AD%E5%A4%AE%E5%85%AC%E5%9B%AD&form=hpcapt&mkt=zh-cn\", \n                \"quiz\": \"/search?q=Bing+homepage+quiz&filters=WQOskey:%22HPQuiz_20171226_CPNYSnow%22&FORM=HPQUIZ\",\n                \"wp\": true, \n                \"hsh\": \"381850a3d2d57acd0ded240e42ffec8e\", \n                \"drk\": 1, \n                \"top\": 1, \n                \"bot\": 1, \n                \"hs\": [ ]\n            }\n        ], \n        \"tooltips\": {\n            \"loading\": \"正在加载...\", \n            \"previous\": \"上一个图像\", \n            \"next\": \"下一个图像\", \n            \"walle\": \"此图片不能下载用作壁纸。\", \n            \"walls\": \"下载今日美图。仅限用作桌面壁纸。\"\n        }\n    }\n{% endcodeblock %}\n\n我们只要在 www.bing.com 后面拼上images[0].url就是我们想要的图片的链接了~还是1920x1080的高清图片呢，拿来做壁纸正合适~\n\n有了这些已知信息，我们终于可以愉快的撸代码了φ(>ω<*)\n\n## 3、撸代码\n\n***\n\n我选择采用Node.js+express来搭建我们的后台代码。并做一个规划，我们的接口要能返回当日的图片，能根据入参返回几天前的哪个地区的图片，哦对了，能随机返回图片，保证咱每次看到的都不一样。\n\n很简单，说干就干。\n\n关于怎么搭建一个Node.js+express服务我就不废话了，这几个接口都要用到请求uri，简单写个公共函数用来获取uri：\n\n{% codeblock lang:javascript %}\n    function getUri(start, number, mkt) {\n        return 'https://www.bing.com/HPImageArchive.aspx?format=js&idx=' + start + '&n=' + number + '&mkt=' + mkt\n    }\n{% endcodeblock %}\n\n另外由于获取随机图片和获取按参数指定的图片肯定是两个不同的接口，但是他们同时要用到一个请求并处理返回值的过程，为了代码好看，我们把他抽离出来：\n\n{% codeblock lang:javascript %}\n    function getWallpaper(res, days_ago, mkt) {\n        let uri;\n        if (days_ago <= 7){\n            uri = getUri(days_ago, 1, mkt)\n        }else {\n            uri = getUri(7, days_ago-6, mkt)\n        }\n        request(uri, function (error, response, body) {\n            if (!error && response.statusCode === 200) {\n                let data = JSON.parse(body);\n                let images = data.images;\n                res.redirect('https://www.bing.com'+images[images.length-1].url)\n            }else{\n                res.send('request error!')\n            }\n        })\n    }\n{% endcodeblock %}\n\n函数很简单，看一眼就明白了，至于为什么返回的时候使用res.redirect()，这跟我的目的有关系。\n\n我一开始就提到了，我要实现自己博客每天更换封面的效果，博客的封面使用的是CSS的background样式，这个样式虽然可以用本地图片也可以用线上图片，但是必须是图片！由于我们的服务自己不做存储，因此直接把要获取到的图片的根地址返回过去才是最优解，这就是我们选择使用res.redirect()的原因。\n\n还有随机接口，我们只要写个自定义范围的随机函数打乱就可以了：\n\n{% codeblock lang:javascript %}\n    function getRandomInteger(min, max) {\n        return Math.floor(Math.random() * (max - min + 1)) + min;\n    }\n{% endcodeblock %}\n\n函数getRandomInteger(min, max)返回min和max之间的任意整数。使用这个函数不仅可以随机获取0-15天内的某个天数，也可以使用ta获取随机的地区：\n\n{% codeblock lang:javascript %}\n    let mkt = getRandomInteger(0,1) ? 'zh-CN' : 'en-US';\n{% endcodeblock %}\n\n其他都没什么难度了，就是传参。可以自己去看[源码](https://github.com/tuobaye0711/new-wallpaper-everyday)~\n\n## 4、BAE线上部署\n\n***\n\n既然我们自己写的接口希望能用在自己的个人网站上，接口肯定不能只能在本地调用吧？我们接下来要做的就是把博客线上部署啦，这样我们就能把接口暴露在互联网上，造福自己，造福大家~\n\n因为我们的项目相当之轻量，不占存储，不占内存，基本上就是做一个转发的功能，因此不需要什么很高的服务器性能。为了这个项目还要自己租用一个云服务器那就得不偿失了~在你自己本身没有服务器的前提下，我推荐你使用百度的BAE进行线上部署(Baidu Application Engine)，一天只要两毛钱，用到天长地久（我都有点替百度心疼资源o(TωT)o ）。 \n\n### 部署步骤\n\n1. 首先登陆[百度云](https://console.bce.baidu.com)的首页，没有注册的注册一下，注册以后实名认证一下。这里不细说了~\n2. 点击左侧菜单栏的应用引擎BAE，界面如图所示，点击“添加部署”。![step2](step2.png)\n3. 界面如图所示，按你的需要选择配置，我选择的是这样的（请无视右侧的重叠框，滚动截图工具不支持position: fixed定位方式的锅）。其中，由于我要跑的是Node.js代码，因此类型选择Node能支持的最高版本。代码版本工具依靠个人喜好，我喜欢git。内存选最低，单元个数选最少，OK，一天只需要两毛钱~点击下一步。![step3](step3.png)\n4. 点击“去支付”即可，后付费方式，账号里没有余额也能支付成功。![step4](step4.png)\n5. OK,开通成功了，去控制台看看吧~![step5](step5.png)\n6. 在部署列表里，直接点名称进到里面，选择发布设置。这里可以看到git地址，我们这就可以通过git clone的方式把代码库同步到本地，然后把本地的代码放到里面，push上来，就大功告成啦~对了，最好把自动发布设置打开，这样每次更新代码都能自动在线上部署最新的版本咯。![step6-1](step6-1.png) ![step6-2](step6-2.png)\n7. 最后，调用一下我的接口试试吧：tuobaye.duapp.com\n\n### BAE部署过程中的几个坑\n\n1. BAE代码只能监听18080，要把原来的端口设置改为18080；\n2. BAE默认不支持ES6语法，所以原来你代码里的let/const什么的老老实实改成var吧，\n3. 我在上传的过程中，把node_modules省略了，然后在package.json里面写上了dependencies，但是报错了。我的解决办法是直接把node_modules上传，把package.json的dependencies删掉，只让他自动执行启动脚本，不管别的，就启动成功了。\n4. [BAE文档](https://cloud.baidu.com/doc/BAE/Nodejs.html)，有其他问题可以看看这个，有一定参考价值。\n\nOK，搞定啦\n\n## 5、修改背景，目的达成！\n\n我的博客是用hexo生成的，博客的背景图片在主题文件的样式里面。每个人都有自己的不同情况，但是只要找到这一行样式就行了。\n\n{% codeblock lang:css %}\n    .panel-cover {\n      display: block;\n      position: fixed;\n      z-index: 900;\n      width: 100%;\n      max-width: none;\n      height: 100%;\n      background: url(../images/background-cover.jpg) top left no-repeat #666666;\n      background-size: cover;\n    }\n{% endcodeblock %}\n\n把background改成我们自己的接口，这个接口可以获取当天的壁纸图片：\n\n{% codeblock lang:css %}\n    .panel-cover {\n      display: block;\n      position: fixed;\n      z-index: 900;\n      width: 100%;\n      max-width: none;\n      height: 100%;\n      background: url(http://tuobaye.duapp.com/wallpaper) top left no-repeat #666666;\n      background-size: cover;\n    }\n{% endcodeblock %}\n\n对比一下，是不是很有成就感~？\n\n![before](before.png)\n![after](after.png)\n\n如果把url换成 http://tuobaye.duapp.com/wallpaper/random ，就可以每刷新一次都是新的封面了~帅气！\n\nPS. 现在我有自己的服务器了，已经不用BAE了。BAE基础版好像马上就要下线了（貌似太便宜了赚不到钱...）。如果想调用我的api，只需把url换成[http://api.tuobaye.com:8888](http://api.tuobaye.com:8888)即可~\n\n## 6、小结\n\n***\n\n看完这篇文章，你将会从零开始学会写一个实用的小项目，然后在线上部署，在相当低成本的情况下将自己的接口暴露出去，造福自己，造福别人~\n\n从想到换封面的点子，到选图源，抓接口，撸代码，BAE部署到最后自己用上自己最新鲜的接口，实际的工作量一共也不超过一天时间，其中还有一大半时间都是在踩BAE的坑。\n\n很多时候，限制我们的并不是我们的技术，而是创意和实干的心。\n\n虽然项目简单，但是能对读到这里的读者一点启发作用，那我觉得就很知足了~\n\n想到就去做，Just do it!","slug":"【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面","published":1,"updated":"2018-07-21T02:23:21.112Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk698hxn0008znzw52ki9j1z","content":"<p>欢迎光临我的博客<a href=\"http://tuobaye.com\" target=\"_blank\" rel=\"noopener\">拓跋的前端客栈</a>，这个是<a href=\"http://tuobaye.com/2017/12/26/%E3%80%90Node.js%E7%BA%BF%E4%B8%8A%E9%83%A8%E7%BD%B2%E5%B0%8F%E9%A1%B9%E7%9B%AE%E3%80%91%E8%AE%A9%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2%E6%AF%8F%E6%AC%A1%E6%89%93%E5%BC%80%E9%83%BD%E6%9C%89%E4%B8%8D%E5%90%8C%E7%9A%84%E5%B0%81%E9%9D%A2/\" target=\"_blank\" rel=\"noopener\">原文地址</a>，这个是<a href=\"https://github.com/tuobaye0711/new-wallpaper-everyday\" target=\"_blank\" rel=\"noopener\">项目地址</a>，这个是<a href=\"http://tuobaye.duapp.com/\" target=\"_blank\" rel=\"noopener\">线上部署地址</a>。如果您发现我文章中存在错误，请尽情向我吐槽，大家一起学习一起进步φ(&gt;ω&lt;*)</p>\n<h2 id=\"1、引子\"><a href=\"#1、引子\" class=\"headerlink\" title=\"1、引子\"></a>1、引子</h2><hr>\n<p>为什么想做这个功能呢？起因很简单————我看腻了自己博客的封面(特地要提一下，封面是来自<a href=\"https://github.com/letiantian/huno\" target=\"_blank\" rel=\"noopener\">huno</a>)。</p>\n<p><img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/background-cover.jpg\" alt=\"old cover\"></p>\n<p>虽然我的封面很好看的说，但是谁还没有个审美疲劳不是？</p>\n<p>毕竟再好看的图片都有看腻的一天，为了克服审美疲劳，最好能经常换换封面，每天都不一样就更好了！</p>\n<p>想到了就去做，动手~</p>\n<h2 id=\"2、选图源\"><a href=\"#2、选图源\" class=\"headerlink\" title=\"2、选图源\"></a>2、选图源</h2><hr>\n<p>说起每天一张美图，那大伙第一个想到的肯定是<a href=\"https://www.bing.com\" target=\"_blank\" rel=\"noopener\">必应</a>啦，必应的搜索引擎虽然大多数人用的不多——翻墙的用谷歌的多，不翻墙的用百度的多。但是必应搜索的首页真的很亮眼~就是因为每天都有不同的美图做背景，而且根据地理位置还有不同的图片：</p>\n<p><img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/bingcn.png\" alt=\"bingcn\"><br><img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/bingen.png\" alt=\"bingen\"></p>\n<p>既美又高清，很适合做壁纸。就是他了！</p>\n<p>既然要做接，首先要抓取bing的api，emmm，打开bing主页，F12，点击Network-XHR，挨个找一下，很容易就能发现在哪里，看图~</p>\n<p><img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/xhr.png\" alt=\"xhr\"></p>\n<p>很容易找到是哪条请求。其实这个bing的壁纸接口在网上一搜也能搜到了，<a href=\"https://stackoverflow.com/questions/10639914/is-there-a-way-to-get-bings-photo-of-the-day\" target=\"_blank\" rel=\"noopener\">看这里</a>。</p>\n<p> 接口格式是这样的：</p>\n<blockquote>\n<p>XML: <a href=\"http://www.bing.com/HPImageArchive.aspx?format=xml&amp;idx=0&amp;n=1&amp;mkt=en-US\" target=\"_blank\" rel=\"noopener\">http://www.bing.com/HPImageArchive.aspx?format=xml&amp;idx=0&amp;n=1&amp;mkt=en-US</a><br>JSON: <a href=\"http://www.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1&amp;mkt=en-US\" target=\"_blank\" rel=\"noopener\">http://www.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1&amp;mkt=en-US</a><br>RSS: <a href=\"http://www.bing.com/HPImageArchive.aspx?format=rss&amp;idx=0&amp;n=1&amp;mkt=en-US\" target=\"_blank\" rel=\"noopener\">http://www.bing.com/HPImageArchive.aspx?format=rss&amp;idx=0&amp;n=1&amp;mkt=en-US</a></p>\n</blockquote>\n<ul>\n<li><em>format</em>表示返回格式，可选字段有xml、js（json）、rss</li>\n<li><em>idx</em>=x表示获取从第x天前开始的图片，最大值为7，n&gt;7时返回的都是n=7的值</li>\n<li><em>n</em>=y表示获取从idx开始连续y天的图片，最大值为9，同时限制最多能获取15天以内的图片</li>\n<li><em>mkt</em>表示地区信息，已知的只有zh-CN和en-US，是否还有其他的我也不清楚</li>\n</ul>\n<p>返回值如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"images\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">\"startdate\"</span>: <span class=\"string\">\"20171226\"</span>, </span><br><span class=\"line\">            <span class=\"string\">\"fullstartdate\"</span>: <span class=\"string\">\"201712261600\"</span>, </span><br><span class=\"line\">            <span class=\"string\">\"enddate\"</span>: <span class=\"string\">\"20171227\"</span>, </span><br><span class=\"line\">            <span class=\"string\">\"url\"</span>: <span class=\"string\">\"/az/hprichbg/rb/CPNYSnow_ZH-CN13335620157_1920x1080.jpg\"</span>, </span><br><span class=\"line\">            <span class=\"string\">\"urlbase\"</span>: <span class=\"string\">\"/az/hprichbg/rb/CPNYSnow_ZH-CN13335620157\"</span>, </span><br><span class=\"line\">            <span class=\"string\">\"copyright\"</span>: <span class=\"string\">\"中央公园，美国纽约市 (© Nisian Hughes/Getty Images)\"</span>, </span><br><span class=\"line\">            <span class=\"string\">\"copyrightlink\"</span>: <span class=\"string\">\"http://www.bing.com/search?q=%E4%B8%AD%E5%A4%AE%E5%85%AC%E5%9B%AD&amp;form=hpcapt&amp;mkt=zh-cn\"</span>, </span><br><span class=\"line\">            <span class=\"string\">\"quiz\"</span>: <span class=\"string\">\"/search?q=Bing+homepage+quiz&amp;filters=WQOskey:%22HPQuiz_20171226_CPNYSnow%22&amp;FORM=HPQUIZ\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"wp\"</span>: <span class=\"literal\">true</span>, </span><br><span class=\"line\">            <span class=\"string\">\"hsh\"</span>: <span class=\"string\">\"381850a3d2d57acd0ded240e42ffec8e\"</span>, </span><br><span class=\"line\">            <span class=\"string\">\"drk\"</span>: <span class=\"number\">1</span>, </span><br><span class=\"line\">            <span class=\"string\">\"top\"</span>: <span class=\"number\">1</span>, </span><br><span class=\"line\">            <span class=\"string\">\"bot\"</span>: <span class=\"number\">1</span>, </span><br><span class=\"line\">            <span class=\"string\">\"hs\"</span>: [ ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ], </span><br><span class=\"line\">    <span class=\"string\">\"tooltips\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"loading\"</span>: <span class=\"string\">\"正在加载...\"</span>, </span><br><span class=\"line\">        <span class=\"string\">\"previous\"</span>: <span class=\"string\">\"上一个图像\"</span>, </span><br><span class=\"line\">        <span class=\"string\">\"next\"</span>: <span class=\"string\">\"下一个图像\"</span>, </span><br><span class=\"line\">        <span class=\"string\">\"walle\"</span>: <span class=\"string\">\"此图片不能下载用作壁纸。\"</span>, </span><br><span class=\"line\">        <span class=\"string\">\"walls\"</span>: <span class=\"string\">\"下载今日美图。仅限用作桌面壁纸。\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们只要在 <a href=\"http://www.bing.com\" target=\"_blank\" rel=\"noopener\">www.bing.com</a> 后面拼上images[0].url就是我们想要的图片的链接了~还是1920x1080的高清图片呢，拿来做壁纸正合适~</p>\n<p>有了这些已知信息，我们终于可以愉快的撸代码了φ(&gt;ω&lt;*)</p>\n<h2 id=\"3、撸代码\"><a href=\"#3、撸代码\" class=\"headerlink\" title=\"3、撸代码\"></a>3、撸代码</h2><hr>\n<p>我选择采用Node.js+express来搭建我们的后台代码。并做一个规划，我们的接口要能返回当日的图片，能根据入参返回几天前的哪个地区的图片，哦对了，能随机返回图片，保证咱每次看到的都不一样。</p>\n<p>很简单，说干就干。</p>\n<p>关于怎么搭建一个Node.js+express服务我就不废话了，这几个接口都要用到请求uri，简单写个公共函数用来获取uri：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getUri</span>(<span class=\"params\">start, number, mkt</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'https://www.bing.com/HPImageArchive.aspx?format=js&amp;idx='</span> + start + <span class=\"string\">'&amp;n='</span> + number + <span class=\"string\">'&amp;mkt='</span> + mkt</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>另外由于获取随机图片和获取按参数指定的图片肯定是两个不同的接口，但是他们同时要用到一个请求并处理返回值的过程，为了代码好看，我们把他抽离出来：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getWallpaper</span>(<span class=\"params\">res, days_ago, mkt</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> uri;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (days_ago &lt;= <span class=\"number\">7</span>)&#123;</span><br><span class=\"line\">        uri = getUri(days_ago, <span class=\"number\">1</span>, mkt)</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        uri = getUri(<span class=\"number\">7</span>, days_ago<span class=\"number\">-6</span>, mkt)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    request(uri, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error, response, body</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!error &amp;&amp; response.statusCode === <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> data = <span class=\"built_in\">JSON</span>.parse(body);</span><br><span class=\"line\">            <span class=\"keyword\">let</span> images = data.images;</span><br><span class=\"line\">            res.redirect(<span class=\"string\">'https://www.bing.com'</span>+images[images.length<span class=\"number\">-1</span>].url)</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            res.send(<span class=\"string\">'request error!'</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>函数很简单，看一眼就明白了，至于为什么返回的时候使用res.redirect()，这跟我的目的有关系。</p>\n<p>我一开始就提到了，我要实现自己博客每天更换封面的效果，博客的封面使用的是CSS的background样式，这个样式虽然可以用本地图片也可以用线上图片，但是必须是图片！由于我们的服务自己不做存储，因此直接把要获取到的图片的根地址返回过去才是最优解，这就是我们选择使用res.redirect()的原因。</p>\n<p>还有随机接口，我们只要写个自定义范围的随机函数打乱就可以了：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getRandomInteger</span>(<span class=\"params\">min, max</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.floor(<span class=\"built_in\">Math</span>.random() * (max - min + <span class=\"number\">1</span>)) + min;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>函数getRandomInteger(min, max)返回min和max之间的任意整数。使用这个函数不仅可以随机获取0-15天内的某个天数，也可以使用ta获取随机的地区：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> mkt = getRandomInteger(<span class=\"number\">0</span>,<span class=\"number\">1</span>) ? <span class=\"string\">'zh-CN'</span> : <span class=\"string\">'en-US'</span>;</span><br></pre></td></tr></table></figure>\n<p>其他都没什么难度了，就是传参。可以自己去看<a href=\"https://github.com/tuobaye0711/new-wallpaper-everyday\" target=\"_blank\" rel=\"noopener\">源码</a>~</p>\n<h2 id=\"4、BAE线上部署\"><a href=\"#4、BAE线上部署\" class=\"headerlink\" title=\"4、BAE线上部署\"></a>4、BAE线上部署</h2><hr>\n<p>既然我们自己写的接口希望能用在自己的个人网站上，接口肯定不能只能在本地调用吧？我们接下来要做的就是把博客线上部署啦，这样我们就能把接口暴露在互联网上，造福自己，造福大家~</p>\n<p>因为我们的项目相当之轻量，不占存储，不占内存，基本上就是做一个转发的功能，因此不需要什么很高的服务器性能。为了这个项目还要自己租用一个云服务器那就得不偿失了~在你自己本身没有服务器的前提下，我推荐你使用百度的BAE进行线上部署(Baidu Application Engine)，一天只要两毛钱，用到天长地久（我都有点替百度心疼资源o(TωT)o ）。 </p>\n<h3 id=\"部署步骤\"><a href=\"#部署步骤\" class=\"headerlink\" title=\"部署步骤\"></a>部署步骤</h3><ol>\n<li>首先登陆<a href=\"https://console.bce.baidu.com\" target=\"_blank\" rel=\"noopener\">百度云</a>的首页，没有注册的注册一下，注册以后实名认证一下。这里不细说了~</li>\n<li>点击左侧菜单栏的应用引擎BAE，界面如图所示，点击“添加部署”。<img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step2.png\" alt=\"step2\"></li>\n<li>界面如图所示，按你的需要选择配置，我选择的是这样的（请无视右侧的重叠框，滚动截图工具不支持position: fixed定位方式的锅）。其中，由于我要跑的是Node.js代码，因此类型选择Node能支持的最高版本。代码版本工具依靠个人喜好，我喜欢git。内存选最低，单元个数选最少，OK，一天只需要两毛钱~点击下一步。<img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step3.png\" alt=\"step3\"></li>\n<li>点击“去支付”即可，后付费方式，账号里没有余额也能支付成功。<img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step4.png\" alt=\"step4\"></li>\n<li>OK,开通成功了，去控制台看看吧~<img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step5.png\" alt=\"step5\"></li>\n<li>在部署列表里，直接点名称进到里面，选择发布设置。这里可以看到git地址，我们这就可以通过git clone的方式把代码库同步到本地，然后把本地的代码放到里面，push上来，就大功告成啦~对了，最好把自动发布设置打开，这样每次更新代码都能自动在线上部署最新的版本咯。<img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step6-1.png\" alt=\"step6-1\"> <img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step6-2.png\" alt=\"step6-2\"></li>\n<li>最后，调用一下我的接口试试吧：tuobaye.duapp.com</li>\n</ol>\n<h3 id=\"BAE部署过程中的几个坑\"><a href=\"#BAE部署过程中的几个坑\" class=\"headerlink\" title=\"BAE部署过程中的几个坑\"></a>BAE部署过程中的几个坑</h3><ol>\n<li>BAE代码只能监听18080，要把原来的端口设置改为18080；</li>\n<li>BAE默认不支持ES6语法，所以原来你代码里的let/const什么的老老实实改成var吧，</li>\n<li>我在上传的过程中，把node_modules省略了，然后在package.json里面写上了dependencies，但是报错了。我的解决办法是直接把node_modules上传，把package.json的dependencies删掉，只让他自动执行启动脚本，不管别的，就启动成功了。</li>\n<li><a href=\"https://cloud.baidu.com/doc/BAE/Nodejs.html\" target=\"_blank\" rel=\"noopener\">BAE文档</a>，有其他问题可以看看这个，有一定参考价值。</li>\n</ol>\n<p>OK，搞定啦</p>\n<h2 id=\"5、修改背景，目的达成！\"><a href=\"#5、修改背景，目的达成！\" class=\"headerlink\" title=\"5、修改背景，目的达成！\"></a>5、修改背景，目的达成！</h2><p>我的博客是用hexo生成的，博客的背景图片在主题文件的样式里面。每个人都有自己的不同情况，但是只要找到这一行样式就行了。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.panel-cover</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">900</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">max-width</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"built_in\">url</span>(../images/background-cover.jpg) top left no-repeat <span class=\"number\">#666666</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-size</span>: cover;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把background改成我们自己的接口，这个接口可以获取当天的壁纸图片：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.panel-cover</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">900</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">max-width</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"built_in\">url</span>(http://tuobaye.duapp.com/wallpaper) top left no-repeat <span class=\"number\">#666666</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-size</span>: cover;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>对比一下，是不是很有成就感~？</p>\n<p><img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/before.png\" alt=\"before\"><br><img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/after.png\" alt=\"after\"></p>\n<p>如果把url换成 <a href=\"http://tuobaye.duapp.com/wallpaper/random\" target=\"_blank\" rel=\"noopener\">http://tuobaye.duapp.com/wallpaper/random</a> ，就可以每刷新一次都是新的封面了~帅气！</p>\n<p>PS. 现在我有自己的服务器了，已经不用BAE了。BAE基础版好像马上就要下线了（貌似太便宜了赚不到钱…）。如果想调用我的api，只需把url换成<a href=\"http://api.tuobaye.com:8888\" target=\"_blank\" rel=\"noopener\">http://api.tuobaye.com:8888</a>即可~</p>\n<h2 id=\"6、小结\"><a href=\"#6、小结\" class=\"headerlink\" title=\"6、小结\"></a>6、小结</h2><hr>\n<p>看完这篇文章，你将会从零开始学会写一个实用的小项目，然后在线上部署，在相当低成本的情况下将自己的接口暴露出去，造福自己，造福别人~</p>\n<p>从想到换封面的点子，到选图源，抓接口，撸代码，BAE部署到最后自己用上自己最新鲜的接口，实际的工作量一共也不超过一天时间，其中还有一大半时间都是在踩BAE的坑。</p>\n<p>很多时候，限制我们的并不是我们的技术，而是创意和实干的心。</p>\n<p>虽然项目简单，但是能对读到这里的读者一点启发作用，那我觉得就很知足了~</p>\n<p>想到就去做，Just do it!</p>\n","site":{"data":{}},"excerpt":"","more":"<p>欢迎光临我的博客<a href=\"http://tuobaye.com\" target=\"_blank\" rel=\"noopener\">拓跋的前端客栈</a>，这个是<a href=\"http://tuobaye.com/2017/12/26/%E3%80%90Node.js%E7%BA%BF%E4%B8%8A%E9%83%A8%E7%BD%B2%E5%B0%8F%E9%A1%B9%E7%9B%AE%E3%80%91%E8%AE%A9%E8%87%AA%E5%B7%B1%E7%9A%84%E5%8D%9A%E5%AE%A2%E6%AF%8F%E6%AC%A1%E6%89%93%E5%BC%80%E9%83%BD%E6%9C%89%E4%B8%8D%E5%90%8C%E7%9A%84%E5%B0%81%E9%9D%A2/\" target=\"_blank\" rel=\"noopener\">原文地址</a>，这个是<a href=\"https://github.com/tuobaye0711/new-wallpaper-everyday\" target=\"_blank\" rel=\"noopener\">项目地址</a>，这个是<a href=\"http://tuobaye.duapp.com/\" target=\"_blank\" rel=\"noopener\">线上部署地址</a>。如果您发现我文章中存在错误，请尽情向我吐槽，大家一起学习一起进步φ(&gt;ω&lt;*)</p>\n<h2 id=\"1、引子\"><a href=\"#1、引子\" class=\"headerlink\" title=\"1、引子\"></a>1、引子</h2><hr>\n<p>为什么想做这个功能呢？起因很简单————我看腻了自己博客的封面(特地要提一下，封面是来自<a href=\"https://github.com/letiantian/huno\" target=\"_blank\" rel=\"noopener\">huno</a>)。</p>\n<p><img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/background-cover.jpg\" alt=\"old cover\"></p>\n<p>虽然我的封面很好看的说，但是谁还没有个审美疲劳不是？</p>\n<p>毕竟再好看的图片都有看腻的一天，为了克服审美疲劳，最好能经常换换封面，每天都不一样就更好了！</p>\n<p>想到了就去做，动手~</p>\n<h2 id=\"2、选图源\"><a href=\"#2、选图源\" class=\"headerlink\" title=\"2、选图源\"></a>2、选图源</h2><hr>\n<p>说起每天一张美图，那大伙第一个想到的肯定是<a href=\"https://www.bing.com\" target=\"_blank\" rel=\"noopener\">必应</a>啦，必应的搜索引擎虽然大多数人用的不多——翻墙的用谷歌的多，不翻墙的用百度的多。但是必应搜索的首页真的很亮眼~就是因为每天都有不同的美图做背景，而且根据地理位置还有不同的图片：</p>\n<p><img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/bingcn.png\" alt=\"bingcn\"><br><img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/bingen.png\" alt=\"bingen\"></p>\n<p>既美又高清，很适合做壁纸。就是他了！</p>\n<p>既然要做接，首先要抓取bing的api，emmm，打开bing主页，F12，点击Network-XHR，挨个找一下，很容易就能发现在哪里，看图~</p>\n<p><img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/xhr.png\" alt=\"xhr\"></p>\n<p>很容易找到是哪条请求。其实这个bing的壁纸接口在网上一搜也能搜到了，<a href=\"https://stackoverflow.com/questions/10639914/is-there-a-way-to-get-bings-photo-of-the-day\" target=\"_blank\" rel=\"noopener\">看这里</a>。</p>\n<p> 接口格式是这样的：</p>\n<blockquote>\n<p>XML: <a href=\"http://www.bing.com/HPImageArchive.aspx?format=xml&amp;idx=0&amp;n=1&amp;mkt=en-US\" target=\"_blank\" rel=\"noopener\">http://www.bing.com/HPImageArchive.aspx?format=xml&amp;idx=0&amp;n=1&amp;mkt=en-US</a><br>JSON: <a href=\"http://www.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1&amp;mkt=en-US\" target=\"_blank\" rel=\"noopener\">http://www.bing.com/HPImageArchive.aspx?format=js&amp;idx=0&amp;n=1&amp;mkt=en-US</a><br>RSS: <a href=\"http://www.bing.com/HPImageArchive.aspx?format=rss&amp;idx=0&amp;n=1&amp;mkt=en-US\" target=\"_blank\" rel=\"noopener\">http://www.bing.com/HPImageArchive.aspx?format=rss&amp;idx=0&amp;n=1&amp;mkt=en-US</a></p>\n</blockquote>\n<ul>\n<li><em>format</em>表示返回格式，可选字段有xml、js（json）、rss</li>\n<li><em>idx</em>=x表示获取从第x天前开始的图片，最大值为7，n&gt;7时返回的都是n=7的值</li>\n<li><em>n</em>=y表示获取从idx开始连续y天的图片，最大值为9，同时限制最多能获取15天以内的图片</li>\n<li><em>mkt</em>表示地区信息，已知的只有zh-CN和en-US，是否还有其他的我也不清楚</li>\n</ul>\n<p>返回值如下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">    <span class=\"string\">\"images\"</span>: [</span><br><span class=\"line\">        &#123;</span><br><span class=\"line\">            <span class=\"string\">\"startdate\"</span>: <span class=\"string\">\"20171226\"</span>, </span><br><span class=\"line\">            <span class=\"string\">\"fullstartdate\"</span>: <span class=\"string\">\"201712261600\"</span>, </span><br><span class=\"line\">            <span class=\"string\">\"enddate\"</span>: <span class=\"string\">\"20171227\"</span>, </span><br><span class=\"line\">            <span class=\"string\">\"url\"</span>: <span class=\"string\">\"/az/hprichbg/rb/CPNYSnow_ZH-CN13335620157_1920x1080.jpg\"</span>, </span><br><span class=\"line\">            <span class=\"string\">\"urlbase\"</span>: <span class=\"string\">\"/az/hprichbg/rb/CPNYSnow_ZH-CN13335620157\"</span>, </span><br><span class=\"line\">            <span class=\"string\">\"copyright\"</span>: <span class=\"string\">\"中央公园，美国纽约市 (© Nisian Hughes/Getty Images)\"</span>, </span><br><span class=\"line\">            <span class=\"string\">\"copyrightlink\"</span>: <span class=\"string\">\"http://www.bing.com/search?q=%E4%B8%AD%E5%A4%AE%E5%85%AC%E5%9B%AD&amp;form=hpcapt&amp;mkt=zh-cn\"</span>, </span><br><span class=\"line\">            <span class=\"string\">\"quiz\"</span>: <span class=\"string\">\"/search?q=Bing+homepage+quiz&amp;filters=WQOskey:%22HPQuiz_20171226_CPNYSnow%22&amp;FORM=HPQUIZ\"</span>,</span><br><span class=\"line\">            <span class=\"string\">\"wp\"</span>: <span class=\"literal\">true</span>, </span><br><span class=\"line\">            <span class=\"string\">\"hsh\"</span>: <span class=\"string\">\"381850a3d2d57acd0ded240e42ffec8e\"</span>, </span><br><span class=\"line\">            <span class=\"string\">\"drk\"</span>: <span class=\"number\">1</span>, </span><br><span class=\"line\">            <span class=\"string\">\"top\"</span>: <span class=\"number\">1</span>, </span><br><span class=\"line\">            <span class=\"string\">\"bot\"</span>: <span class=\"number\">1</span>, </span><br><span class=\"line\">            <span class=\"string\">\"hs\"</span>: [ ]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    ], </span><br><span class=\"line\">    <span class=\"string\">\"tooltips\"</span>: &#123;</span><br><span class=\"line\">        <span class=\"string\">\"loading\"</span>: <span class=\"string\">\"正在加载...\"</span>, </span><br><span class=\"line\">        <span class=\"string\">\"previous\"</span>: <span class=\"string\">\"上一个图像\"</span>, </span><br><span class=\"line\">        <span class=\"string\">\"next\"</span>: <span class=\"string\">\"下一个图像\"</span>, </span><br><span class=\"line\">        <span class=\"string\">\"walle\"</span>: <span class=\"string\">\"此图片不能下载用作壁纸。\"</span>, </span><br><span class=\"line\">        <span class=\"string\">\"walls\"</span>: <span class=\"string\">\"下载今日美图。仅限用作桌面壁纸。\"</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>我们只要在 <a href=\"http://www.bing.com\" target=\"_blank\" rel=\"noopener\">www.bing.com</a> 后面拼上images[0].url就是我们想要的图片的链接了~还是1920x1080的高清图片呢，拿来做壁纸正合适~</p>\n<p>有了这些已知信息，我们终于可以愉快的撸代码了φ(&gt;ω&lt;*)</p>\n<h2 id=\"3、撸代码\"><a href=\"#3、撸代码\" class=\"headerlink\" title=\"3、撸代码\"></a>3、撸代码</h2><hr>\n<p>我选择采用Node.js+express来搭建我们的后台代码。并做一个规划，我们的接口要能返回当日的图片，能根据入参返回几天前的哪个地区的图片，哦对了，能随机返回图片，保证咱每次看到的都不一样。</p>\n<p>很简单，说干就干。</p>\n<p>关于怎么搭建一个Node.js+express服务我就不废话了，这几个接口都要用到请求uri，简单写个公共函数用来获取uri：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getUri</span>(<span class=\"params\">start, number, mkt</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">'https://www.bing.com/HPImageArchive.aspx?format=js&amp;idx='</span> + start + <span class=\"string\">'&amp;n='</span> + number + <span class=\"string\">'&amp;mkt='</span> + mkt</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>另外由于获取随机图片和获取按参数指定的图片肯定是两个不同的接口，但是他们同时要用到一个请求并处理返回值的过程，为了代码好看，我们把他抽离出来：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getWallpaper</span>(<span class=\"params\">res, days_ago, mkt</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> uri;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (days_ago &lt;= <span class=\"number\">7</span>)&#123;</span><br><span class=\"line\">        uri = getUri(days_ago, <span class=\"number\">1</span>, mkt)</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        uri = getUri(<span class=\"number\">7</span>, days_ago<span class=\"number\">-6</span>, mkt)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    request(uri, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">error, response, body</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!error &amp;&amp; response.statusCode === <span class=\"number\">200</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> data = <span class=\"built_in\">JSON</span>.parse(body);</span><br><span class=\"line\">            <span class=\"keyword\">let</span> images = data.images;</span><br><span class=\"line\">            res.redirect(<span class=\"string\">'https://www.bing.com'</span>+images[images.length<span class=\"number\">-1</span>].url)</span><br><span class=\"line\">        &#125;<span class=\"keyword\">else</span>&#123;</span><br><span class=\"line\">            res.send(<span class=\"string\">'request error!'</span>)</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>函数很简单，看一眼就明白了，至于为什么返回的时候使用res.redirect()，这跟我的目的有关系。</p>\n<p>我一开始就提到了，我要实现自己博客每天更换封面的效果，博客的封面使用的是CSS的background样式，这个样式虽然可以用本地图片也可以用线上图片，但是必须是图片！由于我们的服务自己不做存储，因此直接把要获取到的图片的根地址返回过去才是最优解，这就是我们选择使用res.redirect()的原因。</p>\n<p>还有随机接口，我们只要写个自定义范围的随机函数打乱就可以了：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getRandomInteger</span>(<span class=\"params\">min, max</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.floor(<span class=\"built_in\">Math</span>.random() * (max - min + <span class=\"number\">1</span>)) + min;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>函数getRandomInteger(min, max)返回min和max之间的任意整数。使用这个函数不仅可以随机获取0-15天内的某个天数，也可以使用ta获取随机的地区：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> mkt = getRandomInteger(<span class=\"number\">0</span>,<span class=\"number\">1</span>) ? <span class=\"string\">'zh-CN'</span> : <span class=\"string\">'en-US'</span>;</span><br></pre></td></tr></table></figure>\n<p>其他都没什么难度了，就是传参。可以自己去看<a href=\"https://github.com/tuobaye0711/new-wallpaper-everyday\" target=\"_blank\" rel=\"noopener\">源码</a>~</p>\n<h2 id=\"4、BAE线上部署\"><a href=\"#4、BAE线上部署\" class=\"headerlink\" title=\"4、BAE线上部署\"></a>4、BAE线上部署</h2><hr>\n<p>既然我们自己写的接口希望能用在自己的个人网站上，接口肯定不能只能在本地调用吧？我们接下来要做的就是把博客线上部署啦，这样我们就能把接口暴露在互联网上，造福自己，造福大家~</p>\n<p>因为我们的项目相当之轻量，不占存储，不占内存，基本上就是做一个转发的功能，因此不需要什么很高的服务器性能。为了这个项目还要自己租用一个云服务器那就得不偿失了~在你自己本身没有服务器的前提下，我推荐你使用百度的BAE进行线上部署(Baidu Application Engine)，一天只要两毛钱，用到天长地久（我都有点替百度心疼资源o(TωT)o ）。 </p>\n<h3 id=\"部署步骤\"><a href=\"#部署步骤\" class=\"headerlink\" title=\"部署步骤\"></a>部署步骤</h3><ol>\n<li>首先登陆<a href=\"https://console.bce.baidu.com\" target=\"_blank\" rel=\"noopener\">百度云</a>的首页，没有注册的注册一下，注册以后实名认证一下。这里不细说了~</li>\n<li>点击左侧菜单栏的应用引擎BAE，界面如图所示，点击“添加部署”。<img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step2.png\" alt=\"step2\"></li>\n<li>界面如图所示，按你的需要选择配置，我选择的是这样的（请无视右侧的重叠框，滚动截图工具不支持position: fixed定位方式的锅）。其中，由于我要跑的是Node.js代码，因此类型选择Node能支持的最高版本。代码版本工具依靠个人喜好，我喜欢git。内存选最低，单元个数选最少，OK，一天只需要两毛钱~点击下一步。<img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step3.png\" alt=\"step3\"></li>\n<li>点击“去支付”即可，后付费方式，账号里没有余额也能支付成功。<img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step4.png\" alt=\"step4\"></li>\n<li>OK,开通成功了，去控制台看看吧~<img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step5.png\" alt=\"step5\"></li>\n<li>在部署列表里，直接点名称进到里面，选择发布设置。这里可以看到git地址，我们这就可以通过git clone的方式把代码库同步到本地，然后把本地的代码放到里面，push上来，就大功告成啦~对了，最好把自动发布设置打开，这样每次更新代码都能自动在线上部署最新的版本咯。<img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step6-1.png\" alt=\"step6-1\"> <img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step6-2.png\" alt=\"step6-2\"></li>\n<li>最后，调用一下我的接口试试吧：tuobaye.duapp.com</li>\n</ol>\n<h3 id=\"BAE部署过程中的几个坑\"><a href=\"#BAE部署过程中的几个坑\" class=\"headerlink\" title=\"BAE部署过程中的几个坑\"></a>BAE部署过程中的几个坑</h3><ol>\n<li>BAE代码只能监听18080，要把原来的端口设置改为18080；</li>\n<li>BAE默认不支持ES6语法，所以原来你代码里的let/const什么的老老实实改成var吧，</li>\n<li>我在上传的过程中，把node_modules省略了，然后在package.json里面写上了dependencies，但是报错了。我的解决办法是直接把node_modules上传，把package.json的dependencies删掉，只让他自动执行启动脚本，不管别的，就启动成功了。</li>\n<li><a href=\"https://cloud.baidu.com/doc/BAE/Nodejs.html\" target=\"_blank\" rel=\"noopener\">BAE文档</a>，有其他问题可以看看这个，有一定参考价值。</li>\n</ol>\n<p>OK，搞定啦</p>\n<h2 id=\"5、修改背景，目的达成！\"><a href=\"#5、修改背景，目的达成！\" class=\"headerlink\" title=\"5、修改背景，目的达成！\"></a>5、修改背景，目的达成！</h2><p>我的博客是用hexo生成的，博客的背景图片在主题文件的样式里面。每个人都有自己的不同情况，但是只要找到这一行样式就行了。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.panel-cover</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">900</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">max-width</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"built_in\">url</span>(../images/background-cover.jpg) top left no-repeat <span class=\"number\">#666666</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-size</span>: cover;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>把background改成我们自己的接口，这个接口可以获取当天的壁纸图片：</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"selector-class\">.panel-cover</span> &#123;</span><br><span class=\"line\">  <span class=\"attribute\">display</span>: block;</span><br><span class=\"line\">  <span class=\"attribute\">position</span>: fixed;</span><br><span class=\"line\">  <span class=\"attribute\">z-index</span>: <span class=\"number\">900</span>;</span><br><span class=\"line\">  <span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">max-width</span>: none;</span><br><span class=\"line\">  <span class=\"attribute\">height</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background</span>: <span class=\"built_in\">url</span>(http://tuobaye.duapp.com/wallpaper) top left no-repeat <span class=\"number\">#666666</span>;</span><br><span class=\"line\">  <span class=\"attribute\">background-size</span>: cover;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>对比一下，是不是很有成就感~？</p>\n<p><img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/before.png\" alt=\"before\"><br><img src=\"/2017/12/26/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/after.png\" alt=\"after\"></p>\n<p>如果把url换成 <a href=\"http://tuobaye.duapp.com/wallpaper/random\" target=\"_blank\" rel=\"noopener\">http://tuobaye.duapp.com/wallpaper/random</a> ，就可以每刷新一次都是新的封面了~帅气！</p>\n<p>PS. 现在我有自己的服务器了，已经不用BAE了。BAE基础版好像马上就要下线了（貌似太便宜了赚不到钱…）。如果想调用我的api，只需把url换成<a href=\"http://api.tuobaye.com:8888\" target=\"_blank\" rel=\"noopener\">http://api.tuobaye.com:8888</a>即可~</p>\n<h2 id=\"6、小结\"><a href=\"#6、小结\" class=\"headerlink\" title=\"6、小结\"></a>6、小结</h2><hr>\n<p>看完这篇文章，你将会从零开始学会写一个实用的小项目，然后在线上部署，在相当低成本的情况下将自己的接口暴露出去，造福自己，造福别人~</p>\n<p>从想到换封面的点子，到选图源，抓接口，撸代码，BAE部署到最后自己用上自己最新鲜的接口，实际的工作量一共也不超过一天时间，其中还有一大半时间都是在踩BAE的坑。</p>\n<p>很多时候，限制我们的并不是我们的技术，而是创意和实干的心。</p>\n<p>虽然项目简单，但是能对读到这里的读者一点启发作用，那我觉得就很知足了~</p>\n<p>想到就去做，Just do it!</p>\n"},{"title":"使用Code-Printer生成一份炫酷的简历","date":"2018-01-23T05:25:47.000Z","picture":"code-printer.png","description":null,"_content":"\n欢迎光临我的博客[拓跋的前端客栈](http://tuobaye.com)，这个是[原文地址](http://tuobaye.com/2018/01/23/%E4%BD%BF%E7%94%A8code-printer%E7%94%9F%E6%88%90%E4%B8%80%E4%BB%BD%E7%82%AB%E9%85%B7%E7%9A%84%E7%AE%80%E5%8E%86/)，这个是[项目地址](https://github.com/tuobaye0711/code-printer)，欢迎star&fork。如果您发现我文章中存在错误，请尽情向我吐槽，大家一起学习一起进步φ(>ω<*)\n\n***\n\n### DEMO\n\n***\n\n最终效果请点击**[这里](http://tuobaye.com/demo/code-printer)**，是不是有点意思？\n\n![code-printer.png](code-printer.png)\n\n### 源码分析\n\n***\n\ncode-printer的原理是首先搭起一个骨架，然后通过遍历的方式，一点一点地往骨架里塞东西。\n\n骨架主要有三块：\n\n- &lt;pre id=\"my-code\"&gt;: 主要用来展示的HTML代码的，带标签\n- &lt;style id=\"style-elem\"&gt;: 主要填CSS代码的，用于把&lt;pre&gt;里特定的标签转换成特定的样式\n- &lt;div id=\"script-area\"&gt;: 主要是填JS代码的。但是由于一个字符一个字符往里面填代码会出现大量报错，因此这部分需要一个段落的JS代码全部书写完毕以后，通过一个命令符'~'来一次性填入。\n\n#### **printCodes**\n\n{% codeblock lang:javascript %}\nlet printCodes = function (message, index, interval) {\n    if (index < message.length) {\n        $code_pre.scrollTop = $code_pre.scrollHeight;\n        printChar(message[index++]);\n        return setTimeout((function () {\n            return printCodes(message, index, interval);\n        }), speed);\n    }\n};\n{% endcodeblock %}\n\n这段代码的主要作用就是遍历打印字符，同时每次打印的时候都将滚动条拖到最底下，保证用户能看到最新的变化。\n\n#### **printChar**\n\n{% codeblock lang:javascript %}\nlet printChar = function (which) {\n    let char, formatted_code, prior_block_match, prior_comment_match, script_tag;\n    if (which === \"`\") {\n        // 重置为空字符串，防止打印出来\n        which = \"\";\n        isJs = !isJs;\n    }\n    if (isJs) {\n        if (which === \"~\" && !openComment) {\n            script_tag = createElement(\"script\");\n            // two matches based on prior scenario\n            prior_comment_match = /(?:\\*\\/([^\\~]*))$/;\n            prior_block_match = /([^~]*)$/;\n            if (unformatted_code.match(prior_comment_match)) {\n                script_tag.innerHTML = unformatted_code.match(prior_comment_match)[0].replace(\"*/\", \"\") + \"\\n\\n\";\n            } else {\n                script_tag.innerHTML = unformatted_code.match(prior_block_match)[0] + \"\\n\\n\";\n            }\n            $script_area.innerHTML = \"\";\n            $script_area.appendChild(script_tag);\n        }\n        char = which;\n        formatted_code = jsHighlight($code_pre.innerHTML, char);\n    } else {\n        char = which === \"~\" ? \"\" : which;\n        $style_elem.innerHTML += char;\n        formatted_code = cssHighlight($code_pre.innerHTML, char);\n    }\n    prevAsterisk = which === \"*\";\n    prevSlash = (which === \"/\") && !openComment;\n    openInteger = which.match(/[0-9]/) || (openInteger && which.match(/[\\.\\%pxems]/)) ? true : false;\n    if (which === '\"') {\n        openString = !openString;\n    }\n    unformatted_code += which;\n    return $code_pre.innerHTML = formatted_code;\n};\n{% endcodeblock %}\n\n**printChar**函数是code-printer的核心函数，这个函数会根据当前的代码是JS还是CSS，来进行不同的处理。\n\n如何判断是JS还是CSS代码呢？默认设置\n\n{% codeblock lang:javascript %}\nlet isJs = false;\n{% endcodeblock %}\n\n也就是默认是CSS，然后以 **\\`** 作为切换符号，每次遇到 **`** 就切换一次语言。\n\n当前字符属于JS时，在没遇到执行符号 **~** 之前，**printChar**只是单纯的打印格式化后的字符。遇到 **~** 以后，**printChar**进行了如下操作：\n\n1. 函数首先通过正则匹配，匹配出之前的JS整段代码。\n2. 再调用**createElement()**来创造一对&lt;script&gt;&lt;/script&gt;标签，用来存放JS代码。\n3. 然后将处理过的JS代码存入&lt;script&gt;&lt;/script&gt;标签内。\n4. 最后通过**$script_area.appendChild()**的方式将&lt;script&gt;&lt;/script&gt;及其内部的JS代码存入&lt;div id=\"script-area\"&gt;中。注意，每次调用**$script_area.appendChild()**之前，都要将之前&lt;div id=\"script-area\"&gt;清空一遍，防止之前的JS代码再执行一次。\n\n当前字符属于CSS时，每次打印过程，一方面会将未格式化的字符串传入&lt;style id=\"style-elem\"&gt;中，用以生成样式。另一方面会将格式化的代码输出到&lt;pre id=\"my-code\"&gt;中，用以展示代码。\n\n#### **cssHighlight**和**jsHighlight**\n\n这两个函数十分类似，主要作用就是通过正则匹配，给不同类型的字符两端封上不同的标签，用以高亮代码。举个栗子：\n\n{% codeblock lang:javascript %}\nif (openInteger && !which.match(/[0-9\\.]/) && !openString && !openComment) {\n    s = string.replace(/([0-9\\.]*)$/, \"<em class=\\\"int\\\">$1</em>\" + which);\n}\n{% endcodeblock %}\n\n这就是一处典型的匹配+替换标签组合拳。作用是代码在以数字结尾时，给数字两端封上&lt;em class=\"int\"&gt;&lt;/em&gt;的标签。\n\n代码中还有很多用作标志位的参数，比如说**openInteger**，表示这段输入都是数字。通过对这些控制位进行操作，可以将零散的字符分成一段一段的，方便进行处理。\n\n其他部分就不谈了，自己可以看[源代码](https://github.com/tuobaye0711/code-printer/blob/master/src/app.js)，我已经加了备注。\n\n### 使用方法\n\n***\n\n您可以fork过去直接修改，也可以按照如下步骤操作\n\n``` bash\ngit clone https://github.com/tuobaye0711/code-printer.git\n```\n\n安装依赖文件\n\n``` bash\nnpm install\n```\n\n打包文件\n\n``` bash\nnpm start\n```\n\n起服务\n\n``` bash\nnpm run server\n```\n\n修改配置说明：\n\nresume 文件存放简历或者其他静态资源\n\nsource/code.js 存放需要打印并展示样式的代码（CSS/JS）\n\nsource/app.js 是主代码，可以修改一些比如说打印速度、高亮色等配置\n\n### 小结\n\n***\n\n能在自己网站挂一份带打印特效的简历，想必能让人眼前一亮吧。这篇文章主要安利了一下我这个名为code-printer的小项目，希望能帮到各位~","source":"_posts/使用code-printer生成一份炫酷的简历.md","raw":"---\ntitle: 使用code-printer生成一份炫酷的简历\ndate: 2018-01-23 13:25:47\ntags: [CSS,JavaScript]\npicture: code-printer.png\ndescription:\n---\n\n欢迎光临我的博客[拓跋的前端客栈](http://tuobaye.com)，这个是[原文地址](http://tuobaye.com/2018/01/23/%E4%BD%BF%E7%94%A8code-printer%E7%94%9F%E6%88%90%E4%B8%80%E4%BB%BD%E7%82%AB%E9%85%B7%E7%9A%84%E7%AE%80%E5%8E%86/)，这个是[项目地址](https://github.com/tuobaye0711/code-printer)，欢迎star&fork。如果您发现我文章中存在错误，请尽情向我吐槽，大家一起学习一起进步φ(>ω<*)\n\n***\n\n### DEMO\n\n***\n\n最终效果请点击**[这里](http://tuobaye.com/demo/code-printer)**，是不是有点意思？\n\n![code-printer.png](code-printer.png)\n\n### 源码分析\n\n***\n\ncode-printer的原理是首先搭起一个骨架，然后通过遍历的方式，一点一点地往骨架里塞东西。\n\n骨架主要有三块：\n\n- &lt;pre id=\"my-code\"&gt;: 主要用来展示的HTML代码的，带标签\n- &lt;style id=\"style-elem\"&gt;: 主要填CSS代码的，用于把&lt;pre&gt;里特定的标签转换成特定的样式\n- &lt;div id=\"script-area\"&gt;: 主要是填JS代码的。但是由于一个字符一个字符往里面填代码会出现大量报错，因此这部分需要一个段落的JS代码全部书写完毕以后，通过一个命令符'~'来一次性填入。\n\n#### **printCodes**\n\n{% codeblock lang:javascript %}\nlet printCodes = function (message, index, interval) {\n    if (index < message.length) {\n        $code_pre.scrollTop = $code_pre.scrollHeight;\n        printChar(message[index++]);\n        return setTimeout((function () {\n            return printCodes(message, index, interval);\n        }), speed);\n    }\n};\n{% endcodeblock %}\n\n这段代码的主要作用就是遍历打印字符，同时每次打印的时候都将滚动条拖到最底下，保证用户能看到最新的变化。\n\n#### **printChar**\n\n{% codeblock lang:javascript %}\nlet printChar = function (which) {\n    let char, formatted_code, prior_block_match, prior_comment_match, script_tag;\n    if (which === \"`\") {\n        // 重置为空字符串，防止打印出来\n        which = \"\";\n        isJs = !isJs;\n    }\n    if (isJs) {\n        if (which === \"~\" && !openComment) {\n            script_tag = createElement(\"script\");\n            // two matches based on prior scenario\n            prior_comment_match = /(?:\\*\\/([^\\~]*))$/;\n            prior_block_match = /([^~]*)$/;\n            if (unformatted_code.match(prior_comment_match)) {\n                script_tag.innerHTML = unformatted_code.match(prior_comment_match)[0].replace(\"*/\", \"\") + \"\\n\\n\";\n            } else {\n                script_tag.innerHTML = unformatted_code.match(prior_block_match)[0] + \"\\n\\n\";\n            }\n            $script_area.innerHTML = \"\";\n            $script_area.appendChild(script_tag);\n        }\n        char = which;\n        formatted_code = jsHighlight($code_pre.innerHTML, char);\n    } else {\n        char = which === \"~\" ? \"\" : which;\n        $style_elem.innerHTML += char;\n        formatted_code = cssHighlight($code_pre.innerHTML, char);\n    }\n    prevAsterisk = which === \"*\";\n    prevSlash = (which === \"/\") && !openComment;\n    openInteger = which.match(/[0-9]/) || (openInteger && which.match(/[\\.\\%pxems]/)) ? true : false;\n    if (which === '\"') {\n        openString = !openString;\n    }\n    unformatted_code += which;\n    return $code_pre.innerHTML = formatted_code;\n};\n{% endcodeblock %}\n\n**printChar**函数是code-printer的核心函数，这个函数会根据当前的代码是JS还是CSS，来进行不同的处理。\n\n如何判断是JS还是CSS代码呢？默认设置\n\n{% codeblock lang:javascript %}\nlet isJs = false;\n{% endcodeblock %}\n\n也就是默认是CSS，然后以 **\\`** 作为切换符号，每次遇到 **`** 就切换一次语言。\n\n当前字符属于JS时，在没遇到执行符号 **~** 之前，**printChar**只是单纯的打印格式化后的字符。遇到 **~** 以后，**printChar**进行了如下操作：\n\n1. 函数首先通过正则匹配，匹配出之前的JS整段代码。\n2. 再调用**createElement()**来创造一对&lt;script&gt;&lt;/script&gt;标签，用来存放JS代码。\n3. 然后将处理过的JS代码存入&lt;script&gt;&lt;/script&gt;标签内。\n4. 最后通过**$script_area.appendChild()**的方式将&lt;script&gt;&lt;/script&gt;及其内部的JS代码存入&lt;div id=\"script-area\"&gt;中。注意，每次调用**$script_area.appendChild()**之前，都要将之前&lt;div id=\"script-area\"&gt;清空一遍，防止之前的JS代码再执行一次。\n\n当前字符属于CSS时，每次打印过程，一方面会将未格式化的字符串传入&lt;style id=\"style-elem\"&gt;中，用以生成样式。另一方面会将格式化的代码输出到&lt;pre id=\"my-code\"&gt;中，用以展示代码。\n\n#### **cssHighlight**和**jsHighlight**\n\n这两个函数十分类似，主要作用就是通过正则匹配，给不同类型的字符两端封上不同的标签，用以高亮代码。举个栗子：\n\n{% codeblock lang:javascript %}\nif (openInteger && !which.match(/[0-9\\.]/) && !openString && !openComment) {\n    s = string.replace(/([0-9\\.]*)$/, \"<em class=\\\"int\\\">$1</em>\" + which);\n}\n{% endcodeblock %}\n\n这就是一处典型的匹配+替换标签组合拳。作用是代码在以数字结尾时，给数字两端封上&lt;em class=\"int\"&gt;&lt;/em&gt;的标签。\n\n代码中还有很多用作标志位的参数，比如说**openInteger**，表示这段输入都是数字。通过对这些控制位进行操作，可以将零散的字符分成一段一段的，方便进行处理。\n\n其他部分就不谈了，自己可以看[源代码](https://github.com/tuobaye0711/code-printer/blob/master/src/app.js)，我已经加了备注。\n\n### 使用方法\n\n***\n\n您可以fork过去直接修改，也可以按照如下步骤操作\n\n``` bash\ngit clone https://github.com/tuobaye0711/code-printer.git\n```\n\n安装依赖文件\n\n``` bash\nnpm install\n```\n\n打包文件\n\n``` bash\nnpm start\n```\n\n起服务\n\n``` bash\nnpm run server\n```\n\n修改配置说明：\n\nresume 文件存放简历或者其他静态资源\n\nsource/code.js 存放需要打印并展示样式的代码（CSS/JS）\n\nsource/app.js 是主代码，可以修改一些比如说打印速度、高亮色等配置\n\n### 小结\n\n***\n\n能在自己网站挂一份带打印特效的简历，想必能让人眼前一亮吧。这篇文章主要安利了一下我这个名为code-printer的小项目，希望能帮到各位~","slug":"使用code-printer生成一份炫酷的简历","published":1,"updated":"2018-03-04T15:08:12.820Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk698hxq0009znzw7n0zspus","content":"<p>欢迎光临我的博客<a href=\"http://tuobaye.com\" target=\"_blank\" rel=\"noopener\">拓跋的前端客栈</a>，这个是<a href=\"http://tuobaye.com/2018/01/23/%E4%BD%BF%E7%94%A8code-printer%E7%94%9F%E6%88%90%E4%B8%80%E4%BB%BD%E7%82%AB%E9%85%B7%E7%9A%84%E7%AE%80%E5%8E%86/\" target=\"_blank\" rel=\"noopener\">原文地址</a>，这个是<a href=\"https://github.com/tuobaye0711/code-printer\" target=\"_blank\" rel=\"noopener\">项目地址</a>，欢迎star&amp;fork。如果您发现我文章中存在错误，请尽情向我吐槽，大家一起学习一起进步φ(&gt;ω&lt;*)</p>\n<hr>\n<h3 id=\"DEMO\"><a href=\"#DEMO\" class=\"headerlink\" title=\"DEMO\"></a>DEMO</h3><hr>\n<p>最终效果请点击<strong><a href=\"http://tuobaye.com/demo/code-printer\" target=\"_blank\" rel=\"noopener\">这里</a></strong>，是不是有点意思？</p>\n<p><img src=\"/2018/01/23/使用code-printer生成一份炫酷的简历/code-printer.png\" alt=\"code-printer.png\"></p>\n<h3 id=\"源码分析\"><a href=\"#源码分析\" class=\"headerlink\" title=\"源码分析\"></a>源码分析</h3><hr>\n<p>code-printer的原理是首先搭起一个骨架，然后通过遍历的方式，一点一点地往骨架里塞东西。</p>\n<p>骨架主要有三块：</p>\n<ul>\n<li>&lt;pre id=”my-code”&gt;: 主要用来展示的HTML代码的，带标签</li>\n<li>&lt;style id=”style-elem”&gt;: 主要填CSS代码的，用于把&lt;pre&gt;里特定的标签转换成特定的样式</li>\n<li>&lt;div id=”script-area”&gt;: 主要是填JS代码的。但是由于一个字符一个字符往里面填代码会出现大量报错，因此这部分需要一个段落的JS代码全部书写完毕以后，通过一个命令符’~’来一次性填入。</li>\n</ul>\n<h4 id=\"printCodes\"><a href=\"#printCodes\" class=\"headerlink\" title=\"printCodes\"></a><strong>printCodes</strong></h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> printCodes = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">message, index, interval</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &lt; message.length) &#123;</span><br><span class=\"line\">        $code_pre.scrollTop = $code_pre.scrollHeight;</span><br><span class=\"line\">        printChar(message[index++]);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> setTimeout((<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> printCodes(message, index, interval);</span><br><span class=\"line\">        &#125;), speed);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>这段代码的主要作用就是遍历打印字符，同时每次打印的时候都将滚动条拖到最底下，保证用户能看到最新的变化。</p>\n<h4 id=\"printChar\"><a href=\"#printChar\" class=\"headerlink\" title=\"printChar\"></a><strong>printChar</strong></h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> printChar = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">which</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> char, formatted_code, prior_block_match, prior_comment_match, script_tag;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (which === <span class=\"string\">\"`\"</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 重置为空字符串，防止打印出来</span></span><br><span class=\"line\">        which = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">        isJs = !isJs;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isJs) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (which === <span class=\"string\">\"~\"</span> &amp;&amp; !openComment) &#123;</span><br><span class=\"line\">            script_tag = createElement(<span class=\"string\">\"script\"</span>);</span><br><span class=\"line\">            <span class=\"comment\">// two matches based on prior scenario</span></span><br><span class=\"line\">            prior_comment_match = <span class=\"regexp\">/(?:\\*\\/([^\\~]*))$/</span>;</span><br><span class=\"line\">            prior_block_match = <span class=\"regexp\">/([^~]*)$/</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (unformatted_code.match(prior_comment_match)) &#123;</span><br><span class=\"line\">                script_tag.innerHTML = unformatted_code.match(prior_comment_match)[<span class=\"number\">0</span>].replace(<span class=\"string\">\"*/\"</span>, <span class=\"string\">\"\"</span>) + <span class=\"string\">\"\\n\\n\"</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                script_tag.innerHTML = unformatted_code.match(prior_block_match)[<span class=\"number\">0</span>] + <span class=\"string\">\"\\n\\n\"</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            $script_area.innerHTML = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">            $script_area.appendChild(script_tag);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        char = which;</span><br><span class=\"line\">        formatted_code = jsHighlight($code_pre.innerHTML, char);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        char = which === <span class=\"string\">\"~\"</span> ? <span class=\"string\">\"\"</span> : which;</span><br><span class=\"line\">        $style_elem.innerHTML += char;</span><br><span class=\"line\">        formatted_code = cssHighlight($code_pre.innerHTML, char);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    prevAsterisk = which === <span class=\"string\">\"*\"</span>;</span><br><span class=\"line\">    prevSlash = (which === <span class=\"string\">\"/\"</span>) &amp;&amp; !openComment;</span><br><span class=\"line\">    openInteger = which.match(<span class=\"regexp\">/[0-9]/</span>) || (openInteger &amp;&amp; which.match(<span class=\"regexp\">/[\\.\\%pxems]/</span>)) ? <span class=\"literal\">true</span> : <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (which === <span class=\"string\">'\"'</span>) &#123;</span><br><span class=\"line\">        openString = !openString;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    unformatted_code += which;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> $code_pre.innerHTML = formatted_code;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><strong>printChar</strong>函数是code-printer的核心函数，这个函数会根据当前的代码是JS还是CSS，来进行不同的处理。</p>\n<p>如何判断是JS还是CSS代码呢？默认设置</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> isJs = <span class=\"literal\">false</span>;</span><br></pre></td></tr></table></figure>\n<p>也就是默认是CSS，然后以 <strong>`</strong> 作为切换符号，每次遇到 <strong>`</strong> 就切换一次语言。</p>\n<p>当前字符属于JS时，在没遇到执行符号 <strong>~</strong> 之前，<strong>printChar</strong>只是单纯的打印格式化后的字符。遇到 <strong>~</strong> 以后，<strong>printChar</strong>进行了如下操作：</p>\n<ol>\n<li>函数首先通过正则匹配，匹配出之前的JS整段代码。</li>\n<li>再调用<strong>createElement()</strong>来创造一对&lt;script&gt;&lt;/script&gt;标签，用来存放JS代码。</li>\n<li>然后将处理过的JS代码存入&lt;script&gt;&lt;/script&gt;标签内。</li>\n<li>最后通过<strong>$script_area.appendChild()</strong>的方式将&lt;script&gt;&lt;/script&gt;及其内部的JS代码存入&lt;div id=”script-area”&gt;中。注意，每次调用<strong>$script_area.appendChild()</strong>之前，都要将之前&lt;div id=”script-area”&gt;清空一遍，防止之前的JS代码再执行一次。</li>\n</ol>\n<p>当前字符属于CSS时，每次打印过程，一方面会将未格式化的字符串传入&lt;style id=”style-elem”&gt;中，用以生成样式。另一方面会将格式化的代码输出到&lt;pre id=”my-code”&gt;中，用以展示代码。</p>\n<h4 id=\"cssHighlight和jsHighlight\"><a href=\"#cssHighlight和jsHighlight\" class=\"headerlink\" title=\"cssHighlight和jsHighlight\"></a><strong>cssHighlight</strong>和<strong>jsHighlight</strong></h4><p>这两个函数十分类似，主要作用就是通过正则匹配，给不同类型的字符两端封上不同的标签，用以高亮代码。举个栗子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (openInteger &amp;&amp; !which.match(<span class=\"regexp\">/[0-9\\.]/</span>) &amp;&amp; !openString &amp;&amp; !openComment) &#123;</span><br><span class=\"line\">    s = string.replace(<span class=\"regexp\">/([0-9\\.]*)$/</span>, <span class=\"string\">\"&lt;em class=\\\"int\\\"&gt;$1&lt;/em&gt;\"</span> + which);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这就是一处典型的匹配+替换标签组合拳。作用是代码在以数字结尾时，给数字两端封上&lt;em class=”int”&gt;&lt;/em&gt;的标签。</p>\n<p>代码中还有很多用作标志位的参数，比如说<strong>openInteger</strong>，表示这段输入都是数字。通过对这些控制位进行操作，可以将零散的字符分成一段一段的，方便进行处理。</p>\n<p>其他部分就不谈了，自己可以看<a href=\"https://github.com/tuobaye0711/code-printer/blob/master/src/app.js\" target=\"_blank\" rel=\"noopener\">源代码</a>，我已经加了备注。</p>\n<h3 id=\"使用方法\"><a href=\"#使用方法\" class=\"headerlink\" title=\"使用方法\"></a>使用方法</h3><hr>\n<p>您可以fork过去直接修改，也可以按照如下步骤操作</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/tuobaye0711/code-printer.git</span><br></pre></td></tr></table></figure>\n<p>安装依赖文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n<p>打包文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n<p>起服务</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run server</span><br></pre></td></tr></table></figure>\n<p>修改配置说明：</p>\n<p>resume 文件存放简历或者其他静态资源</p>\n<p>source/code.js 存放需要打印并展示样式的代码（CSS/JS）</p>\n<p>source/app.js 是主代码，可以修改一些比如说打印速度、高亮色等配置</p>\n<h3 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h3><hr>\n<p>能在自己网站挂一份带打印特效的简历，想必能让人眼前一亮吧。这篇文章主要安利了一下我这个名为code-printer的小项目，希望能帮到各位~</p>\n","site":{"data":{}},"excerpt":"","more":"<p>欢迎光临我的博客<a href=\"http://tuobaye.com\" target=\"_blank\" rel=\"noopener\">拓跋的前端客栈</a>，这个是<a href=\"http://tuobaye.com/2018/01/23/%E4%BD%BF%E7%94%A8code-printer%E7%94%9F%E6%88%90%E4%B8%80%E4%BB%BD%E7%82%AB%E9%85%B7%E7%9A%84%E7%AE%80%E5%8E%86/\" target=\"_blank\" rel=\"noopener\">原文地址</a>，这个是<a href=\"https://github.com/tuobaye0711/code-printer\" target=\"_blank\" rel=\"noopener\">项目地址</a>，欢迎star&amp;fork。如果您发现我文章中存在错误，请尽情向我吐槽，大家一起学习一起进步φ(&gt;ω&lt;*)</p>\n<hr>\n<h3 id=\"DEMO\"><a href=\"#DEMO\" class=\"headerlink\" title=\"DEMO\"></a>DEMO</h3><hr>\n<p>最终效果请点击<strong><a href=\"http://tuobaye.com/demo/code-printer\" target=\"_blank\" rel=\"noopener\">这里</a></strong>，是不是有点意思？</p>\n<p><img src=\"/2018/01/23/使用code-printer生成一份炫酷的简历/code-printer.png\" alt=\"code-printer.png\"></p>\n<h3 id=\"源码分析\"><a href=\"#源码分析\" class=\"headerlink\" title=\"源码分析\"></a>源码分析</h3><hr>\n<p>code-printer的原理是首先搭起一个骨架，然后通过遍历的方式，一点一点地往骨架里塞东西。</p>\n<p>骨架主要有三块：</p>\n<ul>\n<li>&lt;pre id=”my-code”&gt;: 主要用来展示的HTML代码的，带标签</li>\n<li>&lt;style id=”style-elem”&gt;: 主要填CSS代码的，用于把&lt;pre&gt;里特定的标签转换成特定的样式</li>\n<li>&lt;div id=”script-area”&gt;: 主要是填JS代码的。但是由于一个字符一个字符往里面填代码会出现大量报错，因此这部分需要一个段落的JS代码全部书写完毕以后，通过一个命令符’~’来一次性填入。</li>\n</ul>\n<h4 id=\"printCodes\"><a href=\"#printCodes\" class=\"headerlink\" title=\"printCodes\"></a><strong>printCodes</strong></h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> printCodes = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">message, index, interval</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (index &lt; message.length) &#123;</span><br><span class=\"line\">        $code_pre.scrollTop = $code_pre.scrollHeight;</span><br><span class=\"line\">        printChar(message[index++]);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> setTimeout((<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> printCodes(message, index, interval);</span><br><span class=\"line\">        &#125;), speed);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>这段代码的主要作用就是遍历打印字符，同时每次打印的时候都将滚动条拖到最底下，保证用户能看到最新的变化。</p>\n<h4 id=\"printChar\"><a href=\"#printChar\" class=\"headerlink\" title=\"printChar\"></a><strong>printChar</strong></h4><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> printChar = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">which</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> char, formatted_code, prior_block_match, prior_comment_match, script_tag;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (which === <span class=\"string\">\"`\"</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 重置为空字符串，防止打印出来</span></span><br><span class=\"line\">        which = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">        isJs = !isJs;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (isJs) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (which === <span class=\"string\">\"~\"</span> &amp;&amp; !openComment) &#123;</span><br><span class=\"line\">            script_tag = createElement(<span class=\"string\">\"script\"</span>);</span><br><span class=\"line\">            <span class=\"comment\">// two matches based on prior scenario</span></span><br><span class=\"line\">            prior_comment_match = <span class=\"regexp\">/(?:\\*\\/([^\\~]*))$/</span>;</span><br><span class=\"line\">            prior_block_match = <span class=\"regexp\">/([^~]*)$/</span>;</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (unformatted_code.match(prior_comment_match)) &#123;</span><br><span class=\"line\">                script_tag.innerHTML = unformatted_code.match(prior_comment_match)[<span class=\"number\">0</span>].replace(<span class=\"string\">\"*/\"</span>, <span class=\"string\">\"\"</span>) + <span class=\"string\">\"\\n\\n\"</span>;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                script_tag.innerHTML = unformatted_code.match(prior_block_match)[<span class=\"number\">0</span>] + <span class=\"string\">\"\\n\\n\"</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">            $script_area.innerHTML = <span class=\"string\">\"\"</span>;</span><br><span class=\"line\">            $script_area.appendChild(script_tag);</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        char = which;</span><br><span class=\"line\">        formatted_code = jsHighlight($code_pre.innerHTML, char);</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        char = which === <span class=\"string\">\"~\"</span> ? <span class=\"string\">\"\"</span> : which;</span><br><span class=\"line\">        $style_elem.innerHTML += char;</span><br><span class=\"line\">        formatted_code = cssHighlight($code_pre.innerHTML, char);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    prevAsterisk = which === <span class=\"string\">\"*\"</span>;</span><br><span class=\"line\">    prevSlash = (which === <span class=\"string\">\"/\"</span>) &amp;&amp; !openComment;</span><br><span class=\"line\">    openInteger = which.match(<span class=\"regexp\">/[0-9]/</span>) || (openInteger &amp;&amp; which.match(<span class=\"regexp\">/[\\.\\%pxems]/</span>)) ? <span class=\"literal\">true</span> : <span class=\"literal\">false</span>;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (which === <span class=\"string\">'\"'</span>) &#123;</span><br><span class=\"line\">        openString = !openString;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    unformatted_code += which;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> $code_pre.innerHTML = formatted_code;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p><strong>printChar</strong>函数是code-printer的核心函数，这个函数会根据当前的代码是JS还是CSS，来进行不同的处理。</p>\n<p>如何判断是JS还是CSS代码呢？默认设置</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">let</span> isJs = <span class=\"literal\">false</span>;</span><br></pre></td></tr></table></figure>\n<p>也就是默认是CSS，然后以 <strong>`</strong> 作为切换符号，每次遇到 <strong>`</strong> 就切换一次语言。</p>\n<p>当前字符属于JS时，在没遇到执行符号 <strong>~</strong> 之前，<strong>printChar</strong>只是单纯的打印格式化后的字符。遇到 <strong>~</strong> 以后，<strong>printChar</strong>进行了如下操作：</p>\n<ol>\n<li>函数首先通过正则匹配，匹配出之前的JS整段代码。</li>\n<li>再调用<strong>createElement()</strong>来创造一对&lt;script&gt;&lt;/script&gt;标签，用来存放JS代码。</li>\n<li>然后将处理过的JS代码存入&lt;script&gt;&lt;/script&gt;标签内。</li>\n<li>最后通过<strong>$script_area.appendChild()</strong>的方式将&lt;script&gt;&lt;/script&gt;及其内部的JS代码存入&lt;div id=”script-area”&gt;中。注意，每次调用<strong>$script_area.appendChild()</strong>之前，都要将之前&lt;div id=”script-area”&gt;清空一遍，防止之前的JS代码再执行一次。</li>\n</ol>\n<p>当前字符属于CSS时，每次打印过程，一方面会将未格式化的字符串传入&lt;style id=”style-elem”&gt;中，用以生成样式。另一方面会将格式化的代码输出到&lt;pre id=”my-code”&gt;中，用以展示代码。</p>\n<h4 id=\"cssHighlight和jsHighlight\"><a href=\"#cssHighlight和jsHighlight\" class=\"headerlink\" title=\"cssHighlight和jsHighlight\"></a><strong>cssHighlight</strong>和<strong>jsHighlight</strong></h4><p>这两个函数十分类似，主要作用就是通过正则匹配，给不同类型的字符两端封上不同的标签，用以高亮代码。举个栗子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (openInteger &amp;&amp; !which.match(<span class=\"regexp\">/[0-9\\.]/</span>) &amp;&amp; !openString &amp;&amp; !openComment) &#123;</span><br><span class=\"line\">    s = string.replace(<span class=\"regexp\">/([0-9\\.]*)$/</span>, <span class=\"string\">\"&lt;em class=\\\"int\\\"&gt;$1&lt;/em&gt;\"</span> + which);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这就是一处典型的匹配+替换标签组合拳。作用是代码在以数字结尾时，给数字两端封上&lt;em class=”int”&gt;&lt;/em&gt;的标签。</p>\n<p>代码中还有很多用作标志位的参数，比如说<strong>openInteger</strong>，表示这段输入都是数字。通过对这些控制位进行操作，可以将零散的字符分成一段一段的，方便进行处理。</p>\n<p>其他部分就不谈了，自己可以看<a href=\"https://github.com/tuobaye0711/code-printer/blob/master/src/app.js\" target=\"_blank\" rel=\"noopener\">源代码</a>，我已经加了备注。</p>\n<h3 id=\"使用方法\"><a href=\"#使用方法\" class=\"headerlink\" title=\"使用方法\"></a>使用方法</h3><hr>\n<p>您可以fork过去直接修改，也可以按照如下步骤操作</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">git <span class=\"built_in\">clone</span> https://github.com/tuobaye0711/code-printer.git</span><br></pre></td></tr></table></figure>\n<p>安装依赖文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install</span><br></pre></td></tr></table></figure>\n<p>打包文件</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm start</span><br></pre></td></tr></table></figure>\n<p>起服务</p>\n<figure class=\"highlight bash\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm run server</span><br></pre></td></tr></table></figure>\n<p>修改配置说明：</p>\n<p>resume 文件存放简历或者其他静态资源</p>\n<p>source/code.js 存放需要打印并展示样式的代码（CSS/JS）</p>\n<p>source/app.js 是主代码，可以修改一些比如说打印速度、高亮色等配置</p>\n<h3 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h3><hr>\n<p>能在自己网站挂一份带打印特效的简历，想必能让人眼前一亮吧。这篇文章主要安利了一下我这个名为code-printer的小项目，希望能帮到各位~</p>\n"},{"title":"一个简单的Promise实现","date":"2017-10-17T07:54:45.000Z","description":"Promise 是异步编程的一种解决方案，比传统的解决方案——回调函数和事件——更合理和更强大。它由社区最早提出和实现，ES6 将其写进了语言标准，统一了用法，原生提供了Promise对象。本文采用最简单的方法，实现了一个基本的Promise雏形","picture":"promise.png","_content":"![promise/A+](promise.png)\n> Promise 是异步编程的一种解决方案，比传统的解决方案——回调函数和事件——更合理和更强大。它由社区最早提出和实现，ES6 将其写进了语言标准，统一了用法，原生提供了Promise对象。\n\n通常我们是这么定义和使用promise的：\n{% codeblock lang:javascript %}\n    function getSomethingAsync() {\n        return new Promise(function(resolve) {\n            //异步请求,这里简单的用setTimeout模拟异步\n            setTimeout(function(){\n                resolve('got it!');\n            },5000)\n        })\n    }\n    getSomethingAsync().then(function(id) {\n        //一些处理\n        let information = id;\n        console.log(information)\n    })\n{% endcodeblock %}\n\n这例中主要涉及了Promise的两个核心，一个是then，一个是resolve。据此，我们可以写出一个最基础的Promise的架子：\n\n{% codeblock lang:javascript %}\n    function Promise(fn) {\n        //value用来存储向resolve传递的值，callbacks用来存储已注册的回调函数\n        var value = null,\n            callbacks = [];  //callbacks为数组，因为可能同时有很多个回调\n        this.then = function (onFulfilled) {\n            //将注册的回调函数依次压入栈中\n            callbacks.push(onFulfilled);\n        };\n        function resolve(value) {\n            //当调用resolve函数时，根据传入的value，依次执行已注册的回调函数\n            callbacks.forEach(function (callback) {\n                callback(value);\n            });\n        }\n        fn(resolve);\n    }\n{% endcodeblock %}\n\n在这里，我们分别分析一下then和resolve的作用,首先是then：\n\n<img src='Promise.prototype.then.png' width=\"50%\" height=\"50%\">\n\n注册回调函数的作用很明显，就是在Promise的异步操作执行成功时，将需要执行的回调函数压入callbacks队列中。\n\n同时，then函数要实现类似于\n\n{% codeblock lang:javascript %}\n    getSomethingAsync().then(function() {\n        //一些处理\n    }).then(function(){\n        //二些处理\n    }).then(function(){\n        //三些处理\n    })\n{% endcodeblock %}\n\n的功能，即链式调用，仅需一行代码即可实现：\n\n{% codeblock lang:javascript %}\n    this.then = function (onFulfilled) {\n        //将注册的回调函数依次压入栈中\n        callbacks.push(onFulfilled);\n        //一行代码实现链式调用\n        return this\n    };\n{% endcodeblock %}\n\n是不是很巧妙呢？\n***\n实现了then的基本功能，我们再回过头来看resolve。resolve函数的作用是，将Promise对象的状态从“未完成”变为“成功”（即从 pending 变为 resolved），在异步操作成功时调用，并将异步操作的结果，作为参数传递出去。这样，当Promise实例生成以后，可以用then方法指定resolved状态。\n\n由此可见，resolve状态下，还有一件必须要完成的事情是状态切换:\n- 对象的状态不受外界影响。Promise对象代表一个异步操作，有三种状态：pending（进行中）、fulfilled（已成功）和rejected（已失败）。只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。这也是Promise这个名字的由来，它的英语意思就是“承诺”，表示其他手段无法改变。\n- 一旦状态改变，就不会再变，任何时候都可以得到这个结果。Promise对象的状态改变，只有两种可能：从pending变为fulfilled和从pending变为rejected。只要这两种情况发生，状态就凝固了，不会再变了，会一直保持这个结果。\n\npending -> fulfilled/pending -> rejected\n\n我们接下来就在resolve里面加上状态切换：\n\n{% codeblock lang:javascript %}\n    function Promise(fn) {\n        var value = null,\n            callbacks = [],\n            //初始状态置为pending\n            state = 'pending';\n        this.then = function(onFulfilled) {\n            //假如调用then函数时，状态仍为pending，这时候需要将回调函数压入到callbacks栈中\n        \tif (state === 'pending') {\n        \t\tcallbacks.push(onFulfilled);\n                return this\n        \t}\n        \t//假如调用then函数时，状态不是pending，则直接调用\n            onFulfilled(value);\n            return this\n        }\n        function resolve(value) {\n        \tvalue = newValue;\n        \t//将状态切换为fulfilled\n        \tstate = 'fulfilled';\n            callbacks.forEach(function(callback) {\n                callback(value)\n            })\n        }\n        fn(resolve)\n    }\n{% endcodeblock %}\n\n这样，我们就实现了一个最基础的Promise。等等，是不是还缺了什么？如果在then方法注册回调之前，resolve函数就执行了，怎么办？比如promise内部的函数是同步函数：\n\n{% codeblock lang:javascript %}\n    function getSomething() {\n        return new Promise(function(resolve) {\n            resolve(8384);\n        })\n    }\n    getSomething().then(function (id) {\n        // 一些处理\n    });\n{% endcodeblock %}\n\n这么做显然不对，我们必须将resolve放到队列尾端，以保证在resolve执行前，所有then函数的回调都已经注册完毕，因此我们再加一个延时：\n\n{% codeblock lang:javascript %}\n    function resolve(value) {\n        value = newValue;\n        state = 'fulfilled';\n        // 放到队列尾端执行回调\n        setTimeout(function() {\n            callbacks.forEach(function(callback) {\n                callback(value)\n            })\n        }, 0)\n    }\n{% endcodeblock %}\n\n这样，我们一个最基本的Promise就写完了，为了便于理解逻辑，暂时还没加rejected的状态切换，后面有机会咱再继续丰富我们的Promise源码~下面贴一下完整的代码：\n\n{% codeblock lang:javascript %}\n    function Promise(fn) {\n      var value = null,\n        callbacks = [],\n        state = \"pending\";\n      this.then = function(onFulfilled) {\n        if (state === \"pending\") {\n          callbacks.push(onFulfilled);\n          return this; //一行即可实现链式调用\n        }\n        onFulfilled(value);\n        return this;\n      };\n      function resolve(newValue) {\n        value = newValue;\n        state = \"fulfilled\";\n        setTimeout(function() {\n          callbacks.forEach(function(callback) {\n            callback(value);\n          });\n        }, 0);\n      }\n      fn(resolve);\n    }\n{% endcodeblock %}\n\n点击[这里](https://codepen.io/tuobaye0711/pen/BwMQyL?editors=0010)查看codepen完整代码示例~","source":"_posts/一个简单的promise实现.md","raw":"---\ntitle: 一个简单的promise实现\ndate: 2017-10-17 15:54:45\ntags: JavaScript\ndescription: Promise 是异步编程的一种解决方案，比传统的解决方案——回调函数和事件——更合理和更强大。它由社区最早提出和实现，ES6 将其写进了语言标准，统一了用法，原生提供了Promise对象。本文采用最简单的方法，实现了一个基本的Promise雏形\npicture: promise.png\n---\n![promise/A+](promise.png)\n> Promise 是异步编程的一种解决方案，比传统的解决方案——回调函数和事件——更合理和更强大。它由社区最早提出和实现，ES6 将其写进了语言标准，统一了用法，原生提供了Promise对象。\n\n通常我们是这么定义和使用promise的：\n{% codeblock lang:javascript %}\n    function getSomethingAsync() {\n        return new Promise(function(resolve) {\n            //异步请求,这里简单的用setTimeout模拟异步\n            setTimeout(function(){\n                resolve('got it!');\n            },5000)\n        })\n    }\n    getSomethingAsync().then(function(id) {\n        //一些处理\n        let information = id;\n        console.log(information)\n    })\n{% endcodeblock %}\n\n这例中主要涉及了Promise的两个核心，一个是then，一个是resolve。据此，我们可以写出一个最基础的Promise的架子：\n\n{% codeblock lang:javascript %}\n    function Promise(fn) {\n        //value用来存储向resolve传递的值，callbacks用来存储已注册的回调函数\n        var value = null,\n            callbacks = [];  //callbacks为数组，因为可能同时有很多个回调\n        this.then = function (onFulfilled) {\n            //将注册的回调函数依次压入栈中\n            callbacks.push(onFulfilled);\n        };\n        function resolve(value) {\n            //当调用resolve函数时，根据传入的value，依次执行已注册的回调函数\n            callbacks.forEach(function (callback) {\n                callback(value);\n            });\n        }\n        fn(resolve);\n    }\n{% endcodeblock %}\n\n在这里，我们分别分析一下then和resolve的作用,首先是then：\n\n<img src='Promise.prototype.then.png' width=\"50%\" height=\"50%\">\n\n注册回调函数的作用很明显，就是在Promise的异步操作执行成功时，将需要执行的回调函数压入callbacks队列中。\n\n同时，then函数要实现类似于\n\n{% codeblock lang:javascript %}\n    getSomethingAsync().then(function() {\n        //一些处理\n    }).then(function(){\n        //二些处理\n    }).then(function(){\n        //三些处理\n    })\n{% endcodeblock %}\n\n的功能，即链式调用，仅需一行代码即可实现：\n\n{% codeblock lang:javascript %}\n    this.then = function (onFulfilled) {\n        //将注册的回调函数依次压入栈中\n        callbacks.push(onFulfilled);\n        //一行代码实现链式调用\n        return this\n    };\n{% endcodeblock %}\n\n是不是很巧妙呢？\n***\n实现了then的基本功能，我们再回过头来看resolve。resolve函数的作用是，将Promise对象的状态从“未完成”变为“成功”（即从 pending 变为 resolved），在异步操作成功时调用，并将异步操作的结果，作为参数传递出去。这样，当Promise实例生成以后，可以用then方法指定resolved状态。\n\n由此可见，resolve状态下，还有一件必须要完成的事情是状态切换:\n- 对象的状态不受外界影响。Promise对象代表一个异步操作，有三种状态：pending（进行中）、fulfilled（已成功）和rejected（已失败）。只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。这也是Promise这个名字的由来，它的英语意思就是“承诺”，表示其他手段无法改变。\n- 一旦状态改变，就不会再变，任何时候都可以得到这个结果。Promise对象的状态改变，只有两种可能：从pending变为fulfilled和从pending变为rejected。只要这两种情况发生，状态就凝固了，不会再变了，会一直保持这个结果。\n\npending -> fulfilled/pending -> rejected\n\n我们接下来就在resolve里面加上状态切换：\n\n{% codeblock lang:javascript %}\n    function Promise(fn) {\n        var value = null,\n            callbacks = [],\n            //初始状态置为pending\n            state = 'pending';\n        this.then = function(onFulfilled) {\n            //假如调用then函数时，状态仍为pending，这时候需要将回调函数压入到callbacks栈中\n        \tif (state === 'pending') {\n        \t\tcallbacks.push(onFulfilled);\n                return this\n        \t}\n        \t//假如调用then函数时，状态不是pending，则直接调用\n            onFulfilled(value);\n            return this\n        }\n        function resolve(value) {\n        \tvalue = newValue;\n        \t//将状态切换为fulfilled\n        \tstate = 'fulfilled';\n            callbacks.forEach(function(callback) {\n                callback(value)\n            })\n        }\n        fn(resolve)\n    }\n{% endcodeblock %}\n\n这样，我们就实现了一个最基础的Promise。等等，是不是还缺了什么？如果在then方法注册回调之前，resolve函数就执行了，怎么办？比如promise内部的函数是同步函数：\n\n{% codeblock lang:javascript %}\n    function getSomething() {\n        return new Promise(function(resolve) {\n            resolve(8384);\n        })\n    }\n    getSomething().then(function (id) {\n        // 一些处理\n    });\n{% endcodeblock %}\n\n这么做显然不对，我们必须将resolve放到队列尾端，以保证在resolve执行前，所有then函数的回调都已经注册完毕，因此我们再加一个延时：\n\n{% codeblock lang:javascript %}\n    function resolve(value) {\n        value = newValue;\n        state = 'fulfilled';\n        // 放到队列尾端执行回调\n        setTimeout(function() {\n            callbacks.forEach(function(callback) {\n                callback(value)\n            })\n        }, 0)\n    }\n{% endcodeblock %}\n\n这样，我们一个最基本的Promise就写完了，为了便于理解逻辑，暂时还没加rejected的状态切换，后面有机会咱再继续丰富我们的Promise源码~下面贴一下完整的代码：\n\n{% codeblock lang:javascript %}\n    function Promise(fn) {\n      var value = null,\n        callbacks = [],\n        state = \"pending\";\n      this.then = function(onFulfilled) {\n        if (state === \"pending\") {\n          callbacks.push(onFulfilled);\n          return this; //一行即可实现链式调用\n        }\n        onFulfilled(value);\n        return this;\n      };\n      function resolve(newValue) {\n        value = newValue;\n        state = \"fulfilled\";\n        setTimeout(function() {\n          callbacks.forEach(function(callback) {\n            callback(value);\n          });\n        }, 0);\n      }\n      fn(resolve);\n    }\n{% endcodeblock %}\n\n点击[这里](https://codepen.io/tuobaye0711/pen/BwMQyL?editors=0010)查看codepen完整代码示例~","slug":"一个简单的promise实现","published":1,"updated":"2018-03-04T15:08:12.818Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk698hxx000cznzwe7v96n1n","content":"<p><img src=\"/2017/10/17/一个简单的promise实现/promise.png\" alt=\"promise/A+\"></p>\n<blockquote>\n<p>Promise 是异步编程的一种解决方案，比传统的解决方案——回调函数和事件——更合理和更强大。它由社区最早提出和实现，ES6 将其写进了语言标准，统一了用法，原生提供了Promise对象。</p>\n</blockquote>\n<p>通常我们是这么定义和使用promise的：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getSomethingAsync</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//异步请求,这里简单的用setTimeout模拟异步</span></span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            resolve(<span class=\"string\">'got it!'</span>);</span><br><span class=\"line\">        &#125;,<span class=\"number\">5000</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">getSomethingAsync().then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">id</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//一些处理</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> information = id;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(information)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></p>\n<p>这例中主要涉及了Promise的两个核心，一个是then，一个是resolve。据此，我们可以写出一个最基础的Promise的架子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Promise</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//value用来存储向resolve传递的值，callbacks用来存储已注册的回调函数</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> value = <span class=\"literal\">null</span>,</span><br><span class=\"line\">        callbacks = [];  <span class=\"comment\">//callbacks为数组，因为可能同时有很多个回调</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.then = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">onFulfilled</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//将注册的回调函数依次压入栈中</span></span><br><span class=\"line\">        callbacks.push(onFulfilled);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//当调用resolve函数时，根据传入的value，依次执行已注册的回调函数</span></span><br><span class=\"line\">        callbacks.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">            callback(value);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    fn(resolve);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在这里，我们分别分析一下then和resolve的作用,首先是then：</p>\n<p><img src=\"/2017/10/17/一个简单的promise实现/Promise.prototype.then.png\" width=\"50%\" height=\"50%\"></p>\n<p>注册回调函数的作用很明显，就是在Promise的异步操作执行成功时，将需要执行的回调函数压入callbacks队列中。</p>\n<p>同时，then函数要实现类似于</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getSomethingAsync().then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//一些处理</span></span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//二些处理</span></span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//三些处理</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>的功能，即链式调用，仅需一行代码即可实现：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.then = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">onFulfilled</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//将注册的回调函数依次压入栈中</span></span><br><span class=\"line\">    callbacks.push(onFulfilled);</span><br><span class=\"line\">    <span class=\"comment\">//一行代码实现链式调用</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>是不是很巧妙呢？</p>\n<hr>\n<p>实现了then的基本功能，我们再回过头来看resolve。resolve函数的作用是，将Promise对象的状态从“未完成”变为“成功”（即从 pending 变为 resolved），在异步操作成功时调用，并将异步操作的结果，作为参数传递出去。这样，当Promise实例生成以后，可以用then方法指定resolved状态。</p>\n<p>由此可见，resolve状态下，还有一件必须要完成的事情是状态切换:</p>\n<ul>\n<li>对象的状态不受外界影响。Promise对象代表一个异步操作，有三种状态：pending（进行中）、fulfilled（已成功）和rejected（已失败）。只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。这也是Promise这个名字的由来，它的英语意思就是“承诺”，表示其他手段无法改变。</li>\n<li>一旦状态改变，就不会再变，任何时候都可以得到这个结果。Promise对象的状态改变，只有两种可能：从pending变为fulfilled和从pending变为rejected。只要这两种情况发生，状态就凝固了，不会再变了，会一直保持这个结果。</li>\n</ul>\n<p>pending -&gt; fulfilled/pending -&gt; rejected</p>\n<p>我们接下来就在resolve里面加上状态切换：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Promise</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> value = <span class=\"literal\">null</span>,</span><br><span class=\"line\">        callbacks = [],</span><br><span class=\"line\">        <span class=\"comment\">//初始状态置为pending</span></span><br><span class=\"line\">        state = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.then = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">onFulfilled</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//假如调用then函数时，状态仍为pending，这时候需要将回调函数压入到callbacks栈中</span></span><br><span class=\"line\">    \t<span class=\"keyword\">if</span> (state === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">    \t\tcallbacks.push(onFulfilled);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">    \t<span class=\"comment\">//假如调用then函数时，状态不是pending，则直接调用</span></span><br><span class=\"line\">        onFulfilled(value);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    \tvalue = newValue;</span><br><span class=\"line\">    \t<span class=\"comment\">//将状态切换为fulfilled</span></span><br><span class=\"line\">    \tstate = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">        callbacks.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">            callback(value)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    fn(resolve)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样，我们就实现了一个最基础的Promise。等等，是不是还缺了什么？如果在then方法注册回调之前，resolve函数就执行了，怎么办？比如promise内部的函数是同步函数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getSomething</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve</span>) </span>&#123;</span><br><span class=\"line\">        resolve(<span class=\"number\">8384</span>);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">getSomething().then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">id</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 一些处理</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>这么做显然不对，我们必须将resolve放到队列尾端，以保证在resolve执行前，所有then函数的回调都已经注册完毕，因此我们再加一个延时：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    value = newValue;</span><br><span class=\"line\">    state = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 放到队列尾端执行回调</span></span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        callbacks.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">            callback(value)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;, <span class=\"number\">0</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样，我们一个最基本的Promise就写完了，为了便于理解逻辑，暂时还没加rejected的状态切换，后面有机会咱再继续丰富我们的Promise源码~下面贴一下完整的代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Promise</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> value = <span class=\"literal\">null</span>,</span><br><span class=\"line\">    callbacks = [],</span><br><span class=\"line\">    state = <span class=\"string\">\"pending\"</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.then = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">onFulfilled</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (state === <span class=\"string\">\"pending\"</span>) &#123;</span><br><span class=\"line\">      callbacks.push(onFulfilled);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>; <span class=\"comment\">//一行即可实现链式调用</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    onFulfilled(value);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">newValue</span>) </span>&#123;</span><br><span class=\"line\">    value = newValue;</span><br><span class=\"line\">    state = <span class=\"string\">\"fulfilled\"</span>;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      callbacks.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">        callback(value);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;, <span class=\"number\">0</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  fn(resolve);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>点击<a href=\"https://codepen.io/tuobaye0711/pen/BwMQyL?editors=0010\" target=\"_blank\" rel=\"noopener\">这里</a>查看codepen完整代码示例~</p>\n","site":{"data":{}},"excerpt":"","more":"<p><img src=\"/2017/10/17/一个简单的promise实现/promise.png\" alt=\"promise/A+\"></p>\n<blockquote>\n<p>Promise 是异步编程的一种解决方案，比传统的解决方案——回调函数和事件——更合理和更强大。它由社区最早提出和实现，ES6 将其写进了语言标准，统一了用法，原生提供了Promise对象。</p>\n</blockquote>\n<p>通常我们是这么定义和使用promise的：<br><figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getSomethingAsync</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//异步请求,这里简单的用setTimeout模拟异步</span></span><br><span class=\"line\">        setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">            resolve(<span class=\"string\">'got it!'</span>);</span><br><span class=\"line\">        &#125;,<span class=\"number\">5000</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">getSomethingAsync().then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">id</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//一些处理</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> information = id;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(information)</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure></p>\n<p>这例中主要涉及了Promise的两个核心，一个是then，一个是resolve。据此，我们可以写出一个最基础的Promise的架子：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Promise</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//value用来存储向resolve传递的值，callbacks用来存储已注册的回调函数</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> value = <span class=\"literal\">null</span>,</span><br><span class=\"line\">        callbacks = [];  <span class=\"comment\">//callbacks为数组，因为可能同时有很多个回调</span></span><br><span class=\"line\">    <span class=\"keyword\">this</span>.then = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">onFulfilled</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//将注册的回调函数依次压入栈中</span></span><br><span class=\"line\">        callbacks.push(onFulfilled);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//当调用resolve函数时，根据传入的value，依次执行已注册的回调函数</span></span><br><span class=\"line\">        callbacks.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">            callback(value);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    fn(resolve);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>在这里，我们分别分析一下then和resolve的作用,首先是then：</p>\n<p><img src=\"/2017/10/17/一个简单的promise实现/Promise.prototype.then.png\" width=\"50%\" height=\"50%\"></p>\n<p>注册回调函数的作用很明显，就是在Promise的异步操作执行成功时，将需要执行的回调函数压入callbacks队列中。</p>\n<p>同时，then函数要实现类似于</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">getSomethingAsync().then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//一些处理</span></span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//二些处理</span></span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//三些处理</span></span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n<p>的功能，即链式调用，仅需一行代码即可实现：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">this</span>.then = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">onFulfilled</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//将注册的回调函数依次压入栈中</span></span><br><span class=\"line\">    callbacks.push(onFulfilled);</span><br><span class=\"line\">    <span class=\"comment\">//一行代码实现链式调用</span></span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>是不是很巧妙呢？</p>\n<hr>\n<p>实现了then的基本功能，我们再回过头来看resolve。resolve函数的作用是，将Promise对象的状态从“未完成”变为“成功”（即从 pending 变为 resolved），在异步操作成功时调用，并将异步操作的结果，作为参数传递出去。这样，当Promise实例生成以后，可以用then方法指定resolved状态。</p>\n<p>由此可见，resolve状态下，还有一件必须要完成的事情是状态切换:</p>\n<ul>\n<li>对象的状态不受外界影响。Promise对象代表一个异步操作，有三种状态：pending（进行中）、fulfilled（已成功）和rejected（已失败）。只有异步操作的结果，可以决定当前是哪一种状态，任何其他操作都无法改变这个状态。这也是Promise这个名字的由来，它的英语意思就是“承诺”，表示其他手段无法改变。</li>\n<li>一旦状态改变，就不会再变，任何时候都可以得到这个结果。Promise对象的状态改变，只有两种可能：从pending变为fulfilled和从pending变为rejected。只要这两种情况发生，状态就凝固了，不会再变了，会一直保持这个结果。</li>\n</ul>\n<p>pending -&gt; fulfilled/pending -&gt; rejected</p>\n<p>我们接下来就在resolve里面加上状态切换：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Promise</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> value = <span class=\"literal\">null</span>,</span><br><span class=\"line\">        callbacks = [],</span><br><span class=\"line\">        <span class=\"comment\">//初始状态置为pending</span></span><br><span class=\"line\">        state = <span class=\"string\">'pending'</span>;</span><br><span class=\"line\">    <span class=\"keyword\">this</span>.then = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">onFulfilled</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">//假如调用then函数时，状态仍为pending，这时候需要将回调函数压入到callbacks栈中</span></span><br><span class=\"line\">    \t<span class=\"keyword\">if</span> (state === <span class=\"string\">'pending'</span>) &#123;</span><br><span class=\"line\">    \t\tcallbacks.push(onFulfilled);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">    \t&#125;</span><br><span class=\"line\">    \t<span class=\"comment\">//假如调用then函数时，状态不是pending，则直接调用</span></span><br><span class=\"line\">        onFulfilled(value);</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"keyword\">this</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    \tvalue = newValue;</span><br><span class=\"line\">    \t<span class=\"comment\">//将状态切换为fulfilled</span></span><br><span class=\"line\">    \tstate = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">        callbacks.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">            callback(value)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    fn(resolve)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样，我们就实现了一个最基础的Promise。等等，是不是还缺了什么？如果在then方法注册回调之前，resolve函数就执行了，怎么办？比如promise内部的函数是同步函数：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getSomething</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve</span>) </span>&#123;</span><br><span class=\"line\">        resolve(<span class=\"number\">8384</span>);</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\">getSomething().then(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">id</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 一些处理</span></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>这么做显然不对，我们必须将resolve放到队列尾端，以保证在resolve执行前，所有then函数的回调都已经注册完毕，因此我们再加一个延时：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">    value = newValue;</span><br><span class=\"line\">    state = <span class=\"string\">'fulfilled'</span>;</span><br><span class=\"line\">    <span class=\"comment\">// 放到队列尾端执行回调</span></span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        callbacks.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">            callback(value)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;, <span class=\"number\">0</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>这样，我们一个最基本的Promise就写完了，为了便于理解逻辑，暂时还没加rejected的状态切换，后面有机会咱再继续丰富我们的Promise源码~下面贴一下完整的代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">Promise</span>(<span class=\"params\">fn</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">var</span> value = <span class=\"literal\">null</span>,</span><br><span class=\"line\">    callbacks = [],</span><br><span class=\"line\">    state = <span class=\"string\">\"pending\"</span>;</span><br><span class=\"line\">  <span class=\"keyword\">this</span>.then = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">onFulfilled</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (state === <span class=\"string\">\"pending\"</span>) &#123;</span><br><span class=\"line\">      callbacks.push(onFulfilled);</span><br><span class=\"line\">      <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>; <span class=\"comment\">//一行即可实现链式调用</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    onFulfilled(value);</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"keyword\">this</span>;</span><br><span class=\"line\">  &#125;;</span><br><span class=\"line\">  <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">resolve</span>(<span class=\"params\">newValue</span>) </span>&#123;</span><br><span class=\"line\">    value = newValue;</span><br><span class=\"line\">    state = <span class=\"string\">\"fulfilled\"</span>;</span><br><span class=\"line\">    setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">      callbacks.forEach(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">callback</span>) </span>&#123;</span><br><span class=\"line\">        callback(value);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">    &#125;, <span class=\"number\">0</span>);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  fn(resolve);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>点击<a href=\"https://codepen.io/tuobaye0711/pen/BwMQyL?editors=0010\" target=\"_blank\" rel=\"noopener\">这里</a>查看codepen完整代码示例~</p>\n"},{"title":"【译】Chrome浏览器开发者工具的13个有趣技巧——希望你已经掌握","date":"2018-03-26T03:27:06.000Z","description":"Chrome浏览器提供了一套非常出色的开发者工具来帮助您在Web平台上开发。下面我将介绍13个有趣的技巧，掌握他们对你只有好处。","picture":"6.gif","_content":"\nChrome浏览器提供了一套非常出色的开发者工具来帮助您在Web平台上开发。下面我将介绍13个有趣的技巧，掌握他们对你只有好处。\n\n###  1. 在Elements面板中拖放元素\n\n***\n\n在Elements面板中，你可以拖放任意的HTML元素，并在整个页面中更改其位置：\n\n![Drag-and-drop in the Elements panel](1.gif)\n\n###  2. 在控制台中引用当前选定的元素\n\n***\n\n在Elements面板中，选择一个节点，然后输入$0控制台以引用它：\n\n![Reference the currently selected element in the Console](2.gif)\n\n###  3. 使用控制台中最后一个操作的值\n\n***\n\n使用$_引用在控制台执行的前一操作的返回值：\n\n![Use the value of the last operation in the Console](3.gif)\n\n###  4. 添加CSS并编辑元素状态\n\n***\n\n在Elements面板中有2个超级有用的按钮。\n\n第一个可以为你的选择器(selector)增加新的CSS属性：\n\n![Add CSS and edit the element state](4.gif)\n\n第二个可以为你触发选定元素的状态，这样你就可以看到当它处于活动状态(active)，悬停状态(hovered)，焦点状态(focus)等等时应用的样式：\n\n![Add CSS and edit the element state](4.2.png)\n\n###  5. 将修改后的CSS保存到文件\n\n***\n\n点击你编辑的CSS文件的名称，进入到Sources面板，你会发现你的修改已经在里面了。然后你可以对你实时的编辑进行保存。\n\n这个修改不适用于添加的新选择器，也不适用于element.style属性，仅仅适用于原有选择器。\n\n![Save to file the modified CSS](5.gif)\n\n###  6. 截图单个元素\n\n***\n\n选择一个元素，MAC下按cmd+shift+p、windows下按ctrl+shift+p来打开命令菜单，然后输入**Capture node screenshot**：\n\n![Screenshot a single element](6.gif)\n\n###  7. 使用CSS选择器查找元素\n\n***\n\nMAC下按cmd+f、windows下按ctrl+f来打开搜索框\n\n您可以在其中键入任何字符串以匹配源代码，或者也可以使用CSS选择器让Chrome为您生成一个图像：\n\n![Find an element using CSS selectors](7.gif)\n\n###  8. 控制台中的shift和enter\n\n***\n\n要编写跨越控制台多行的命令，请按shift+enter\n\n准备就绪后，在脚本末尾按Enter键即可执行该操作：\n\n![Shift-enter in the Console](8.gif)\n\n###  9. 跳转\n\n***\n\n在Sources面板中：\n\n- cmd+o(windows下ctrl+o) 显示你页面加载的所有文件\n\n- cmd+shift+o(windows下ctrl+shift+o) 显示当前文件中的symbols（属性、函数、类等）\n\n- cmd+o(windows下ctrl+o) 跳转到指定行\n\n准备就绪后，在脚本末尾按Enter键即可执行该操作：\n\n![Go to…](9.png)\n\n###  10. 监听表达式\n\n***\n\n不需要一次又一次地输入一个变量名或者表达式，你只需将他们添加到监视列表中就可以时时观察它们的变化：\n\n![Watch Expression](10.gif)\n\n###  11. XHR/Fetch调试\n\n***\n\n从调试器打开**XHR/Fetch Breakpoints**面板。\n\n你可以针对某一个请求或者请求的关键字设置断点：\n\n![XHR/Fetch debugging](11.png)\n\n###  12. 调试DOM修改\n\n***\n\n右键单击某个DOM元素，并选择Break on下的subtree modifications。这样调试器就可以在脚本遍历到该元素并且要修改它的时候自动停止，以让用户进行调试检查。\n\n![XHR/Fetch debugging](12.png)\n\n###  13. 找到CSS属性定义的位置\n\n***\n\nMAC使用cmd+鼠标左键(windows下使用ctrl+鼠标左键)点击Elements面板中的CSS属性，可以直接帮您定位到Source面板中相应CSS定义的位置：\n\n![Use the value of the last operation in the Console](13.gif)\n\n### 原文链接\n\n***\n\n[https://flaviocopes.com/chrome-devtools-tips/](https://flaviocopes.com/chrome-devtools-tips/)","source":"_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握.md","raw":"---\ntitle: 【译】Chrome浏览器开发者工具的13个有趣技巧——希望你已经掌握\ndate: 2018-03-26 11:27:06\ntags: 外文翻译\ndescription: Chrome浏览器提供了一套非常出色的开发者工具来帮助您在Web平台上开发。下面我将介绍13个有趣的技巧，掌握他们对你只有好处。\npicture: 6.gif\n---\n\nChrome浏览器提供了一套非常出色的开发者工具来帮助您在Web平台上开发。下面我将介绍13个有趣的技巧，掌握他们对你只有好处。\n\n###  1. 在Elements面板中拖放元素\n\n***\n\n在Elements面板中，你可以拖放任意的HTML元素，并在整个页面中更改其位置：\n\n![Drag-and-drop in the Elements panel](1.gif)\n\n###  2. 在控制台中引用当前选定的元素\n\n***\n\n在Elements面板中，选择一个节点，然后输入$0控制台以引用它：\n\n![Reference the currently selected element in the Console](2.gif)\n\n###  3. 使用控制台中最后一个操作的值\n\n***\n\n使用$_引用在控制台执行的前一操作的返回值：\n\n![Use the value of the last operation in the Console](3.gif)\n\n###  4. 添加CSS并编辑元素状态\n\n***\n\n在Elements面板中有2个超级有用的按钮。\n\n第一个可以为你的选择器(selector)增加新的CSS属性：\n\n![Add CSS and edit the element state](4.gif)\n\n第二个可以为你触发选定元素的状态，这样你就可以看到当它处于活动状态(active)，悬停状态(hovered)，焦点状态(focus)等等时应用的样式：\n\n![Add CSS and edit the element state](4.2.png)\n\n###  5. 将修改后的CSS保存到文件\n\n***\n\n点击你编辑的CSS文件的名称，进入到Sources面板，你会发现你的修改已经在里面了。然后你可以对你实时的编辑进行保存。\n\n这个修改不适用于添加的新选择器，也不适用于element.style属性，仅仅适用于原有选择器。\n\n![Save to file the modified CSS](5.gif)\n\n###  6. 截图单个元素\n\n***\n\n选择一个元素，MAC下按cmd+shift+p、windows下按ctrl+shift+p来打开命令菜单，然后输入**Capture node screenshot**：\n\n![Screenshot a single element](6.gif)\n\n###  7. 使用CSS选择器查找元素\n\n***\n\nMAC下按cmd+f、windows下按ctrl+f来打开搜索框\n\n您可以在其中键入任何字符串以匹配源代码，或者也可以使用CSS选择器让Chrome为您生成一个图像：\n\n![Find an element using CSS selectors](7.gif)\n\n###  8. 控制台中的shift和enter\n\n***\n\n要编写跨越控制台多行的命令，请按shift+enter\n\n准备就绪后，在脚本末尾按Enter键即可执行该操作：\n\n![Shift-enter in the Console](8.gif)\n\n###  9. 跳转\n\n***\n\n在Sources面板中：\n\n- cmd+o(windows下ctrl+o) 显示你页面加载的所有文件\n\n- cmd+shift+o(windows下ctrl+shift+o) 显示当前文件中的symbols（属性、函数、类等）\n\n- cmd+o(windows下ctrl+o) 跳转到指定行\n\n准备就绪后，在脚本末尾按Enter键即可执行该操作：\n\n![Go to…](9.png)\n\n###  10. 监听表达式\n\n***\n\n不需要一次又一次地输入一个变量名或者表达式，你只需将他们添加到监视列表中就可以时时观察它们的变化：\n\n![Watch Expression](10.gif)\n\n###  11. XHR/Fetch调试\n\n***\n\n从调试器打开**XHR/Fetch Breakpoints**面板。\n\n你可以针对某一个请求或者请求的关键字设置断点：\n\n![XHR/Fetch debugging](11.png)\n\n###  12. 调试DOM修改\n\n***\n\n右键单击某个DOM元素，并选择Break on下的subtree modifications。这样调试器就可以在脚本遍历到该元素并且要修改它的时候自动停止，以让用户进行调试检查。\n\n![XHR/Fetch debugging](12.png)\n\n###  13. 找到CSS属性定义的位置\n\n***\n\nMAC使用cmd+鼠标左键(windows下使用ctrl+鼠标左键)点击Elements面板中的CSS属性，可以直接帮您定位到Source面板中相应CSS定义的位置：\n\n![Use the value of the last operation in the Console](13.gif)\n\n### 原文链接\n\n***\n\n[https://flaviocopes.com/chrome-devtools-tips/](https://flaviocopes.com/chrome-devtools-tips/)","slug":"【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握","published":1,"updated":"2018-04-20T15:44:49.473Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk698hxz000dznzwm33d9q74","content":"<p>Chrome浏览器提供了一套非常出色的开发者工具来帮助您在Web平台上开发。下面我将介绍13个有趣的技巧，掌握他们对你只有好处。</p>\n<h3 id=\"1-在Elements面板中拖放元素\"><a href=\"#1-在Elements面板中拖放元素\" class=\"headerlink\" title=\"1. 在Elements面板中拖放元素\"></a>1. 在Elements面板中拖放元素</h3><hr>\n<p>在Elements面板中，你可以拖放任意的HTML元素，并在整个页面中更改其位置：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/1.gif\" alt=\"Drag-and-drop in the Elements panel\"></p>\n<h3 id=\"2-在控制台中引用当前选定的元素\"><a href=\"#2-在控制台中引用当前选定的元素\" class=\"headerlink\" title=\"2. 在控制台中引用当前选定的元素\"></a>2. 在控制台中引用当前选定的元素</h3><hr>\n<p>在Elements面板中，选择一个节点，然后输入$0控制台以引用它：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/2.gif\" alt=\"Reference the currently selected element in the Console\"></p>\n<h3 id=\"3-使用控制台中最后一个操作的值\"><a href=\"#3-使用控制台中最后一个操作的值\" class=\"headerlink\" title=\"3. 使用控制台中最后一个操作的值\"></a>3. 使用控制台中最后一个操作的值</h3><hr>\n<p>使用$_引用在控制台执行的前一操作的返回值：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/3.gif\" alt=\"Use the value of the last operation in the Console\"></p>\n<h3 id=\"4-添加CSS并编辑元素状态\"><a href=\"#4-添加CSS并编辑元素状态\" class=\"headerlink\" title=\"4. 添加CSS并编辑元素状态\"></a>4. 添加CSS并编辑元素状态</h3><hr>\n<p>在Elements面板中有2个超级有用的按钮。</p>\n<p>第一个可以为你的选择器(selector)增加新的CSS属性：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/4.gif\" alt=\"Add CSS and edit the element state\"></p>\n<p>第二个可以为你触发选定元素的状态，这样你就可以看到当它处于活动状态(active)，悬停状态(hovered)，焦点状态(focus)等等时应用的样式：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/4.2.png\" alt=\"Add CSS and edit the element state\"></p>\n<h3 id=\"5-将修改后的CSS保存到文件\"><a href=\"#5-将修改后的CSS保存到文件\" class=\"headerlink\" title=\"5. 将修改后的CSS保存到文件\"></a>5. 将修改后的CSS保存到文件</h3><hr>\n<p>点击你编辑的CSS文件的名称，进入到Sources面板，你会发现你的修改已经在里面了。然后你可以对你实时的编辑进行保存。</p>\n<p>这个修改不适用于添加的新选择器，也不适用于element.style属性，仅仅适用于原有选择器。</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/5.gif\" alt=\"Save to file the modified CSS\"></p>\n<h3 id=\"6-截图单个元素\"><a href=\"#6-截图单个元素\" class=\"headerlink\" title=\"6. 截图单个元素\"></a>6. 截图单个元素</h3><hr>\n<p>选择一个元素，MAC下按cmd+shift+p、windows下按ctrl+shift+p来打开命令菜单，然后输入<strong>Capture node screenshot</strong>：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/6.gif\" alt=\"Screenshot a single element\"></p>\n<h3 id=\"7-使用CSS选择器查找元素\"><a href=\"#7-使用CSS选择器查找元素\" class=\"headerlink\" title=\"7. 使用CSS选择器查找元素\"></a>7. 使用CSS选择器查找元素</h3><hr>\n<p>MAC下按cmd+f、windows下按ctrl+f来打开搜索框</p>\n<p>您可以在其中键入任何字符串以匹配源代码，或者也可以使用CSS选择器让Chrome为您生成一个图像：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/7.gif\" alt=\"Find an element using CSS selectors\"></p>\n<h3 id=\"8-控制台中的shift和enter\"><a href=\"#8-控制台中的shift和enter\" class=\"headerlink\" title=\"8. 控制台中的shift和enter\"></a>8. 控制台中的shift和enter</h3><hr>\n<p>要编写跨越控制台多行的命令，请按shift+enter</p>\n<p>准备就绪后，在脚本末尾按Enter键即可执行该操作：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/8.gif\" alt=\"Shift-enter in the Console\"></p>\n<h3 id=\"9-跳转\"><a href=\"#9-跳转\" class=\"headerlink\" title=\"9. 跳转\"></a>9. 跳转</h3><hr>\n<p>在Sources面板中：</p>\n<ul>\n<li><p>cmd+o(windows下ctrl+o) 显示你页面加载的所有文件</p>\n</li>\n<li><p>cmd+shift+o(windows下ctrl+shift+o) 显示当前文件中的symbols（属性、函数、类等）</p>\n</li>\n<li><p>cmd+o(windows下ctrl+o) 跳转到指定行</p>\n</li>\n</ul>\n<p>准备就绪后，在脚本末尾按Enter键即可执行该操作：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/9.png\" alt=\"Go to…\"></p>\n<h3 id=\"10-监听表达式\"><a href=\"#10-监听表达式\" class=\"headerlink\" title=\"10. 监听表达式\"></a>10. 监听表达式</h3><hr>\n<p>不需要一次又一次地输入一个变量名或者表达式，你只需将他们添加到监视列表中就可以时时观察它们的变化：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/10.gif\" alt=\"Watch Expression\"></p>\n<h3 id=\"11-XHR-Fetch调试\"><a href=\"#11-XHR-Fetch调试\" class=\"headerlink\" title=\"11. XHR/Fetch调试\"></a>11. XHR/Fetch调试</h3><hr>\n<p>从调试器打开<strong>XHR/Fetch Breakpoints</strong>面板。</p>\n<p>你可以针对某一个请求或者请求的关键字设置断点：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/11.png\" alt=\"XHR/Fetch debugging\"></p>\n<h3 id=\"12-调试DOM修改\"><a href=\"#12-调试DOM修改\" class=\"headerlink\" title=\"12. 调试DOM修改\"></a>12. 调试DOM修改</h3><hr>\n<p>右键单击某个DOM元素，并选择Break on下的subtree modifications。这样调试器就可以在脚本遍历到该元素并且要修改它的时候自动停止，以让用户进行调试检查。</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/12.png\" alt=\"XHR/Fetch debugging\"></p>\n<h3 id=\"13-找到CSS属性定义的位置\"><a href=\"#13-找到CSS属性定义的位置\" class=\"headerlink\" title=\"13. 找到CSS属性定义的位置\"></a>13. 找到CSS属性定义的位置</h3><hr>\n<p>MAC使用cmd+鼠标左键(windows下使用ctrl+鼠标左键)点击Elements面板中的CSS属性，可以直接帮您定位到Source面板中相应CSS定义的位置：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/13.gif\" alt=\"Use the value of the last operation in the Console\"></p>\n<h3 id=\"原文链接\"><a href=\"#原文链接\" class=\"headerlink\" title=\"原文链接\"></a>原文链接</h3><hr>\n<p><a href=\"https://flaviocopes.com/chrome-devtools-tips/\" target=\"_blank\" rel=\"noopener\">https://flaviocopes.com/chrome-devtools-tips/</a></p>\n","site":{"data":{}},"excerpt":"","more":"<p>Chrome浏览器提供了一套非常出色的开发者工具来帮助您在Web平台上开发。下面我将介绍13个有趣的技巧，掌握他们对你只有好处。</p>\n<h3 id=\"1-在Elements面板中拖放元素\"><a href=\"#1-在Elements面板中拖放元素\" class=\"headerlink\" title=\"1. 在Elements面板中拖放元素\"></a>1. 在Elements面板中拖放元素</h3><hr>\n<p>在Elements面板中，你可以拖放任意的HTML元素，并在整个页面中更改其位置：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/1.gif\" alt=\"Drag-and-drop in the Elements panel\"></p>\n<h3 id=\"2-在控制台中引用当前选定的元素\"><a href=\"#2-在控制台中引用当前选定的元素\" class=\"headerlink\" title=\"2. 在控制台中引用当前选定的元素\"></a>2. 在控制台中引用当前选定的元素</h3><hr>\n<p>在Elements面板中，选择一个节点，然后输入$0控制台以引用它：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/2.gif\" alt=\"Reference the currently selected element in the Console\"></p>\n<h3 id=\"3-使用控制台中最后一个操作的值\"><a href=\"#3-使用控制台中最后一个操作的值\" class=\"headerlink\" title=\"3. 使用控制台中最后一个操作的值\"></a>3. 使用控制台中最后一个操作的值</h3><hr>\n<p>使用$_引用在控制台执行的前一操作的返回值：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/3.gif\" alt=\"Use the value of the last operation in the Console\"></p>\n<h3 id=\"4-添加CSS并编辑元素状态\"><a href=\"#4-添加CSS并编辑元素状态\" class=\"headerlink\" title=\"4. 添加CSS并编辑元素状态\"></a>4. 添加CSS并编辑元素状态</h3><hr>\n<p>在Elements面板中有2个超级有用的按钮。</p>\n<p>第一个可以为你的选择器(selector)增加新的CSS属性：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/4.gif\" alt=\"Add CSS and edit the element state\"></p>\n<p>第二个可以为你触发选定元素的状态，这样你就可以看到当它处于活动状态(active)，悬停状态(hovered)，焦点状态(focus)等等时应用的样式：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/4.2.png\" alt=\"Add CSS and edit the element state\"></p>\n<h3 id=\"5-将修改后的CSS保存到文件\"><a href=\"#5-将修改后的CSS保存到文件\" class=\"headerlink\" title=\"5. 将修改后的CSS保存到文件\"></a>5. 将修改后的CSS保存到文件</h3><hr>\n<p>点击你编辑的CSS文件的名称，进入到Sources面板，你会发现你的修改已经在里面了。然后你可以对你实时的编辑进行保存。</p>\n<p>这个修改不适用于添加的新选择器，也不适用于element.style属性，仅仅适用于原有选择器。</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/5.gif\" alt=\"Save to file the modified CSS\"></p>\n<h3 id=\"6-截图单个元素\"><a href=\"#6-截图单个元素\" class=\"headerlink\" title=\"6. 截图单个元素\"></a>6. 截图单个元素</h3><hr>\n<p>选择一个元素，MAC下按cmd+shift+p、windows下按ctrl+shift+p来打开命令菜单，然后输入<strong>Capture node screenshot</strong>：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/6.gif\" alt=\"Screenshot a single element\"></p>\n<h3 id=\"7-使用CSS选择器查找元素\"><a href=\"#7-使用CSS选择器查找元素\" class=\"headerlink\" title=\"7. 使用CSS选择器查找元素\"></a>7. 使用CSS选择器查找元素</h3><hr>\n<p>MAC下按cmd+f、windows下按ctrl+f来打开搜索框</p>\n<p>您可以在其中键入任何字符串以匹配源代码，或者也可以使用CSS选择器让Chrome为您生成一个图像：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/7.gif\" alt=\"Find an element using CSS selectors\"></p>\n<h3 id=\"8-控制台中的shift和enter\"><a href=\"#8-控制台中的shift和enter\" class=\"headerlink\" title=\"8. 控制台中的shift和enter\"></a>8. 控制台中的shift和enter</h3><hr>\n<p>要编写跨越控制台多行的命令，请按shift+enter</p>\n<p>准备就绪后，在脚本末尾按Enter键即可执行该操作：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/8.gif\" alt=\"Shift-enter in the Console\"></p>\n<h3 id=\"9-跳转\"><a href=\"#9-跳转\" class=\"headerlink\" title=\"9. 跳转\"></a>9. 跳转</h3><hr>\n<p>在Sources面板中：</p>\n<ul>\n<li><p>cmd+o(windows下ctrl+o) 显示你页面加载的所有文件</p>\n</li>\n<li><p>cmd+shift+o(windows下ctrl+shift+o) 显示当前文件中的symbols（属性、函数、类等）</p>\n</li>\n<li><p>cmd+o(windows下ctrl+o) 跳转到指定行</p>\n</li>\n</ul>\n<p>准备就绪后，在脚本末尾按Enter键即可执行该操作：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/9.png\" alt=\"Go to…\"></p>\n<h3 id=\"10-监听表达式\"><a href=\"#10-监听表达式\" class=\"headerlink\" title=\"10. 监听表达式\"></a>10. 监听表达式</h3><hr>\n<p>不需要一次又一次地输入一个变量名或者表达式，你只需将他们添加到监视列表中就可以时时观察它们的变化：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/10.gif\" alt=\"Watch Expression\"></p>\n<h3 id=\"11-XHR-Fetch调试\"><a href=\"#11-XHR-Fetch调试\" class=\"headerlink\" title=\"11. XHR/Fetch调试\"></a>11. XHR/Fetch调试</h3><hr>\n<p>从调试器打开<strong>XHR/Fetch Breakpoints</strong>面板。</p>\n<p>你可以针对某一个请求或者请求的关键字设置断点：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/11.png\" alt=\"XHR/Fetch debugging\"></p>\n<h3 id=\"12-调试DOM修改\"><a href=\"#12-调试DOM修改\" class=\"headerlink\" title=\"12. 调试DOM修改\"></a>12. 调试DOM修改</h3><hr>\n<p>右键单击某个DOM元素，并选择Break on下的subtree modifications。这样调试器就可以在脚本遍历到该元素并且要修改它的时候自动停止，以让用户进行调试检查。</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/12.png\" alt=\"XHR/Fetch debugging\"></p>\n<h3 id=\"13-找到CSS属性定义的位置\"><a href=\"#13-找到CSS属性定义的位置\" class=\"headerlink\" title=\"13. 找到CSS属性定义的位置\"></a>13. 找到CSS属性定义的位置</h3><hr>\n<p>MAC使用cmd+鼠标左键(windows下使用ctrl+鼠标左键)点击Elements面板中的CSS属性，可以直接帮您定位到Source面板中相应CSS定义的位置：</p>\n<p><img src=\"/2018/03/26/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/13.gif\" alt=\"Use the value of the last operation in the Console\"></p>\n<h3 id=\"原文链接\"><a href=\"#原文链接\" class=\"headerlink\" title=\"原文链接\"></a>原文链接</h3><hr>\n<p><a href=\"https://flaviocopes.com/chrome-devtools-tips/\" target=\"_blank\" rel=\"noopener\">https://flaviocopes.com/chrome-devtools-tips/</a></p>\n"},{"title":"仅用1行核心JS代码实现一个轻量级富文本编辑器","date":"2017-11-03T09:01:21.000Z","description":"富文本编辑器是我们在生活中非常常用到的编辑工具，现在有很多功能完备且强大的编辑器，比如Quill Rich Text Editor、ueditor等，都是很优秀的富文本编辑器。甚至说我们每个人都会用到的word，才是最优秀、国民度最高的富文本编辑器。这篇文章使用极少的代码，实现了一个简洁、无任何依赖的轻量级富文本编辑器。","picture":"zEditor.png","_content":"\n## 引子\n\n把[demo](https://tuobaye.com/demo/zEditor/index)放在显眼的位置\n\n***\n\n富文本编辑器是我们在生活中非常常用到的编辑工具，现在有很多功能完备且强大的编辑器，比如[Quill Rich Text Editor](https://github.com/quilljs/quill)、[ueditor](http://ueditor.baidu.com/website/)等，都是很优秀的富文本编辑器。甚至说我们每个人都会用到的word，才是最优秀、国民度最高的富文本编辑器。\n\n今天我们要实现一个轻量级的编辑器，主要利用的是[document.execCommand](https://developer.mozilla.org/zh-CN/docs/Web/API/Document/execCommand)。\n\n> 当一个HTML文档切换到设计模式(designMode)时，文档对象暴露 execCommand方法，该方法允许运行命令来操纵可编辑区域的内容。大多数命令影响文档的选择（粗体，斜体等），而其他命令插入新元素（添加链接）或影响整行（缩进）。当使用 contentEditable时，调用 execCommand() 将影响当前活动的可编辑元素。\n\n用document.execCommand和contentEditable相互配合，就可以实现我们想要实现的功能。\n\n在查阅了execCommand的文档后，我们决定实现以下功能\n\n1. 选中文字样式调整\n    - 斜体\n    - 粗体\n    - 下划线\n    - 删除线\n2. 对齐方式调整\n    - 左对齐\n    - 右对齐\n    - 居中\n    - 两端对齐\n3. 缩进调整\n    - 右缩进\n    - 左缩进\n4. 列表操作\n    - 有序列表\n    - 无序列表\n5. 上下标\n6. 文字操作\n    - 全选\n    - 复制\n    - 粘贴\n7. 基本的字号调整\n8. 基本的颜色调整\n9. 基本的字体调整\n10. undo&redo\n\n## 实现\n\n***\n\n说到编辑器，最基本的会分为上下两部分\n> - 上部分为控制区域，用于对文本进行各种控制修改\n> - 下部分为文本区域，用于输入和展示文本的样式\n\n因此我们可以先在HTML里把两部分简单画出来\n\n{% codeblock lang:html %}\n<div id=\"wrapper\">\n    <div id=\"control-area\"></div>\n    <div id=\"text-area\" contenteditable></div>\n</div>\n{% endcodeblock %}\n\n注意，既然文本区域要可编辑，要加上contenteditable属性，这样就可以自如的在文本区域输入文字了。OK,编辑器雏形已经出来了~\n\n接下来要对两部分分别进行操作，在控制区域，应该就是各种按钮。参考document.execCommand的语法：\n![document.execCommand](execCommand.png)\n\n主要控制到样式的有两个api：aCommandName和aValueArgument。同时，命令名aCommandName每条execCommand都会有，aCommandName和aValueArgument。因此我们需要在每个按钮上传递两个变量。第一个是必填项aCommandName，第二个是选填项aValueArgument。我们考虑采用HTML5的新属性data-*传递这两个参数:\n{% codeblock lang:html %}\n    <!--调整为斜体-->\n    <a href=\"#\" data-command='italic' onclick=\"changeStyle(this.dataset)\">斜体</a>\n    <!--调整字号为1号-->\n    <a href=\"#\" data-command='fontSize' data-value=\"1\" onclick=\"changeStyle(this.dataset)\">1号</a>\n{% endcodeblock %}\n\n上面是两个基本按钮示例，一个是不传参的，一个是传参的，然后在js端做一个判断即可实现功能：\n\n{% codeblock lang:javascript %}\n    const changeStyle = (data) => {\n        //一行核心代码即可实现基本编辑器功能\n        data.value? document.execCommand(data.command, false, data.value):document.execCommand(data.command, false, null)\n    }\n{% endcodeblock %}\n\n是不是很简单呢？\n\n最后，只有两个按钮肯定是不够的，我们要把按钮数和编辑器的功能扩充丰富起来。我们就按照第一节整理的决定要实现的功能列表列出来的功能，按照分类，一一来实现。最后，再把按钮和文本区域的样式美化一下，即可实现我们这个轻量级富文本编辑器啦~\n\n这是我们的预览图：\n![zEditor](zEditor.png)\n\n大家可以访问[我的博客](https://tuobaye.com/demo/zEditor/index)尝试一下这个小小富文本编辑器，也希望能去我的[github项目](https://github.com/tuobaye0711/zEditor)上点颗star,谢谢啦~\n\n顺道贴一个codepen的预览，有些网络可能加载不出来...\n<p data-height=\"744\" data-theme-id=\"dark\" data-slug-hash=\"LOZRaL\" data-default-tab=\"html,result\" data-user=\"tuobaye0711\" data-embed-version=\"2\" data-pen-title=\"zEditor\" class=\"codepen\">See the Pen <a href=\"https://codepen.io/tuobaye0711/pen/LOZRaL/\">zEditor</a> by zhleven (<a href=\"https://codepen.io/tuobaye0711\">@tuobaye0711</a>) on <a href=\"https://codepen.io\">CodePen</a>.</p>\n<script async src=\"https://production-assets.codepen.io/assets/embed/ei.js\"></script>\n\n## 结语\n\n***\n\n实际上，我们这个富文本编辑器是一种最最简单的实现，仅仅是对contentEditable和document.execCommand进行了一层封装，所有的样式实现都是调用的这同一条api。\n\n在当前流行的真正功能强大的富文本编辑器中，基本都是实现了自己的contentEditable，抛弃了对浏览器原生的contentEditable特性的依赖。大家都说富文本编辑器是个天坑，事实也正是如此，原生的document.execCommand实现的功能太少，BUG太多，如果使用自己写的功能来编辑文字，又会破坏contentEditable的undo/redo栈。总之，contentEditable最大的特点就是样式、html语意环境跟调用页面混合在一起，非常容易出现覆盖现象，而牛逼的富文本编辑器基本上都会使用一套自己的事件监听机制来实现类似contentEditable的功能，这些东西太繁琐太复杂，不在这里的讨论范围之内了~","source":"_posts/仅用1行核心JS代码实现一个轻量级富文本编辑器.md","raw":"---\ntitle: 仅用1行核心JS代码实现一个轻量级富文本编辑器\ndate: 2017-11-03 17:01:21\ntags: JavaScript\ndescription: 富文本编辑器是我们在生活中非常常用到的编辑工具，现在有很多功能完备且强大的编辑器，比如Quill Rich Text Editor、ueditor等，都是很优秀的富文本编辑器。甚至说我们每个人都会用到的word，才是最优秀、国民度最高的富文本编辑器。这篇文章使用极少的代码，实现了一个简洁、无任何依赖的轻量级富文本编辑器。\npicture: zEditor.png\n---\n\n## 引子\n\n把[demo](https://tuobaye.com/demo/zEditor/index)放在显眼的位置\n\n***\n\n富文本编辑器是我们在生活中非常常用到的编辑工具，现在有很多功能完备且强大的编辑器，比如[Quill Rich Text Editor](https://github.com/quilljs/quill)、[ueditor](http://ueditor.baidu.com/website/)等，都是很优秀的富文本编辑器。甚至说我们每个人都会用到的word，才是最优秀、国民度最高的富文本编辑器。\n\n今天我们要实现一个轻量级的编辑器，主要利用的是[document.execCommand](https://developer.mozilla.org/zh-CN/docs/Web/API/Document/execCommand)。\n\n> 当一个HTML文档切换到设计模式(designMode)时，文档对象暴露 execCommand方法，该方法允许运行命令来操纵可编辑区域的内容。大多数命令影响文档的选择（粗体，斜体等），而其他命令插入新元素（添加链接）或影响整行（缩进）。当使用 contentEditable时，调用 execCommand() 将影响当前活动的可编辑元素。\n\n用document.execCommand和contentEditable相互配合，就可以实现我们想要实现的功能。\n\n在查阅了execCommand的文档后，我们决定实现以下功能\n\n1. 选中文字样式调整\n    - 斜体\n    - 粗体\n    - 下划线\n    - 删除线\n2. 对齐方式调整\n    - 左对齐\n    - 右对齐\n    - 居中\n    - 两端对齐\n3. 缩进调整\n    - 右缩进\n    - 左缩进\n4. 列表操作\n    - 有序列表\n    - 无序列表\n5. 上下标\n6. 文字操作\n    - 全选\n    - 复制\n    - 粘贴\n7. 基本的字号调整\n8. 基本的颜色调整\n9. 基本的字体调整\n10. undo&redo\n\n## 实现\n\n***\n\n说到编辑器，最基本的会分为上下两部分\n> - 上部分为控制区域，用于对文本进行各种控制修改\n> - 下部分为文本区域，用于输入和展示文本的样式\n\n因此我们可以先在HTML里把两部分简单画出来\n\n{% codeblock lang:html %}\n<div id=\"wrapper\">\n    <div id=\"control-area\"></div>\n    <div id=\"text-area\" contenteditable></div>\n</div>\n{% endcodeblock %}\n\n注意，既然文本区域要可编辑，要加上contenteditable属性，这样就可以自如的在文本区域输入文字了。OK,编辑器雏形已经出来了~\n\n接下来要对两部分分别进行操作，在控制区域，应该就是各种按钮。参考document.execCommand的语法：\n![document.execCommand](execCommand.png)\n\n主要控制到样式的有两个api：aCommandName和aValueArgument。同时，命令名aCommandName每条execCommand都会有，aCommandName和aValueArgument。因此我们需要在每个按钮上传递两个变量。第一个是必填项aCommandName，第二个是选填项aValueArgument。我们考虑采用HTML5的新属性data-*传递这两个参数:\n{% codeblock lang:html %}\n    <!--调整为斜体-->\n    <a href=\"#\" data-command='italic' onclick=\"changeStyle(this.dataset)\">斜体</a>\n    <!--调整字号为1号-->\n    <a href=\"#\" data-command='fontSize' data-value=\"1\" onclick=\"changeStyle(this.dataset)\">1号</a>\n{% endcodeblock %}\n\n上面是两个基本按钮示例，一个是不传参的，一个是传参的，然后在js端做一个判断即可实现功能：\n\n{% codeblock lang:javascript %}\n    const changeStyle = (data) => {\n        //一行核心代码即可实现基本编辑器功能\n        data.value? document.execCommand(data.command, false, data.value):document.execCommand(data.command, false, null)\n    }\n{% endcodeblock %}\n\n是不是很简单呢？\n\n最后，只有两个按钮肯定是不够的，我们要把按钮数和编辑器的功能扩充丰富起来。我们就按照第一节整理的决定要实现的功能列表列出来的功能，按照分类，一一来实现。最后，再把按钮和文本区域的样式美化一下，即可实现我们这个轻量级富文本编辑器啦~\n\n这是我们的预览图：\n![zEditor](zEditor.png)\n\n大家可以访问[我的博客](https://tuobaye.com/demo/zEditor/index)尝试一下这个小小富文本编辑器，也希望能去我的[github项目](https://github.com/tuobaye0711/zEditor)上点颗star,谢谢啦~\n\n顺道贴一个codepen的预览，有些网络可能加载不出来...\n<p data-height=\"744\" data-theme-id=\"dark\" data-slug-hash=\"LOZRaL\" data-default-tab=\"html,result\" data-user=\"tuobaye0711\" data-embed-version=\"2\" data-pen-title=\"zEditor\" class=\"codepen\">See the Pen <a href=\"https://codepen.io/tuobaye0711/pen/LOZRaL/\">zEditor</a> by zhleven (<a href=\"https://codepen.io/tuobaye0711\">@tuobaye0711</a>) on <a href=\"https://codepen.io\">CodePen</a>.</p>\n<script async src=\"https://production-assets.codepen.io/assets/embed/ei.js\"></script>\n\n## 结语\n\n***\n\n实际上，我们这个富文本编辑器是一种最最简单的实现，仅仅是对contentEditable和document.execCommand进行了一层封装，所有的样式实现都是调用的这同一条api。\n\n在当前流行的真正功能强大的富文本编辑器中，基本都是实现了自己的contentEditable，抛弃了对浏览器原生的contentEditable特性的依赖。大家都说富文本编辑器是个天坑，事实也正是如此，原生的document.execCommand实现的功能太少，BUG太多，如果使用自己写的功能来编辑文字，又会破坏contentEditable的undo/redo栈。总之，contentEditable最大的特点就是样式、html语意环境跟调用页面混合在一起，非常容易出现覆盖现象，而牛逼的富文本编辑器基本上都会使用一套自己的事件监听机制来实现类似contentEditable的功能，这些东西太繁琐太复杂，不在这里的讨论范围之内了~","slug":"仅用1行核心JS代码实现一个轻量级富文本编辑器","published":1,"updated":"2018-07-26T02:01:48.471Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk698hy1000fznzwebi9n10o","content":"<h2 id=\"引子\"><a href=\"#引子\" class=\"headerlink\" title=\"引子\"></a>引子</h2><p>把<a href=\"https://tuobaye.com/demo/zEditor/index\" target=\"_blank\" rel=\"noopener\">demo</a>放在显眼的位置</p>\n<hr>\n<p>富文本编辑器是我们在生活中非常常用到的编辑工具，现在有很多功能完备且强大的编辑器，比如<a href=\"https://github.com/quilljs/quill\" target=\"_blank\" rel=\"noopener\">Quill Rich Text Editor</a>、<a href=\"http://ueditor.baidu.com/website/\" target=\"_blank\" rel=\"noopener\">ueditor</a>等，都是很优秀的富文本编辑器。甚至说我们每个人都会用到的word，才是最优秀、国民度最高的富文本编辑器。</p>\n<p>今天我们要实现一个轻量级的编辑器，主要利用的是<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Document/execCommand\" target=\"_blank\" rel=\"noopener\">document.execCommand</a>。</p>\n<blockquote>\n<p>当一个HTML文档切换到设计模式(designMode)时，文档对象暴露 execCommand方法，该方法允许运行命令来操纵可编辑区域的内容。大多数命令影响文档的选择（粗体，斜体等），而其他命令插入新元素（添加链接）或影响整行（缩进）。当使用 contentEditable时，调用 execCommand() 将影响当前活动的可编辑元素。</p>\n</blockquote>\n<p>用document.execCommand和contentEditable相互配合，就可以实现我们想要实现的功能。</p>\n<p>在查阅了execCommand的文档后，我们决定实现以下功能</p>\n<ol>\n<li>选中文字样式调整<ul>\n<li>斜体</li>\n<li>粗体</li>\n<li>下划线</li>\n<li>删除线</li>\n</ul>\n</li>\n<li>对齐方式调整<ul>\n<li>左对齐</li>\n<li>右对齐</li>\n<li>居中</li>\n<li>两端对齐</li>\n</ul>\n</li>\n<li>缩进调整<ul>\n<li>右缩进</li>\n<li>左缩进</li>\n</ul>\n</li>\n<li>列表操作<ul>\n<li>有序列表</li>\n<li>无序列表</li>\n</ul>\n</li>\n<li>上下标</li>\n<li>文字操作<ul>\n<li>全选</li>\n<li>复制</li>\n<li>粘贴</li>\n</ul>\n</li>\n<li>基本的字号调整</li>\n<li>基本的颜色调整</li>\n<li>基本的字体调整</li>\n<li>undo&amp;redo</li>\n</ol>\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><hr>\n<p>说到编辑器，最基本的会分为上下两部分</p>\n<blockquote>\n<ul>\n<li>上部分为控制区域，用于对文本进行各种控制修改</li>\n<li>下部分为文本区域，用于输入和展示文本的样式</li>\n</ul>\n</blockquote>\n<p>因此我们可以先在HTML里把两部分简单画出来</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"wrapper\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"control-area\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"text-area\"</span> <span class=\"attr\">contenteditable</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>注意，既然文本区域要可编辑，要加上contenteditable属性，这样就可以自如的在文本区域输入文字了。OK,编辑器雏形已经出来了~</p>\n<p>接下来要对两部分分别进行操作，在控制区域，应该就是各种按钮。参考document.execCommand的语法：<br><img src=\"/2017/11/03/仅用1行核心JS代码实现一个轻量级富文本编辑器/execCommand.png\" alt=\"document.execCommand\"></p>\n<p>主要控制到样式的有两个api：aCommandName和aValueArgument。同时，命令名aCommandName每条execCommand都会有，aCommandName和aValueArgument。因此我们需要在每个按钮上传递两个变量。第一个是必填项aCommandName，第二个是选填项aValueArgument。我们考虑采用HTML5的新属性data-*传递这两个参数:<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--调整为斜体--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"#\"</span> <span class=\"attr\">data-command</span>=<span class=\"string\">'italic'</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"changeStyle(this.dataset)\"</span>&gt;</span>斜体<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--调整字号为1号--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"#\"</span> <span class=\"attr\">data-command</span>=<span class=\"string\">'fontSize'</span> <span class=\"attr\">data-value</span>=<span class=\"string\">\"1\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"changeStyle(this.dataset)\"</span>&gt;</span>1号<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>上面是两个基本按钮示例，一个是不传参的，一个是传参的，然后在js端做一个判断即可实现功能：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> changeStyle = <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//一行核心代码即可实现基本编辑器功能</span></span><br><span class=\"line\">    data.value? <span class=\"built_in\">document</span>.execCommand(data.command, <span class=\"literal\">false</span>, data.value):<span class=\"built_in\">document</span>.execCommand(data.command, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>是不是很简单呢？</p>\n<p>最后，只有两个按钮肯定是不够的，我们要把按钮数和编辑器的功能扩充丰富起来。我们就按照第一节整理的决定要实现的功能列表列出来的功能，按照分类，一一来实现。最后，再把按钮和文本区域的样式美化一下，即可实现我们这个轻量级富文本编辑器啦~</p>\n<p>这是我们的预览图：<br><img src=\"/2017/11/03/仅用1行核心JS代码实现一个轻量级富文本编辑器/zEditor.png\" alt=\"zEditor\"></p>\n<p>大家可以访问<a href=\"https://tuobaye.com/demo/zEditor/index\" target=\"_blank\" rel=\"noopener\">我的博客</a>尝试一下这个小小富文本编辑器，也希望能去我的<a href=\"https://github.com/tuobaye0711/zEditor\" target=\"_blank\" rel=\"noopener\">github项目</a>上点颗star,谢谢啦~</p>\n<p>顺道贴一个codepen的预览，有些网络可能加载不出来…</p>\n<p></p><p data-height=\"744\" data-theme-id=\"dark\" data-slug-hash=\"LOZRaL\" data-default-tab=\"html,result\" data-user=\"tuobaye0711\" data-embed-version=\"2\" data-pen-title=\"zEditor\" class=\"codepen\">See the Pen <a href=\"https://codepen.io/tuobaye0711/pen/LOZRaL/\" target=\"_blank\" rel=\"noopener\">zEditor</a> by zhleven (<a href=\"https://codepen.io/tuobaye0711\" target=\"_blank\" rel=\"noopener\">@tuobaye0711</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.</p><p></p>\n<script async src=\"https://production-assets.codepen.io/assets/embed/ei.js\"></script>\n\n<h2 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h2><hr>\n<p>实际上，我们这个富文本编辑器是一种最最简单的实现，仅仅是对contentEditable和document.execCommand进行了一层封装，所有的样式实现都是调用的这同一条api。</p>\n<p>在当前流行的真正功能强大的富文本编辑器中，基本都是实现了自己的contentEditable，抛弃了对浏览器原生的contentEditable特性的依赖。大家都说富文本编辑器是个天坑，事实也正是如此，原生的document.execCommand实现的功能太少，BUG太多，如果使用自己写的功能来编辑文字，又会破坏contentEditable的undo/redo栈。总之，contentEditable最大的特点就是样式、html语意环境跟调用页面混合在一起，非常容易出现覆盖现象，而牛逼的富文本编辑器基本上都会使用一套自己的事件监听机制来实现类似contentEditable的功能，这些东西太繁琐太复杂，不在这里的讨论范围之内了~</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"引子\"><a href=\"#引子\" class=\"headerlink\" title=\"引子\"></a>引子</h2><p>把<a href=\"https://tuobaye.com/demo/zEditor/index\" target=\"_blank\" rel=\"noopener\">demo</a>放在显眼的位置</p>\n<hr>\n<p>富文本编辑器是我们在生活中非常常用到的编辑工具，现在有很多功能完备且强大的编辑器，比如<a href=\"https://github.com/quilljs/quill\" target=\"_blank\" rel=\"noopener\">Quill Rich Text Editor</a>、<a href=\"http://ueditor.baidu.com/website/\" target=\"_blank\" rel=\"noopener\">ueditor</a>等，都是很优秀的富文本编辑器。甚至说我们每个人都会用到的word，才是最优秀、国民度最高的富文本编辑器。</p>\n<p>今天我们要实现一个轻量级的编辑器，主要利用的是<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/API/Document/execCommand\" target=\"_blank\" rel=\"noopener\">document.execCommand</a>。</p>\n<blockquote>\n<p>当一个HTML文档切换到设计模式(designMode)时，文档对象暴露 execCommand方法，该方法允许运行命令来操纵可编辑区域的内容。大多数命令影响文档的选择（粗体，斜体等），而其他命令插入新元素（添加链接）或影响整行（缩进）。当使用 contentEditable时，调用 execCommand() 将影响当前活动的可编辑元素。</p>\n</blockquote>\n<p>用document.execCommand和contentEditable相互配合，就可以实现我们想要实现的功能。</p>\n<p>在查阅了execCommand的文档后，我们决定实现以下功能</p>\n<ol>\n<li>选中文字样式调整<ul>\n<li>斜体</li>\n<li>粗体</li>\n<li>下划线</li>\n<li>删除线</li>\n</ul>\n</li>\n<li>对齐方式调整<ul>\n<li>左对齐</li>\n<li>右对齐</li>\n<li>居中</li>\n<li>两端对齐</li>\n</ul>\n</li>\n<li>缩进调整<ul>\n<li>右缩进</li>\n<li>左缩进</li>\n</ul>\n</li>\n<li>列表操作<ul>\n<li>有序列表</li>\n<li>无序列表</li>\n</ul>\n</li>\n<li>上下标</li>\n<li>文字操作<ul>\n<li>全选</li>\n<li>复制</li>\n<li>粘贴</li>\n</ul>\n</li>\n<li>基本的字号调整</li>\n<li>基本的颜色调整</li>\n<li>基本的字体调整</li>\n<li>undo&amp;redo</li>\n</ol>\n<h2 id=\"实现\"><a href=\"#实现\" class=\"headerlink\" title=\"实现\"></a>实现</h2><hr>\n<p>说到编辑器，最基本的会分为上下两部分</p>\n<blockquote>\n<ul>\n<li>上部分为控制区域，用于对文本进行各种控制修改</li>\n<li>下部分为文本区域，用于输入和展示文本的样式</li>\n</ul>\n</blockquote>\n<p>因此我们可以先在HTML里把两部分简单画出来</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"wrapper\"</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"control-area\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"text-area\"</span> <span class=\"attr\">contenteditable</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span><br></pre></td></tr></table></figure>\n<p>注意，既然文本区域要可编辑，要加上contenteditable属性，这样就可以自如的在文本区域输入文字了。OK,编辑器雏形已经出来了~</p>\n<p>接下来要对两部分分别进行操作，在控制区域，应该就是各种按钮。参考document.execCommand的语法：<br><img src=\"/2017/11/03/仅用1行核心JS代码实现一个轻量级富文本编辑器/execCommand.png\" alt=\"document.execCommand\"></p>\n<p>主要控制到样式的有两个api：aCommandName和aValueArgument。同时，命令名aCommandName每条execCommand都会有，aCommandName和aValueArgument。因此我们需要在每个按钮上传递两个变量。第一个是必填项aCommandName，第二个是选填项aValueArgument。我们考虑采用HTML5的新属性data-*传递这两个参数:<br><figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">&lt;!--调整为斜体--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"#\"</span> <span class=\"attr\">data-command</span>=<span class=\"string\">'italic'</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"changeStyle(this.dataset)\"</span>&gt;</span>斜体<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br><span class=\"line\"><span class=\"comment\">&lt;!--调整字号为1号--&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">a</span> <span class=\"attr\">href</span>=<span class=\"string\">\"#\"</span> <span class=\"attr\">data-command</span>=<span class=\"string\">'fontSize'</span> <span class=\"attr\">data-value</span>=<span class=\"string\">\"1\"</span> <span class=\"attr\">onclick</span>=<span class=\"string\">\"changeStyle(this.dataset)\"</span>&gt;</span>1号<span class=\"tag\">&lt;/<span class=\"name\">a</span>&gt;</span></span><br></pre></td></tr></table></figure></p>\n<p>上面是两个基本按钮示例，一个是不传参的，一个是传参的，然后在js端做一个判断即可实现功能：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> changeStyle = <span class=\"function\">(<span class=\"params\">data</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">//一行核心代码即可实现基本编辑器功能</span></span><br><span class=\"line\">    data.value? <span class=\"built_in\">document</span>.execCommand(data.command, <span class=\"literal\">false</span>, data.value):<span class=\"built_in\">document</span>.execCommand(data.command, <span class=\"literal\">false</span>, <span class=\"literal\">null</span>)</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>是不是很简单呢？</p>\n<p>最后，只有两个按钮肯定是不够的，我们要把按钮数和编辑器的功能扩充丰富起来。我们就按照第一节整理的决定要实现的功能列表列出来的功能，按照分类，一一来实现。最后，再把按钮和文本区域的样式美化一下，即可实现我们这个轻量级富文本编辑器啦~</p>\n<p>这是我们的预览图：<br><img src=\"/2017/11/03/仅用1行核心JS代码实现一个轻量级富文本编辑器/zEditor.png\" alt=\"zEditor\"></p>\n<p>大家可以访问<a href=\"https://tuobaye.com/demo/zEditor/index\" target=\"_blank\" rel=\"noopener\">我的博客</a>尝试一下这个小小富文本编辑器，也希望能去我的<a href=\"https://github.com/tuobaye0711/zEditor\" target=\"_blank\" rel=\"noopener\">github项目</a>上点颗star,谢谢啦~</p>\n<p>顺道贴一个codepen的预览，有些网络可能加载不出来…</p>\n<p></p><p data-height=\"744\" data-theme-id=\"dark\" data-slug-hash=\"LOZRaL\" data-default-tab=\"html,result\" data-user=\"tuobaye0711\" data-embed-version=\"2\" data-pen-title=\"zEditor\" class=\"codepen\">See the Pen <a href=\"https://codepen.io/tuobaye0711/pen/LOZRaL/\" target=\"_blank\" rel=\"noopener\">zEditor</a> by zhleven (<a href=\"https://codepen.io/tuobaye0711\" target=\"_blank\" rel=\"noopener\">@tuobaye0711</a>) on <a href=\"https://codepen.io\" target=\"_blank\" rel=\"noopener\">CodePen</a>.</p><p></p>\n<script async src=\"https://production-assets.codepen.io/assets/embed/ei.js\"></script>\n\n<h2 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h2><hr>\n<p>实际上，我们这个富文本编辑器是一种最最简单的实现，仅仅是对contentEditable和document.execCommand进行了一层封装，所有的样式实现都是调用的这同一条api。</p>\n<p>在当前流行的真正功能强大的富文本编辑器中，基本都是实现了自己的contentEditable，抛弃了对浏览器原生的contentEditable特性的依赖。大家都说富文本编辑器是个天坑，事实也正是如此，原生的document.execCommand实现的功能太少，BUG太多，如果使用自己写的功能来编辑文字，又会破坏contentEditable的undo/redo栈。总之，contentEditable最大的特点就是样式、html语意环境跟调用页面混合在一起，非常容易出现覆盖现象，而牛逼的富文本编辑器基本上都会使用一套自己的事件监听机制来实现类似contentEditable的功能，这些东西太繁琐太复杂，不在这里的讨论范围之内了~</p>\n"},{"title":"坚持这件事儿","date":"2017-09-15T13:54:40.000Z","description":"hello, my blog!","picture":"930753.jpg","_content":"  无数次想要开一个博客，把自己学习中的感悟和开发工作中遇到的典型问题记下来，给自己提个醒，也可以给他人做个参考，然而拖延症晚期，一拖再拖，总算还是在17年过去了四分之三的时候下了决心，把这个博客搭起来了。希望自己坚持下去。\n  说起坚持这件事情，前两天同学聚会，毕业都一年多了，大家一起吃个饭很开心。但是大家都说我胖了，胖了。。。说我脸跟吹气球似的，我明明才150好吗？不过这确实让我正视起体重的问题。工作这段时间，工资没见涨多少，体重蹭蹭蹭的增。所以下定决心，狠出了一把血买了台跑步机。女朋友嘲讽我不可能坚持下来的，我觉得我能，我们打了个赌，谁输谁赢只能交给时间咯~\n  不啰嗦了，尽快把博客运转起来，坚持更新，fighting！\n\n![fighting](930753.jpg)","source":"_posts/坚持这件事儿.md","raw":"---\ntitle: 坚持这件事儿\ndate: 2017-09-15 21:54:40\ntags: 随笔\ndescription: hello, my blog!\npicture: 930753.jpg\n---\n  无数次想要开一个博客，把自己学习中的感悟和开发工作中遇到的典型问题记下来，给自己提个醒，也可以给他人做个参考，然而拖延症晚期，一拖再拖，总算还是在17年过去了四分之三的时候下了决心，把这个博客搭起来了。希望自己坚持下去。\n  说起坚持这件事情，前两天同学聚会，毕业都一年多了，大家一起吃个饭很开心。但是大家都说我胖了，胖了。。。说我脸跟吹气球似的，我明明才150好吗？不过这确实让我正视起体重的问题。工作这段时间，工资没见涨多少，体重蹭蹭蹭的增。所以下定决心，狠出了一把血买了台跑步机。女朋友嘲讽我不可能坚持下来的，我觉得我能，我们打了个赌，谁输谁赢只能交给时间咯~\n  不啰嗦了，尽快把博客运转起来，坚持更新，fighting！\n\n![fighting](930753.jpg)","slug":"坚持这件事儿","published":1,"updated":"2018-03-04T15:08:12.821Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk698hy3000hznzwaef9ynsv","content":"<p>  无数次想要开一个博客，把自己学习中的感悟和开发工作中遇到的典型问题记下来，给自己提个醒，也可以给他人做个参考，然而拖延症晚期，一拖再拖，总算还是在17年过去了四分之三的时候下了决心，把这个博客搭起来了。希望自己坚持下去。<br>  说起坚持这件事情，前两天同学聚会，毕业都一年多了，大家一起吃个饭很开心。但是大家都说我胖了，胖了。。。说我脸跟吹气球似的，我明明才150好吗？不过这确实让我正视起体重的问题。工作这段时间，工资没见涨多少，体重蹭蹭蹭的增。所以下定决心，狠出了一把血买了台跑步机。女朋友嘲讽我不可能坚持下来的，我觉得我能，我们打了个赌，谁输谁赢只能交给时间咯~<br>  不啰嗦了，尽快把博客运转起来，坚持更新，fighting！</p>\n<p><img src=\"/2017/09/15/坚持这件事儿/930753.jpg\" alt=\"fighting\"></p>\n","site":{"data":{}},"excerpt":"","more":"<p>  无数次想要开一个博客，把自己学习中的感悟和开发工作中遇到的典型问题记下来，给自己提个醒，也可以给他人做个参考，然而拖延症晚期，一拖再拖，总算还是在17年过去了四分之三的时候下了决心，把这个博客搭起来了。希望自己坚持下去。<br>  说起坚持这件事情，前两天同学聚会，毕业都一年多了，大家一起吃个饭很开心。但是大家都说我胖了，胖了。。。说我脸跟吹气球似的，我明明才150好吗？不过这确实让我正视起体重的问题。工作这段时间，工资没见涨多少，体重蹭蹭蹭的增。所以下定决心，狠出了一把血买了台跑步机。女朋友嘲讽我不可能坚持下来的，我觉得我能，我们打了个赌，谁输谁赢只能交给时间咯~<br>  不啰嗦了，尽快把博客运转起来，坚持更新，fighting！</p>\n<p><img src=\"/2017/09/15/坚持这件事儿/930753.jpg\" alt=\"fighting\"></p>\n"},{"title":"开发环境备份","date":"2018-03-01T11:41:03.000Z","picture":"hello2018.jpg","description":"2018，开工大吉！过完年，从家里跑去1100多公里外去定亲，最近两天才回来。恰逢有个机会，换了台高配的工作站作开发用。由于公司内网的限制，没法直接把旧电脑的东西备份到新电脑上，遂把自己的开发环境备份到个人博客上，记录之，分享之。","_content":"\n# 2018，开工大吉！\n\n![2018，开工大吉](hello2018.jpg)\n\n过完年，从家里跑去1100多公里外去定亲，最近两天才回来。恰逢有个机会，换了台高配的工作站作开发用。由于公司内网的限制，没法直接把旧电脑的东西备份到新电脑上，遂把自己的开发环境备份到个人博客上，记录之，分享之。\n\n***\n\n下面是我的开发环境：\n\n- [Node.js](https://nodejs.org/zh-cn/) 一个基于 Chrome V8 引擎的 JavaScript 运行环境，对于现如今的前端开发者而言几乎是必备的。\n- [Python](https://www.python.org/) 个人爱好。\n- [VS Code](https://code.visualstudio.com/) 主力编辑器，相当好用\n- [WebStorm](https://www.jetbrains.com/webstorm/) 副编辑器，曾经用的比较多，现在已经逐步转向VS Code了。\n- [Sublime Text 3](https://www.sublimetext.com/3) 备用的副编辑器，现在常用来打开文本或者查看日志文件。\n- [PyCharm](https://www.jetbrains.com/pycharm/download/#section=windows) 好用的python开发环境。\n- [Chorme](https://www.google.cn/intl/zh-CN/chrome/?brand=CHBD&gclid=EAIaIQobChMI4qaciMrM2QIVR4uPCh2oYAoXEAAYASAAEgIqpvD_BwE) 怎么能少得了chrome呢？\n- [FireFox](https://www.mozilla.org/en-US/firefox/) 前端开发者常备浏览器之一。\n- [MobaXterm](https://mobaxterm.mobatek.net/) 一款功能强大的SSH客户端。\n- [cmder](http://cmder.net/) windows下最好的命令行工具。\n- [Typora](https://typora.io/) 小巧好用的markdown阅读器、编辑器。\n- [幕布](https://mubu.com/) 一键生成思维导图。\n- [Beyond Compare 4](https://www.scootersoftware.com/download.php) 我最喜欢的代码比较工具。\n- [Everything](https://everything.en.softonic.com/) 体积小但功能强大文件搜索工具。\n- [FastStone Capture](http://www.faststone.org/FSCaptureDetail.htm) 可以满足我全部需求的截图工具。\n- [Git bash](https://git-scm.com/downloads) git工具。\n- [TortoiseSVN](https://tortoisesvn.net/downloads.html) svn工具。\n- [MySQL](https://www.mysql.com/cn/) 本地数据库。\n- [Navicat for MySQL](https://www.navicat.com/en/products/navicat-for-mysql) 本地数据库可视化工具，别说我懒，确实是提高效率...\n- [Q-Dir](https://www.softwareok.com/?seite=Freeware/Q-Dir) 文件四分屏工具，非常方便。\n- [CCleaner](https://www.ccleaner.com/ccleaner) 垃圾清理工具，过段时间运行一次就可以了。\n- [SitemapX](http://cn.sitemapx.com/) 一款网站地图生成工具。\n- [搜狗壁纸](http://bizhi.sogou.com/index.html) 非常好用的自动更换壁纸和桌面整理功能，可惜已经三年多不更新了。\n- [PxCook](http://www.fancynode.com.cn/pxcook) 像素大厨，高效易用的自动标注工具，前端开发神器。\n\n***\n\n以后若有新增工具，会持续更新~\n\n","source":"_posts/开发环境备份.md","raw":"---\ntitle: 开发环境备份\ndate: 2018-03-01 19:41:03\ntags: 拾遗\npicture: hello2018.jpg\ndescription: 2018，开工大吉！过完年，从家里跑去1100多公里外去定亲，最近两天才回来。恰逢有个机会，换了台高配的工作站作开发用。由于公司内网的限制，没法直接把旧电脑的东西备份到新电脑上，遂把自己的开发环境备份到个人博客上，记录之，分享之。\n---\n\n# 2018，开工大吉！\n\n![2018，开工大吉](hello2018.jpg)\n\n过完年，从家里跑去1100多公里外去定亲，最近两天才回来。恰逢有个机会，换了台高配的工作站作开发用。由于公司内网的限制，没法直接把旧电脑的东西备份到新电脑上，遂把自己的开发环境备份到个人博客上，记录之，分享之。\n\n***\n\n下面是我的开发环境：\n\n- [Node.js](https://nodejs.org/zh-cn/) 一个基于 Chrome V8 引擎的 JavaScript 运行环境，对于现如今的前端开发者而言几乎是必备的。\n- [Python](https://www.python.org/) 个人爱好。\n- [VS Code](https://code.visualstudio.com/) 主力编辑器，相当好用\n- [WebStorm](https://www.jetbrains.com/webstorm/) 副编辑器，曾经用的比较多，现在已经逐步转向VS Code了。\n- [Sublime Text 3](https://www.sublimetext.com/3) 备用的副编辑器，现在常用来打开文本或者查看日志文件。\n- [PyCharm](https://www.jetbrains.com/pycharm/download/#section=windows) 好用的python开发环境。\n- [Chorme](https://www.google.cn/intl/zh-CN/chrome/?brand=CHBD&gclid=EAIaIQobChMI4qaciMrM2QIVR4uPCh2oYAoXEAAYASAAEgIqpvD_BwE) 怎么能少得了chrome呢？\n- [FireFox](https://www.mozilla.org/en-US/firefox/) 前端开发者常备浏览器之一。\n- [MobaXterm](https://mobaxterm.mobatek.net/) 一款功能强大的SSH客户端。\n- [cmder](http://cmder.net/) windows下最好的命令行工具。\n- [Typora](https://typora.io/) 小巧好用的markdown阅读器、编辑器。\n- [幕布](https://mubu.com/) 一键生成思维导图。\n- [Beyond Compare 4](https://www.scootersoftware.com/download.php) 我最喜欢的代码比较工具。\n- [Everything](https://everything.en.softonic.com/) 体积小但功能强大文件搜索工具。\n- [FastStone Capture](http://www.faststone.org/FSCaptureDetail.htm) 可以满足我全部需求的截图工具。\n- [Git bash](https://git-scm.com/downloads) git工具。\n- [TortoiseSVN](https://tortoisesvn.net/downloads.html) svn工具。\n- [MySQL](https://www.mysql.com/cn/) 本地数据库。\n- [Navicat for MySQL](https://www.navicat.com/en/products/navicat-for-mysql) 本地数据库可视化工具，别说我懒，确实是提高效率...\n- [Q-Dir](https://www.softwareok.com/?seite=Freeware/Q-Dir) 文件四分屏工具，非常方便。\n- [CCleaner](https://www.ccleaner.com/ccleaner) 垃圾清理工具，过段时间运行一次就可以了。\n- [SitemapX](http://cn.sitemapx.com/) 一款网站地图生成工具。\n- [搜狗壁纸](http://bizhi.sogou.com/index.html) 非常好用的自动更换壁纸和桌面整理功能，可惜已经三年多不更新了。\n- [PxCook](http://www.fancynode.com.cn/pxcook) 像素大厨，高效易用的自动标注工具，前端开发神器。\n\n***\n\n以后若有新增工具，会持续更新~\n\n","slug":"开发环境备份","published":1,"updated":"2018-03-04T15:08:12.823Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk698hy6000kznzw11c744h8","content":"<h1 id=\"2018，开工大吉！\"><a href=\"#2018，开工大吉！\" class=\"headerlink\" title=\"2018，开工大吉！\"></a>2018，开工大吉！</h1><p><img src=\"/2018/03/01/开发环境备份/hello2018.jpg\" alt=\"2018，开工大吉\"></p>\n<p>过完年，从家里跑去1100多公里外去定亲，最近两天才回来。恰逢有个机会，换了台高配的工作站作开发用。由于公司内网的限制，没法直接把旧电脑的东西备份到新电脑上，遂把自己的开发环境备份到个人博客上，记录之，分享之。</p>\n<hr>\n<p>下面是我的开发环境：</p>\n<ul>\n<li><a href=\"https://nodejs.org/zh-cn/\" target=\"_blank\" rel=\"noopener\">Node.js</a> 一个基于 Chrome V8 引擎的 JavaScript 运行环境，对于现如今的前端开发者而言几乎是必备的。</li>\n<li><a href=\"https://www.python.org/\" target=\"_blank\" rel=\"noopener\">Python</a> 个人爱好。</li>\n<li><a href=\"https://code.visualstudio.com/\" target=\"_blank\" rel=\"noopener\">VS Code</a> 主力编辑器，相当好用</li>\n<li><a href=\"https://www.jetbrains.com/webstorm/\" target=\"_blank\" rel=\"noopener\">WebStorm</a> 副编辑器，曾经用的比较多，现在已经逐步转向VS Code了。</li>\n<li><a href=\"https://www.sublimetext.com/3\" target=\"_blank\" rel=\"noopener\">Sublime Text 3</a> 备用的副编辑器，现在常用来打开文本或者查看日志文件。</li>\n<li><a href=\"https://www.jetbrains.com/pycharm/download/#section=windows\" target=\"_blank\" rel=\"noopener\">PyCharm</a> 好用的python开发环境。</li>\n<li><a href=\"https://www.google.cn/intl/zh-CN/chrome/?brand=CHBD&amp;gclid=EAIaIQobChMI4qaciMrM2QIVR4uPCh2oYAoXEAAYASAAEgIqpvD_BwE\" target=\"_blank\" rel=\"noopener\">Chorme</a> 怎么能少得了chrome呢？</li>\n<li><a href=\"https://www.mozilla.org/en-US/firefox/\" target=\"_blank\" rel=\"noopener\">FireFox</a> 前端开发者常备浏览器之一。</li>\n<li><a href=\"https://mobaxterm.mobatek.net/\" target=\"_blank\" rel=\"noopener\">MobaXterm</a> 一款功能强大的SSH客户端。</li>\n<li><a href=\"http://cmder.net/\" target=\"_blank\" rel=\"noopener\">cmder</a> windows下最好的命令行工具。</li>\n<li><a href=\"https://typora.io/\" target=\"_blank\" rel=\"noopener\">Typora</a> 小巧好用的markdown阅读器、编辑器。</li>\n<li><a href=\"https://mubu.com/\" target=\"_blank\" rel=\"noopener\">幕布</a> 一键生成思维导图。</li>\n<li><a href=\"https://www.scootersoftware.com/download.php\" target=\"_blank\" rel=\"noopener\">Beyond Compare 4</a> 我最喜欢的代码比较工具。</li>\n<li><a href=\"https://everything.en.softonic.com/\" target=\"_blank\" rel=\"noopener\">Everything</a> 体积小但功能强大文件搜索工具。</li>\n<li><a href=\"http://www.faststone.org/FSCaptureDetail.htm\" target=\"_blank\" rel=\"noopener\">FastStone Capture</a> 可以满足我全部需求的截图工具。</li>\n<li><a href=\"https://git-scm.com/downloads\" target=\"_blank\" rel=\"noopener\">Git bash</a> git工具。</li>\n<li><a href=\"https://tortoisesvn.net/downloads.html\" target=\"_blank\" rel=\"noopener\">TortoiseSVN</a> svn工具。</li>\n<li><a href=\"https://www.mysql.com/cn/\" target=\"_blank\" rel=\"noopener\">MySQL</a> 本地数据库。</li>\n<li><a href=\"https://www.navicat.com/en/products/navicat-for-mysql\" target=\"_blank\" rel=\"noopener\">Navicat for MySQL</a> 本地数据库可视化工具，别说我懒，确实是提高效率…</li>\n<li><a href=\"https://www.softwareok.com/?seite=Freeware/Q-Dir\" target=\"_blank\" rel=\"noopener\">Q-Dir</a> 文件四分屏工具，非常方便。</li>\n<li><a href=\"https://www.ccleaner.com/ccleaner\" target=\"_blank\" rel=\"noopener\">CCleaner</a> 垃圾清理工具，过段时间运行一次就可以了。</li>\n<li><a href=\"http://cn.sitemapx.com/\" target=\"_blank\" rel=\"noopener\">SitemapX</a> 一款网站地图生成工具。</li>\n<li><a href=\"http://bizhi.sogou.com/index.html\" target=\"_blank\" rel=\"noopener\">搜狗壁纸</a> 非常好用的自动更换壁纸和桌面整理功能，可惜已经三年多不更新了。</li>\n<li><a href=\"http://www.fancynode.com.cn/pxcook\" target=\"_blank\" rel=\"noopener\">PxCook</a> 像素大厨，高效易用的自动标注工具，前端开发神器。</li>\n</ul>\n<hr>\n<p>以后若有新增工具，会持续更新~</p>\n","site":{"data":{}},"excerpt":"","more":"<h1 id=\"2018，开工大吉！\"><a href=\"#2018，开工大吉！\" class=\"headerlink\" title=\"2018，开工大吉！\"></a>2018，开工大吉！</h1><p><img src=\"/2018/03/01/开发环境备份/hello2018.jpg\" alt=\"2018，开工大吉\"></p>\n<p>过完年，从家里跑去1100多公里外去定亲，最近两天才回来。恰逢有个机会，换了台高配的工作站作开发用。由于公司内网的限制，没法直接把旧电脑的东西备份到新电脑上，遂把自己的开发环境备份到个人博客上，记录之，分享之。</p>\n<hr>\n<p>下面是我的开发环境：</p>\n<ul>\n<li><a href=\"https://nodejs.org/zh-cn/\" target=\"_blank\" rel=\"noopener\">Node.js</a> 一个基于 Chrome V8 引擎的 JavaScript 运行环境，对于现如今的前端开发者而言几乎是必备的。</li>\n<li><a href=\"https://www.python.org/\" target=\"_blank\" rel=\"noopener\">Python</a> 个人爱好。</li>\n<li><a href=\"https://code.visualstudio.com/\" target=\"_blank\" rel=\"noopener\">VS Code</a> 主力编辑器，相当好用</li>\n<li><a href=\"https://www.jetbrains.com/webstorm/\" target=\"_blank\" rel=\"noopener\">WebStorm</a> 副编辑器，曾经用的比较多，现在已经逐步转向VS Code了。</li>\n<li><a href=\"https://www.sublimetext.com/3\" target=\"_blank\" rel=\"noopener\">Sublime Text 3</a> 备用的副编辑器，现在常用来打开文本或者查看日志文件。</li>\n<li><a href=\"https://www.jetbrains.com/pycharm/download/#section=windows\" target=\"_blank\" rel=\"noopener\">PyCharm</a> 好用的python开发环境。</li>\n<li><a href=\"https://www.google.cn/intl/zh-CN/chrome/?brand=CHBD&amp;gclid=EAIaIQobChMI4qaciMrM2QIVR4uPCh2oYAoXEAAYASAAEgIqpvD_BwE\" target=\"_blank\" rel=\"noopener\">Chorme</a> 怎么能少得了chrome呢？</li>\n<li><a href=\"https://www.mozilla.org/en-US/firefox/\" target=\"_blank\" rel=\"noopener\">FireFox</a> 前端开发者常备浏览器之一。</li>\n<li><a href=\"https://mobaxterm.mobatek.net/\" target=\"_blank\" rel=\"noopener\">MobaXterm</a> 一款功能强大的SSH客户端。</li>\n<li><a href=\"http://cmder.net/\" target=\"_blank\" rel=\"noopener\">cmder</a> windows下最好的命令行工具。</li>\n<li><a href=\"https://typora.io/\" target=\"_blank\" rel=\"noopener\">Typora</a> 小巧好用的markdown阅读器、编辑器。</li>\n<li><a href=\"https://mubu.com/\" target=\"_blank\" rel=\"noopener\">幕布</a> 一键生成思维导图。</li>\n<li><a href=\"https://www.scootersoftware.com/download.php\" target=\"_blank\" rel=\"noopener\">Beyond Compare 4</a> 我最喜欢的代码比较工具。</li>\n<li><a href=\"https://everything.en.softonic.com/\" target=\"_blank\" rel=\"noopener\">Everything</a> 体积小但功能强大文件搜索工具。</li>\n<li><a href=\"http://www.faststone.org/FSCaptureDetail.htm\" target=\"_blank\" rel=\"noopener\">FastStone Capture</a> 可以满足我全部需求的截图工具。</li>\n<li><a href=\"https://git-scm.com/downloads\" target=\"_blank\" rel=\"noopener\">Git bash</a> git工具。</li>\n<li><a href=\"https://tortoisesvn.net/downloads.html\" target=\"_blank\" rel=\"noopener\">TortoiseSVN</a> svn工具。</li>\n<li><a href=\"https://www.mysql.com/cn/\" target=\"_blank\" rel=\"noopener\">MySQL</a> 本地数据库。</li>\n<li><a href=\"https://www.navicat.com/en/products/navicat-for-mysql\" target=\"_blank\" rel=\"noopener\">Navicat for MySQL</a> 本地数据库可视化工具，别说我懒，确实是提高效率…</li>\n<li><a href=\"https://www.softwareok.com/?seite=Freeware/Q-Dir\" target=\"_blank\" rel=\"noopener\">Q-Dir</a> 文件四分屏工具，非常方便。</li>\n<li><a href=\"https://www.ccleaner.com/ccleaner\" target=\"_blank\" rel=\"noopener\">CCleaner</a> 垃圾清理工具，过段时间运行一次就可以了。</li>\n<li><a href=\"http://cn.sitemapx.com/\" target=\"_blank\" rel=\"noopener\">SitemapX</a> 一款网站地图生成工具。</li>\n<li><a href=\"http://bizhi.sogou.com/index.html\" target=\"_blank\" rel=\"noopener\">搜狗壁纸</a> 非常好用的自动更换壁纸和桌面整理功能，可惜已经三年多不更新了。</li>\n<li><a href=\"http://www.fancynode.com.cn/pxcook\" target=\"_blank\" rel=\"noopener\">PxCook</a> 像素大厨，高效易用的自动标注工具，前端开发神器。</li>\n</ul>\n<hr>\n<p>以后若有新增工具，会持续更新~</p>\n"},{"title":"基于RBAC的分权分域用户权限系统数据库设计","date":"2018-02-12T08:02:24.000Z","description":"最近要开发一个新的系统，系统里面可以有许多不同的社区，每个社区下面有不同的项目。项目和项目、社区和社区之间都是相互独立的。我所做的工作是设计一套权限管理系统，这套系统允许不同的用户在不同的社区或者项目之中有不同的权限，可以保证用户无法做出越权的操作。","picture":"分权分域数据库设计.png","_content":"\n## 引子\n\n***\n\n最近要开发一个新的系统，系统里面可以有许多不同的社区，每个社区下面有不同的项目。项目和项目、社区和社区之间都是相互独立的。我所做的工作是设计一套权限管理系统，这套系统允许不同的用户在不同的社区或者项目之中有不同的权限，可以保证用户无法做出越权的操作。\n\n经过了一番努力，设计出了一套基于RBAC的分权分域的用户权限系统。\n\n首先介绍一下什么是RBAC:\n\n> 以角色为基础的访问控制（英语：Role-based access control, RBAC），是资讯安全领域中，一种较新且广为使用的访问控制机制，其不同于强制访问控制以及自由选定访问控制直接赋予使用者权限，而是将权限赋予角色。1996年，莱威·桑度（Ravi Sandhu）等人在前人的理论基础上，提出以角色为基础的访问控制模型，故该模型又被称为RBAC96。之后，美国国家标准局重新定义了以角色为基础的访问控制模型，并将之纳为一种标准，称之为NIST RBAC。\n> 以角色为基础的访问控制模型是一套较强制访问控制以及自由选定访问控制更为中性且更具灵活性的访问控制技术。\n\n在一个组织中，会因为不同的作业功能产生不同的角色，执行某项操作的权限会被赋予特定的角色。组织成员或者工作人员（抑或其它系统用户）则被赋予不同的角色，这些用户通过被赋予角色来取得执行某项计算机系统功能的权限。\n\n- S = 主体 = 一名使用者或自动代理人\n- R = 角色 = 被定义为一个授权等级的工作职位或职称\n- P = 权限 = 一种存取资源的方式\n- SE = 会期 = S，R或P之间的映射关系\n- SA = 主体指派\n- PA = 权限指派\n- RH = 角色阶层。能被表示为：≥（x ≥ y 代表 x 继承 y 的权限）\n- 一个主体可对应多个角色。\n- 一个角色可对应多个主体。\n- 一个角色可拥有多个权限。\n- 一种权限可被分配给许多个角色。\n- 一个角色可以有专属于自己的权限。\n\n## 数据库结构设计\n\n***\n\n项目使用的mysql数据库，设计表格的大体结构如下：\n\n![数据库结构设计](分权分域数据库设计.png)\n\n蓝底模块为**基本表**，黄底模块为**关系表**。\n\n基本表有\n\n- t_user\n- t_role\n- t_permission\n- t_operation\n\n关系表有\n\n- t_user_role_community\n- t_user_role_project\n- t_role_permission\n- t_permission_operation\n\n权限判断的主要思路是根据用户传过来的社区ID/项目ID+用户ID+发起的请求路径，通过多表联查，来确定用户在对应的社区/项目内所对应的角色是否具有权限执行响应请求的操作。\n\n由于在域方面，有社区和项目两个尺度，其中社区包含项目。但是由于一些其他原因，在社区表中无法表示出与项目的从属关系，只能把t_user_role表复用，分身成两张表：t_user_role_community和t_user_role_project。\n\n由于我们的鉴权系统整个流程都是一对多的关系，即一个用户可能对应多个角色，一个角色可能对应多种权限，一种权限又能对应多种操作。因此，一个用户能对应N多种操作，同时，由于中间的多重映射关系，一个用户对某个操作可能会对应多次。\n\n我们采用多表联查的方式，输入项为用户+操作（操作具体表示为request的method+url），使用如下SQL语句进行查询，只要查询结果不为空，即证明用户有相应的操作权限：\n\n{% codeblock lang:sql %}\nSELECT\n    *\nFROM\n    t_user_role_community\nINNER JOIN t_role_permission\nINNER JOIN t_permission_operation ON t_user_role_community.strRole = t_role_permission.strRole\nAND t_role_permission.nPermission = t_permission_operation.nPermission\nWHERE\n    nUser = 10025\nAND nCommunity = 1\nAND strMethod = 'get'\nAND strUrl = '/api/t_service'\n{% endcodeblock %}\n\n这样做实际上只查询了社区线的权限，此外还有项目线的权限以及非社区非项目线的权限（例如个人中心、系统管理之类的，我们把这部分的域直接设置为nCommunity=0，即项目编号为0），想要覆盖所有的域，我们相当于要同时多表联查三次，只要其中任意一次能够查到数据，则表明用户有执行该操作的权限。我们可以用UNION语句来实现：\n\n{% codeblock lang:sql %}\n(SELECT\n    *\nFROM\n    t_user_role_community\nINNER JOIN t_role_permission\nINNER JOIN t_permission_operation ON t_user_role_community.strRole = t_role_permission.strRole\nAND t_role_permission.nPermission = t_permission_operation.nPermission\nWHERE\n    nUser = 10025\nAND (nCommunity = 0 OR nCommunity = 0)\nAND strMethod = 'get'\nAND strUrl = '/api/t_service')\nUNION\n(SELECT\n    *\nFROM\n    t_user_role_project\nINNER JOIN t_role_permission\nINNER JOIN t_permission_operation ON t_user_role_project.strRole = t_role_permission.strRole\nAND t_role_permission.nPermission = t_permission_operation.nPermission\nWHERE\n    nUser = 10025\nAND nProject = 0\nAND strMethod = 'get'\nAND strUrl = '/api/t_service')\n{% endcodeblock %}\n\n好啦，这就实现了一个相对完整的分权分域的系统啦~\n\n## 结语\n\n***\n\n整个鉴权过程是放在后台以中间件的形式存在的。所有发送的请求都要经过鉴权中间件才能继续往后走下去。\n\n因此，除了在数据库层面进行设计以外，还要在后台代码进行一些必要性的优化。比如说有一类操作的对应权限是通用权限，这类接口占所有接口的一半以上。因此在鉴权中间件我会先判断一步是否为通用权限，若是则跳过接下来的鉴权，直接判过；不是的话再按照既定流程继续鉴权。\n\n也可以在鉴权层增加日志打印，把所有经过鉴权的请求记录在案，以便日后追踪。\n\n写到这里突然发现，我这个前端，越做越往后了...","source":"_posts/基于RBAC的分权分域用户权限系统数据库设计.md","raw":"---\ntitle: 基于RBAC的分权分域用户权限系统数据库设计\ndate: 2018-02-12 16:02:24\ntags: [mysql,技术杂谈]\ndescription: 最近要开发一个新的系统，系统里面可以有许多不同的社区，每个社区下面有不同的项目。项目和项目、社区和社区之间都是相互独立的。我所做的工作是设计一套权限管理系统，这套系统允许不同的用户在不同的社区或者项目之中有不同的权限，可以保证用户无法做出越权的操作。\npicture: 分权分域数据库设计.png\n---\n\n## 引子\n\n***\n\n最近要开发一个新的系统，系统里面可以有许多不同的社区，每个社区下面有不同的项目。项目和项目、社区和社区之间都是相互独立的。我所做的工作是设计一套权限管理系统，这套系统允许不同的用户在不同的社区或者项目之中有不同的权限，可以保证用户无法做出越权的操作。\n\n经过了一番努力，设计出了一套基于RBAC的分权分域的用户权限系统。\n\n首先介绍一下什么是RBAC:\n\n> 以角色为基础的访问控制（英语：Role-based access control, RBAC），是资讯安全领域中，一种较新且广为使用的访问控制机制，其不同于强制访问控制以及自由选定访问控制直接赋予使用者权限，而是将权限赋予角色。1996年，莱威·桑度（Ravi Sandhu）等人在前人的理论基础上，提出以角色为基础的访问控制模型，故该模型又被称为RBAC96。之后，美国国家标准局重新定义了以角色为基础的访问控制模型，并将之纳为一种标准，称之为NIST RBAC。\n> 以角色为基础的访问控制模型是一套较强制访问控制以及自由选定访问控制更为中性且更具灵活性的访问控制技术。\n\n在一个组织中，会因为不同的作业功能产生不同的角色，执行某项操作的权限会被赋予特定的角色。组织成员或者工作人员（抑或其它系统用户）则被赋予不同的角色，这些用户通过被赋予角色来取得执行某项计算机系统功能的权限。\n\n- S = 主体 = 一名使用者或自动代理人\n- R = 角色 = 被定义为一个授权等级的工作职位或职称\n- P = 权限 = 一种存取资源的方式\n- SE = 会期 = S，R或P之间的映射关系\n- SA = 主体指派\n- PA = 权限指派\n- RH = 角色阶层。能被表示为：≥（x ≥ y 代表 x 继承 y 的权限）\n- 一个主体可对应多个角色。\n- 一个角色可对应多个主体。\n- 一个角色可拥有多个权限。\n- 一种权限可被分配给许多个角色。\n- 一个角色可以有专属于自己的权限。\n\n## 数据库结构设计\n\n***\n\n项目使用的mysql数据库，设计表格的大体结构如下：\n\n![数据库结构设计](分权分域数据库设计.png)\n\n蓝底模块为**基本表**，黄底模块为**关系表**。\n\n基本表有\n\n- t_user\n- t_role\n- t_permission\n- t_operation\n\n关系表有\n\n- t_user_role_community\n- t_user_role_project\n- t_role_permission\n- t_permission_operation\n\n权限判断的主要思路是根据用户传过来的社区ID/项目ID+用户ID+发起的请求路径，通过多表联查，来确定用户在对应的社区/项目内所对应的角色是否具有权限执行响应请求的操作。\n\n由于在域方面，有社区和项目两个尺度，其中社区包含项目。但是由于一些其他原因，在社区表中无法表示出与项目的从属关系，只能把t_user_role表复用，分身成两张表：t_user_role_community和t_user_role_project。\n\n由于我们的鉴权系统整个流程都是一对多的关系，即一个用户可能对应多个角色，一个角色可能对应多种权限，一种权限又能对应多种操作。因此，一个用户能对应N多种操作，同时，由于中间的多重映射关系，一个用户对某个操作可能会对应多次。\n\n我们采用多表联查的方式，输入项为用户+操作（操作具体表示为request的method+url），使用如下SQL语句进行查询，只要查询结果不为空，即证明用户有相应的操作权限：\n\n{% codeblock lang:sql %}\nSELECT\n    *\nFROM\n    t_user_role_community\nINNER JOIN t_role_permission\nINNER JOIN t_permission_operation ON t_user_role_community.strRole = t_role_permission.strRole\nAND t_role_permission.nPermission = t_permission_operation.nPermission\nWHERE\n    nUser = 10025\nAND nCommunity = 1\nAND strMethod = 'get'\nAND strUrl = '/api/t_service'\n{% endcodeblock %}\n\n这样做实际上只查询了社区线的权限，此外还有项目线的权限以及非社区非项目线的权限（例如个人中心、系统管理之类的，我们把这部分的域直接设置为nCommunity=0，即项目编号为0），想要覆盖所有的域，我们相当于要同时多表联查三次，只要其中任意一次能够查到数据，则表明用户有执行该操作的权限。我们可以用UNION语句来实现：\n\n{% codeblock lang:sql %}\n(SELECT\n    *\nFROM\n    t_user_role_community\nINNER JOIN t_role_permission\nINNER JOIN t_permission_operation ON t_user_role_community.strRole = t_role_permission.strRole\nAND t_role_permission.nPermission = t_permission_operation.nPermission\nWHERE\n    nUser = 10025\nAND (nCommunity = 0 OR nCommunity = 0)\nAND strMethod = 'get'\nAND strUrl = '/api/t_service')\nUNION\n(SELECT\n    *\nFROM\n    t_user_role_project\nINNER JOIN t_role_permission\nINNER JOIN t_permission_operation ON t_user_role_project.strRole = t_role_permission.strRole\nAND t_role_permission.nPermission = t_permission_operation.nPermission\nWHERE\n    nUser = 10025\nAND nProject = 0\nAND strMethod = 'get'\nAND strUrl = '/api/t_service')\n{% endcodeblock %}\n\n好啦，这就实现了一个相对完整的分权分域的系统啦~\n\n## 结语\n\n***\n\n整个鉴权过程是放在后台以中间件的形式存在的。所有发送的请求都要经过鉴权中间件才能继续往后走下去。\n\n因此，除了在数据库层面进行设计以外，还要在后台代码进行一些必要性的优化。比如说有一类操作的对应权限是通用权限，这类接口占所有接口的一半以上。因此在鉴权中间件我会先判断一步是否为通用权限，若是则跳过接下来的鉴权，直接判过；不是的话再按照既定流程继续鉴权。\n\n也可以在鉴权层增加日志打印，把所有经过鉴权的请求记录在案，以便日后追踪。\n\n写到这里突然发现，我这个前端，越做越往后了...","slug":"基于RBAC的分权分域用户权限系统数据库设计","published":1,"updated":"2018-03-04T15:08:12.823Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk698hy7000lznzwgpp15ipj","content":"<h2 id=\"引子\"><a href=\"#引子\" class=\"headerlink\" title=\"引子\"></a>引子</h2><hr>\n<p>最近要开发一个新的系统，系统里面可以有许多不同的社区，每个社区下面有不同的项目。项目和项目、社区和社区之间都是相互独立的。我所做的工作是设计一套权限管理系统，这套系统允许不同的用户在不同的社区或者项目之中有不同的权限，可以保证用户无法做出越权的操作。</p>\n<p>经过了一番努力，设计出了一套基于RBAC的分权分域的用户权限系统。</p>\n<p>首先介绍一下什么是RBAC:</p>\n<blockquote>\n<p>以角色为基础的访问控制（英语：Role-based access control, RBAC），是资讯安全领域中，一种较新且广为使用的访问控制机制，其不同于强制访问控制以及自由选定访问控制直接赋予使用者权限，而是将权限赋予角色。1996年，莱威·桑度（Ravi Sandhu）等人在前人的理论基础上，提出以角色为基础的访问控制模型，故该模型又被称为RBAC96。之后，美国国家标准局重新定义了以角色为基础的访问控制模型，并将之纳为一种标准，称之为NIST RBAC。<br>以角色为基础的访问控制模型是一套较强制访问控制以及自由选定访问控制更为中性且更具灵活性的访问控制技术。</p>\n</blockquote>\n<p>在一个组织中，会因为不同的作业功能产生不同的角色，执行某项操作的权限会被赋予特定的角色。组织成员或者工作人员（抑或其它系统用户）则被赋予不同的角色，这些用户通过被赋予角色来取得执行某项计算机系统功能的权限。</p>\n<ul>\n<li>S = 主体 = 一名使用者或自动代理人</li>\n<li>R = 角色 = 被定义为一个授权等级的工作职位或职称</li>\n<li>P = 权限 = 一种存取资源的方式</li>\n<li>SE = 会期 = S，R或P之间的映射关系</li>\n<li>SA = 主体指派</li>\n<li>PA = 权限指派</li>\n<li>RH = 角色阶层。能被表示为：≥（x ≥ y 代表 x 继承 y 的权限）</li>\n<li>一个主体可对应多个角色。</li>\n<li>一个角色可对应多个主体。</li>\n<li>一个角色可拥有多个权限。</li>\n<li>一种权限可被分配给许多个角色。</li>\n<li>一个角色可以有专属于自己的权限。</li>\n</ul>\n<h2 id=\"数据库结构设计\"><a href=\"#数据库结构设计\" class=\"headerlink\" title=\"数据库结构设计\"></a>数据库结构设计</h2><hr>\n<p>项目使用的mysql数据库，设计表格的大体结构如下：</p>\n<p><img src=\"/2018/02/12/基于RBAC的分权分域用户权限系统数据库设计/分权分域数据库设计.png\" alt=\"数据库结构设计\"></p>\n<p>蓝底模块为<strong>基本表</strong>，黄底模块为<strong>关系表</strong>。</p>\n<p>基本表有</p>\n<ul>\n<li>t_user</li>\n<li>t_role</li>\n<li>t_permission</li>\n<li>t_operation</li>\n</ul>\n<p>关系表有</p>\n<ul>\n<li>t_user_role_community</li>\n<li>t_user_role_project</li>\n<li>t_role_permission</li>\n<li>t_permission_operation</li>\n</ul>\n<p>权限判断的主要思路是根据用户传过来的社区ID/项目ID+用户ID+发起的请求路径，通过多表联查，来确定用户在对应的社区/项目内所对应的角色是否具有权限执行响应请求的操作。</p>\n<p>由于在域方面，有社区和项目两个尺度，其中社区包含项目。但是由于一些其他原因，在社区表中无法表示出与项目的从属关系，只能把t_user_role表复用，分身成两张表：t_user_role_community和t_user_role_project。</p>\n<p>由于我们的鉴权系统整个流程都是一对多的关系，即一个用户可能对应多个角色，一个角色可能对应多种权限，一种权限又能对应多种操作。因此，一个用户能对应N多种操作，同时，由于中间的多重映射关系，一个用户对某个操作可能会对应多次。</p>\n<p>我们采用多表联查的方式，输入项为用户+操作（操作具体表示为request的method+url），使用如下SQL语句进行查询，只要查询结果不为空，即证明用户有相应的操作权限：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span></span><br><span class=\"line\">    *</span><br><span class=\"line\"><span class=\"keyword\">FROM</span></span><br><span class=\"line\">    t_user_role_community</span><br><span class=\"line\"><span class=\"keyword\">INNER</span> <span class=\"keyword\">JOIN</span> t_role_permission</span><br><span class=\"line\"><span class=\"keyword\">INNER</span> <span class=\"keyword\">JOIN</span> t_permission_operation <span class=\"keyword\">ON</span> t_user_role_community.strRole = t_role_permission.strRole</span><br><span class=\"line\"><span class=\"keyword\">AND</span> t_role_permission.nPermission = t_permission_operation.nPermission</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span></span><br><span class=\"line\">    nUser = <span class=\"number\">10025</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> nCommunity = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> strMethod = <span class=\"string\">'get'</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> strUrl = <span class=\"string\">'/api/t_service'</span></span><br></pre></td></tr></table></figure>\n<p>这样做实际上只查询了社区线的权限，此外还有项目线的权限以及非社区非项目线的权限（例如个人中心、系统管理之类的，我们把这部分的域直接设置为nCommunity=0，即项目编号为0），想要覆盖所有的域，我们相当于要同时多表联查三次，只要其中任意一次能够查到数据，则表明用户有执行该操作的权限。我们可以用UNION语句来实现：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"keyword\">SELECT</span></span><br><span class=\"line\">    *</span><br><span class=\"line\"><span class=\"keyword\">FROM</span></span><br><span class=\"line\">    t_user_role_community</span><br><span class=\"line\"><span class=\"keyword\">INNER</span> <span class=\"keyword\">JOIN</span> t_role_permission</span><br><span class=\"line\"><span class=\"keyword\">INNER</span> <span class=\"keyword\">JOIN</span> t_permission_operation <span class=\"keyword\">ON</span> t_user_role_community.strRole = t_role_permission.strRole</span><br><span class=\"line\"><span class=\"keyword\">AND</span> t_role_permission.nPermission = t_permission_operation.nPermission</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span></span><br><span class=\"line\">    nUser = <span class=\"number\">10025</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> (nCommunity = <span class=\"number\">0</span> <span class=\"keyword\">OR</span> nCommunity = <span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"keyword\">AND</span> strMethod = <span class=\"string\">'get'</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> strUrl = <span class=\"string\">'/api/t_service'</span>)</span><br><span class=\"line\"><span class=\"keyword\">UNION</span></span><br><span class=\"line\">(<span class=\"keyword\">SELECT</span></span><br><span class=\"line\">    *</span><br><span class=\"line\"><span class=\"keyword\">FROM</span></span><br><span class=\"line\">    t_user_role_project</span><br><span class=\"line\"><span class=\"keyword\">INNER</span> <span class=\"keyword\">JOIN</span> t_role_permission</span><br><span class=\"line\"><span class=\"keyword\">INNER</span> <span class=\"keyword\">JOIN</span> t_permission_operation <span class=\"keyword\">ON</span> t_user_role_project.strRole = t_role_permission.strRole</span><br><span class=\"line\"><span class=\"keyword\">AND</span> t_role_permission.nPermission = t_permission_operation.nPermission</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span></span><br><span class=\"line\">    nUser = <span class=\"number\">10025</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> nProject = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> strMethod = <span class=\"string\">'get'</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> strUrl = <span class=\"string\">'/api/t_service'</span>)</span><br></pre></td></tr></table></figure>\n<p>好啦，这就实现了一个相对完整的分权分域的系统啦~</p>\n<h2 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h2><hr>\n<p>整个鉴权过程是放在后台以中间件的形式存在的。所有发送的请求都要经过鉴权中间件才能继续往后走下去。</p>\n<p>因此，除了在数据库层面进行设计以外，还要在后台代码进行一些必要性的优化。比如说有一类操作的对应权限是通用权限，这类接口占所有接口的一半以上。因此在鉴权中间件我会先判断一步是否为通用权限，若是则跳过接下来的鉴权，直接判过；不是的话再按照既定流程继续鉴权。</p>\n<p>也可以在鉴权层增加日志打印，把所有经过鉴权的请求记录在案，以便日后追踪。</p>\n<p>写到这里突然发现，我这个前端，越做越往后了…</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"引子\"><a href=\"#引子\" class=\"headerlink\" title=\"引子\"></a>引子</h2><hr>\n<p>最近要开发一个新的系统，系统里面可以有许多不同的社区，每个社区下面有不同的项目。项目和项目、社区和社区之间都是相互独立的。我所做的工作是设计一套权限管理系统，这套系统允许不同的用户在不同的社区或者项目之中有不同的权限，可以保证用户无法做出越权的操作。</p>\n<p>经过了一番努力，设计出了一套基于RBAC的分权分域的用户权限系统。</p>\n<p>首先介绍一下什么是RBAC:</p>\n<blockquote>\n<p>以角色为基础的访问控制（英语：Role-based access control, RBAC），是资讯安全领域中，一种较新且广为使用的访问控制机制，其不同于强制访问控制以及自由选定访问控制直接赋予使用者权限，而是将权限赋予角色。1996年，莱威·桑度（Ravi Sandhu）等人在前人的理论基础上，提出以角色为基础的访问控制模型，故该模型又被称为RBAC96。之后，美国国家标准局重新定义了以角色为基础的访问控制模型，并将之纳为一种标准，称之为NIST RBAC。<br>以角色为基础的访问控制模型是一套较强制访问控制以及自由选定访问控制更为中性且更具灵活性的访问控制技术。</p>\n</blockquote>\n<p>在一个组织中，会因为不同的作业功能产生不同的角色，执行某项操作的权限会被赋予特定的角色。组织成员或者工作人员（抑或其它系统用户）则被赋予不同的角色，这些用户通过被赋予角色来取得执行某项计算机系统功能的权限。</p>\n<ul>\n<li>S = 主体 = 一名使用者或自动代理人</li>\n<li>R = 角色 = 被定义为一个授权等级的工作职位或职称</li>\n<li>P = 权限 = 一种存取资源的方式</li>\n<li>SE = 会期 = S，R或P之间的映射关系</li>\n<li>SA = 主体指派</li>\n<li>PA = 权限指派</li>\n<li>RH = 角色阶层。能被表示为：≥（x ≥ y 代表 x 继承 y 的权限）</li>\n<li>一个主体可对应多个角色。</li>\n<li>一个角色可对应多个主体。</li>\n<li>一个角色可拥有多个权限。</li>\n<li>一种权限可被分配给许多个角色。</li>\n<li>一个角色可以有专属于自己的权限。</li>\n</ul>\n<h2 id=\"数据库结构设计\"><a href=\"#数据库结构设计\" class=\"headerlink\" title=\"数据库结构设计\"></a>数据库结构设计</h2><hr>\n<p>项目使用的mysql数据库，设计表格的大体结构如下：</p>\n<p><img src=\"/2018/02/12/基于RBAC的分权分域用户权限系统数据库设计/分权分域数据库设计.png\" alt=\"数据库结构设计\"></p>\n<p>蓝底模块为<strong>基本表</strong>，黄底模块为<strong>关系表</strong>。</p>\n<p>基本表有</p>\n<ul>\n<li>t_user</li>\n<li>t_role</li>\n<li>t_permission</li>\n<li>t_operation</li>\n</ul>\n<p>关系表有</p>\n<ul>\n<li>t_user_role_community</li>\n<li>t_user_role_project</li>\n<li>t_role_permission</li>\n<li>t_permission_operation</li>\n</ul>\n<p>权限判断的主要思路是根据用户传过来的社区ID/项目ID+用户ID+发起的请求路径，通过多表联查，来确定用户在对应的社区/项目内所对应的角色是否具有权限执行响应请求的操作。</p>\n<p>由于在域方面，有社区和项目两个尺度，其中社区包含项目。但是由于一些其他原因，在社区表中无法表示出与项目的从属关系，只能把t_user_role表复用，分身成两张表：t_user_role_community和t_user_role_project。</p>\n<p>由于我们的鉴权系统整个流程都是一对多的关系，即一个用户可能对应多个角色，一个角色可能对应多种权限，一种权限又能对应多种操作。因此，一个用户能对应N多种操作，同时，由于中间的多重映射关系，一个用户对某个操作可能会对应多次。</p>\n<p>我们采用多表联查的方式，输入项为用户+操作（操作具体表示为request的method+url），使用如下SQL语句进行查询，只要查询结果不为空，即证明用户有相应的操作权限：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">SELECT</span></span><br><span class=\"line\">    *</span><br><span class=\"line\"><span class=\"keyword\">FROM</span></span><br><span class=\"line\">    t_user_role_community</span><br><span class=\"line\"><span class=\"keyword\">INNER</span> <span class=\"keyword\">JOIN</span> t_role_permission</span><br><span class=\"line\"><span class=\"keyword\">INNER</span> <span class=\"keyword\">JOIN</span> t_permission_operation <span class=\"keyword\">ON</span> t_user_role_community.strRole = t_role_permission.strRole</span><br><span class=\"line\"><span class=\"keyword\">AND</span> t_role_permission.nPermission = t_permission_operation.nPermission</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span></span><br><span class=\"line\">    nUser = <span class=\"number\">10025</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> nCommunity = <span class=\"number\">1</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> strMethod = <span class=\"string\">'get'</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> strUrl = <span class=\"string\">'/api/t_service'</span></span><br></pre></td></tr></table></figure>\n<p>这样做实际上只查询了社区线的权限，此外还有项目线的权限以及非社区非项目线的权限（例如个人中心、系统管理之类的，我们把这部分的域直接设置为nCommunity=0，即项目编号为0），想要覆盖所有的域，我们相当于要同时多表联查三次，只要其中任意一次能够查到数据，则表明用户有执行该操作的权限。我们可以用UNION语句来实现：</p>\n<figure class=\"highlight sql\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">(<span class=\"keyword\">SELECT</span></span><br><span class=\"line\">    *</span><br><span class=\"line\"><span class=\"keyword\">FROM</span></span><br><span class=\"line\">    t_user_role_community</span><br><span class=\"line\"><span class=\"keyword\">INNER</span> <span class=\"keyword\">JOIN</span> t_role_permission</span><br><span class=\"line\"><span class=\"keyword\">INNER</span> <span class=\"keyword\">JOIN</span> t_permission_operation <span class=\"keyword\">ON</span> t_user_role_community.strRole = t_role_permission.strRole</span><br><span class=\"line\"><span class=\"keyword\">AND</span> t_role_permission.nPermission = t_permission_operation.nPermission</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span></span><br><span class=\"line\">    nUser = <span class=\"number\">10025</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> (nCommunity = <span class=\"number\">0</span> <span class=\"keyword\">OR</span> nCommunity = <span class=\"number\">0</span>)</span><br><span class=\"line\"><span class=\"keyword\">AND</span> strMethod = <span class=\"string\">'get'</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> strUrl = <span class=\"string\">'/api/t_service'</span>)</span><br><span class=\"line\"><span class=\"keyword\">UNION</span></span><br><span class=\"line\">(<span class=\"keyword\">SELECT</span></span><br><span class=\"line\">    *</span><br><span class=\"line\"><span class=\"keyword\">FROM</span></span><br><span class=\"line\">    t_user_role_project</span><br><span class=\"line\"><span class=\"keyword\">INNER</span> <span class=\"keyword\">JOIN</span> t_role_permission</span><br><span class=\"line\"><span class=\"keyword\">INNER</span> <span class=\"keyword\">JOIN</span> t_permission_operation <span class=\"keyword\">ON</span> t_user_role_project.strRole = t_role_permission.strRole</span><br><span class=\"line\"><span class=\"keyword\">AND</span> t_role_permission.nPermission = t_permission_operation.nPermission</span><br><span class=\"line\"><span class=\"keyword\">WHERE</span></span><br><span class=\"line\">    nUser = <span class=\"number\">10025</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> nProject = <span class=\"number\">0</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> strMethod = <span class=\"string\">'get'</span></span><br><span class=\"line\"><span class=\"keyword\">AND</span> strUrl = <span class=\"string\">'/api/t_service'</span>)</span><br></pre></td></tr></table></figure>\n<p>好啦，这就实现了一个相对完整的分权分域的系统啦~</p>\n<h2 id=\"结语\"><a href=\"#结语\" class=\"headerlink\" title=\"结语\"></a>结语</h2><hr>\n<p>整个鉴权过程是放在后台以中间件的形式存在的。所有发送的请求都要经过鉴权中间件才能继续往后走下去。</p>\n<p>因此，除了在数据库层面进行设计以外，还要在后台代码进行一些必要性的优化。比如说有一类操作的对应权限是通用权限，这类接口占所有接口的一半以上。因此在鉴权中间件我会先判断一步是否为通用权限，若是则跳过接下来的鉴权，直接判过；不是的话再按照既定流程继续鉴权。</p>\n<p>也可以在鉴权层增加日志打印，把所有经过鉴权的请求记录在案，以便日后追踪。</p>\n<p>写到这里突然发现，我这个前端，越做越往后了…</p>\n"},{"title":"深入探讨正斜杠和反斜杠","date":"2017-11-17T02:00:52.000Z","description":"在我们写代码时，经常会遇到正斜杠（/）和反斜杠（\\）带来的困惑，如果没有专门深入研究过，很容易搞混。大多数情况下不会真的出问题，但是一旦有一次不小心搞错了，还真挺难受的。只要您能仔细看完这篇文章，相信以后区分正斜杠（/）和反斜杠（\\）就不会出现问题。","picture":"slash.jpg","_content":"\n## 引子\n\n***\n\n为什么要写这篇文章呢？实际上还是源于上一篇文章[Nginx 配置指南](http://tuobaye.com/2017/11/11/Nginx%20%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/)里面一处配置代码给我带来的小纠结：\n\n> 你需要将静态网页和文件放到一个目录（例如/data/www），将图片等文件放到另一个目录（例如/data/images），然后在nginx.conf中进行配置。这需要在*http*模块下的*server*模块内新建两个*location*模块：\n\n>  {% codeblock lang:nginx %}\n  http {\n      server {\n          location / {\n              root /data/www;\n          }\n          location /images/ {\n              root /data;\n          }\n      }\n  }\n  {% endcodeblock %}\n\n>  看起来很好理解吧~也可以直接把文件放到一块，直接location配置绝对路径：\n\n>  {% codeblock lang:nginx %}\n  location / {\n      root   F:\\webapp\\portal;\n  }\n  {% endcodeblock %}\n\n发现问题了么？上面的代码块root路径都是以斜杠(/)分隔的，下面的代码块的root路径却是以反斜杠(\\\\)分隔的。两种不同的方式却能同样生效，这个是为什么呢？\n\n## 作为路径分隔符在windows和Unix系统下的区别\n\n***\n\n在上文中的例子，不论是正斜杠还是反斜杠(\\\\)，都是作为路径分隔符存在的，因此我们首先把他们作为路径分隔符，分别在windows和Unix两种不同内核的系统下进行一波测试。\n\nwindows（win7 64位系统）下：\n\n![windows](windows.png)\n\nUnix（Ubuntu 14.04.5）下：\n\n![Unix](Unix.png)\n\n可以看出，Unix内核系统，路径格式仅支持正斜杠(/)分隔，而windows的系统，正斜杠(/)反斜杠(\\\\)都支持，这是个很奇妙的差别。\n\n在查询了资料后，我才知道造成这种差别的深层次原因。\n\nwindows的命令行（CMD应用程序）跟早期的MS-DOS操作系统的命令格式是前向兼容的。而DOS系统其实有很多历史遗留问题。\n\nDOS系统很大一部分参考（抄袭？）自加里·基尔代尔的更早的一款操作系统CP/M。\n\n> CP/M是数字研究公司（1991年被Novell所兼并）在1974年开发，为8位CPU（如Intel 8080、Zilog Z80等）的个人电脑（PC）所设计的操作系统。在PC市场的黎明阶段，它成为被广泛应用的操作系统。可是因为在向16位CPU的转化上错失机会，在以IBM PC/AT以及IBM PC兼容机为中心的16位PC市场上惨败给Microsoft的MS-DOS，从而从市场上消失。虽然CP/M推出了为Intel 8086而设计的“CP/M 86”以及为Motorola 68000而设计的“CP/M 68k”等版本，但用户几乎不存在。\n\n由于CP/M系统是不支持目录的，/被拿来用作命令行参数的标识符，比如说dir /a, dir /w, dir /q等等（Unix用的是\"-\"），因此，当MS-DOS系统准备支持目录时，/已被占用，只能使用\\来表示路径分隔符了。再后来，windows系统诞生之时，命令行因为要跟MS-DOS兼容，只能把DOS的特性沿用了下来，同时又给支持/作为路径分隔符，于是就造成了现在这种正斜杠(/)反斜杠(\\\\)都支持作为路径分隔符的情况的出现。而Unix不存在这种历史遗留问题，从诞生之初就开始使用斜杠(/)作为路径分隔符，因此，两个系统在这种奇怪的地方出现了分叉。\n\n而我当时的那段代码\n\n{% codeblock lang:nginx %}\n  location / {\n      root   F:\\webapp\\portal;\n  }\n{% endcodeblock %}\n\n中的root路径，是直接从windows系统中粘贴的路径，因此就会出现这种反斜杠(\\\\)做分隔符的奇怪场景。\n\n对了，在测试过程中还发现了windows系统中使用/和\\做分隔符的一个好玩的区别：\n\n- 使用\\做分隔符时，在输入二级子目录（比如\\zgit\\<span style=\"color:red\">zblog</span>）时，可以提示补全路径，输入z以后按一下tab就帮我把zblog给补全了\n- 使用/做分隔符时，在输入二级子目录（比如\\zgit\\<span style=\"color:red\">zblog</span>）时，并不能提示补全路径，他给我提示的还是1级子目录的列表，在我输入z以后按一下tab，他帮我补了一个zgit，我输入zb，按tab无反应。这实际上根本无可用补全功能。\n\n因此，仅在windows下做目录操作时，还是使用反斜杠(\\\\)做分隔符系统支持度更强些，使用体验也更好一些。\n\n## 广义方面的区别\n\n***\n\n### 正斜杠(/)\n\n正斜杠(/)是我们平时很多时候都会用到的斜杠，我们经常会见到这样的写法：小明/小红/小强，你/我/他等等。这种格式在各种文章里面十分常见，表示“或”或者是“和”的意思。\n\n浏览器中URL的层级URL标记符(//)以及路径分隔符(/)也是由正斜杠(/)组成，例如\"https://zh.wikipedia.org/wiki/\", 可以看到里面清一色的都是正斜杠(/)。使用正斜杠(/)的原因据说是web网站最早是在Unix系统下运行的，于是沿袭了Unix的那一套路径表述方式，因此使用正斜杠(/)作为分隔符。\n\n正斜杠(/)也可以用作“除法”或者“分号”的作用，比如说\"100÷4\"我们在计算机上输入时，由于除号比较难输，经常就会写成\"100/4\"，效果是完全一致的。这种用法应该是从“分号”演化来的，毕竟\"4/3\"你看做“三分之四”还是看做“4除以3”，都是可以的。\n\n连续两个正斜杠(/)可做“注释”之用，在C++/C#/Java/JavaScript/PHP等主流编程语言中基本上通用：\n\n日期也可以使用正斜杠(/)分隔年月日，例如\"2017/11/17\"，也可以用美国标准\"11/17/2017\"，都表示2017年11月17日。\n\n最后，斜线除了上述用法，也成为连字号的代替品。例如美国空军的飞机序号。\"85-1000\"是第1000架飞机在1985年制造，使用斜线\"85-1001/1050\"表示首批连串50部制造的飞机。\n\n{% codeblock lang:javascript %}\n    // 在控制台打印hello world!\n    console.log('hello world!')\n{% endcodeblock %}\n\n### 反斜杠(\\\\)\n\n比起正斜杠(/)的诸多用处，反斜杠(\\\\)的用处可就少多了。如果你还是动不动就用到反斜杠(\\\\)，证明你肯定是一个程序员。\n\n反斜杠(\\\\)除了可以在windows下可以做路径分隔符外，最常用的功能就是做转义字符了。许多正则表达式语言都会将它视为字面意义和元字符之前的切换。例如\\n是换行，\\0是空字符，它们表示的实际上都是一个字符（char）；而在一些数学软件（如MATLAB）和维基百科上，可以使用反斜线输入希腊字母。\\pi会转成π，\\lambda会转成λ。由于反斜杠(\\\\)存在转义字符的作用，因此我们常常在一些代码里面看到形如\"C:\\\\\\\\Windows\\\\\\\\System32\\\\\\\\cmd.exe\"的路径格式（*实际上你看到的双反斜杠(\\\\)，我在markdown格式下输入了连续4个反斜杠...*），并不代表实际路径是这样的，而是其中连续两个反斜杠(\\\\)发生了“化学反应”，第一个反斜杠(\\\\)代表对后面部分进行转义，而对反斜杠(\\\\)的转义还是反斜杠(\\\\)，因此虽然连续输入两个反斜杠(\\\\)，但是实际输出时只有一个反斜杠(\\\\)。\n\n另外，在某些程序语言的命令行中，例如在linux中,反斜线常被放在一行的末尾用来指示编译器忽略其后的换行符，使得下一行会被当做同一行语句。这种情况下，反斜线作为一个强制换行符，将代码拆解成“连续行”。\n\n## 小结\n\n***\n\n通读完这篇文章，相信你对正斜杠(/)和反斜杠(\\\\)的作用不会再有疑惑了。最后，我再用一张图来总结一下两者各自的功能，以供各位看官整理记忆。\n\n![正斜杠和反斜杠](slash.png)\n\n## TIPS\n\n***\n\n看了这么一大堆正斜杠(/)和反斜杠(\\\\)，是不是头都大了呢？没关系，要想记忆区分正斜杠(/)反斜杠(\\\\)，可以把他们想象为笔画上的撇（丿）和捺（㇏），一撇一捺是为八，第一笔正斜，第二笔反斜（/\\），这样是不是好记多了呢？","source":"_posts/深入探讨正斜杠和反斜杠.md","raw":"---\ntitle: 深入探讨正斜杠和反斜杠\ndate: 2017-11-17 10:00:52\ntags: 拾遗\ndescription: 在我们写代码时，经常会遇到正斜杠（/）和反斜杠（\\）带来的困惑，如果没有专门深入研究过，很容易搞混。大多数情况下不会真的出问题，但是一旦有一次不小心搞错了，还真挺难受的。只要您能仔细看完这篇文章，相信以后区分正斜杠（/）和反斜杠（\\）就不会出现问题。\npicture: slash.jpg\n---\n\n## 引子\n\n***\n\n为什么要写这篇文章呢？实际上还是源于上一篇文章[Nginx 配置指南](http://tuobaye.com/2017/11/11/Nginx%20%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/)里面一处配置代码给我带来的小纠结：\n\n> 你需要将静态网页和文件放到一个目录（例如/data/www），将图片等文件放到另一个目录（例如/data/images），然后在nginx.conf中进行配置。这需要在*http*模块下的*server*模块内新建两个*location*模块：\n\n>  {% codeblock lang:nginx %}\n  http {\n      server {\n          location / {\n              root /data/www;\n          }\n          location /images/ {\n              root /data;\n          }\n      }\n  }\n  {% endcodeblock %}\n\n>  看起来很好理解吧~也可以直接把文件放到一块，直接location配置绝对路径：\n\n>  {% codeblock lang:nginx %}\n  location / {\n      root   F:\\webapp\\portal;\n  }\n  {% endcodeblock %}\n\n发现问题了么？上面的代码块root路径都是以斜杠(/)分隔的，下面的代码块的root路径却是以反斜杠(\\\\)分隔的。两种不同的方式却能同样生效，这个是为什么呢？\n\n## 作为路径分隔符在windows和Unix系统下的区别\n\n***\n\n在上文中的例子，不论是正斜杠还是反斜杠(\\\\)，都是作为路径分隔符存在的，因此我们首先把他们作为路径分隔符，分别在windows和Unix两种不同内核的系统下进行一波测试。\n\nwindows（win7 64位系统）下：\n\n![windows](windows.png)\n\nUnix（Ubuntu 14.04.5）下：\n\n![Unix](Unix.png)\n\n可以看出，Unix内核系统，路径格式仅支持正斜杠(/)分隔，而windows的系统，正斜杠(/)反斜杠(\\\\)都支持，这是个很奇妙的差别。\n\n在查询了资料后，我才知道造成这种差别的深层次原因。\n\nwindows的命令行（CMD应用程序）跟早期的MS-DOS操作系统的命令格式是前向兼容的。而DOS系统其实有很多历史遗留问题。\n\nDOS系统很大一部分参考（抄袭？）自加里·基尔代尔的更早的一款操作系统CP/M。\n\n> CP/M是数字研究公司（1991年被Novell所兼并）在1974年开发，为8位CPU（如Intel 8080、Zilog Z80等）的个人电脑（PC）所设计的操作系统。在PC市场的黎明阶段，它成为被广泛应用的操作系统。可是因为在向16位CPU的转化上错失机会，在以IBM PC/AT以及IBM PC兼容机为中心的16位PC市场上惨败给Microsoft的MS-DOS，从而从市场上消失。虽然CP/M推出了为Intel 8086而设计的“CP/M 86”以及为Motorola 68000而设计的“CP/M 68k”等版本，但用户几乎不存在。\n\n由于CP/M系统是不支持目录的，/被拿来用作命令行参数的标识符，比如说dir /a, dir /w, dir /q等等（Unix用的是\"-\"），因此，当MS-DOS系统准备支持目录时，/已被占用，只能使用\\来表示路径分隔符了。再后来，windows系统诞生之时，命令行因为要跟MS-DOS兼容，只能把DOS的特性沿用了下来，同时又给支持/作为路径分隔符，于是就造成了现在这种正斜杠(/)反斜杠(\\\\)都支持作为路径分隔符的情况的出现。而Unix不存在这种历史遗留问题，从诞生之初就开始使用斜杠(/)作为路径分隔符，因此，两个系统在这种奇怪的地方出现了分叉。\n\n而我当时的那段代码\n\n{% codeblock lang:nginx %}\n  location / {\n      root   F:\\webapp\\portal;\n  }\n{% endcodeblock %}\n\n中的root路径，是直接从windows系统中粘贴的路径，因此就会出现这种反斜杠(\\\\)做分隔符的奇怪场景。\n\n对了，在测试过程中还发现了windows系统中使用/和\\做分隔符的一个好玩的区别：\n\n- 使用\\做分隔符时，在输入二级子目录（比如\\zgit\\<span style=\"color:red\">zblog</span>）时，可以提示补全路径，输入z以后按一下tab就帮我把zblog给补全了\n- 使用/做分隔符时，在输入二级子目录（比如\\zgit\\<span style=\"color:red\">zblog</span>）时，并不能提示补全路径，他给我提示的还是1级子目录的列表，在我输入z以后按一下tab，他帮我补了一个zgit，我输入zb，按tab无反应。这实际上根本无可用补全功能。\n\n因此，仅在windows下做目录操作时，还是使用反斜杠(\\\\)做分隔符系统支持度更强些，使用体验也更好一些。\n\n## 广义方面的区别\n\n***\n\n### 正斜杠(/)\n\n正斜杠(/)是我们平时很多时候都会用到的斜杠，我们经常会见到这样的写法：小明/小红/小强，你/我/他等等。这种格式在各种文章里面十分常见，表示“或”或者是“和”的意思。\n\n浏览器中URL的层级URL标记符(//)以及路径分隔符(/)也是由正斜杠(/)组成，例如\"https://zh.wikipedia.org/wiki/\", 可以看到里面清一色的都是正斜杠(/)。使用正斜杠(/)的原因据说是web网站最早是在Unix系统下运行的，于是沿袭了Unix的那一套路径表述方式，因此使用正斜杠(/)作为分隔符。\n\n正斜杠(/)也可以用作“除法”或者“分号”的作用，比如说\"100÷4\"我们在计算机上输入时，由于除号比较难输，经常就会写成\"100/4\"，效果是完全一致的。这种用法应该是从“分号”演化来的，毕竟\"4/3\"你看做“三分之四”还是看做“4除以3”，都是可以的。\n\n连续两个正斜杠(/)可做“注释”之用，在C++/C#/Java/JavaScript/PHP等主流编程语言中基本上通用：\n\n日期也可以使用正斜杠(/)分隔年月日，例如\"2017/11/17\"，也可以用美国标准\"11/17/2017\"，都表示2017年11月17日。\n\n最后，斜线除了上述用法，也成为连字号的代替品。例如美国空军的飞机序号。\"85-1000\"是第1000架飞机在1985年制造，使用斜线\"85-1001/1050\"表示首批连串50部制造的飞机。\n\n{% codeblock lang:javascript %}\n    // 在控制台打印hello world!\n    console.log('hello world!')\n{% endcodeblock %}\n\n### 反斜杠(\\\\)\n\n比起正斜杠(/)的诸多用处，反斜杠(\\\\)的用处可就少多了。如果你还是动不动就用到反斜杠(\\\\)，证明你肯定是一个程序员。\n\n反斜杠(\\\\)除了可以在windows下可以做路径分隔符外，最常用的功能就是做转义字符了。许多正则表达式语言都会将它视为字面意义和元字符之前的切换。例如\\n是换行，\\0是空字符，它们表示的实际上都是一个字符（char）；而在一些数学软件（如MATLAB）和维基百科上，可以使用反斜线输入希腊字母。\\pi会转成π，\\lambda会转成λ。由于反斜杠(\\\\)存在转义字符的作用，因此我们常常在一些代码里面看到形如\"C:\\\\\\\\Windows\\\\\\\\System32\\\\\\\\cmd.exe\"的路径格式（*实际上你看到的双反斜杠(\\\\)，我在markdown格式下输入了连续4个反斜杠...*），并不代表实际路径是这样的，而是其中连续两个反斜杠(\\\\)发生了“化学反应”，第一个反斜杠(\\\\)代表对后面部分进行转义，而对反斜杠(\\\\)的转义还是反斜杠(\\\\)，因此虽然连续输入两个反斜杠(\\\\)，但是实际输出时只有一个反斜杠(\\\\)。\n\n另外，在某些程序语言的命令行中，例如在linux中,反斜线常被放在一行的末尾用来指示编译器忽略其后的换行符，使得下一行会被当做同一行语句。这种情况下，反斜线作为一个强制换行符，将代码拆解成“连续行”。\n\n## 小结\n\n***\n\n通读完这篇文章，相信你对正斜杠(/)和反斜杠(\\\\)的作用不会再有疑惑了。最后，我再用一张图来总结一下两者各自的功能，以供各位看官整理记忆。\n\n![正斜杠和反斜杠](slash.png)\n\n## TIPS\n\n***\n\n看了这么一大堆正斜杠(/)和反斜杠(\\\\)，是不是头都大了呢？没关系，要想记忆区分正斜杠(/)反斜杠(\\\\)，可以把他们想象为笔画上的撇（丿）和捺（㇏），一撇一捺是为八，第一笔正斜，第二笔反斜（/\\），这样是不是好记多了呢？","slug":"深入探讨正斜杠和反斜杠","published":1,"updated":"2018-03-04T15:08:12.824Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk698hya000nznzww6909mk6","content":"<h2 id=\"引子\"><a href=\"#引子\" class=\"headerlink\" title=\"引子\"></a>引子</h2><hr>\n<p>为什么要写这篇文章呢？实际上还是源于上一篇文章<a href=\"http://tuobaye.com/2017/11/11/Nginx%20%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/\" target=\"_blank\" rel=\"noopener\">Nginx 配置指南</a>里面一处配置代码给我带来的小纠结：</p>\n<blockquote>\n<p>你需要将静态网页和文件放到一个目录（例如/data/www），将图片等文件放到另一个目录（例如/data/images），然后在nginx.conf中进行配置。这需要在<em>http</em>模块下的<em>server</em>模块内新建两个<em>location</em>模块：</p>\n</blockquote>\n<blockquote>\n <figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">http</span> &#123;</span><br><span class=\"line\">    <span class=\"section\">server</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">            <span class=\"attribute\">root</span> /data/www;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"attribute\">location</span> /images/ &#123;</span><br><span class=\"line\">            <span class=\"attribute\">root</span> /data;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</blockquote>\n<blockquote>\n<p> 看起来很好理解吧~也可以直接把文件放到一块，直接location配置绝对路径：</p>\n</blockquote>\n<blockquote>\n <figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">    <span class=\"attribute\">root</span>   F:\\webapp\\portal;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</blockquote>\n<p>发现问题了么？上面的代码块root路径都是以斜杠(/)分隔的，下面的代码块的root路径却是以反斜杠(\\)分隔的。两种不同的方式却能同样生效，这个是为什么呢？</p>\n<h2 id=\"作为路径分隔符在windows和Unix系统下的区别\"><a href=\"#作为路径分隔符在windows和Unix系统下的区别\" class=\"headerlink\" title=\"作为路径分隔符在windows和Unix系统下的区别\"></a>作为路径分隔符在windows和Unix系统下的区别</h2><hr>\n<p>在上文中的例子，不论是正斜杠还是反斜杠(\\)，都是作为路径分隔符存在的，因此我们首先把他们作为路径分隔符，分别在windows和Unix两种不同内核的系统下进行一波测试。</p>\n<p>windows（win7 64位系统）下：</p>\n<p><img src=\"/2017/11/17/深入探讨正斜杠和反斜杠/windows.png\" alt=\"windows\"></p>\n<p>Unix（Ubuntu 14.04.5）下：</p>\n<p><img src=\"/2017/11/17/深入探讨正斜杠和反斜杠/Unix.png\" alt=\"Unix\"></p>\n<p>可以看出，Unix内核系统，路径格式仅支持正斜杠(/)分隔，而windows的系统，正斜杠(/)反斜杠(\\)都支持，这是个很奇妙的差别。</p>\n<p>在查询了资料后，我才知道造成这种差别的深层次原因。</p>\n<p>windows的命令行（CMD应用程序）跟早期的MS-DOS操作系统的命令格式是前向兼容的。而DOS系统其实有很多历史遗留问题。</p>\n<p>DOS系统很大一部分参考（抄袭？）自加里·基尔代尔的更早的一款操作系统CP/M。</p>\n<blockquote>\n<p>CP/M是数字研究公司（1991年被Novell所兼并）在1974年开发，为8位CPU（如Intel 8080、Zilog Z80等）的个人电脑（PC）所设计的操作系统。在PC市场的黎明阶段，它成为被广泛应用的操作系统。可是因为在向16位CPU的转化上错失机会，在以IBM PC/AT以及IBM PC兼容机为中心的16位PC市场上惨败给Microsoft的MS-DOS，从而从市场上消失。虽然CP/M推出了为Intel 8086而设计的“CP/M 86”以及为Motorola 68000而设计的“CP/M 68k”等版本，但用户几乎不存在。</p>\n</blockquote>\n<p>由于CP/M系统是不支持目录的，/被拿来用作命令行参数的标识符，比如说dir /a, dir /w, dir /q等等（Unix用的是”-“），因此，当MS-DOS系统准备支持目录时，/已被占用，只能使用\\来表示路径分隔符了。再后来，windows系统诞生之时，命令行因为要跟MS-DOS兼容，只能把DOS的特性沿用了下来，同时又给支持/作为路径分隔符，于是就造成了现在这种正斜杠(/)反斜杠(\\)都支持作为路径分隔符的情况的出现。而Unix不存在这种历史遗留问题，从诞生之初就开始使用斜杠(/)作为路径分隔符，因此，两个系统在这种奇怪的地方出现了分叉。</p>\n<p>而我当时的那段代码</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">    <span class=\"attribute\">root</span>   F:\\webapp\\portal;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>中的root路径，是直接从windows系统中粘贴的路径，因此就会出现这种反斜杠(\\)做分隔符的奇怪场景。</p>\n<p>对了，在测试过程中还发现了windows系统中使用/和\\做分隔符的一个好玩的区别：</p>\n<ul>\n<li>使用\\做分隔符时，在输入二级子目录（比如\\zgit\\<span style=\"color:red\">zblog</span>）时，可以提示补全路径，输入z以后按一下tab就帮我把zblog给补全了</li>\n<li>使用/做分隔符时，在输入二级子目录（比如\\zgit\\<span style=\"color:red\">zblog</span>）时，并不能提示补全路径，他给我提示的还是1级子目录的列表，在我输入z以后按一下tab，他帮我补了一个zgit，我输入zb，按tab无反应。这实际上根本无可用补全功能。</li>\n</ul>\n<p>因此，仅在windows下做目录操作时，还是使用反斜杠(\\)做分隔符系统支持度更强些，使用体验也更好一些。</p>\n<h2 id=\"广义方面的区别\"><a href=\"#广义方面的区别\" class=\"headerlink\" title=\"广义方面的区别\"></a>广义方面的区别</h2><hr>\n<h3 id=\"正斜杠\"><a href=\"#正斜杠\" class=\"headerlink\" title=\"正斜杠(/)\"></a>正斜杠(/)</h3><p>正斜杠(/)是我们平时很多时候都会用到的斜杠，我们经常会见到这样的写法：小明/小红/小强，你/我/他等等。这种格式在各种文章里面十分常见，表示“或”或者是“和”的意思。</p>\n<p>浏览器中URL的层级URL标记符(//)以及路径分隔符(/)也是由正斜杠(/)组成，例如”<a href=\"https://zh.wikipedia.org/wiki/&quot;\" target=\"_blank\" rel=\"noopener\">https://zh.wikipedia.org/wiki/&quot;</a>, 可以看到里面清一色的都是正斜杠(/)。使用正斜杠(/)的原因据说是web网站最早是在Unix系统下运行的，于是沿袭了Unix的那一套路径表述方式，因此使用正斜杠(/)作为分隔符。</p>\n<p>正斜杠(/)也可以用作“除法”或者“分号”的作用，比如说”100÷4”我们在计算机上输入时，由于除号比较难输，经常就会写成”100/4”，效果是完全一致的。这种用法应该是从“分号”演化来的，毕竟”4/3”你看做“三分之四”还是看做“4除以3”，都是可以的。</p>\n<p>连续两个正斜杠(/)可做“注释”之用，在C++/C#/Java/JavaScript/PHP等主流编程语言中基本上通用：</p>\n<p>日期也可以使用正斜杠(/)分隔年月日，例如”2017/11/17”，也可以用美国标准”11/17/2017”，都表示2017年11月17日。</p>\n<p>最后，斜线除了上述用法，也成为连字号的代替品。例如美国空军的飞机序号。”85-1000”是第1000架飞机在1985年制造，使用斜线”85-1001/1050”表示首批连串50部制造的飞机。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 在控制台打印hello world!</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'hello world!'</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"反斜杠\"><a href=\"#反斜杠\" class=\"headerlink\" title=\"反斜杠(\\)\"></a>反斜杠(\\)</h3><p>比起正斜杠(/)的诸多用处，反斜杠(\\)的用处可就少多了。如果你还是动不动就用到反斜杠(\\)，证明你肯定是一个程序员。</p>\n<p>反斜杠(\\)除了可以在windows下可以做路径分隔符外，最常用的功能就是做转义字符了。许多正则表达式语言都会将它视为字面意义和元字符之前的切换。例如\\n是换行，\\0是空字符，它们表示的实际上都是一个字符（char）；而在一些数学软件（如MATLAB）和维基百科上，可以使用反斜线输入希腊字母。\\pi会转成π，\\lambda会转成λ。由于反斜杠(\\)存在转义字符的作用，因此我们常常在一些代码里面看到形如”C:\\\\Windows\\\\System32\\\\cmd.exe”的路径格式（<em>实际上你看到的双反斜杠(\\)，我在markdown格式下输入了连续4个反斜杠…</em>），并不代表实际路径是这样的，而是其中连续两个反斜杠(\\)发生了“化学反应”，第一个反斜杠(\\)代表对后面部分进行转义，而对反斜杠(\\)的转义还是反斜杠(\\)，因此虽然连续输入两个反斜杠(\\)，但是实际输出时只有一个反斜杠(\\)。</p>\n<p>另外，在某些程序语言的命令行中，例如在linux中,反斜线常被放在一行的末尾用来指示编译器忽略其后的换行符，使得下一行会被当做同一行语句。这种情况下，反斜线作为一个强制换行符，将代码拆解成“连续行”。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><hr>\n<p>通读完这篇文章，相信你对正斜杠(/)和反斜杠(\\)的作用不会再有疑惑了。最后，我再用一张图来总结一下两者各自的功能，以供各位看官整理记忆。</p>\n<p><img src=\"/2017/11/17/深入探讨正斜杠和反斜杠/slash.png\" alt=\"正斜杠和反斜杠\"></p>\n<h2 id=\"TIPS\"><a href=\"#TIPS\" class=\"headerlink\" title=\"TIPS\"></a>TIPS</h2><hr>\n<p>看了这么一大堆正斜杠(/)和反斜杠(\\)，是不是头都大了呢？没关系，要想记忆区分正斜杠(/)反斜杠(\\)，可以把他们想象为笔画上的撇（丿）和捺（㇏），一撇一捺是为八，第一笔正斜，第二笔反斜（/\\），这样是不是好记多了呢？</p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"引子\"><a href=\"#引子\" class=\"headerlink\" title=\"引子\"></a>引子</h2><hr>\n<p>为什么要写这篇文章呢？实际上还是源于上一篇文章<a href=\"http://tuobaye.com/2017/11/11/Nginx%20%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/\" target=\"_blank\" rel=\"noopener\">Nginx 配置指南</a>里面一处配置代码给我带来的小纠结：</p>\n<blockquote>\n<p>你需要将静态网页和文件放到一个目录（例如/data/www），将图片等文件放到另一个目录（例如/data/images），然后在nginx.conf中进行配置。这需要在<em>http</em>模块下的<em>server</em>模块内新建两个<em>location</em>模块：</p>\n</blockquote>\n<blockquote>\n <figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"section\">http</span> &#123;</span><br><span class=\"line\">    <span class=\"section\">server</span> &#123;</span><br><span class=\"line\">        <span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">            <span class=\"attribute\">root</span> /data/www;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"attribute\">location</span> /images/ &#123;</span><br><span class=\"line\">            <span class=\"attribute\">root</span> /data;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</blockquote>\n<blockquote>\n<p> 看起来很好理解吧~也可以直接把文件放到一块，直接location配置绝对路径：</p>\n</blockquote>\n<blockquote>\n <figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">    <span class=\"attribute\">root</span>   F:\\webapp\\portal;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</blockquote>\n<p>发现问题了么？上面的代码块root路径都是以斜杠(/)分隔的，下面的代码块的root路径却是以反斜杠(\\)分隔的。两种不同的方式却能同样生效，这个是为什么呢？</p>\n<h2 id=\"作为路径分隔符在windows和Unix系统下的区别\"><a href=\"#作为路径分隔符在windows和Unix系统下的区别\" class=\"headerlink\" title=\"作为路径分隔符在windows和Unix系统下的区别\"></a>作为路径分隔符在windows和Unix系统下的区别</h2><hr>\n<p>在上文中的例子，不论是正斜杠还是反斜杠(\\)，都是作为路径分隔符存在的，因此我们首先把他们作为路径分隔符，分别在windows和Unix两种不同内核的系统下进行一波测试。</p>\n<p>windows（win7 64位系统）下：</p>\n<p><img src=\"/2017/11/17/深入探讨正斜杠和反斜杠/windows.png\" alt=\"windows\"></p>\n<p>Unix（Ubuntu 14.04.5）下：</p>\n<p><img src=\"/2017/11/17/深入探讨正斜杠和反斜杠/Unix.png\" alt=\"Unix\"></p>\n<p>可以看出，Unix内核系统，路径格式仅支持正斜杠(/)分隔，而windows的系统，正斜杠(/)反斜杠(\\)都支持，这是个很奇妙的差别。</p>\n<p>在查询了资料后，我才知道造成这种差别的深层次原因。</p>\n<p>windows的命令行（CMD应用程序）跟早期的MS-DOS操作系统的命令格式是前向兼容的。而DOS系统其实有很多历史遗留问题。</p>\n<p>DOS系统很大一部分参考（抄袭？）自加里·基尔代尔的更早的一款操作系统CP/M。</p>\n<blockquote>\n<p>CP/M是数字研究公司（1991年被Novell所兼并）在1974年开发，为8位CPU（如Intel 8080、Zilog Z80等）的个人电脑（PC）所设计的操作系统。在PC市场的黎明阶段，它成为被广泛应用的操作系统。可是因为在向16位CPU的转化上错失机会，在以IBM PC/AT以及IBM PC兼容机为中心的16位PC市场上惨败给Microsoft的MS-DOS，从而从市场上消失。虽然CP/M推出了为Intel 8086而设计的“CP/M 86”以及为Motorola 68000而设计的“CP/M 68k”等版本，但用户几乎不存在。</p>\n</blockquote>\n<p>由于CP/M系统是不支持目录的，/被拿来用作命令行参数的标识符，比如说dir /a, dir /w, dir /q等等（Unix用的是”-“），因此，当MS-DOS系统准备支持目录时，/已被占用，只能使用\\来表示路径分隔符了。再后来，windows系统诞生之时，命令行因为要跟MS-DOS兼容，只能把DOS的特性沿用了下来，同时又给支持/作为路径分隔符，于是就造成了现在这种正斜杠(/)反斜杠(\\)都支持作为路径分隔符的情况的出现。而Unix不存在这种历史遗留问题，从诞生之初就开始使用斜杠(/)作为路径分隔符，因此，两个系统在这种奇怪的地方出现了分叉。</p>\n<p>而我当时的那段代码</p>\n<figure class=\"highlight nginx\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"attribute\">location</span> / &#123;</span><br><span class=\"line\">    <span class=\"attribute\">root</span>   F:\\webapp\\portal;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>中的root路径，是直接从windows系统中粘贴的路径，因此就会出现这种反斜杠(\\)做分隔符的奇怪场景。</p>\n<p>对了，在测试过程中还发现了windows系统中使用/和\\做分隔符的一个好玩的区别：</p>\n<ul>\n<li>使用\\做分隔符时，在输入二级子目录（比如\\zgit\\<span style=\"color:red\">zblog</span>）时，可以提示补全路径，输入z以后按一下tab就帮我把zblog给补全了</li>\n<li>使用/做分隔符时，在输入二级子目录（比如\\zgit\\<span style=\"color:red\">zblog</span>）时，并不能提示补全路径，他给我提示的还是1级子目录的列表，在我输入z以后按一下tab，他帮我补了一个zgit，我输入zb，按tab无反应。这实际上根本无可用补全功能。</li>\n</ul>\n<p>因此，仅在windows下做目录操作时，还是使用反斜杠(\\)做分隔符系统支持度更强些，使用体验也更好一些。</p>\n<h2 id=\"广义方面的区别\"><a href=\"#广义方面的区别\" class=\"headerlink\" title=\"广义方面的区别\"></a>广义方面的区别</h2><hr>\n<h3 id=\"正斜杠\"><a href=\"#正斜杠\" class=\"headerlink\" title=\"正斜杠(/)\"></a>正斜杠(/)</h3><p>正斜杠(/)是我们平时很多时候都会用到的斜杠，我们经常会见到这样的写法：小明/小红/小强，你/我/他等等。这种格式在各种文章里面十分常见，表示“或”或者是“和”的意思。</p>\n<p>浏览器中URL的层级URL标记符(//)以及路径分隔符(/)也是由正斜杠(/)组成，例如”<a href=\"https://zh.wikipedia.org/wiki/&quot;\" target=\"_blank\" rel=\"noopener\">https://zh.wikipedia.org/wiki/&quot;</a>, 可以看到里面清一色的都是正斜杠(/)。使用正斜杠(/)的原因据说是web网站最早是在Unix系统下运行的，于是沿袭了Unix的那一套路径表述方式，因此使用正斜杠(/)作为分隔符。</p>\n<p>正斜杠(/)也可以用作“除法”或者“分号”的作用，比如说”100÷4”我们在计算机上输入时，由于除号比较难输，经常就会写成”100/4”，效果是完全一致的。这种用法应该是从“分号”演化来的，毕竟”4/3”你看做“三分之四”还是看做“4除以3”，都是可以的。</p>\n<p>连续两个正斜杠(/)可做“注释”之用，在C++/C#/Java/JavaScript/PHP等主流编程语言中基本上通用：</p>\n<p>日期也可以使用正斜杠(/)分隔年月日，例如”2017/11/17”，也可以用美国标准”11/17/2017”，都表示2017年11月17日。</p>\n<p>最后，斜线除了上述用法，也成为连字号的代替品。例如美国空军的飞机序号。”85-1000”是第1000架飞机在1985年制造，使用斜线”85-1001/1050”表示首批连串50部制造的飞机。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 在控制台打印hello world!</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">'hello world!'</span>)</span><br></pre></td></tr></table></figure>\n<h3 id=\"反斜杠\"><a href=\"#反斜杠\" class=\"headerlink\" title=\"反斜杠(\\)\"></a>反斜杠(\\)</h3><p>比起正斜杠(/)的诸多用处，反斜杠(\\)的用处可就少多了。如果你还是动不动就用到反斜杠(\\)，证明你肯定是一个程序员。</p>\n<p>反斜杠(\\)除了可以在windows下可以做路径分隔符外，最常用的功能就是做转义字符了。许多正则表达式语言都会将它视为字面意义和元字符之前的切换。例如\\n是换行，\\0是空字符，它们表示的实际上都是一个字符（char）；而在一些数学软件（如MATLAB）和维基百科上，可以使用反斜线输入希腊字母。\\pi会转成π，\\lambda会转成λ。由于反斜杠(\\)存在转义字符的作用，因此我们常常在一些代码里面看到形如”C:\\\\Windows\\\\System32\\\\cmd.exe”的路径格式（<em>实际上你看到的双反斜杠(\\)，我在markdown格式下输入了连续4个反斜杠…</em>），并不代表实际路径是这样的，而是其中连续两个反斜杠(\\)发生了“化学反应”，第一个反斜杠(\\)代表对后面部分进行转义，而对反斜杠(\\)的转义还是反斜杠(\\)，因此虽然连续输入两个反斜杠(\\)，但是实际输出时只有一个反斜杠(\\)。</p>\n<p>另外，在某些程序语言的命令行中，例如在linux中,反斜线常被放在一行的末尾用来指示编译器忽略其后的换行符，使得下一行会被当做同一行语句。这种情况下，反斜线作为一个强制换行符，将代码拆解成“连续行”。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><hr>\n<p>通读完这篇文章，相信你对正斜杠(/)和反斜杠(\\)的作用不会再有疑惑了。最后，我再用一张图来总结一下两者各自的功能，以供各位看官整理记忆。</p>\n<p><img src=\"/2017/11/17/深入探讨正斜杠和反斜杠/slash.png\" alt=\"正斜杠和反斜杠\"></p>\n<h2 id=\"TIPS\"><a href=\"#TIPS\" class=\"headerlink\" title=\"TIPS\"></a>TIPS</h2><hr>\n<p>看了这么一大堆正斜杠(/)和反斜杠(\\)，是不是头都大了呢？没关系，要想记忆区分正斜杠(/)反斜杠(\\)，可以把他们想象为笔画上的撇（丿）和捺（㇏），一撇一捺是为八，第一笔正斜，第二笔反斜（/\\），这样是不是好记多了呢？</p>\n"},{"title":"谈一谈大文件上传——前台分片和后台合并","date":"2017-12-01T09:26:35.000Z","picture":"upload.png","description":"最近做了一个需求，需要上传镜像的tar包，小的3、5G，大的可能会达到20多G，而要求在浏览器中上传，因此普通的上传方式肯定无法满足需求，必须要使用到分片上传，前台分片后台就需要合并，一系列做完以后踩了很多坑，在这边总结记录一下。","_content":"最近做了一个需求，需要上传镜像的tar包，小的3、5G，大的可能会达到20多G，而要求在浏览器中上传，因此普通的上传方式肯定无法满足需求，必须要使用到分片上传，前台分片后台就需要合并，一系列做完以后踩了很多坑，在这边总结记录一下。\n\n## 前台分片上传\n\n***\n\n所谓上传，实际上就是一个把文件通过客户端传给服务端的过程，也就是通过前端传给后台的过程。在这个过程中，如果要传输的内容太过庞大，在传输过程中就容易遇到各种各样的问题。为了把出现问题的概率控制在最低，我们往往需要把大文件分成一份一份的小文件来依次上传，这个过程就是我们所说分片上传。\n\n我前台使用的是webuploader上传插件，参考webuploader的切片方法：\n\n{% codeblock lang:javascript %}\n    function CuteFile( file, chunkSize ) {\n        var pending = [],\n            blob = file.source,\n            total = blob.size,\n            chunks = chunkSize ? Math.ceil( total / chunkSize ) : 1,\n            start = 0,\n            index = 0,\n            len, api;\n\n        api = {\n            file: file,\n\n            has: function() {\n                return !!pending.length;\n            },\n\n            shift: function() {\n                return pending.shift();\n            },\n\n            unshift: function( block ) {\n                pending.unshift( block );\n            }\n        };\n\n        while ( index < chunks ) {\n            len = Math.min( chunkSize, total - start );\n\n            pending.push({\n                file: file,\n                start: start,\n                end: chunkSize ? (start + len) : total,\n                total: total,\n                chunks: chunks,\n                chunk: index++,\n                cuted: api\n            });\n            start += len;\n        }\n\n        file.blocks = pending.concat();\n        file.remaning = pending.length;\n\n        return api;\n    }\n{% endcodeblock %}\n\n其中，chunkSize表示每片大小，chunks表示切片的数目，具体切分方法也很简单，看代码就好了。\n\n具体在使用webuploader的过程中，只需要在创建webuploader实例的过程中如下配置一下：\n\n{% codeblock lang:javascript %}\n    const uploader = WebUploader.create({\n        // 文件接收服务端。\n        server: './ftp/images',\n\n        // 选择文件的按钮。可选。\n        // 内部根据当前运行是创建，可能是input元素，也可能是flash.\n        pick: '#picker',\n\n        chunked: true,//开启分片上传\n        chunkSize: 50*1024*1024,//每片大小50M\n        chunkRetry: 1,//失败后重试次数\n        threads: 1,//上传并发数目\n        fileNumLimit: 1,//验证文件总数量，超出则不允许加入队列\n\n    });\n{% endcodeblock %}\n\n## 后台合并\n\n***\n\n\n对于分片上传上来的文件，后台肯定要再次合并起来，重新生成跟原文件一模一样的文件。后台合并的方法有很多，以Node.js为例，可以使用以下方式：\n\n### buffer合并\n\n按照惯例，先贴代码：\n\n{% codeblock lang:javascript %}\n    // 合并分片\n    function mergeChunks(fileName, chunks, callback) {\n        console.log('chunks:' + chunks);\n        let chunkPaths = chunks.map(function (name) {\n            return path.join(process.env.IMAGESDIR, name)\n        });\n\n        // 采用Buffer方式合并\n        const readStream = function (chunkArray, cb) {\n            let buffers = [];\n            chunkPaths.forEach(function (path) {\n                let buffer = fs.readFileSync(path);\n                buffers.push(buffer);\n            });\n\n            let concatBuffer = Buffer.concat(buffers);\n            let concatFilePath = path.join(process.env.IMAGESDIR, fileName);\n            fs.writeFileSync(concatFilePath, concatBuffer);\n\n            chunkPaths.forEach(function (path) {\n                fs.unlinkSync(path)\n            })\n            cb();\n        };\n\n\n        readStream(chunkPaths, callback);\n\n    }\n{% endcodeblock %}\n\nbuffer方式合并是一种常见的文件合并方式，方法是将各个分片文件分别用fs.readFile()方式读取，然后通过Buffer.concat()进行合并。\n\n这种方法简单易理解，但有个最大的缺点，就是你读取的文件有多大，合并的过程占用的内存就有多大，因为我们相当于把这个大文件的全部内容都一次性载入到内存中了，这是非常低效的。同时，Node默认的缓冲区大小的上限是2GB，一旦我们上传的大文件超出2GB，那使用这种方法就会失败。虽然可以通过修改缓冲区大小上限的方法来规避这个问题，但是鉴于这种合并方式极吃内存，我不建议您这么做。\n\n那么，有更好的方式吗？那是当然，下面介绍一种stream合并方式。\n\n### stream合并\n\n显然，stream（流，下面都用‘流’来表示stream）就是这种更好的方式。\n\n按照惯例，先贴代码：\n\n{% codeblock lang:javascript %}\n    // 合并分片\n    function mergeChunks(fileName, chunks, callback) {\n        console.log('chunks:' + chunks);\n        let chunkPaths = chunks.map(function (name) {\n            return path.join(process.env.IMAGESDIR, name)\n        });\n\n        // 采用Stream方式合并\n        let targetStream = fs.createWriteStream(path.join(process.env.IMAGESDIR, fileName));\n        const readStream = function (chunkArray, cb) {\n            let path = chunkArray.shift();\n            let originStream = fs.createReadStream(path);\n            originStream.pipe(targetStream, {end: false});\n            originStream.on(\"end\", function () {\n                // 删除文件\n                fs.unlinkSync(path);\n                if (chunkArray.length > 0) {\n                    readStream(chunkArray, callback)\n                } else {\n                    cb()\n                }\n            });\n        };\n\n        readStream(chunkPaths, callback);\n\n    }\n{% endcodeblock %}\n\n#### 为什么说流更好呢？流到底是什么呢？\n\n流是数据的集合 —— 就像数组或字符串一样。区别在于流中的数据可能不会立刻就全部可用，并且你无需一次性的把这些数据全部放入内存。这使得流在操作大量数据或是数据从外部来源逐段发送过来的时候变得非常有用。\n\n换句话说，当你使用buffer方式来处理一个2GB的文件，占用的内存可能是2GB以上，而当你使用流来处理这个文件，可能只会占用几十个M。这就是我们为什么选择流的原因所在。\n\n在Node.js中，有4种基本类型的流，分别是可读流，可写流，双向流以及变换流。\n\n- 可读流是对一个可以读取数据的源的抽象。fs.createReadStream 方法是一个可读流的例子。\n- 可写流是对一个可以写入数据的目标的抽象。fs.createWriteStream 方法是一个可写流的例子。\n- 双向流既是可读的，又是可写的。TCP socket 就属于这种。\n- 变换流是一种特殊的双向流，它会基于写入的数据生成可供读取的数据。\n\n所有的流都是EventEmitter的实例。它们发出可用于读取或写入数据的事件。然而，我们可以利用pipe方法以一种更简单的方式使用流中的数据。\n\n在上面那段代码中，我们首先通过fs.createWriteStream()创建了一个可写流，用来存放最终合并的文件。然后使用fs.createReadStream()分别读取各个分片后的文件，再通过pipe()方式将读取的数据像倒水一样“倒”到可写流中，到监控到一杯水倒完后，马上接着倒下一杯，直到全部倒完为止。此时，全部文件合并完毕。\n\n### 追加文件方式合并\n\n追加文件方式合并指的是使用fs.appendFile()的方式来进行合并。fs.appendFile()的作用是异步地追加数据到一个文件，如果文件不存在则创建文件。data可以是一个字符串或buffer。例：\n\n{% codeblock lang:javascript %}\n    fs.appendFile('message.txt', 'data to append', (err) => {\n      if (err) throw err;\n      console.log('The \"data to append\" was appended to file!');\n    });\n{% endcodeblock %}\n\n使用这种方法也可以将文件合并，虽然我没有在项目中实验，但通过在网上查的资料来看，性能强过buffer合并方式，但不及流合并方式。\n\n## 小结\n\n***\n\n这篇文章虽然是谈前台分片和后台合并，但是由于前台分片主要是使用webUploader实现的，因此侧重点都在后台合并上。\n\n后台合并主要有3种方式：buffer合并、流合并、追加文件方式合并。三种方式各有各的特点，但是在大文件合并上，我推荐使用流方式合并，流合并占内存最少，效率最高，是处理大文件的最佳选择。","source":"_posts/谈一谈大文件上传——前台分片和后台合并.md","raw":"---\ntitle: 谈一谈大文件上传——前台分片和后台合并\ndate: 2017-12-01 17:26:35\ntags: Node.js\npicture: upload.png\ndescription: 最近做了一个需求，需要上传镜像的tar包，小的3、5G，大的可能会达到20多G，而要求在浏览器中上传，因此普通的上传方式肯定无法满足需求，必须要使用到分片上传，前台分片后台就需要合并，一系列做完以后踩了很多坑，在这边总结记录一下。\n---\n最近做了一个需求，需要上传镜像的tar包，小的3、5G，大的可能会达到20多G，而要求在浏览器中上传，因此普通的上传方式肯定无法满足需求，必须要使用到分片上传，前台分片后台就需要合并，一系列做完以后踩了很多坑，在这边总结记录一下。\n\n## 前台分片上传\n\n***\n\n所谓上传，实际上就是一个把文件通过客户端传给服务端的过程，也就是通过前端传给后台的过程。在这个过程中，如果要传输的内容太过庞大，在传输过程中就容易遇到各种各样的问题。为了把出现问题的概率控制在最低，我们往往需要把大文件分成一份一份的小文件来依次上传，这个过程就是我们所说分片上传。\n\n我前台使用的是webuploader上传插件，参考webuploader的切片方法：\n\n{% codeblock lang:javascript %}\n    function CuteFile( file, chunkSize ) {\n        var pending = [],\n            blob = file.source,\n            total = blob.size,\n            chunks = chunkSize ? Math.ceil( total / chunkSize ) : 1,\n            start = 0,\n            index = 0,\n            len, api;\n\n        api = {\n            file: file,\n\n            has: function() {\n                return !!pending.length;\n            },\n\n            shift: function() {\n                return pending.shift();\n            },\n\n            unshift: function( block ) {\n                pending.unshift( block );\n            }\n        };\n\n        while ( index < chunks ) {\n            len = Math.min( chunkSize, total - start );\n\n            pending.push({\n                file: file,\n                start: start,\n                end: chunkSize ? (start + len) : total,\n                total: total,\n                chunks: chunks,\n                chunk: index++,\n                cuted: api\n            });\n            start += len;\n        }\n\n        file.blocks = pending.concat();\n        file.remaning = pending.length;\n\n        return api;\n    }\n{% endcodeblock %}\n\n其中，chunkSize表示每片大小，chunks表示切片的数目，具体切分方法也很简单，看代码就好了。\n\n具体在使用webuploader的过程中，只需要在创建webuploader实例的过程中如下配置一下：\n\n{% codeblock lang:javascript %}\n    const uploader = WebUploader.create({\n        // 文件接收服务端。\n        server: './ftp/images',\n\n        // 选择文件的按钮。可选。\n        // 内部根据当前运行是创建，可能是input元素，也可能是flash.\n        pick: '#picker',\n\n        chunked: true,//开启分片上传\n        chunkSize: 50*1024*1024,//每片大小50M\n        chunkRetry: 1,//失败后重试次数\n        threads: 1,//上传并发数目\n        fileNumLimit: 1,//验证文件总数量，超出则不允许加入队列\n\n    });\n{% endcodeblock %}\n\n## 后台合并\n\n***\n\n\n对于分片上传上来的文件，后台肯定要再次合并起来，重新生成跟原文件一模一样的文件。后台合并的方法有很多，以Node.js为例，可以使用以下方式：\n\n### buffer合并\n\n按照惯例，先贴代码：\n\n{% codeblock lang:javascript %}\n    // 合并分片\n    function mergeChunks(fileName, chunks, callback) {\n        console.log('chunks:' + chunks);\n        let chunkPaths = chunks.map(function (name) {\n            return path.join(process.env.IMAGESDIR, name)\n        });\n\n        // 采用Buffer方式合并\n        const readStream = function (chunkArray, cb) {\n            let buffers = [];\n            chunkPaths.forEach(function (path) {\n                let buffer = fs.readFileSync(path);\n                buffers.push(buffer);\n            });\n\n            let concatBuffer = Buffer.concat(buffers);\n            let concatFilePath = path.join(process.env.IMAGESDIR, fileName);\n            fs.writeFileSync(concatFilePath, concatBuffer);\n\n            chunkPaths.forEach(function (path) {\n                fs.unlinkSync(path)\n            })\n            cb();\n        };\n\n\n        readStream(chunkPaths, callback);\n\n    }\n{% endcodeblock %}\n\nbuffer方式合并是一种常见的文件合并方式，方法是将各个分片文件分别用fs.readFile()方式读取，然后通过Buffer.concat()进行合并。\n\n这种方法简单易理解，但有个最大的缺点，就是你读取的文件有多大，合并的过程占用的内存就有多大，因为我们相当于把这个大文件的全部内容都一次性载入到内存中了，这是非常低效的。同时，Node默认的缓冲区大小的上限是2GB，一旦我们上传的大文件超出2GB，那使用这种方法就会失败。虽然可以通过修改缓冲区大小上限的方法来规避这个问题，但是鉴于这种合并方式极吃内存，我不建议您这么做。\n\n那么，有更好的方式吗？那是当然，下面介绍一种stream合并方式。\n\n### stream合并\n\n显然，stream（流，下面都用‘流’来表示stream）就是这种更好的方式。\n\n按照惯例，先贴代码：\n\n{% codeblock lang:javascript %}\n    // 合并分片\n    function mergeChunks(fileName, chunks, callback) {\n        console.log('chunks:' + chunks);\n        let chunkPaths = chunks.map(function (name) {\n            return path.join(process.env.IMAGESDIR, name)\n        });\n\n        // 采用Stream方式合并\n        let targetStream = fs.createWriteStream(path.join(process.env.IMAGESDIR, fileName));\n        const readStream = function (chunkArray, cb) {\n            let path = chunkArray.shift();\n            let originStream = fs.createReadStream(path);\n            originStream.pipe(targetStream, {end: false});\n            originStream.on(\"end\", function () {\n                // 删除文件\n                fs.unlinkSync(path);\n                if (chunkArray.length > 0) {\n                    readStream(chunkArray, callback)\n                } else {\n                    cb()\n                }\n            });\n        };\n\n        readStream(chunkPaths, callback);\n\n    }\n{% endcodeblock %}\n\n#### 为什么说流更好呢？流到底是什么呢？\n\n流是数据的集合 —— 就像数组或字符串一样。区别在于流中的数据可能不会立刻就全部可用，并且你无需一次性的把这些数据全部放入内存。这使得流在操作大量数据或是数据从外部来源逐段发送过来的时候变得非常有用。\n\n换句话说，当你使用buffer方式来处理一个2GB的文件，占用的内存可能是2GB以上，而当你使用流来处理这个文件，可能只会占用几十个M。这就是我们为什么选择流的原因所在。\n\n在Node.js中，有4种基本类型的流，分别是可读流，可写流，双向流以及变换流。\n\n- 可读流是对一个可以读取数据的源的抽象。fs.createReadStream 方法是一个可读流的例子。\n- 可写流是对一个可以写入数据的目标的抽象。fs.createWriteStream 方法是一个可写流的例子。\n- 双向流既是可读的，又是可写的。TCP socket 就属于这种。\n- 变换流是一种特殊的双向流，它会基于写入的数据生成可供读取的数据。\n\n所有的流都是EventEmitter的实例。它们发出可用于读取或写入数据的事件。然而，我们可以利用pipe方法以一种更简单的方式使用流中的数据。\n\n在上面那段代码中，我们首先通过fs.createWriteStream()创建了一个可写流，用来存放最终合并的文件。然后使用fs.createReadStream()分别读取各个分片后的文件，再通过pipe()方式将读取的数据像倒水一样“倒”到可写流中，到监控到一杯水倒完后，马上接着倒下一杯，直到全部倒完为止。此时，全部文件合并完毕。\n\n### 追加文件方式合并\n\n追加文件方式合并指的是使用fs.appendFile()的方式来进行合并。fs.appendFile()的作用是异步地追加数据到一个文件，如果文件不存在则创建文件。data可以是一个字符串或buffer。例：\n\n{% codeblock lang:javascript %}\n    fs.appendFile('message.txt', 'data to append', (err) => {\n      if (err) throw err;\n      console.log('The \"data to append\" was appended to file!');\n    });\n{% endcodeblock %}\n\n使用这种方法也可以将文件合并，虽然我没有在项目中实验，但通过在网上查的资料来看，性能强过buffer合并方式，但不及流合并方式。\n\n## 小结\n\n***\n\n这篇文章虽然是谈前台分片和后台合并，但是由于前台分片主要是使用webUploader实现的，因此侧重点都在后台合并上。\n\n后台合并主要有3种方式：buffer合并、流合并、追加文件方式合并。三种方式各有各的特点，但是在大文件合并上，我推荐使用流方式合并，流合并占内存最少，效率最高，是处理大文件的最佳选择。","slug":"谈一谈大文件上传——前台分片和后台合并","published":1,"updated":"2018-03-04T15:08:12.826Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk698hyc000oznzwh4eo1k3y","content":"<p>最近做了一个需求，需要上传镜像的tar包，小的3、5G，大的可能会达到20多G，而要求在浏览器中上传，因此普通的上传方式肯定无法满足需求，必须要使用到分片上传，前台分片后台就需要合并，一系列做完以后踩了很多坑，在这边总结记录一下。</p>\n<h2 id=\"前台分片上传\"><a href=\"#前台分片上传\" class=\"headerlink\" title=\"前台分片上传\"></a>前台分片上传</h2><hr>\n<p>所谓上传，实际上就是一个把文件通过客户端传给服务端的过程，也就是通过前端传给后台的过程。在这个过程中，如果要传输的内容太过庞大，在传输过程中就容易遇到各种各样的问题。为了把出现问题的概率控制在最低，我们往往需要把大文件分成一份一份的小文件来依次上传，这个过程就是我们所说分片上传。</p>\n<p>我前台使用的是webuploader上传插件，参考webuploader的切片方法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">CuteFile</span>(<span class=\"params\"> file, chunkSize </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> pending = [],</span><br><span class=\"line\">        blob = file.source,</span><br><span class=\"line\">        total = blob.size,</span><br><span class=\"line\">        chunks = chunkSize ? <span class=\"built_in\">Math</span>.ceil( total / chunkSize ) : <span class=\"number\">1</span>,</span><br><span class=\"line\">        start = <span class=\"number\">0</span>,</span><br><span class=\"line\">        index = <span class=\"number\">0</span>,</span><br><span class=\"line\">        len, api;</span><br><span class=\"line\"></span><br><span class=\"line\">    api = &#123;</span><br><span class=\"line\">        file: file,</span><br><span class=\"line\"></span><br><span class=\"line\">        has: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> !!pending.length;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        shift: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> pending.shift();</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        unshift: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> block </span>) </span>&#123;</span><br><span class=\"line\">            pending.unshift( block );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> ( index &lt; chunks ) &#123;</span><br><span class=\"line\">        len = <span class=\"built_in\">Math</span>.min( chunkSize, total - start );</span><br><span class=\"line\"></span><br><span class=\"line\">        pending.push(&#123;</span><br><span class=\"line\">            file: file,</span><br><span class=\"line\">            start: start,</span><br><span class=\"line\">            end: chunkSize ? (start + len) : total,</span><br><span class=\"line\">            total: total,</span><br><span class=\"line\">            chunks: chunks,</span><br><span class=\"line\">            chunk: index++,</span><br><span class=\"line\">            cuted: api</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        start += len;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    file.blocks = pending.concat();</span><br><span class=\"line\">    file.remaning = pending.length;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> api;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其中，chunkSize表示每片大小，chunks表示切片的数目，具体切分方法也很简单，看代码就好了。</p>\n<p>具体在使用webuploader的过程中，只需要在创建webuploader实例的过程中如下配置一下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> uploader = WebUploader.create(&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 文件接收服务端。</span></span><br><span class=\"line\">    server: <span class=\"string\">'./ftp/images'</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 选择文件的按钮。可选。</span></span><br><span class=\"line\">    <span class=\"comment\">// 内部根据当前运行是创建，可能是input元素，也可能是flash.</span></span><br><span class=\"line\">    pick: <span class=\"string\">'#picker'</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">    chunked: <span class=\"literal\">true</span>,<span class=\"comment\">//开启分片上传</span></span><br><span class=\"line\">    chunkSize: <span class=\"number\">50</span>*<span class=\"number\">1024</span>*<span class=\"number\">1024</span>,<span class=\"comment\">//每片大小50M</span></span><br><span class=\"line\">    chunkRetry: <span class=\"number\">1</span>,<span class=\"comment\">//失败后重试次数</span></span><br><span class=\"line\">    threads: <span class=\"number\">1</span>,<span class=\"comment\">//上传并发数目</span></span><br><span class=\"line\">    fileNumLimit: <span class=\"number\">1</span>,<span class=\"comment\">//验证文件总数量，超出则不允许加入队列</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"后台合并\"><a href=\"#后台合并\" class=\"headerlink\" title=\"后台合并\"></a>后台合并</h2><hr>\n<p>对于分片上传上来的文件，后台肯定要再次合并起来，重新生成跟原文件一模一样的文件。后台合并的方法有很多，以Node.js为例，可以使用以下方式：</p>\n<h3 id=\"buffer合并\"><a href=\"#buffer合并\" class=\"headerlink\" title=\"buffer合并\"></a>buffer合并</h3><p>按照惯例，先贴代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 合并分片</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mergeChunks</span>(<span class=\"params\">fileName, chunks, callback</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'chunks:'</span> + chunks);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> chunkPaths = chunks.map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> path.join(process.env.IMAGESDIR, name)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 采用Buffer方式合并</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> readStream = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">chunkArray, cb</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> buffers = [];</span><br><span class=\"line\">        chunkPaths.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">path</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> buffer = fs.readFileSync(path);</span><br><span class=\"line\">            buffers.push(buffer);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">let</span> concatBuffer = Buffer.concat(buffers);</span><br><span class=\"line\">        <span class=\"keyword\">let</span> concatFilePath = path.join(process.env.IMAGESDIR, fileName);</span><br><span class=\"line\">        fs.writeFileSync(concatFilePath, concatBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\">        chunkPaths.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">path</span>) </span>&#123;</span><br><span class=\"line\">            fs.unlinkSync(path)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        cb();</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    readStream(chunkPaths, callback);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>buffer方式合并是一种常见的文件合并方式，方法是将各个分片文件分别用fs.readFile()方式读取，然后通过Buffer.concat()进行合并。</p>\n<p>这种方法简单易理解，但有个最大的缺点，就是你读取的文件有多大，合并的过程占用的内存就有多大，因为我们相当于把这个大文件的全部内容都一次性载入到内存中了，这是非常低效的。同时，Node默认的缓冲区大小的上限是2GB，一旦我们上传的大文件超出2GB，那使用这种方法就会失败。虽然可以通过修改缓冲区大小上限的方法来规避这个问题，但是鉴于这种合并方式极吃内存，我不建议您这么做。</p>\n<p>那么，有更好的方式吗？那是当然，下面介绍一种stream合并方式。</p>\n<h3 id=\"stream合并\"><a href=\"#stream合并\" class=\"headerlink\" title=\"stream合并\"></a>stream合并</h3><p>显然，stream（流，下面都用‘流’来表示stream）就是这种更好的方式。</p>\n<p>按照惯例，先贴代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 合并分片</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mergeChunks</span>(<span class=\"params\">fileName, chunks, callback</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'chunks:'</span> + chunks);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> chunkPaths = chunks.map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> path.join(process.env.IMAGESDIR, name)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 采用Stream方式合并</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> targetStream = fs.createWriteStream(path.join(process.env.IMAGESDIR, fileName));</span><br><span class=\"line\">    <span class=\"keyword\">const</span> readStream = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">chunkArray, cb</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> path = chunkArray.shift();</span><br><span class=\"line\">        <span class=\"keyword\">let</span> originStream = fs.createReadStream(path);</span><br><span class=\"line\">        originStream.pipe(targetStream, &#123;<span class=\"attr\">end</span>: <span class=\"literal\">false</span>&#125;);</span><br><span class=\"line\">        originStream.on(<span class=\"string\">\"end\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 删除文件</span></span><br><span class=\"line\">            fs.unlinkSync(path);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (chunkArray.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                readStream(chunkArray, callback)</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                cb()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    readStream(chunkPaths, callback);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"为什么说流更好呢？流到底是什么呢？\"><a href=\"#为什么说流更好呢？流到底是什么呢？\" class=\"headerlink\" title=\"为什么说流更好呢？流到底是什么呢？\"></a>为什么说流更好呢？流到底是什么呢？</h4><p>流是数据的集合 —— 就像数组或字符串一样。区别在于流中的数据可能不会立刻就全部可用，并且你无需一次性的把这些数据全部放入内存。这使得流在操作大量数据或是数据从外部来源逐段发送过来的时候变得非常有用。</p>\n<p>换句话说，当你使用buffer方式来处理一个2GB的文件，占用的内存可能是2GB以上，而当你使用流来处理这个文件，可能只会占用几十个M。这就是我们为什么选择流的原因所在。</p>\n<p>在Node.js中，有4种基本类型的流，分别是可读流，可写流，双向流以及变换流。</p>\n<ul>\n<li>可读流是对一个可以读取数据的源的抽象。fs.createReadStream 方法是一个可读流的例子。</li>\n<li>可写流是对一个可以写入数据的目标的抽象。fs.createWriteStream 方法是一个可写流的例子。</li>\n<li>双向流既是可读的，又是可写的。TCP socket 就属于这种。</li>\n<li>变换流是一种特殊的双向流，它会基于写入的数据生成可供读取的数据。</li>\n</ul>\n<p>所有的流都是EventEmitter的实例。它们发出可用于读取或写入数据的事件。然而，我们可以利用pipe方法以一种更简单的方式使用流中的数据。</p>\n<p>在上面那段代码中，我们首先通过fs.createWriteStream()创建了一个可写流，用来存放最终合并的文件。然后使用fs.createReadStream()分别读取各个分片后的文件，再通过pipe()方式将读取的数据像倒水一样“倒”到可写流中，到监控到一杯水倒完后，马上接着倒下一杯，直到全部倒完为止。此时，全部文件合并完毕。</p>\n<h3 id=\"追加文件方式合并\"><a href=\"#追加文件方式合并\" class=\"headerlink\" title=\"追加文件方式合并\"></a>追加文件方式合并</h3><p>追加文件方式合并指的是使用fs.appendFile()的方式来进行合并。fs.appendFile()的作用是异步地追加数据到一个文件，如果文件不存在则创建文件。data可以是一个字符串或buffer。例：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fs.appendFile(<span class=\"string\">'message.txt'</span>, <span class=\"string\">'data to append'</span>, (err) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (err) <span class=\"keyword\">throw</span> err;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'The \"data to append\" was appended to file!'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>使用这种方法也可以将文件合并，虽然我没有在项目中实验，但通过在网上查的资料来看，性能强过buffer合并方式，但不及流合并方式。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><hr>\n<p>这篇文章虽然是谈前台分片和后台合并，但是由于前台分片主要是使用webUploader实现的，因此侧重点都在后台合并上。</p>\n<p>后台合并主要有3种方式：buffer合并、流合并、追加文件方式合并。三种方式各有各的特点，但是在大文件合并上，我推荐使用流方式合并，流合并占内存最少，效率最高，是处理大文件的最佳选择。</p>\n","site":{"data":{}},"excerpt":"","more":"<p>最近做了一个需求，需要上传镜像的tar包，小的3、5G，大的可能会达到20多G，而要求在浏览器中上传，因此普通的上传方式肯定无法满足需求，必须要使用到分片上传，前台分片后台就需要合并，一系列做完以后踩了很多坑，在这边总结记录一下。</p>\n<h2 id=\"前台分片上传\"><a href=\"#前台分片上传\" class=\"headerlink\" title=\"前台分片上传\"></a>前台分片上传</h2><hr>\n<p>所谓上传，实际上就是一个把文件通过客户端传给服务端的过程，也就是通过前端传给后台的过程。在这个过程中，如果要传输的内容太过庞大，在传输过程中就容易遇到各种各样的问题。为了把出现问题的概率控制在最低，我们往往需要把大文件分成一份一份的小文件来依次上传，这个过程就是我们所说分片上传。</p>\n<p>我前台使用的是webuploader上传插件，参考webuploader的切片方法：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">CuteFile</span>(<span class=\"params\"> file, chunkSize </span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> pending = [],</span><br><span class=\"line\">        blob = file.source,</span><br><span class=\"line\">        total = blob.size,</span><br><span class=\"line\">        chunks = chunkSize ? <span class=\"built_in\">Math</span>.ceil( total / chunkSize ) : <span class=\"number\">1</span>,</span><br><span class=\"line\">        start = <span class=\"number\">0</span>,</span><br><span class=\"line\">        index = <span class=\"number\">0</span>,</span><br><span class=\"line\">        len, api;</span><br><span class=\"line\"></span><br><span class=\"line\">    api = &#123;</span><br><span class=\"line\">        file: file,</span><br><span class=\"line\"></span><br><span class=\"line\">        has: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> !!pending.length;</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        shift: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> pending.shift();</span><br><span class=\"line\">        &#125;,</span><br><span class=\"line\"></span><br><span class=\"line\">        unshift: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"> block </span>) </span>&#123;</span><br><span class=\"line\">            pending.unshift( block );</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">while</span> ( index &lt; chunks ) &#123;</span><br><span class=\"line\">        len = <span class=\"built_in\">Math</span>.min( chunkSize, total - start );</span><br><span class=\"line\"></span><br><span class=\"line\">        pending.push(&#123;</span><br><span class=\"line\">            file: file,</span><br><span class=\"line\">            start: start,</span><br><span class=\"line\">            end: chunkSize ? (start + len) : total,</span><br><span class=\"line\">            total: total,</span><br><span class=\"line\">            chunks: chunks,</span><br><span class=\"line\">            chunk: index++,</span><br><span class=\"line\">            cuted: api</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">        start += len;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    file.blocks = pending.concat();</span><br><span class=\"line\">    file.remaning = pending.length;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> api;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>其中，chunkSize表示每片大小，chunks表示切片的数目，具体切分方法也很简单，看代码就好了。</p>\n<p>具体在使用webuploader的过程中，只需要在创建webuploader实例的过程中如下配置一下：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> uploader = WebUploader.create(&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 文件接收服务端。</span></span><br><span class=\"line\">    server: <span class=\"string\">'./ftp/images'</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 选择文件的按钮。可选。</span></span><br><span class=\"line\">    <span class=\"comment\">// 内部根据当前运行是创建，可能是input元素，也可能是flash.</span></span><br><span class=\"line\">    pick: <span class=\"string\">'#picker'</span>,</span><br><span class=\"line\"></span><br><span class=\"line\">    chunked: <span class=\"literal\">true</span>,<span class=\"comment\">//开启分片上传</span></span><br><span class=\"line\">    chunkSize: <span class=\"number\">50</span>*<span class=\"number\">1024</span>*<span class=\"number\">1024</span>,<span class=\"comment\">//每片大小50M</span></span><br><span class=\"line\">    chunkRetry: <span class=\"number\">1</span>,<span class=\"comment\">//失败后重试次数</span></span><br><span class=\"line\">    threads: <span class=\"number\">1</span>,<span class=\"comment\">//上传并发数目</span></span><br><span class=\"line\">    fileNumLimit: <span class=\"number\">1</span>,<span class=\"comment\">//验证文件总数量，超出则不允许加入队列</span></span><br><span class=\"line\"></span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<h2 id=\"后台合并\"><a href=\"#后台合并\" class=\"headerlink\" title=\"后台合并\"></a>后台合并</h2><hr>\n<p>对于分片上传上来的文件，后台肯定要再次合并起来，重新生成跟原文件一模一样的文件。后台合并的方法有很多，以Node.js为例，可以使用以下方式：</p>\n<h3 id=\"buffer合并\"><a href=\"#buffer合并\" class=\"headerlink\" title=\"buffer合并\"></a>buffer合并</h3><p>按照惯例，先贴代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 合并分片</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mergeChunks</span>(<span class=\"params\">fileName, chunks, callback</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'chunks:'</span> + chunks);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> chunkPaths = chunks.map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> path.join(process.env.IMAGESDIR, name)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 采用Buffer方式合并</span></span><br><span class=\"line\">    <span class=\"keyword\">const</span> readStream = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">chunkArray, cb</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> buffers = [];</span><br><span class=\"line\">        chunkPaths.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">path</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> buffer = fs.readFileSync(path);</span><br><span class=\"line\">            buffers.push(buffer);</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"keyword\">let</span> concatBuffer = Buffer.concat(buffers);</span><br><span class=\"line\">        <span class=\"keyword\">let</span> concatFilePath = path.join(process.env.IMAGESDIR, fileName);</span><br><span class=\"line\">        fs.writeFileSync(concatFilePath, concatBuffer);</span><br><span class=\"line\"></span><br><span class=\"line\">        chunkPaths.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">path</span>) </span>&#123;</span><br><span class=\"line\">            fs.unlinkSync(path)</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">        cb();</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">    readStream(chunkPaths, callback);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p>buffer方式合并是一种常见的文件合并方式，方法是将各个分片文件分别用fs.readFile()方式读取，然后通过Buffer.concat()进行合并。</p>\n<p>这种方法简单易理解，但有个最大的缺点，就是你读取的文件有多大，合并的过程占用的内存就有多大，因为我们相当于把这个大文件的全部内容都一次性载入到内存中了，这是非常低效的。同时，Node默认的缓冲区大小的上限是2GB，一旦我们上传的大文件超出2GB，那使用这种方法就会失败。虽然可以通过修改缓冲区大小上限的方法来规避这个问题，但是鉴于这种合并方式极吃内存，我不建议您这么做。</p>\n<p>那么，有更好的方式吗？那是当然，下面介绍一种stream合并方式。</p>\n<h3 id=\"stream合并\"><a href=\"#stream合并\" class=\"headerlink\" title=\"stream合并\"></a>stream合并</h3><p>显然，stream（流，下面都用‘流’来表示stream）就是这种更好的方式。</p>\n<p>按照惯例，先贴代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 合并分片</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mergeChunks</span>(<span class=\"params\">fileName, chunks, callback</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'chunks:'</span> + chunks);</span><br><span class=\"line\">    <span class=\"keyword\">let</span> chunkPaths = chunks.map(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">name</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> path.join(process.env.IMAGESDIR, name)</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 采用Stream方式合并</span></span><br><span class=\"line\">    <span class=\"keyword\">let</span> targetStream = fs.createWriteStream(path.join(process.env.IMAGESDIR, fileName));</span><br><span class=\"line\">    <span class=\"keyword\">const</span> readStream = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">chunkArray, cb</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> path = chunkArray.shift();</span><br><span class=\"line\">        <span class=\"keyword\">let</span> originStream = fs.createReadStream(path);</span><br><span class=\"line\">        originStream.pipe(targetStream, &#123;<span class=\"attr\">end</span>: <span class=\"literal\">false</span>&#125;);</span><br><span class=\"line\">        originStream.on(<span class=\"string\">\"end\"</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 删除文件</span></span><br><span class=\"line\">            fs.unlinkSync(path);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (chunkArray.length &gt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">                readStream(chunkArray, callback)</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                cb()</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;);</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    readStream(chunkPaths, callback);</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<h4 id=\"为什么说流更好呢？流到底是什么呢？\"><a href=\"#为什么说流更好呢？流到底是什么呢？\" class=\"headerlink\" title=\"为什么说流更好呢？流到底是什么呢？\"></a>为什么说流更好呢？流到底是什么呢？</h4><p>流是数据的集合 —— 就像数组或字符串一样。区别在于流中的数据可能不会立刻就全部可用，并且你无需一次性的把这些数据全部放入内存。这使得流在操作大量数据或是数据从外部来源逐段发送过来的时候变得非常有用。</p>\n<p>换句话说，当你使用buffer方式来处理一个2GB的文件，占用的内存可能是2GB以上，而当你使用流来处理这个文件，可能只会占用几十个M。这就是我们为什么选择流的原因所在。</p>\n<p>在Node.js中，有4种基本类型的流，分别是可读流，可写流，双向流以及变换流。</p>\n<ul>\n<li>可读流是对一个可以读取数据的源的抽象。fs.createReadStream 方法是一个可读流的例子。</li>\n<li>可写流是对一个可以写入数据的目标的抽象。fs.createWriteStream 方法是一个可写流的例子。</li>\n<li>双向流既是可读的，又是可写的。TCP socket 就属于这种。</li>\n<li>变换流是一种特殊的双向流，它会基于写入的数据生成可供读取的数据。</li>\n</ul>\n<p>所有的流都是EventEmitter的实例。它们发出可用于读取或写入数据的事件。然而，我们可以利用pipe方法以一种更简单的方式使用流中的数据。</p>\n<p>在上面那段代码中，我们首先通过fs.createWriteStream()创建了一个可写流，用来存放最终合并的文件。然后使用fs.createReadStream()分别读取各个分片后的文件，再通过pipe()方式将读取的数据像倒水一样“倒”到可写流中，到监控到一杯水倒完后，马上接着倒下一杯，直到全部倒完为止。此时，全部文件合并完毕。</p>\n<h3 id=\"追加文件方式合并\"><a href=\"#追加文件方式合并\" class=\"headerlink\" title=\"追加文件方式合并\"></a>追加文件方式合并</h3><p>追加文件方式合并指的是使用fs.appendFile()的方式来进行合并。fs.appendFile()的作用是异步地追加数据到一个文件，如果文件不存在则创建文件。data可以是一个字符串或buffer。例：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fs.appendFile(<span class=\"string\">'message.txt'</span>, <span class=\"string\">'data to append'</span>, (err) =&gt; &#123;</span><br><span class=\"line\">  <span class=\"keyword\">if</span> (err) <span class=\"keyword\">throw</span> err;</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(<span class=\"string\">'The \"data to append\" was appended to file!'</span>);</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n<p>使用这种方法也可以将文件合并，虽然我没有在项目中实验，但通过在网上查的资料来看，性能强过buffer合并方式，但不及流合并方式。</p>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><hr>\n<p>这篇文章虽然是谈前台分片和后台合并，但是由于前台分片主要是使用webUploader实现的，因此侧重点都在后台合并上。</p>\n<p>后台合并主要有3种方式：buffer合并、流合并、追加文件方式合并。三种方式各有各的特点，但是在大文件合并上，我推荐使用流方式合并，流合并占内存最少，效率最高，是处理大文件的最佳选择。</p>\n"},{"title":"通过microtasks和macrotasks看JavaScript异步任务执行顺序","date":"2017-10-24T03:08:09.000Z","picture":"tasks.png","description":"JS引擎是单线程的。这意味着在任何环境中，只有一段JS代码会被执行。当JS引擎开始执行一个函数时，它就会把这个函数执行完，也就是说只有执行完这段代码才会继续执行后面的代码。这种模式的好处是实现起来比较简单，执行环境相对单纯；坏处是只要有一个任务耗时很长，后面的任务都必须排队等着，会拖延整个程序的执行。因此，JavaScript采用了一种“异步”的方式，在浏览器端，耗时很长的操作都应该异步执行。本文，我们将讨论几种常见的异步操作方式，并且通过将任务划分为microtasks和macrotasks来分析异步任务的执行顺序。","_content":"### 1. 初探 --- setTimeout()的那些事儿\n\n***\n\n相信很多人在初学JavaScript的时候都遇到过类似的代码：\n\n\n{% codeblock lang:javascript %}\n    // part1\n    console.log(1);\n    setTimeout(function(){\n        console.log(2);\n    },100);\n    console.log(3);\n    console.log(4);\n    // part2\n    console.log(1);\n    setTimeout(function(){\n        console.log(2);\n    },0);\n    console.log(3);\n    console.log(4);\n{% endcodeblock %}\n\n萌新们看到这个，肯定觉得很简单。part1输出顺序是1,3,4,2;part2输出顺序是1,2,3,4嘛。显而易见，part1中在打印2的时候延迟了100ms，所以被放到了队列的尾端执行，理所当然的最后输出；part2中虽然调用了setTimeout函数，但是延迟设置为0ms，实际上并未延迟，因此应该立即执行，所以输出顺序应该是1,2,3,4。\n\n看到这里，很多人应该都知道了，上面的说法实际上是错误的。\n\n> setTimeout(fn,0)的含义是，指定某个任务在主线程最早可得的空闲时间执行，也就是说，尽可能早得执行。它在\"任务队列\"的尾部添加一个事件，因此要等到同步任务和\"任务队列\"现有的事件都处理完，才会得到执行。\n\n上面的这段文字摘自[阮一峰的博客](http://www.ruanyifeng.com/blog/2014/10/event-loop.html)，即使你的延迟设定的是0，setTimeout仍然会将你的函数给放到队列最尾端，等你的当前任务执行完毕以后,才会去执行该函数。\n\n### 2. 深入 --- setTimeout()和Promise同场竞技时是什么样呢？\n\n***\n\n众所周知，Promise是ES6发布的一种非常流行的异步实现方案，当Promise和setTimeout同时出现在一段代码中，他们的执行顺序是什么样子的呢？请看下面这段代码：\n\n{% codeblock lang:javascript %}\n    setTimeout(function(){\n        console.log(1)\n    },0);\n    new Promise(function(resolve){\n        console.log(2)\n        for( var i=100000 ; i>0 ; i-- ){\n            i==1 && resolve()\n        }\n        console.log(3)\n    }).then(function(){\n        console.log(4)\n    });\n    console.log(5);\n{% endcodeblock %}\n\n如果按照正常逻辑分析，应该是这样的：\n1. 当运行到setTimeout时，会把setTimeout的回调函数console.log(1)放到任务队列里去，然后继续向下执行。\n2. 接下来会遇到一个Promise。首先执行打印console.log(2)，然后执行for循环，即时for循环要累加到10万，也是在执行栈里面，等待for循环执行完毕以后，将Promise的状态从fulfilled切换到resolve，随后把要执行的回调函数，也就是then里面的console.log(4)推到任务队列里面去。接下来马上执行马上console.log(3)。\n3. 然后出Promise，还剩一个同步的console.log(5)，直接打印。这样第一轮下来，已经依次打印了2，3，5。\n4. 然后再读取任务队列，任务队列里还剩console.log(1)和console.log(4)，因为任务队列是队列嘛，肯定遵循的先进先出的策略，因此更早入列的setTimeout()的回调函数先执行，打印1，最后剩下Promise的回调，打印4。\n\n因此一通分析下来，得到的打印结果是2,3,5,1,4。那我们实际试一下呢？\n\n{% codeblock lang:javascript %}\n    2\n    3\n    5\n    4\n    1\n{% endcodeblock %}\n\n啊嘞嘞？跟我们一开始想象的貌似有点不一样啊！是什么原因导致了原本应该在setTimeout回调后面的Promise的回调反而跑到前面去执行了呢？\n\n为了搞清这个问题，我专门去翻阅了一下资料，首先找到了[Promises/A+标准](https://promisesaplus.com/#point-67)里面提到：\n\n>   Here “platform code” means engine, environment, and promise implementation code. In practice, this requirement ensures that onFulfilled and onRejected execute asynchronously, after the event loop turn in which then is called, and with a fresh stack. <span style=\"color:red\">This can be implemented with either a “macro-task” mechanism such as setTimeout or setImmediate, or with a “micro-task” mechanism such as MutationObserver or process.nextTick. </span>Since the promise implementation is considered platform code, it may itself contain a task-scheduling queue or “trampoline” in which the handlers are called.\n\n这里提到了micro-task和macro-task这两个概念，并分别列举了两种情况：setTimeout和setImmediate属于macro-task，MutationObserver和process.nextTick属于micro-task。但并没有进一步的详述，于是我以此为线索进一步搜索资料，找到[stackoverflow上的一个问答](https://stackoverflow.com/questions/25915634/difference-between-microtask-and-macrotask-within-an-event-loop-context)，终于让我的疑惑得到解决。\n\nmacrotasks和microtasks的划分：\n\n#### macrotasks:\n- setTimeout\n- setInterval\n- setImmediate\n- requestAnimationFrame\n- I/O\n- UI rendering\n\n#### microtasks:\n- process.nextTick\n- Promises\n- Object.observe\n- MutationObserver\n\n那我们上面提到的任务队列到底是什么呢？跟macrotasks和microtasks有什么联系呢？\n\n>   - An event loop has one or more task queues.(task queue is macrotask queue)\n  - Each event loop has a microtask queue.\n  - task queue = macrotask queue != microtask queue\n  - a task may be pushed into macrotask queue,or microtask queue\n  - when a task is pushed into a queue(micro/macro),we mean preparing work is finished,so the task can be executed now.\n\n翻译一下就是：\n- 一个事件循环有一个或者多个任务队列；\n- 每个事件循环都有一个microtask队列\n- macrotask队列就是我们常说的任务队列，microtask队列不是任务队列\n- 一个任务可以被放入到macrotask队列，也可以放入microtask队列\n- 当一个任务被放入microtask或者macrotask队列后，准备工作就已经结束，这时候可以开始执行任务了。\n\n可见，setTimeout和Promises不是同一类的任务，处理方式应该会有区别，具体的处理方式有什么不同呢？我从[这篇文章](https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/?utm_source=html5weekly&utm_medium=email)里找到了下面这段话：\n\n> Microtasks are usually scheduled for things that should happen straight after the currently executing script, such as reacting to a batch of actions, or to make something async without taking the penalty of a whole new task. The microtask queue is processed after callbacks as long as no other JavaScript is mid-execution, and at the end of each task. Any additional microtasks queued during microtasks are added to the end of the queue and also processed. Microtasks include mutation observer callbacks, and as in the above example, promise callbacks.\n\n通俗的解释一下，<font color=\"red\">microtasks的作用是用来调度应在当前执行的脚本执行结束后立即执行的任务。</font>  例如响应事件、或者异步操作，以避免付出额外的一个task的费用。\n\nmicrotask会在两种情况下执行：\n1. 任务队列(macrotask = task queue)回调后执行，前提条件是当前没有其他执行中的代码。\n2. 每个task末尾执行。\n\n另外在处理microtask期间，如果有新添加的microtasks，也会被添加到队列的末尾并执行。\n\n也就是说执行顺序是：\n\n开始 -> <font color=\"red\">取task queue第一个task执行 -> 取microtask全部任务依次执行 -> 取task queue下一个任务执行 -> 再次取出microtask全部任务执行 -> ...  </font>  这样循环往复\n\n\n> Once a promise settles, or if it has already settled, it queues a microtask for its reactionary callbacks. This ensures promise callbacks are async even if the promise has already settled. So calling .then(yey, nay) against a settled promise immediately queues a microtask. This is why promise1 and promise2 are logged after script end, as the currently running script must finish before microtasks are handled. promise1 and promise2 are logged before setTimeout, as microtasks always happen before the next task.\n\nPromise一旦状态置为完成态，便为其回调(.then内的函数)安排一个microtask。\n\n接下来我们看回我们上面的代码\n\n{% codeblock lang:javascript %}\n    setTimeout(function(){\n        console.log(1)\n    },0);\n    new Promise(function(resolve){\n        console.log(2)\n        for( var i=100000 ; i>0 ; i-- ){\n            i==1 && resolve()\n        }\n        console.log(3)\n    }).then(function(){\n        console.log(4)\n    });\n    console.log(5);\n{% endcodeblock %}\n\n按照上面的规则重新分析一遍：\n1. 当运行到setTimeout时，会把setTimeout的回调函数console.log(1)放到任务队列里去，然后继续向下执行。\n2. 接下来会遇到一个Promise。首先执行打印console.log(2)，然后执行for循环，即时for循环要累加到10万，也是在执行栈里面，等待for循环执行完毕以后，将Promise的状态从fulfilled切换到resolve，<font color=\"red\">随后把要执行的回调函数，也就是then里面的console.log(4)推到microtask里面去。</font>接下来马上执行马上console.log(3)。\n3. 然后出Promise，还剩一个同步的console.log(5)，直接打印。这样第一轮下来，已经依次打印了2，3，5。\n4. 现在第一轮任务队列已经执行完毕，没有正在执行的代码。符合上面讲的microtask执行条件，因此会将microtask中的任务优先执行，因此执行console.log(4)\n5. 最后还剩macrotask里的setTimeout放入的函数console.log(1)最后执行。\n\n如此分析输出顺序是：\n\n{% codeblock lang:javascript %}\n    2\n    3\n    5\n    4\n    1\n{% endcodeblock %}\n\n看吧，这次分析对了呢ヾ(◍°∇°◍)ﾉﾞ\n\n### 3. 总结和参考资料\n\n***\n\nmicrotask和macrotask看起来容易混淆，实际上还是很好区分的。macrotask就是我们常说的任务队列(task queue)。\n\nJavaScript执行顺序可以简要总结如下：\n\n开始 -> <font color=\"red\">取task queue第一个task执行 -> 取microtask全部任务依次执行 -> 取task queue下一个任务执行 -> 再次取出microtask全部任务执行 -> ...  </font>\n\n循环往复，直至两个队列全部任务执行完毕。\n\n#### 参考资料\n\n[Tasks, microtasks, queues and schedules](https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/?utm_source=html5weekly&utm_medium=email)\n[github-setImmediate.js](https://github.com/YuzuJS/setImmediate)\n[Promises/A+](https://promisesaplus.com/#point-67)\n[知乎-Promise的队列与setTimeout的队列有何关联？](https://www.zhihu.com/question/36972010)\n[stack overflow-Difference between microtask and macrotask within an event loop context\n](https://stackoverflow.com/questions/25915634/difference-between-microtask-and-macrotask-within-an-event-loop-context)\n[阮一峰-JavaScript 运行机制详解：再谈Event Loop](http://www.ruanyifeng.com/blog/2014/10/event-loop.html)","source":"_posts/通过microtasks和macrotasks看JavaScript异步任务执行顺序.md","raw":"---\ntitle: 通过microtasks和macrotasks看JavaScript异步任务执行顺序\ndate: 2017-10-24 11:08:09\ntags: JavaScript\npicture: tasks.png\ndescription: JS引擎是单线程的。这意味着在任何环境中，只有一段JS代码会被执行。当JS引擎开始执行一个函数时，它就会把这个函数执行完，也就是说只有执行完这段代码才会继续执行后面的代码。这种模式的好处是实现起来比较简单，执行环境相对单纯；坏处是只要有一个任务耗时很长，后面的任务都必须排队等着，会拖延整个程序的执行。因此，JavaScript采用了一种“异步”的方式，在浏览器端，耗时很长的操作都应该异步执行。本文，我们将讨论几种常见的异步操作方式，并且通过将任务划分为microtasks和macrotasks来分析异步任务的执行顺序。\n\n---\n### 1. 初探 --- setTimeout()的那些事儿\n\n***\n\n相信很多人在初学JavaScript的时候都遇到过类似的代码：\n\n\n{% codeblock lang:javascript %}\n    // part1\n    console.log(1);\n    setTimeout(function(){\n        console.log(2);\n    },100);\n    console.log(3);\n    console.log(4);\n    // part2\n    console.log(1);\n    setTimeout(function(){\n        console.log(2);\n    },0);\n    console.log(3);\n    console.log(4);\n{% endcodeblock %}\n\n萌新们看到这个，肯定觉得很简单。part1输出顺序是1,3,4,2;part2输出顺序是1,2,3,4嘛。显而易见，part1中在打印2的时候延迟了100ms，所以被放到了队列的尾端执行，理所当然的最后输出；part2中虽然调用了setTimeout函数，但是延迟设置为0ms，实际上并未延迟，因此应该立即执行，所以输出顺序应该是1,2,3,4。\n\n看到这里，很多人应该都知道了，上面的说法实际上是错误的。\n\n> setTimeout(fn,0)的含义是，指定某个任务在主线程最早可得的空闲时间执行，也就是说，尽可能早得执行。它在\"任务队列\"的尾部添加一个事件，因此要等到同步任务和\"任务队列\"现有的事件都处理完，才会得到执行。\n\n上面的这段文字摘自[阮一峰的博客](http://www.ruanyifeng.com/blog/2014/10/event-loop.html)，即使你的延迟设定的是0，setTimeout仍然会将你的函数给放到队列最尾端，等你的当前任务执行完毕以后,才会去执行该函数。\n\n### 2. 深入 --- setTimeout()和Promise同场竞技时是什么样呢？\n\n***\n\n众所周知，Promise是ES6发布的一种非常流行的异步实现方案，当Promise和setTimeout同时出现在一段代码中，他们的执行顺序是什么样子的呢？请看下面这段代码：\n\n{% codeblock lang:javascript %}\n    setTimeout(function(){\n        console.log(1)\n    },0);\n    new Promise(function(resolve){\n        console.log(2)\n        for( var i=100000 ; i>0 ; i-- ){\n            i==1 && resolve()\n        }\n        console.log(3)\n    }).then(function(){\n        console.log(4)\n    });\n    console.log(5);\n{% endcodeblock %}\n\n如果按照正常逻辑分析，应该是这样的：\n1. 当运行到setTimeout时，会把setTimeout的回调函数console.log(1)放到任务队列里去，然后继续向下执行。\n2. 接下来会遇到一个Promise。首先执行打印console.log(2)，然后执行for循环，即时for循环要累加到10万，也是在执行栈里面，等待for循环执行完毕以后，将Promise的状态从fulfilled切换到resolve，随后把要执行的回调函数，也就是then里面的console.log(4)推到任务队列里面去。接下来马上执行马上console.log(3)。\n3. 然后出Promise，还剩一个同步的console.log(5)，直接打印。这样第一轮下来，已经依次打印了2，3，5。\n4. 然后再读取任务队列，任务队列里还剩console.log(1)和console.log(4)，因为任务队列是队列嘛，肯定遵循的先进先出的策略，因此更早入列的setTimeout()的回调函数先执行，打印1，最后剩下Promise的回调，打印4。\n\n因此一通分析下来，得到的打印结果是2,3,5,1,4。那我们实际试一下呢？\n\n{% codeblock lang:javascript %}\n    2\n    3\n    5\n    4\n    1\n{% endcodeblock %}\n\n啊嘞嘞？跟我们一开始想象的貌似有点不一样啊！是什么原因导致了原本应该在setTimeout回调后面的Promise的回调反而跑到前面去执行了呢？\n\n为了搞清这个问题，我专门去翻阅了一下资料，首先找到了[Promises/A+标准](https://promisesaplus.com/#point-67)里面提到：\n\n>   Here “platform code” means engine, environment, and promise implementation code. In practice, this requirement ensures that onFulfilled and onRejected execute asynchronously, after the event loop turn in which then is called, and with a fresh stack. <span style=\"color:red\">This can be implemented with either a “macro-task” mechanism such as setTimeout or setImmediate, or with a “micro-task” mechanism such as MutationObserver or process.nextTick. </span>Since the promise implementation is considered platform code, it may itself contain a task-scheduling queue or “trampoline” in which the handlers are called.\n\n这里提到了micro-task和macro-task这两个概念，并分别列举了两种情况：setTimeout和setImmediate属于macro-task，MutationObserver和process.nextTick属于micro-task。但并没有进一步的详述，于是我以此为线索进一步搜索资料，找到[stackoverflow上的一个问答](https://stackoverflow.com/questions/25915634/difference-between-microtask-and-macrotask-within-an-event-loop-context)，终于让我的疑惑得到解决。\n\nmacrotasks和microtasks的划分：\n\n#### macrotasks:\n- setTimeout\n- setInterval\n- setImmediate\n- requestAnimationFrame\n- I/O\n- UI rendering\n\n#### microtasks:\n- process.nextTick\n- Promises\n- Object.observe\n- MutationObserver\n\n那我们上面提到的任务队列到底是什么呢？跟macrotasks和microtasks有什么联系呢？\n\n>   - An event loop has one or more task queues.(task queue is macrotask queue)\n  - Each event loop has a microtask queue.\n  - task queue = macrotask queue != microtask queue\n  - a task may be pushed into macrotask queue,or microtask queue\n  - when a task is pushed into a queue(micro/macro),we mean preparing work is finished,so the task can be executed now.\n\n翻译一下就是：\n- 一个事件循环有一个或者多个任务队列；\n- 每个事件循环都有一个microtask队列\n- macrotask队列就是我们常说的任务队列，microtask队列不是任务队列\n- 一个任务可以被放入到macrotask队列，也可以放入microtask队列\n- 当一个任务被放入microtask或者macrotask队列后，准备工作就已经结束，这时候可以开始执行任务了。\n\n可见，setTimeout和Promises不是同一类的任务，处理方式应该会有区别，具体的处理方式有什么不同呢？我从[这篇文章](https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/?utm_source=html5weekly&utm_medium=email)里找到了下面这段话：\n\n> Microtasks are usually scheduled for things that should happen straight after the currently executing script, such as reacting to a batch of actions, or to make something async without taking the penalty of a whole new task. The microtask queue is processed after callbacks as long as no other JavaScript is mid-execution, and at the end of each task. Any additional microtasks queued during microtasks are added to the end of the queue and also processed. Microtasks include mutation observer callbacks, and as in the above example, promise callbacks.\n\n通俗的解释一下，<font color=\"red\">microtasks的作用是用来调度应在当前执行的脚本执行结束后立即执行的任务。</font>  例如响应事件、或者异步操作，以避免付出额外的一个task的费用。\n\nmicrotask会在两种情况下执行：\n1. 任务队列(macrotask = task queue)回调后执行，前提条件是当前没有其他执行中的代码。\n2. 每个task末尾执行。\n\n另外在处理microtask期间，如果有新添加的microtasks，也会被添加到队列的末尾并执行。\n\n也就是说执行顺序是：\n\n开始 -> <font color=\"red\">取task queue第一个task执行 -> 取microtask全部任务依次执行 -> 取task queue下一个任务执行 -> 再次取出microtask全部任务执行 -> ...  </font>  这样循环往复\n\n\n> Once a promise settles, or if it has already settled, it queues a microtask for its reactionary callbacks. This ensures promise callbacks are async even if the promise has already settled. So calling .then(yey, nay) against a settled promise immediately queues a microtask. This is why promise1 and promise2 are logged after script end, as the currently running script must finish before microtasks are handled. promise1 and promise2 are logged before setTimeout, as microtasks always happen before the next task.\n\nPromise一旦状态置为完成态，便为其回调(.then内的函数)安排一个microtask。\n\n接下来我们看回我们上面的代码\n\n{% codeblock lang:javascript %}\n    setTimeout(function(){\n        console.log(1)\n    },0);\n    new Promise(function(resolve){\n        console.log(2)\n        for( var i=100000 ; i>0 ; i-- ){\n            i==1 && resolve()\n        }\n        console.log(3)\n    }).then(function(){\n        console.log(4)\n    });\n    console.log(5);\n{% endcodeblock %}\n\n按照上面的规则重新分析一遍：\n1. 当运行到setTimeout时，会把setTimeout的回调函数console.log(1)放到任务队列里去，然后继续向下执行。\n2. 接下来会遇到一个Promise。首先执行打印console.log(2)，然后执行for循环，即时for循环要累加到10万，也是在执行栈里面，等待for循环执行完毕以后，将Promise的状态从fulfilled切换到resolve，<font color=\"red\">随后把要执行的回调函数，也就是then里面的console.log(4)推到microtask里面去。</font>接下来马上执行马上console.log(3)。\n3. 然后出Promise，还剩一个同步的console.log(5)，直接打印。这样第一轮下来，已经依次打印了2，3，5。\n4. 现在第一轮任务队列已经执行完毕，没有正在执行的代码。符合上面讲的microtask执行条件，因此会将microtask中的任务优先执行，因此执行console.log(4)\n5. 最后还剩macrotask里的setTimeout放入的函数console.log(1)最后执行。\n\n如此分析输出顺序是：\n\n{% codeblock lang:javascript %}\n    2\n    3\n    5\n    4\n    1\n{% endcodeblock %}\n\n看吧，这次分析对了呢ヾ(◍°∇°◍)ﾉﾞ\n\n### 3. 总结和参考资料\n\n***\n\nmicrotask和macrotask看起来容易混淆，实际上还是很好区分的。macrotask就是我们常说的任务队列(task queue)。\n\nJavaScript执行顺序可以简要总结如下：\n\n开始 -> <font color=\"red\">取task queue第一个task执行 -> 取microtask全部任务依次执行 -> 取task queue下一个任务执行 -> 再次取出microtask全部任务执行 -> ...  </font>\n\n循环往复，直至两个队列全部任务执行完毕。\n\n#### 参考资料\n\n[Tasks, microtasks, queues and schedules](https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/?utm_source=html5weekly&utm_medium=email)\n[github-setImmediate.js](https://github.com/YuzuJS/setImmediate)\n[Promises/A+](https://promisesaplus.com/#point-67)\n[知乎-Promise的队列与setTimeout的队列有何关联？](https://www.zhihu.com/question/36972010)\n[stack overflow-Difference between microtask and macrotask within an event loop context\n](https://stackoverflow.com/questions/25915634/difference-between-microtask-and-macrotask-within-an-event-loop-context)\n[阮一峰-JavaScript 运行机制详解：再谈Event Loop](http://www.ruanyifeng.com/blog/2014/10/event-loop.html)","slug":"通过microtasks和macrotasks看JavaScript异步任务执行顺序","published":1,"updated":"2018-03-04T15:08:12.827Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk698hyd000qznzwzu02iqf6","content":"<h3 id=\"1-初探-—-setTimeout-的那些事儿\"><a href=\"#1-初探-—-setTimeout-的那些事儿\" class=\"headerlink\" title=\"1. 初探 — setTimeout()的那些事儿\"></a>1. 初探 — setTimeout()的那些事儿</h3><hr>\n<p>相信很多人在初学JavaScript的时候都遇到过类似的代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// part1</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>);</span><br><span class=\"line\">&#125;,<span class=\"number\">100</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>);</span><br><span class=\"line\"><span class=\"comment\">// part2</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>);</span><br><span class=\"line\">&#125;,<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>);</span><br></pre></td></tr></table></figure>\n<p>萌新们看到这个，肯定觉得很简单。part1输出顺序是1,3,4,2;part2输出顺序是1,2,3,4嘛。显而易见，part1中在打印2的时候延迟了100ms，所以被放到了队列的尾端执行，理所当然的最后输出；part2中虽然调用了setTimeout函数，但是延迟设置为0ms，实际上并未延迟，因此应该立即执行，所以输出顺序应该是1,2,3,4。</p>\n<p>看到这里，很多人应该都知道了，上面的说法实际上是错误的。</p>\n<blockquote>\n<p>setTimeout(fn,0)的含义是，指定某个任务在主线程最早可得的空闲时间执行，也就是说，尽可能早得执行。它在”任务队列”的尾部添加一个事件，因此要等到同步任务和”任务队列”现有的事件都处理完，才会得到执行。</p>\n</blockquote>\n<p>上面的这段文字摘自<a href=\"http://www.ruanyifeng.com/blog/2014/10/event-loop.html\" target=\"_blank\" rel=\"noopener\">阮一峰的博客</a>，即使你的延迟设定的是0，setTimeout仍然会将你的函数给放到队列最尾端，等你的当前任务执行完毕以后,才会去执行该函数。</p>\n<h3 id=\"2-深入-—-setTimeout-和Promise同场竞技时是什么样呢？\"><a href=\"#2-深入-—-setTimeout-和Promise同场竞技时是什么样呢？\" class=\"headerlink\" title=\"2. 深入 — setTimeout()和Promise同场竞技时是什么样呢？\"></a>2. 深入 — setTimeout()和Promise同场竞技时是什么样呢？</h3><hr>\n<p>众所周知，Promise是ES6发布的一种非常流行的异步实现方案，当Promise和setTimeout同时出现在一段代码中，他们的执行顺序是什么样子的呢？请看下面这段代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;,<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> i=<span class=\"number\">100000</span> ; i&gt;<span class=\"number\">0</span> ; i-- )&#123;</span><br><span class=\"line\">        i==<span class=\"number\">1</span> &amp;&amp; resolve()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>)</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">5</span>);</span><br></pre></td></tr></table></figure>\n<p>如果按照正常逻辑分析，应该是这样的：</p>\n<ol>\n<li>当运行到setTimeout时，会把setTimeout的回调函数console.log(1)放到任务队列里去，然后继续向下执行。</li>\n<li>接下来会遇到一个Promise。首先执行打印console.log(2)，然后执行for循环，即时for循环要累加到10万，也是在执行栈里面，等待for循环执行完毕以后，将Promise的状态从fulfilled切换到resolve，随后把要执行的回调函数，也就是then里面的console.log(4)推到任务队列里面去。接下来马上执行马上console.log(3)。</li>\n<li>然后出Promise，还剩一个同步的console.log(5)，直接打印。这样第一轮下来，已经依次打印了2，3，5。</li>\n<li>然后再读取任务队列，任务队列里还剩console.log(1)和console.log(4)，因为任务队列是队列嘛，肯定遵循的先进先出的策略，因此更早入列的setTimeout()的回调函数先执行，打印1，最后剩下Promise的回调，打印4。</li>\n</ol>\n<p>因此一通分析下来，得到的打印结果是2,3,5,1,4。那我们实际试一下呢？</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<p>啊嘞嘞？跟我们一开始想象的貌似有点不一样啊！是什么原因导致了原本应该在setTimeout回调后面的Promise的回调反而跑到前面去执行了呢？</p>\n<p>为了搞清这个问题，我专门去翻阅了一下资料，首先找到了<a href=\"https://promisesaplus.com/#point-67\" target=\"_blank\" rel=\"noopener\">Promises/A+标准</a>里面提到：</p>\n<blockquote>\n<p>  Here “platform code” means engine, environment, and promise implementation code. In practice, this requirement ensures that onFulfilled and onRejected execute asynchronously, after the event loop turn in which then is called, and with a fresh stack. <span style=\"color:red\">This can be implemented with either a “macro-task” mechanism such as setTimeout or setImmediate, or with a “micro-task” mechanism such as MutationObserver or process.nextTick. </span>Since the promise implementation is considered platform code, it may itself contain a task-scheduling queue or “trampoline” in which the handlers are called.</p>\n</blockquote>\n<p>这里提到了micro-task和macro-task这两个概念，并分别列举了两种情况：setTimeout和setImmediate属于macro-task，MutationObserver和process.nextTick属于micro-task。但并没有进一步的详述，于是我以此为线索进一步搜索资料，找到<a href=\"https://stackoverflow.com/questions/25915634/difference-between-microtask-and-macrotask-within-an-event-loop-context\" target=\"_blank\" rel=\"noopener\">stackoverflow上的一个问答</a>，终于让我的疑惑得到解决。</p>\n<p>macrotasks和microtasks的划分：</p>\n<h4 id=\"macrotasks\"><a href=\"#macrotasks\" class=\"headerlink\" title=\"macrotasks:\"></a>macrotasks:</h4><ul>\n<li>setTimeout</li>\n<li>setInterval</li>\n<li>setImmediate</li>\n<li>requestAnimationFrame</li>\n<li>I/O</li>\n<li>UI rendering</li>\n</ul>\n<h4 id=\"microtasks\"><a href=\"#microtasks\" class=\"headerlink\" title=\"microtasks:\"></a>microtasks:</h4><ul>\n<li>process.nextTick</li>\n<li>Promises</li>\n<li>Object.observe</li>\n<li>MutationObserver</li>\n</ul>\n<p>那我们上面提到的任务队列到底是什么呢？跟macrotasks和microtasks有什么联系呢？</p>\n<blockquote>\n<ul>\n<li>An event loop has one or more task queues.(task queue is macrotask queue)</li>\n<li>Each event loop has a microtask queue.</li>\n<li>task queue = macrotask queue != microtask queue</li>\n<li>a task may be pushed into macrotask queue,or microtask queue</li>\n<li>when a task is pushed into a queue(micro/macro),we mean preparing work is finished,so the task can be executed now.</li>\n</ul>\n</blockquote>\n<p>翻译一下就是：</p>\n<ul>\n<li>一个事件循环有一个或者多个任务队列；</li>\n<li>每个事件循环都有一个microtask队列</li>\n<li>macrotask队列就是我们常说的任务队列，microtask队列不是任务队列</li>\n<li>一个任务可以被放入到macrotask队列，也可以放入microtask队列</li>\n<li>当一个任务被放入microtask或者macrotask队列后，准备工作就已经结束，这时候可以开始执行任务了。</li>\n</ul>\n<p>可见，setTimeout和Promises不是同一类的任务，处理方式应该会有区别，具体的处理方式有什么不同呢？我从<a href=\"https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/?utm_source=html5weekly&amp;utm_medium=email\" target=\"_blank\" rel=\"noopener\">这篇文章</a>里找到了下面这段话：</p>\n<blockquote>\n<p>Microtasks are usually scheduled for things that should happen straight after the currently executing script, such as reacting to a batch of actions, or to make something async without taking the penalty of a whole new task. The microtask queue is processed after callbacks as long as no other JavaScript is mid-execution, and at the end of each task. Any additional microtasks queued during microtasks are added to the end of the queue and also processed. Microtasks include mutation observer callbacks, and as in the above example, promise callbacks.</p>\n</blockquote>\n<p>通俗的解释一下，<font color=\"red\">microtasks的作用是用来调度应在当前执行的脚本执行结束后立即执行的任务。</font>  例如响应事件、或者异步操作，以避免付出额外的一个task的费用。</p>\n<p>microtask会在两种情况下执行：</p>\n<ol>\n<li>任务队列(macrotask = task queue)回调后执行，前提条件是当前没有其他执行中的代码。</li>\n<li>每个task末尾执行。</li>\n</ol>\n<p>另外在处理microtask期间，如果有新添加的microtasks，也会被添加到队列的末尾并执行。</p>\n<p>也就是说执行顺序是：</p>\n<p>开始 -&gt; <font color=\"red\">取task queue第一个task执行 -&gt; 取microtask全部任务依次执行 -&gt; 取task queue下一个任务执行 -&gt; 再次取出microtask全部任务执行 -&gt; …  </font>  这样循环往复</p>\n<blockquote>\n<p>Once a promise settles, or if it has already settled, it queues a microtask for its reactionary callbacks. This ensures promise callbacks are async even if the promise has already settled. So calling .then(yey, nay) against a settled promise immediately queues a microtask. This is why promise1 and promise2 are logged after script end, as the currently running script must finish before microtasks are handled. promise1 and promise2 are logged before setTimeout, as microtasks always happen before the next task.</p>\n</blockquote>\n<p>Promise一旦状态置为完成态，便为其回调(.then内的函数)安排一个microtask。</p>\n<p>接下来我们看回我们上面的代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;,<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> i=<span class=\"number\">100000</span> ; i&gt;<span class=\"number\">0</span> ; i-- )&#123;</span><br><span class=\"line\">        i==<span class=\"number\">1</span> &amp;&amp; resolve()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>)</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">5</span>);</span><br></pre></td></tr></table></figure>\n<p>按照上面的规则重新分析一遍：</p>\n<ol>\n<li>当运行到setTimeout时，会把setTimeout的回调函数console.log(1)放到任务队列里去，然后继续向下执行。</li>\n<li>接下来会遇到一个Promise。首先执行打印console.log(2)，然后执行for循环，即时for循环要累加到10万，也是在执行栈里面，等待for循环执行完毕以后，将Promise的状态从fulfilled切换到resolve，<font color=\"red\">随后把要执行的回调函数，也就是then里面的console.log(4)推到microtask里面去。</font>接下来马上执行马上console.log(3)。</li>\n<li>然后出Promise，还剩一个同步的console.log(5)，直接打印。这样第一轮下来，已经依次打印了2，3，5。</li>\n<li>现在第一轮任务队列已经执行完毕，没有正在执行的代码。符合上面讲的microtask执行条件，因此会将microtask中的任务优先执行，因此执行console.log(4)</li>\n<li>最后还剩macrotask里的setTimeout放入的函数console.log(1)最后执行。</li>\n</ol>\n<p>如此分析输出顺序是：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<p>看吧，这次分析对了呢ヾ(◍°∇°◍)ﾉﾞ</p>\n<h3 id=\"3-总结和参考资料\"><a href=\"#3-总结和参考资料\" class=\"headerlink\" title=\"3. 总结和参考资料\"></a>3. 总结和参考资料</h3><hr>\n<p>microtask和macrotask看起来容易混淆，实际上还是很好区分的。macrotask就是我们常说的任务队列(task queue)。</p>\n<p>JavaScript执行顺序可以简要总结如下：</p>\n<p>开始 -&gt; <font color=\"red\">取task queue第一个task执行 -&gt; 取microtask全部任务依次执行 -&gt; 取task queue下一个任务执行 -&gt; 再次取出microtask全部任务执行 -&gt; …  </font></p>\n<p>循环往复，直至两个队列全部任务执行完毕。</p>\n<h4 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h4><p><a href=\"https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/?utm_source=html5weekly&amp;utm_medium=email\" target=\"_blank\" rel=\"noopener\">Tasks, microtasks, queues and schedules</a><br><a href=\"https://github.com/YuzuJS/setImmediate\" target=\"_blank\" rel=\"noopener\">github-setImmediate.js</a><br><a href=\"https://promisesaplus.com/#point-67\" target=\"_blank\" rel=\"noopener\">Promises/A+</a><br><a href=\"https://www.zhihu.com/question/36972010\" target=\"_blank\" rel=\"noopener\">知乎-Promise的队列与setTimeout的队列有何关联？</a><br><a href=\"https://stackoverflow.com/questions/25915634/difference-between-microtask-and-macrotask-within-an-event-loop-context\" target=\"_blank\" rel=\"noopener\">stack overflow-Difference between microtask and macrotask within an event loop context\n</a><br><a href=\"http://www.ruanyifeng.com/blog/2014/10/event-loop.html\" target=\"_blank\" rel=\"noopener\">阮一峰-JavaScript 运行机制详解：再谈Event Loop</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h3 id=\"1-初探-—-setTimeout-的那些事儿\"><a href=\"#1-初探-—-setTimeout-的那些事儿\" class=\"headerlink\" title=\"1. 初探 — setTimeout()的那些事儿\"></a>1. 初探 — setTimeout()的那些事儿</h3><hr>\n<p>相信很多人在初学JavaScript的时候都遇到过类似的代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// part1</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>);</span><br><span class=\"line\">&#125;,<span class=\"number\">100</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>);</span><br><span class=\"line\"><span class=\"comment\">// part2</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>);</span><br><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>);</span><br><span class=\"line\">&#125;,<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>);</span><br></pre></td></tr></table></figure>\n<p>萌新们看到这个，肯定觉得很简单。part1输出顺序是1,3,4,2;part2输出顺序是1,2,3,4嘛。显而易见，part1中在打印2的时候延迟了100ms，所以被放到了队列的尾端执行，理所当然的最后输出；part2中虽然调用了setTimeout函数，但是延迟设置为0ms，实际上并未延迟，因此应该立即执行，所以输出顺序应该是1,2,3,4。</p>\n<p>看到这里，很多人应该都知道了，上面的说法实际上是错误的。</p>\n<blockquote>\n<p>setTimeout(fn,0)的含义是，指定某个任务在主线程最早可得的空闲时间执行，也就是说，尽可能早得执行。它在”任务队列”的尾部添加一个事件，因此要等到同步任务和”任务队列”现有的事件都处理完，才会得到执行。</p>\n</blockquote>\n<p>上面的这段文字摘自<a href=\"http://www.ruanyifeng.com/blog/2014/10/event-loop.html\" target=\"_blank\" rel=\"noopener\">阮一峰的博客</a>，即使你的延迟设定的是0，setTimeout仍然会将你的函数给放到队列最尾端，等你的当前任务执行完毕以后,才会去执行该函数。</p>\n<h3 id=\"2-深入-—-setTimeout-和Promise同场竞技时是什么样呢？\"><a href=\"#2-深入-—-setTimeout-和Promise同场竞技时是什么样呢？\" class=\"headerlink\" title=\"2. 深入 — setTimeout()和Promise同场竞技时是什么样呢？\"></a>2. 深入 — setTimeout()和Promise同场竞技时是什么样呢？</h3><hr>\n<p>众所周知，Promise是ES6发布的一种非常流行的异步实现方案，当Promise和setTimeout同时出现在一段代码中，他们的执行顺序是什么样子的呢？请看下面这段代码：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;,<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> i=<span class=\"number\">100000</span> ; i&gt;<span class=\"number\">0</span> ; i-- )&#123;</span><br><span class=\"line\">        i==<span class=\"number\">1</span> &amp;&amp; resolve()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>)</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">5</span>);</span><br></pre></td></tr></table></figure>\n<p>如果按照正常逻辑分析，应该是这样的：</p>\n<ol>\n<li>当运行到setTimeout时，会把setTimeout的回调函数console.log(1)放到任务队列里去，然后继续向下执行。</li>\n<li>接下来会遇到一个Promise。首先执行打印console.log(2)，然后执行for循环，即时for循环要累加到10万，也是在执行栈里面，等待for循环执行完毕以后，将Promise的状态从fulfilled切换到resolve，随后把要执行的回调函数，也就是then里面的console.log(4)推到任务队列里面去。接下来马上执行马上console.log(3)。</li>\n<li>然后出Promise，还剩一个同步的console.log(5)，直接打印。这样第一轮下来，已经依次打印了2，3，5。</li>\n<li>然后再读取任务队列，任务队列里还剩console.log(1)和console.log(4)，因为任务队列是队列嘛，肯定遵循的先进先出的策略，因此更早入列的setTimeout()的回调函数先执行，打印1，最后剩下Promise的回调，打印4。</li>\n</ol>\n<p>因此一通分析下来，得到的打印结果是2,3,5,1,4。那我们实际试一下呢？</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<p>啊嘞嘞？跟我们一开始想象的貌似有点不一样啊！是什么原因导致了原本应该在setTimeout回调后面的Promise的回调反而跑到前面去执行了呢？</p>\n<p>为了搞清这个问题，我专门去翻阅了一下资料，首先找到了<a href=\"https://promisesaplus.com/#point-67\" target=\"_blank\" rel=\"noopener\">Promises/A+标准</a>里面提到：</p>\n<blockquote>\n<p>  Here “platform code” means engine, environment, and promise implementation code. In practice, this requirement ensures that onFulfilled and onRejected execute asynchronously, after the event loop turn in which then is called, and with a fresh stack. <span style=\"color:red\">This can be implemented with either a “macro-task” mechanism such as setTimeout or setImmediate, or with a “micro-task” mechanism such as MutationObserver or process.nextTick. </span>Since the promise implementation is considered platform code, it may itself contain a task-scheduling queue or “trampoline” in which the handlers are called.</p>\n</blockquote>\n<p>这里提到了micro-task和macro-task这两个概念，并分别列举了两种情况：setTimeout和setImmediate属于macro-task，MutationObserver和process.nextTick属于micro-task。但并没有进一步的详述，于是我以此为线索进一步搜索资料，找到<a href=\"https://stackoverflow.com/questions/25915634/difference-between-microtask-and-macrotask-within-an-event-loop-context\" target=\"_blank\" rel=\"noopener\">stackoverflow上的一个问答</a>，终于让我的疑惑得到解决。</p>\n<p>macrotasks和microtasks的划分：</p>\n<h4 id=\"macrotasks\"><a href=\"#macrotasks\" class=\"headerlink\" title=\"macrotasks:\"></a>macrotasks:</h4><ul>\n<li>setTimeout</li>\n<li>setInterval</li>\n<li>setImmediate</li>\n<li>requestAnimationFrame</li>\n<li>I/O</li>\n<li>UI rendering</li>\n</ul>\n<h4 id=\"microtasks\"><a href=\"#microtasks\" class=\"headerlink\" title=\"microtasks:\"></a>microtasks:</h4><ul>\n<li>process.nextTick</li>\n<li>Promises</li>\n<li>Object.observe</li>\n<li>MutationObserver</li>\n</ul>\n<p>那我们上面提到的任务队列到底是什么呢？跟macrotasks和microtasks有什么联系呢？</p>\n<blockquote>\n<ul>\n<li>An event loop has one or more task queues.(task queue is macrotask queue)</li>\n<li>Each event loop has a microtask queue.</li>\n<li>task queue = macrotask queue != microtask queue</li>\n<li>a task may be pushed into macrotask queue,or microtask queue</li>\n<li>when a task is pushed into a queue(micro/macro),we mean preparing work is finished,so the task can be executed now.</li>\n</ul>\n</blockquote>\n<p>翻译一下就是：</p>\n<ul>\n<li>一个事件循环有一个或者多个任务队列；</li>\n<li>每个事件循环都有一个microtask队列</li>\n<li>macrotask队列就是我们常说的任务队列，microtask队列不是任务队列</li>\n<li>一个任务可以被放入到macrotask队列，也可以放入microtask队列</li>\n<li>当一个任务被放入microtask或者macrotask队列后，准备工作就已经结束，这时候可以开始执行任务了。</li>\n</ul>\n<p>可见，setTimeout和Promises不是同一类的任务，处理方式应该会有区别，具体的处理方式有什么不同呢？我从<a href=\"https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/?utm_source=html5weekly&amp;utm_medium=email\" target=\"_blank\" rel=\"noopener\">这篇文章</a>里找到了下面这段话：</p>\n<blockquote>\n<p>Microtasks are usually scheduled for things that should happen straight after the currently executing script, such as reacting to a batch of actions, or to make something async without taking the penalty of a whole new task. The microtask queue is processed after callbacks as long as no other JavaScript is mid-execution, and at the end of each task. Any additional microtasks queued during microtasks are added to the end of the queue and also processed. Microtasks include mutation observer callbacks, and as in the above example, promise callbacks.</p>\n</blockquote>\n<p>通俗的解释一下，<font color=\"red\">microtasks的作用是用来调度应在当前执行的脚本执行结束后立即执行的任务。</font>  例如响应事件、或者异步操作，以避免付出额外的一个task的费用。</p>\n<p>microtask会在两种情况下执行：</p>\n<ol>\n<li>任务队列(macrotask = task queue)回调后执行，前提条件是当前没有其他执行中的代码。</li>\n<li>每个task末尾执行。</li>\n</ol>\n<p>另外在处理microtask期间，如果有新添加的microtasks，也会被添加到队列的末尾并执行。</p>\n<p>也就是说执行顺序是：</p>\n<p>开始 -&gt; <font color=\"red\">取task queue第一个task执行 -&gt; 取microtask全部任务依次执行 -&gt; 取task queue下一个任务执行 -&gt; 再次取出microtask全部任务执行 -&gt; …  </font>  这样循环往复</p>\n<blockquote>\n<p>Once a promise settles, or if it has already settled, it queues a microtask for its reactionary callbacks. This ensures promise callbacks are async even if the promise has already settled. So calling .then(yey, nay) against a settled promise immediately queues a microtask. This is why promise1 and promise2 are logged after script end, as the currently running script must finish before microtasks are handled. promise1 and promise2 are logged before setTimeout, as microtasks always happen before the next task.</p>\n</blockquote>\n<p>Promise一旦状态置为完成态，便为其回调(.then内的函数)安排一个microtask。</p>\n<p>接下来我们看回我们上面的代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">setTimeout(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">1</span>)</span><br><span class=\"line\">&#125;,<span class=\"number\">0</span>);</span><br><span class=\"line\"><span class=\"keyword\">new</span> <span class=\"built_in\">Promise</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">resolve</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">2</span>)</span><br><span class=\"line\">    <span class=\"keyword\">for</span>( <span class=\"keyword\">var</span> i=<span class=\"number\">100000</span> ; i&gt;<span class=\"number\">0</span> ; i-- )&#123;</span><br><span class=\"line\">        i==<span class=\"number\">1</span> &amp;&amp; resolve()</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">3</span>)</span><br><span class=\"line\">&#125;).then(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"number\">4</span>)</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"number\">5</span>);</span><br></pre></td></tr></table></figure>\n<p>按照上面的规则重新分析一遍：</p>\n<ol>\n<li>当运行到setTimeout时，会把setTimeout的回调函数console.log(1)放到任务队列里去，然后继续向下执行。</li>\n<li>接下来会遇到一个Promise。首先执行打印console.log(2)，然后执行for循环，即时for循环要累加到10万，也是在执行栈里面，等待for循环执行完毕以后，将Promise的状态从fulfilled切换到resolve，<font color=\"red\">随后把要执行的回调函数，也就是then里面的console.log(4)推到microtask里面去。</font>接下来马上执行马上console.log(3)。</li>\n<li>然后出Promise，还剩一个同步的console.log(5)，直接打印。这样第一轮下来，已经依次打印了2，3，5。</li>\n<li>现在第一轮任务队列已经执行完毕，没有正在执行的代码。符合上面讲的microtask执行条件，因此会将microtask中的任务优先执行，因此执行console.log(4)</li>\n<li>最后还剩macrotask里的setTimeout放入的函数console.log(1)最后执行。</li>\n</ol>\n<p>如此分析输出顺序是：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"number\">2</span></span><br><span class=\"line\"><span class=\"number\">3</span></span><br><span class=\"line\"><span class=\"number\">5</span></span><br><span class=\"line\"><span class=\"number\">4</span></span><br><span class=\"line\"><span class=\"number\">1</span></span><br></pre></td></tr></table></figure>\n<p>看吧，这次分析对了呢ヾ(◍°∇°◍)ﾉﾞ</p>\n<h3 id=\"3-总结和参考资料\"><a href=\"#3-总结和参考资料\" class=\"headerlink\" title=\"3. 总结和参考资料\"></a>3. 总结和参考资料</h3><hr>\n<p>microtask和macrotask看起来容易混淆，实际上还是很好区分的。macrotask就是我们常说的任务队列(task queue)。</p>\n<p>JavaScript执行顺序可以简要总结如下：</p>\n<p>开始 -&gt; <font color=\"red\">取task queue第一个task执行 -&gt; 取microtask全部任务依次执行 -&gt; 取task queue下一个任务执行 -&gt; 再次取出microtask全部任务执行 -&gt; …  </font></p>\n<p>循环往复，直至两个队列全部任务执行完毕。</p>\n<h4 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h4><p><a href=\"https://jakearchibald.com/2015/tasks-microtasks-queues-and-schedules/?utm_source=html5weekly&amp;utm_medium=email\" target=\"_blank\" rel=\"noopener\">Tasks, microtasks, queues and schedules</a><br><a href=\"https://github.com/YuzuJS/setImmediate\" target=\"_blank\" rel=\"noopener\">github-setImmediate.js</a><br><a href=\"https://promisesaplus.com/#point-67\" target=\"_blank\" rel=\"noopener\">Promises/A+</a><br><a href=\"https://www.zhihu.com/question/36972010\" target=\"_blank\" rel=\"noopener\">知乎-Promise的队列与setTimeout的队列有何关联？</a><br><a href=\"https://stackoverflow.com/questions/25915634/difference-between-microtask-and-macrotask-within-an-event-loop-context\" target=\"_blank\" rel=\"noopener\">stack overflow-Difference between microtask and macrotask within an event loop context\n</a><br><a href=\"http://www.ruanyifeng.com/blog/2014/10/event-loop.html\" target=\"_blank\" rel=\"noopener\">阮一峰-JavaScript 运行机制详解：再谈Event Loop</a></p>\n"},{"title":"那些优雅灵性的JS代码片段","date":"2018-04-04T07:47:08.000Z","description":"如果你甘于平凡，写代码对你来说可以就是Ctrl+C和Ctrl+V；如果你充满创造力，写代码也可以成为一门艺术。我们在平时总会遇到一些堪称优雅灵性的代码片段，在这里，仅以我之见，列举出我所见到的那一部分。","picture":"codewars.png","_content":"\n## 引子\n\n***\n\n如果你甘于平凡，写代码对你来说可以就是Ctrl+C和Ctrl+V；如果你充满创造力，写代码也可以成为一门艺术。我们在平时总会遇到一些堪称优雅灵性的代码片段，在这里，仅以我之见，列举出我所见到的那一部分。\n\n下面为了阅读方便，我会把**代码的题目和莽夫解法放在一起，优雅灵性的解法放在最下面**，希望能对您造成一定的冲击，看官们可以自己尝试一下，题目并不难。\n\n当然，通往罗马的大路有千千万，可能您的解法更为优秀。如果这样，希望您能在评论区展示出来，让更多人看见~\n\n注：以下所有题目均来自[codewars](http://www.codewars.com)\n\n![codewars](codewars.png)\n\n## 题目\n\n***\n\n1. Create Phone Number\n\n    题目：编写一个函数，它接受一个由10个整数组成的数组（0到9之间的数组），该函数以形似(123) 456-7890的电话号码的形式返回这些数字的字符串。\n\n    Example:\n\n    {% codeblock lang:javascript %}\n    createPhoneNumber([1, 2, 3, 4, 5, 6, 7, 8, 9, 0]) // => returns \"(123) 456-7890\"\n    {% endcodeblock %}\n\n    莽夫解法：\n\n    {% codeblock lang:javascript %}\n    const createPhoneNumber = n => \"(\" + n[0] + n[1] + n[2] + \") \" + n[3] + n[4] + n[5] + \"-\" + n[6] + n[7] + n[8] + n[9]\n    {% endcodeblock %}\n\n2. Find the odd int\n\n    题目：给定一个数组，找到出现奇数次的数字。\n\n    PS:将始终只有一个整数出现奇数次。\n\n    Example:\n\n    {% codeblock lang:javascript %}\n    findOdd([1,1,2,-2,5,2,4,4,-1,-2,5]); // => returns -1\n    {% endcodeblock %}\n\n    莽夫解法：\n\n    {% codeblock lang:javascript %}\n    function findOdd(A) {\n        let count = 0;\n        do {\n            let i = A.splice(count,1,'p')[0];\n            if (i !== 'p'){\n                let result = [i];\n                A.forEach(function (e, index) {\n                    if (e === i){\n                        i === result[0] ? result.pop(): result.push(i);\n                        A.splice(index, 1, 'p');\n                    }\n                });\n                if (result.length > 0){\n                    return result[0]\n                }\n            }\n            count ++;\n        } while (A.length > count);\n    }\n    {% endcodeblock %}\n\n3. Who likes it?\n\n    题目：你可能知道Facebook或者其他网站的“喜欢”系统。人们可以“喜欢”博客文章，图片或其他项目。我们想要创建一份显示在这样项目旁边的文本。\n\n    实现一个函数，它的输入是数组，其中包含喜欢该项目的人的姓名。返回值是如下格式的文本：\n\n    {% codeblock lang:javascript %}\n    likes [] // must be \"no one likes this\"\n    likes [\"Peter\"] // must be \"Peter likes this\"\n    likes [\"Jacob\", \"Alex\"] // must be \"Jacob and Alex like this\"\n    likes [\"Max\", \"John\", \"Mark\"] // must be \"Max, John and Mark like this\"\n    likes [\"Alex\", \"Jacob\", \"Mark\", \"Max\"] // must be \"Alex, Jacob and 2 others like this\"\n    {% endcodeblock %}\n\n    莽夫解法：\n\n    {% codeblock lang:javascript %}\n    const likes = names => {\n        switch (names.length) {\n            case 0: return 'no one likes this'\n            case 1: return names[0] + ' likes this'\n            case 2: return names[0] + ' and ' + names[1] + ' like this'\n            case 3: return names[0] + ', ' + names[1] + ' and ' + names[2] + ' like this'\n            default: return names[0] + ', ' + names[1] + ' and ' + (names.length - 2) + ' others like this'\n        }\n    }\n    {% endcodeblock %}\n\n4. Shortest Word\n\n    题目：给定一串单词，返回最短单词的长度。\n\n    字符串永远不会为空，您不需要考虑不同的数据类型。\n\n    Example:\n\n    {% codeblock lang:javascript %}\n    findShort(\"bitcoin take over the world maybe who knows perhaps\") // returns 3，因为最短单词是the和who，长度为3\n    {% endcodeblock %}\n\n    莽夫解法：\n\n    {% codeblock lang:javascript %}\n    // 其实也不是特别莽\n    const findShort = s => s.split(' ').map(w => w.length).sort((a,b) => a-b)[0];\n    {% endcodeblock %}\n\n5. Sum of Digits / Digital Root\n\n    题目：创建一个计算digital root的函数。\n\n    digital root是数字中各位数字的递归总和。给定n，取n各位数字之和。如果该值是两位数或者更多，则继续以这种方式递归，直到产生一位数字，这个数字就是digital root。这只适用于自然数。\n\n    Example:\n\n    {% codeblock lang:javascript %}\n    digital_root(16)\n    => 1 + 6\n    => 7\n\n    digital_root(942)\n    => 9 + 4 + 2\n    => 15 ...\n    => 1 + 5\n    => 6\n\n    digital_root(132189)\n    => 1 + 3 + 2 + 1 + 8 + 9\n    => 24 ...\n    => 2 + 4\n    => 6\n\n    digital_root(493193)\n    => 4 + 9 + 3 + 1 + 9 + 3\n    => 29 ...\n    => 2 + 9\n    => 11 ...\n    => 1 + 1\n    => 2\n    {% endcodeblock %}\n\n    莽夫解法：\n\n    {% codeblock lang:javascript %}\n    function digital_root(n) {\n        let num = n;\n        if (num < 10){\n            return num\n        }else {\n            return arguments.callee((num+'').split('').reduce(function (a,b) {\n                return parseInt(a) + parseInt(b)\n            }))\n        }\n    }\n    {% endcodeblock %}\n\n## 优雅&灵性解\n\n***\n\n1. Create Phone Number\n\n    {% codeblock lang:javascript %}\n    function createPhoneNumber(numbers){\n        var format = \"(xxx) xxx-xxxx\";\n        for(var i = 0; i < numbers.length; i++){\n            format = format.replace('x', numbers[i]);\n        }\n        return format;\n    }\n    {% endcodeblock %}\n\n    使用一个format的模版，通过循环replace所有format里的x位，优雅且可读性强，让人眼前一亮。\n\n2. Find the odd int\n\n    {% codeblock lang:javascript %}\n    const findOdd = (xs) => xs.reduce((a, b) => a ^ b);\n    {% endcodeblock %}\n\n    我猜起码70%的人看到这个解法会一愣。回想一下，自己多久没有用过位运算了？本题使用reduce()和按位异或操作，相当于所有出现偶数次的数按位异或后均为0，然后出现基数次的数字与0按位异或得到自己本身，从而得解。\n\n3. Who likes it?\n\n    {% codeblock lang:javascript %}\n    function likes (names) {\n        var templates = [\n            'no one likes this',\n            '{name} likes this',\n            '{name} and {name} like this',\n            '{name}, {name} and {name} like this',\n            '{name}, {name} and {n} others like this'\n        ];\n        var idx = Math.min(names.length, 4);\n        \n        return templates[idx].replace(/{name}|{n}/g, function (val) {\n            return val === '{name}' ? names.shift() : names.length;\n        });\n    }\n    {% endcodeblock %}\n\n    这个不用解释了，使用模版字符串，可别傻傻的手动拼写了。\n\n4. Shortest Word\n\n    {% codeblock lang:javascript %}\n    function findShort(s){\n        return Math.min.apply(null, s.split(' ').map(w => w.length));\n    }\n    {% endcodeblock %}\n\n    面试中经常可能会遇到问apply和call的区别之类的题目，但是实际上在工作中有多少人用它们写过代码呢？\n\n5. Sum of Digits / Digital Root\n\n    {% codeblock lang:javascript %}\n    function digital_root(n) {\n        return (n - 1) % 9 + 1;\n    }\n    {% endcodeblock %}\n\n    这个解法堪称神来之笔。有些人可能看不懂，它利用了我们小学时期学的一条定理，“所有位相加之和是9的倍数的数字能被9整除”。这个您可能没印象了，但是“所有位相加之和是3的倍数的数字能被3整除”这个您一定知道吧，这是同样的道理。至于为什么(n-1)整除9以后再加1，是为了防止9的倍数本身求出0的解来。\n\n## 小结\n\n***\n\n\n以上五段代码，分别通过replace、位运算、模版字符串、apply甚至是“所有位相加之和是9的倍数的数字能被9整除”这种定理都能拿来解题，实在是令人叹为观止。\n\n有些操作是神来之笔，有些操作是可以学习的。我们要做的就是把能学习到的学习到，下次自己能用上，这就够了。\n\n## 参考资料\n\n***\n\n[1. Create Phone Number](https://www.codewars.com/kata/create-phone-number)\n[2. Find the odd int](https://www.codewars.com/kata/find-the-odd-int)\n[3. Who likes it?](https://www.codewars.com/kata/who-likes-it)\n[4. Shortest Word](https://www.codewars.com/kata/shortest-word)\n[5. Sum of Digits / Digital Root](https://www.codewars.com/kata/sum-of-digits-slash-digital-root)","source":"_posts/那些优雅灵性的JS代码片段.md","raw":"---\ntitle: 那些优雅灵性的JS代码片段\ndate: 2018-04-04 15:47:08\ntags: JavaScript\ndescription: 如果你甘于平凡，写代码对你来说可以就是Ctrl+C和Ctrl+V；如果你充满创造力，写代码也可以成为一门艺术。我们在平时总会遇到一些堪称优雅灵性的代码片段，在这里，仅以我之见，列举出我所见到的那一部分。\npicture: codewars.png\n---\n\n## 引子\n\n***\n\n如果你甘于平凡，写代码对你来说可以就是Ctrl+C和Ctrl+V；如果你充满创造力，写代码也可以成为一门艺术。我们在平时总会遇到一些堪称优雅灵性的代码片段，在这里，仅以我之见，列举出我所见到的那一部分。\n\n下面为了阅读方便，我会把**代码的题目和莽夫解法放在一起，优雅灵性的解法放在最下面**，希望能对您造成一定的冲击，看官们可以自己尝试一下，题目并不难。\n\n当然，通往罗马的大路有千千万，可能您的解法更为优秀。如果这样，希望您能在评论区展示出来，让更多人看见~\n\n注：以下所有题目均来自[codewars](http://www.codewars.com)\n\n![codewars](codewars.png)\n\n## 题目\n\n***\n\n1. Create Phone Number\n\n    题目：编写一个函数，它接受一个由10个整数组成的数组（0到9之间的数组），该函数以形似(123) 456-7890的电话号码的形式返回这些数字的字符串。\n\n    Example:\n\n    {% codeblock lang:javascript %}\n    createPhoneNumber([1, 2, 3, 4, 5, 6, 7, 8, 9, 0]) // => returns \"(123) 456-7890\"\n    {% endcodeblock %}\n\n    莽夫解法：\n\n    {% codeblock lang:javascript %}\n    const createPhoneNumber = n => \"(\" + n[0] + n[1] + n[2] + \") \" + n[3] + n[4] + n[5] + \"-\" + n[6] + n[7] + n[8] + n[9]\n    {% endcodeblock %}\n\n2. Find the odd int\n\n    题目：给定一个数组，找到出现奇数次的数字。\n\n    PS:将始终只有一个整数出现奇数次。\n\n    Example:\n\n    {% codeblock lang:javascript %}\n    findOdd([1,1,2,-2,5,2,4,4,-1,-2,5]); // => returns -1\n    {% endcodeblock %}\n\n    莽夫解法：\n\n    {% codeblock lang:javascript %}\n    function findOdd(A) {\n        let count = 0;\n        do {\n            let i = A.splice(count,1,'p')[0];\n            if (i !== 'p'){\n                let result = [i];\n                A.forEach(function (e, index) {\n                    if (e === i){\n                        i === result[0] ? result.pop(): result.push(i);\n                        A.splice(index, 1, 'p');\n                    }\n                });\n                if (result.length > 0){\n                    return result[0]\n                }\n            }\n            count ++;\n        } while (A.length > count);\n    }\n    {% endcodeblock %}\n\n3. Who likes it?\n\n    题目：你可能知道Facebook或者其他网站的“喜欢”系统。人们可以“喜欢”博客文章，图片或其他项目。我们想要创建一份显示在这样项目旁边的文本。\n\n    实现一个函数，它的输入是数组，其中包含喜欢该项目的人的姓名。返回值是如下格式的文本：\n\n    {% codeblock lang:javascript %}\n    likes [] // must be \"no one likes this\"\n    likes [\"Peter\"] // must be \"Peter likes this\"\n    likes [\"Jacob\", \"Alex\"] // must be \"Jacob and Alex like this\"\n    likes [\"Max\", \"John\", \"Mark\"] // must be \"Max, John and Mark like this\"\n    likes [\"Alex\", \"Jacob\", \"Mark\", \"Max\"] // must be \"Alex, Jacob and 2 others like this\"\n    {% endcodeblock %}\n\n    莽夫解法：\n\n    {% codeblock lang:javascript %}\n    const likes = names => {\n        switch (names.length) {\n            case 0: return 'no one likes this'\n            case 1: return names[0] + ' likes this'\n            case 2: return names[0] + ' and ' + names[1] + ' like this'\n            case 3: return names[0] + ', ' + names[1] + ' and ' + names[2] + ' like this'\n            default: return names[0] + ', ' + names[1] + ' and ' + (names.length - 2) + ' others like this'\n        }\n    }\n    {% endcodeblock %}\n\n4. Shortest Word\n\n    题目：给定一串单词，返回最短单词的长度。\n\n    字符串永远不会为空，您不需要考虑不同的数据类型。\n\n    Example:\n\n    {% codeblock lang:javascript %}\n    findShort(\"bitcoin take over the world maybe who knows perhaps\") // returns 3，因为最短单词是the和who，长度为3\n    {% endcodeblock %}\n\n    莽夫解法：\n\n    {% codeblock lang:javascript %}\n    // 其实也不是特别莽\n    const findShort = s => s.split(' ').map(w => w.length).sort((a,b) => a-b)[0];\n    {% endcodeblock %}\n\n5. Sum of Digits / Digital Root\n\n    题目：创建一个计算digital root的函数。\n\n    digital root是数字中各位数字的递归总和。给定n，取n各位数字之和。如果该值是两位数或者更多，则继续以这种方式递归，直到产生一位数字，这个数字就是digital root。这只适用于自然数。\n\n    Example:\n\n    {% codeblock lang:javascript %}\n    digital_root(16)\n    => 1 + 6\n    => 7\n\n    digital_root(942)\n    => 9 + 4 + 2\n    => 15 ...\n    => 1 + 5\n    => 6\n\n    digital_root(132189)\n    => 1 + 3 + 2 + 1 + 8 + 9\n    => 24 ...\n    => 2 + 4\n    => 6\n\n    digital_root(493193)\n    => 4 + 9 + 3 + 1 + 9 + 3\n    => 29 ...\n    => 2 + 9\n    => 11 ...\n    => 1 + 1\n    => 2\n    {% endcodeblock %}\n\n    莽夫解法：\n\n    {% codeblock lang:javascript %}\n    function digital_root(n) {\n        let num = n;\n        if (num < 10){\n            return num\n        }else {\n            return arguments.callee((num+'').split('').reduce(function (a,b) {\n                return parseInt(a) + parseInt(b)\n            }))\n        }\n    }\n    {% endcodeblock %}\n\n## 优雅&灵性解\n\n***\n\n1. Create Phone Number\n\n    {% codeblock lang:javascript %}\n    function createPhoneNumber(numbers){\n        var format = \"(xxx) xxx-xxxx\";\n        for(var i = 0; i < numbers.length; i++){\n            format = format.replace('x', numbers[i]);\n        }\n        return format;\n    }\n    {% endcodeblock %}\n\n    使用一个format的模版，通过循环replace所有format里的x位，优雅且可读性强，让人眼前一亮。\n\n2. Find the odd int\n\n    {% codeblock lang:javascript %}\n    const findOdd = (xs) => xs.reduce((a, b) => a ^ b);\n    {% endcodeblock %}\n\n    我猜起码70%的人看到这个解法会一愣。回想一下，自己多久没有用过位运算了？本题使用reduce()和按位异或操作，相当于所有出现偶数次的数按位异或后均为0，然后出现基数次的数字与0按位异或得到自己本身，从而得解。\n\n3. Who likes it?\n\n    {% codeblock lang:javascript %}\n    function likes (names) {\n        var templates = [\n            'no one likes this',\n            '{name} likes this',\n            '{name} and {name} like this',\n            '{name}, {name} and {name} like this',\n            '{name}, {name} and {n} others like this'\n        ];\n        var idx = Math.min(names.length, 4);\n        \n        return templates[idx].replace(/{name}|{n}/g, function (val) {\n            return val === '{name}' ? names.shift() : names.length;\n        });\n    }\n    {% endcodeblock %}\n\n    这个不用解释了，使用模版字符串，可别傻傻的手动拼写了。\n\n4. Shortest Word\n\n    {% codeblock lang:javascript %}\n    function findShort(s){\n        return Math.min.apply(null, s.split(' ').map(w => w.length));\n    }\n    {% endcodeblock %}\n\n    面试中经常可能会遇到问apply和call的区别之类的题目，但是实际上在工作中有多少人用它们写过代码呢？\n\n5. Sum of Digits / Digital Root\n\n    {% codeblock lang:javascript %}\n    function digital_root(n) {\n        return (n - 1) % 9 + 1;\n    }\n    {% endcodeblock %}\n\n    这个解法堪称神来之笔。有些人可能看不懂，它利用了我们小学时期学的一条定理，“所有位相加之和是9的倍数的数字能被9整除”。这个您可能没印象了，但是“所有位相加之和是3的倍数的数字能被3整除”这个您一定知道吧，这是同样的道理。至于为什么(n-1)整除9以后再加1，是为了防止9的倍数本身求出0的解来。\n\n## 小结\n\n***\n\n\n以上五段代码，分别通过replace、位运算、模版字符串、apply甚至是“所有位相加之和是9的倍数的数字能被9整除”这种定理都能拿来解题，实在是令人叹为观止。\n\n有些操作是神来之笔，有些操作是可以学习的。我们要做的就是把能学习到的学习到，下次自己能用上，这就够了。\n\n## 参考资料\n\n***\n\n[1. Create Phone Number](https://www.codewars.com/kata/create-phone-number)\n[2. Find the odd int](https://www.codewars.com/kata/find-the-odd-int)\n[3. Who likes it?](https://www.codewars.com/kata/who-likes-it)\n[4. Shortest Word](https://www.codewars.com/kata/shortest-word)\n[5. Sum of Digits / Digital Root](https://www.codewars.com/kata/sum-of-digits-slash-digital-root)","slug":"那些优雅灵性的JS代码片段","published":1,"updated":"2018-04-20T15:44:49.644Z","comments":1,"layout":"post","photos":[],"link":"","_id":"cjk698hyf000sznzwmtvt9r0z","content":"<h2 id=\"引子\"><a href=\"#引子\" class=\"headerlink\" title=\"引子\"></a>引子</h2><hr>\n<p>如果你甘于平凡，写代码对你来说可以就是Ctrl+C和Ctrl+V；如果你充满创造力，写代码也可以成为一门艺术。我们在平时总会遇到一些堪称优雅灵性的代码片段，在这里，仅以我之见，列举出我所见到的那一部分。</p>\n<p>下面为了阅读方便，我会把<strong>代码的题目和莽夫解法放在一起，优雅灵性的解法放在最下面</strong>，希望能对您造成一定的冲击，看官们可以自己尝试一下，题目并不难。</p>\n<p>当然，通往罗马的大路有千千万，可能您的解法更为优秀。如果这样，希望您能在评论区展示出来，让更多人看见~</p>\n<p>注：以下所有题目均来自<a href=\"http://www.codewars.com\" target=\"_blank\" rel=\"noopener\">codewars</a></p>\n<p><img src=\"/2018/04/04/那些优雅灵性的JS代码片段/codewars.png\" alt=\"codewars\"></p>\n<h2 id=\"题目\"><a href=\"#题目\" class=\"headerlink\" title=\"题目\"></a>题目</h2><hr>\n<ol>\n<li><p>Create Phone Number</p>\n<p> 题目：编写一个函数，它接受一个由10个整数组成的数组（0到9之间的数组），该函数以形似(123) 456-7890的电话号码的形式返回这些数字的字符串。</p>\n<p> Example:</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">createPhoneNumber([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">0</span>]) <span class=\"comment\">// =&gt; returns \"(123) 456-7890\"</span></span><br></pre></td></tr></table></figure>\n<p> 莽夫解法：</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> createPhoneNumber = <span class=\"function\"><span class=\"params\">n</span> =&gt;</span> <span class=\"string\">\"(\"</span> + n[<span class=\"number\">0</span>] + n[<span class=\"number\">1</span>] + n[<span class=\"number\">2</span>] + <span class=\"string\">\") \"</span> + n[<span class=\"number\">3</span>] + n[<span class=\"number\">4</span>] + n[<span class=\"number\">5</span>] + <span class=\"string\">\"-\"</span> + n[<span class=\"number\">6</span>] + n[<span class=\"number\">7</span>] + n[<span class=\"number\">8</span>] + n[<span class=\"number\">9</span>]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Find the odd int</p>\n<p> 题目：给定一个数组，找到出现奇数次的数字。</p>\n<p> PS:将始终只有一个整数出现奇数次。</p>\n<p> Example:</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">findOdd([<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">-2</span>,<span class=\"number\">5</span>,<span class=\"number\">2</span>,<span class=\"number\">4</span>,<span class=\"number\">4</span>,<span class=\"number\">-1</span>,<span class=\"number\">-2</span>,<span class=\"number\">5</span>]); <span class=\"comment\">// =&gt; returns -1</span></span><br></pre></td></tr></table></figure>\n<p> 莽夫解法：</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">findOdd</span>(<span class=\"params\">A</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> i = A.splice(count,<span class=\"number\">1</span>,<span class=\"string\">'p'</span>)[<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i !== <span class=\"string\">'p'</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> result = [i];</span><br><span class=\"line\">            A.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e, index</span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (e === i)&#123;</span><br><span class=\"line\">                    i === result[<span class=\"number\">0</span>] ? result.pop(): result.push(i);</span><br><span class=\"line\">                    A.splice(index, <span class=\"number\">1</span>, <span class=\"string\">'p'</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (result.length &gt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> result[<span class=\"number\">0</span>]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        count ++;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">while</span> (A.length &gt; count);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Who likes it?</p>\n<p> 题目：你可能知道Facebook或者其他网站的“喜欢”系统。人们可以“喜欢”博客文章，图片或其他项目。我们想要创建一份显示在这样项目旁边的文本。</p>\n<p> 实现一个函数，它的输入是数组，其中包含喜欢该项目的人的姓名。返回值是如下格式的文本：</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">likes [] <span class=\"comment\">// must be \"no one likes this\"</span></span><br><span class=\"line\">likes [<span class=\"string\">\"Peter\"</span>] <span class=\"comment\">// must be \"Peter likes this\"</span></span><br><span class=\"line\">likes [<span class=\"string\">\"Jacob\"</span>, <span class=\"string\">\"Alex\"</span>] <span class=\"comment\">// must be \"Jacob and Alex like this\"</span></span><br><span class=\"line\">likes [<span class=\"string\">\"Max\"</span>, <span class=\"string\">\"John\"</span>, <span class=\"string\">\"Mark\"</span>] <span class=\"comment\">// must be \"Max, John and Mark like this\"</span></span><br><span class=\"line\">likes [<span class=\"string\">\"Alex\"</span>, <span class=\"string\">\"Jacob\"</span>, <span class=\"string\">\"Mark\"</span>, <span class=\"string\">\"Max\"</span>] <span class=\"comment\">// must be \"Alex, Jacob and 2 others like this\"</span></span><br></pre></td></tr></table></figure>\n<p> 莽夫解法：</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> likes = <span class=\"function\"><span class=\"params\">names</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (names.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">0</span>: <span class=\"keyword\">return</span> <span class=\"string\">'no one likes this'</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>: <span class=\"keyword\">return</span> names[<span class=\"number\">0</span>] + <span class=\"string\">' likes this'</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>: <span class=\"keyword\">return</span> names[<span class=\"number\">0</span>] + <span class=\"string\">' and '</span> + names[<span class=\"number\">1</span>] + <span class=\"string\">' like this'</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">3</span>: <span class=\"keyword\">return</span> names[<span class=\"number\">0</span>] + <span class=\"string\">', '</span> + names[<span class=\"number\">1</span>] + <span class=\"string\">' and '</span> + names[<span class=\"number\">2</span>] + <span class=\"string\">' like this'</span></span><br><span class=\"line\">        <span class=\"keyword\">default</span>: <span class=\"keyword\">return</span> names[<span class=\"number\">0</span>] + <span class=\"string\">', '</span> + names[<span class=\"number\">1</span>] + <span class=\"string\">' and '</span> + (names.length - <span class=\"number\">2</span>) + <span class=\"string\">' others like this'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Shortest Word</p>\n<p> 题目：给定一串单词，返回最短单词的长度。</p>\n<p> 字符串永远不会为空，您不需要考虑不同的数据类型。</p>\n<p> Example:</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">findShort(<span class=\"string\">\"bitcoin take over the world maybe who knows perhaps\"</span>) <span class=\"comment\">// returns 3，因为最短单词是the和who，长度为3</span></span><br></pre></td></tr></table></figure>\n<p> 莽夫解法：</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 其实也不是特别莽</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> findShort = <span class=\"function\"><span class=\"params\">s</span> =&gt;</span> s.split(<span class=\"string\">' '</span>).map(<span class=\"function\"><span class=\"params\">w</span> =&gt;</span> w.length).sort(<span class=\"function\">(<span class=\"params\">a,b</span>) =&gt;</span> a-b)[<span class=\"number\">0</span>];</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Sum of Digits / Digital Root</p>\n<p> 题目：创建一个计算digital root的函数。</p>\n<p> digital root是数字中各位数字的递归总和。给定n，取n各位数字之和。如果该值是两位数或者更多，则继续以这种方式递归，直到产生一位数字，这个数字就是digital root。这只适用于自然数。</p>\n<p> Example:</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">digital_root(<span class=\"number\">16</span>)</span><br><span class=\"line\">=&gt; <span class=\"number\">1</span> + <span class=\"number\">6</span></span><br><span class=\"line\">=&gt; <span class=\"number\">7</span></span><br><span class=\"line\"></span><br><span class=\"line\">digital_root(<span class=\"number\">942</span>)</span><br><span class=\"line\">=&gt; <span class=\"number\">9</span> + <span class=\"number\">4</span> + <span class=\"number\">2</span></span><br><span class=\"line\">=&gt; <span class=\"number\">15</span> ...</span><br><span class=\"line\">=&gt; <span class=\"number\">1</span> + <span class=\"number\">5</span></span><br><span class=\"line\">=&gt; <span class=\"number\">6</span></span><br><span class=\"line\"></span><br><span class=\"line\">digital_root(<span class=\"number\">132189</span>)</span><br><span class=\"line\">=&gt; <span class=\"number\">1</span> + <span class=\"number\">3</span> + <span class=\"number\">2</span> + <span class=\"number\">1</span> + <span class=\"number\">8</span> + <span class=\"number\">9</span></span><br><span class=\"line\">=&gt; <span class=\"number\">24</span> ...</span><br><span class=\"line\">=&gt; <span class=\"number\">2</span> + <span class=\"number\">4</span></span><br><span class=\"line\">=&gt; <span class=\"number\">6</span></span><br><span class=\"line\"></span><br><span class=\"line\">digital_root(<span class=\"number\">493193</span>)</span><br><span class=\"line\">=&gt; <span class=\"number\">4</span> + <span class=\"number\">9</span> + <span class=\"number\">3</span> + <span class=\"number\">1</span> + <span class=\"number\">9</span> + <span class=\"number\">3</span></span><br><span class=\"line\">=&gt; <span class=\"number\">29</span> ...</span><br><span class=\"line\">=&gt; <span class=\"number\">2</span> + <span class=\"number\">9</span></span><br><span class=\"line\">=&gt; <span class=\"number\">11</span> ...</span><br><span class=\"line\">=&gt; <span class=\"number\">1</span> + <span class=\"number\">1</span></span><br><span class=\"line\">=&gt; <span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n<p> 莽夫解法：</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">digital_root</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> num = n;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (num &lt; <span class=\"number\">10</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> num</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">arguments</span>.callee((num+<span class=\"string\">''</span>).split(<span class=\"string\">''</span>).reduce(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a,b</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>(a) + <span class=\"built_in\">parseInt</span>(b)</span><br><span class=\"line\">        &#125;))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"优雅-amp-灵性解\"><a href=\"#优雅-amp-灵性解\" class=\"headerlink\" title=\"优雅&amp;灵性解\"></a>优雅&amp;灵性解</h2><hr>\n<ol>\n<li><p>Create Phone Number</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createPhoneNumber</span>(<span class=\"params\">numbers</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> format = <span class=\"string\">\"(xxx) xxx-xxxx\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; numbers.length; i++)&#123;</span><br><span class=\"line\">        format = format.replace(<span class=\"string\">'x'</span>, numbers[i]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> format;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> 使用一个format的模版，通过循环replace所有format里的x位，优雅且可读性强，让人眼前一亮。</p>\n</li>\n<li><p>Find the odd int</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> findOdd = <span class=\"function\">(<span class=\"params\">xs</span>) =&gt;</span> xs.reduce(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a ^ b);</span><br></pre></td></tr></table></figure>\n<p> 我猜起码70%的人看到这个解法会一愣。回想一下，自己多久没有用过位运算了？本题使用reduce()和按位异或操作，相当于所有出现偶数次的数按位异或后均为0，然后出现基数次的数字与0按位异或得到自己本身，从而得解。</p>\n</li>\n<li><p>Who likes it?</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">likes</span> (<span class=\"params\">names</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> templates = [</span><br><span class=\"line\">        <span class=\"string\">'no one likes this'</span>,</span><br><span class=\"line\">        <span class=\"string\">'&#123;name&#125; likes this'</span>,</span><br><span class=\"line\">        <span class=\"string\">'&#123;name&#125; and &#123;name&#125; like this'</span>,</span><br><span class=\"line\">        <span class=\"string\">'&#123;name&#125;, &#123;name&#125; and &#123;name&#125; like this'</span>,</span><br><span class=\"line\">        <span class=\"string\">'&#123;name&#125;, &#123;name&#125; and &#123;n&#125; others like this'</span></span><br><span class=\"line\">    ];</span><br><span class=\"line\">    <span class=\"keyword\">var</span> idx = <span class=\"built_in\">Math</span>.min(names.length, <span class=\"number\">4</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> templates[idx].replace(<span class=\"regexp\">/&#123;name&#125;|&#123;n&#125;/g</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">val</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> val === <span class=\"string\">'&#123;name&#125;'</span> ? names.shift() : names.length;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> 这个不用解释了，使用模版字符串，可别傻傻的手动拼写了。</p>\n</li>\n<li><p>Shortest Word</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">findShort</span>(<span class=\"params\">s</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.min.apply(<span class=\"literal\">null</span>, s.split(<span class=\"string\">' '</span>).map(<span class=\"function\"><span class=\"params\">w</span> =&gt;</span> w.length));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> 面试中经常可能会遇到问apply和call的区别之类的题目，但是实际上在工作中有多少人用它们写过代码呢？</p>\n</li>\n<li><p>Sum of Digits / Digital Root</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">digital_root</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (n - <span class=\"number\">1</span>) % <span class=\"number\">9</span> + <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> 这个解法堪称神来之笔。有些人可能看不懂，它利用了我们小学时期学的一条定理，“所有位相加之和是9的倍数的数字能被9整除”。这个您可能没印象了，但是“所有位相加之和是3的倍数的数字能被3整除”这个您一定知道吧，这是同样的道理。至于为什么(n-1)整除9以后再加1，是为了防止9的倍数本身求出0的解来。</p>\n</li>\n</ol>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><hr>\n<p>以上五段代码，分别通过replace、位运算、模版字符串、apply甚至是“所有位相加之和是9的倍数的数字能被9整除”这种定理都能拿来解题，实在是令人叹为观止。</p>\n<p>有些操作是神来之笔，有些操作是可以学习的。我们要做的就是把能学习到的学习到，下次自己能用上，这就够了。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><hr>\n<p><a href=\"https://www.codewars.com/kata/create-phone-number\" target=\"_blank\" rel=\"noopener\">1. Create Phone Number</a><br><a href=\"https://www.codewars.com/kata/find-the-odd-int\" target=\"_blank\" rel=\"noopener\">2. Find the odd int</a><br><a href=\"https://www.codewars.com/kata/who-likes-it\" target=\"_blank\" rel=\"noopener\">3. Who likes it?</a><br><a href=\"https://www.codewars.com/kata/shortest-word\" target=\"_blank\" rel=\"noopener\">4. Shortest Word</a><br><a href=\"https://www.codewars.com/kata/sum-of-digits-slash-digital-root\" target=\"_blank\" rel=\"noopener\">5. Sum of Digits / Digital Root</a></p>\n","site":{"data":{}},"excerpt":"","more":"<h2 id=\"引子\"><a href=\"#引子\" class=\"headerlink\" title=\"引子\"></a>引子</h2><hr>\n<p>如果你甘于平凡，写代码对你来说可以就是Ctrl+C和Ctrl+V；如果你充满创造力，写代码也可以成为一门艺术。我们在平时总会遇到一些堪称优雅灵性的代码片段，在这里，仅以我之见，列举出我所见到的那一部分。</p>\n<p>下面为了阅读方便，我会把<strong>代码的题目和莽夫解法放在一起，优雅灵性的解法放在最下面</strong>，希望能对您造成一定的冲击，看官们可以自己尝试一下，题目并不难。</p>\n<p>当然，通往罗马的大路有千千万，可能您的解法更为优秀。如果这样，希望您能在评论区展示出来，让更多人看见~</p>\n<p>注：以下所有题目均来自<a href=\"http://www.codewars.com\" target=\"_blank\" rel=\"noopener\">codewars</a></p>\n<p><img src=\"/2018/04/04/那些优雅灵性的JS代码片段/codewars.png\" alt=\"codewars\"></p>\n<h2 id=\"题目\"><a href=\"#题目\" class=\"headerlink\" title=\"题目\"></a>题目</h2><hr>\n<ol>\n<li><p>Create Phone Number</p>\n<p> 题目：编写一个函数，它接受一个由10个整数组成的数组（0到9之间的数组），该函数以形似(123) 456-7890的电话号码的形式返回这些数字的字符串。</p>\n<p> Example:</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">createPhoneNumber([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>, <span class=\"number\">5</span>, <span class=\"number\">6</span>, <span class=\"number\">7</span>, <span class=\"number\">8</span>, <span class=\"number\">9</span>, <span class=\"number\">0</span>]) <span class=\"comment\">// =&gt; returns \"(123) 456-7890\"</span></span><br></pre></td></tr></table></figure>\n<p> 莽夫解法：</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> createPhoneNumber = <span class=\"function\"><span class=\"params\">n</span> =&gt;</span> <span class=\"string\">\"(\"</span> + n[<span class=\"number\">0</span>] + n[<span class=\"number\">1</span>] + n[<span class=\"number\">2</span>] + <span class=\"string\">\") \"</span> + n[<span class=\"number\">3</span>] + n[<span class=\"number\">4</span>] + n[<span class=\"number\">5</span>] + <span class=\"string\">\"-\"</span> + n[<span class=\"number\">6</span>] + n[<span class=\"number\">7</span>] + n[<span class=\"number\">8</span>] + n[<span class=\"number\">9</span>]</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Find the odd int</p>\n<p> 题目：给定一个数组，找到出现奇数次的数字。</p>\n<p> PS:将始终只有一个整数出现奇数次。</p>\n<p> Example:</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">findOdd([<span class=\"number\">1</span>,<span class=\"number\">1</span>,<span class=\"number\">2</span>,<span class=\"number\">-2</span>,<span class=\"number\">5</span>,<span class=\"number\">2</span>,<span class=\"number\">4</span>,<span class=\"number\">4</span>,<span class=\"number\">-1</span>,<span class=\"number\">-2</span>,<span class=\"number\">5</span>]); <span class=\"comment\">// =&gt; returns -1</span></span><br></pre></td></tr></table></figure>\n<p> 莽夫解法：</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">findOdd</span>(<span class=\"params\">A</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> count = <span class=\"number\">0</span>;</span><br><span class=\"line\">    <span class=\"keyword\">do</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">let</span> i = A.splice(count,<span class=\"number\">1</span>,<span class=\"string\">'p'</span>)[<span class=\"number\">0</span>];</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (i !== <span class=\"string\">'p'</span>)&#123;</span><br><span class=\"line\">            <span class=\"keyword\">let</span> result = [i];</span><br><span class=\"line\">            A.forEach(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">e, index</span>) </span>&#123;</span><br><span class=\"line\">                <span class=\"keyword\">if</span> (e === i)&#123;</span><br><span class=\"line\">                    i === result[<span class=\"number\">0</span>] ? result.pop(): result.push(i);</span><br><span class=\"line\">                    A.splice(index, <span class=\"number\">1</span>, <span class=\"string\">'p'</span>);</span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\">            <span class=\"keyword\">if</span> (result.length &gt; <span class=\"number\">0</span>)&#123;</span><br><span class=\"line\">                <span class=\"keyword\">return</span> result[<span class=\"number\">0</span>]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        count ++;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">while</span> (A.length &gt; count);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Who likes it?</p>\n<p> 题目：你可能知道Facebook或者其他网站的“喜欢”系统。人们可以“喜欢”博客文章，图片或其他项目。我们想要创建一份显示在这样项目旁边的文本。</p>\n<p> 实现一个函数，它的输入是数组，其中包含喜欢该项目的人的姓名。返回值是如下格式的文本：</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">likes [] <span class=\"comment\">// must be \"no one likes this\"</span></span><br><span class=\"line\">likes [<span class=\"string\">\"Peter\"</span>] <span class=\"comment\">// must be \"Peter likes this\"</span></span><br><span class=\"line\">likes [<span class=\"string\">\"Jacob\"</span>, <span class=\"string\">\"Alex\"</span>] <span class=\"comment\">// must be \"Jacob and Alex like this\"</span></span><br><span class=\"line\">likes [<span class=\"string\">\"Max\"</span>, <span class=\"string\">\"John\"</span>, <span class=\"string\">\"Mark\"</span>] <span class=\"comment\">// must be \"Max, John and Mark like this\"</span></span><br><span class=\"line\">likes [<span class=\"string\">\"Alex\"</span>, <span class=\"string\">\"Jacob\"</span>, <span class=\"string\">\"Mark\"</span>, <span class=\"string\">\"Max\"</span>] <span class=\"comment\">// must be \"Alex, Jacob and 2 others like this\"</span></span><br></pre></td></tr></table></figure>\n<p> 莽夫解法：</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> likes = <span class=\"function\"><span class=\"params\">names</span> =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">switch</span> (names.length) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">0</span>: <span class=\"keyword\">return</span> <span class=\"string\">'no one likes this'</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">1</span>: <span class=\"keyword\">return</span> names[<span class=\"number\">0</span>] + <span class=\"string\">' likes this'</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">2</span>: <span class=\"keyword\">return</span> names[<span class=\"number\">0</span>] + <span class=\"string\">' and '</span> + names[<span class=\"number\">1</span>] + <span class=\"string\">' like this'</span></span><br><span class=\"line\">        <span class=\"keyword\">case</span> <span class=\"number\">3</span>: <span class=\"keyword\">return</span> names[<span class=\"number\">0</span>] + <span class=\"string\">', '</span> + names[<span class=\"number\">1</span>] + <span class=\"string\">' and '</span> + names[<span class=\"number\">2</span>] + <span class=\"string\">' like this'</span></span><br><span class=\"line\">        <span class=\"keyword\">default</span>: <span class=\"keyword\">return</span> names[<span class=\"number\">0</span>] + <span class=\"string\">', '</span> + names[<span class=\"number\">1</span>] + <span class=\"string\">' and '</span> + (names.length - <span class=\"number\">2</span>) + <span class=\"string\">' others like this'</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Shortest Word</p>\n<p> 题目：给定一串单词，返回最短单词的长度。</p>\n<p> 字符串永远不会为空，您不需要考虑不同的数据类型。</p>\n<p> Example:</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">findShort(<span class=\"string\">\"bitcoin take over the world maybe who knows perhaps\"</span>) <span class=\"comment\">// returns 3，因为最短单词是the和who，长度为3</span></span><br></pre></td></tr></table></figure>\n<p> 莽夫解法：</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 其实也不是特别莽</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> findShort = <span class=\"function\"><span class=\"params\">s</span> =&gt;</span> s.split(<span class=\"string\">' '</span>).map(<span class=\"function\"><span class=\"params\">w</span> =&gt;</span> w.length).sort(<span class=\"function\">(<span class=\"params\">a,b</span>) =&gt;</span> a-b)[<span class=\"number\">0</span>];</span><br></pre></td></tr></table></figure>\n</li>\n<li><p>Sum of Digits / Digital Root</p>\n<p> 题目：创建一个计算digital root的函数。</p>\n<p> digital root是数字中各位数字的递归总和。给定n，取n各位数字之和。如果该值是两位数或者更多，则继续以这种方式递归，直到产生一位数字，这个数字就是digital root。这只适用于自然数。</p>\n<p> Example:</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">digital_root(<span class=\"number\">16</span>)</span><br><span class=\"line\">=&gt; <span class=\"number\">1</span> + <span class=\"number\">6</span></span><br><span class=\"line\">=&gt; <span class=\"number\">7</span></span><br><span class=\"line\"></span><br><span class=\"line\">digital_root(<span class=\"number\">942</span>)</span><br><span class=\"line\">=&gt; <span class=\"number\">9</span> + <span class=\"number\">4</span> + <span class=\"number\">2</span></span><br><span class=\"line\">=&gt; <span class=\"number\">15</span> ...</span><br><span class=\"line\">=&gt; <span class=\"number\">1</span> + <span class=\"number\">5</span></span><br><span class=\"line\">=&gt; <span class=\"number\">6</span></span><br><span class=\"line\"></span><br><span class=\"line\">digital_root(<span class=\"number\">132189</span>)</span><br><span class=\"line\">=&gt; <span class=\"number\">1</span> + <span class=\"number\">3</span> + <span class=\"number\">2</span> + <span class=\"number\">1</span> + <span class=\"number\">8</span> + <span class=\"number\">9</span></span><br><span class=\"line\">=&gt; <span class=\"number\">24</span> ...</span><br><span class=\"line\">=&gt; <span class=\"number\">2</span> + <span class=\"number\">4</span></span><br><span class=\"line\">=&gt; <span class=\"number\">6</span></span><br><span class=\"line\"></span><br><span class=\"line\">digital_root(<span class=\"number\">493193</span>)</span><br><span class=\"line\">=&gt; <span class=\"number\">4</span> + <span class=\"number\">9</span> + <span class=\"number\">3</span> + <span class=\"number\">1</span> + <span class=\"number\">9</span> + <span class=\"number\">3</span></span><br><span class=\"line\">=&gt; <span class=\"number\">29</span> ...</span><br><span class=\"line\">=&gt; <span class=\"number\">2</span> + <span class=\"number\">9</span></span><br><span class=\"line\">=&gt; <span class=\"number\">11</span> ...</span><br><span class=\"line\">=&gt; <span class=\"number\">1</span> + <span class=\"number\">1</span></span><br><span class=\"line\">=&gt; <span class=\"number\">2</span></span><br></pre></td></tr></table></figure>\n<p> 莽夫解法：</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">digital_root</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> num = n;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (num &lt; <span class=\"number\">10</span>)&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> num</span><br><span class=\"line\">    &#125;<span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">arguments</span>.callee((num+<span class=\"string\">''</span>).split(<span class=\"string\">''</span>).reduce(<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">a,b</span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>(a) + <span class=\"built_in\">parseInt</span>(b)</span><br><span class=\"line\">        &#125;))</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n</li>\n</ol>\n<h2 id=\"优雅-amp-灵性解\"><a href=\"#优雅-amp-灵性解\" class=\"headerlink\" title=\"优雅&amp;灵性解\"></a>优雅&amp;灵性解</h2><hr>\n<ol>\n<li><p>Create Phone Number</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">createPhoneNumber</span>(<span class=\"params\">numbers</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> format = <span class=\"string\">\"(xxx) xxx-xxxx\"</span>;</span><br><span class=\"line\">    <span class=\"keyword\">for</span>(<span class=\"keyword\">var</span> i = <span class=\"number\">0</span>; i &lt; numbers.length; i++)&#123;</span><br><span class=\"line\">        format = format.replace(<span class=\"string\">'x'</span>, numbers[i]);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> format;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> 使用一个format的模版，通过循环replace所有format里的x位，优雅且可读性强，让人眼前一亮。</p>\n</li>\n<li><p>Find the odd int</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> findOdd = <span class=\"function\">(<span class=\"params\">xs</span>) =&gt;</span> xs.reduce(<span class=\"function\">(<span class=\"params\">a, b</span>) =&gt;</span> a ^ b);</span><br></pre></td></tr></table></figure>\n<p> 我猜起码70%的人看到这个解法会一愣。回想一下，自己多久没有用过位运算了？本题使用reduce()和按位异或操作，相当于所有出现偶数次的数按位异或后均为0，然后出现基数次的数字与0按位异或得到自己本身，从而得解。</p>\n</li>\n<li><p>Who likes it?</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">likes</span> (<span class=\"params\">names</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> templates = [</span><br><span class=\"line\">        <span class=\"string\">'no one likes this'</span>,</span><br><span class=\"line\">        <span class=\"string\">'&#123;name&#125; likes this'</span>,</span><br><span class=\"line\">        <span class=\"string\">'&#123;name&#125; and &#123;name&#125; like this'</span>,</span><br><span class=\"line\">        <span class=\"string\">'&#123;name&#125;, &#123;name&#125; and &#123;name&#125; like this'</span>,</span><br><span class=\"line\">        <span class=\"string\">'&#123;name&#125;, &#123;name&#125; and &#123;n&#125; others like this'</span></span><br><span class=\"line\">    ];</span><br><span class=\"line\">    <span class=\"keyword\">var</span> idx = <span class=\"built_in\">Math</span>.min(names.length, <span class=\"number\">4</span>);</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">return</span> templates[idx].replace(<span class=\"regexp\">/&#123;name&#125;|&#123;n&#125;/g</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">val</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> val === <span class=\"string\">'&#123;name&#125;'</span> ? names.shift() : names.length;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> 这个不用解释了，使用模版字符串，可别傻傻的手动拼写了。</p>\n</li>\n<li><p>Shortest Word</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">findShort</span>(<span class=\"params\">s</span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"built_in\">Math</span>.min.apply(<span class=\"literal\">null</span>, s.split(<span class=\"string\">' '</span>).map(<span class=\"function\"><span class=\"params\">w</span> =&gt;</span> w.length));</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> 面试中经常可能会遇到问apply和call的区别之类的题目，但是实际上在工作中有多少人用它们写过代码呢？</p>\n</li>\n<li><p>Sum of Digits / Digital Root</p>\n <figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">digital_root</span>(<span class=\"params\">n</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> (n - <span class=\"number\">1</span>) % <span class=\"number\">9</span> + <span class=\"number\">1</span>;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p> 这个解法堪称神来之笔。有些人可能看不懂，它利用了我们小学时期学的一条定理，“所有位相加之和是9的倍数的数字能被9整除”。这个您可能没印象了，但是“所有位相加之和是3的倍数的数字能被3整除”这个您一定知道吧，这是同样的道理。至于为什么(n-1)整除9以后再加1，是为了防止9的倍数本身求出0的解来。</p>\n</li>\n</ol>\n<h2 id=\"小结\"><a href=\"#小结\" class=\"headerlink\" title=\"小结\"></a>小结</h2><hr>\n<p>以上五段代码，分别通过replace、位运算、模版字符串、apply甚至是“所有位相加之和是9的倍数的数字能被9整除”这种定理都能拿来解题，实在是令人叹为观止。</p>\n<p>有些操作是神来之笔，有些操作是可以学习的。我们要做的就是把能学习到的学习到，下次自己能用上，这就够了。</p>\n<h2 id=\"参考资料\"><a href=\"#参考资料\" class=\"headerlink\" title=\"参考资料\"></a>参考资料</h2><hr>\n<p><a href=\"https://www.codewars.com/kata/create-phone-number\" target=\"_blank\" rel=\"noopener\">1. Create Phone Number</a><br><a href=\"https://www.codewars.com/kata/find-the-odd-int\" target=\"_blank\" rel=\"noopener\">2. Find the odd int</a><br><a href=\"https://www.codewars.com/kata/who-likes-it\" target=\"_blank\" rel=\"noopener\">3. Who likes it?</a><br><a href=\"https://www.codewars.com/kata/shortest-word\" target=\"_blank\" rel=\"noopener\">4. Shortest Word</a><br><a href=\"https://www.codewars.com/kata/sum-of-digits-slash-digital-root\" target=\"_blank\" rel=\"noopener\">5. Sum of Digits / Digital Root</a></p>\n"}],"PostAsset":[{"_id":"source/_posts/web超时配置总结/timeout.jpg","slug":"timeout.jpg","post":"cjk698hxi0006znzwfynehrwo","modified":1,"renderable":0},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/13.gif","slug":"13.gif","post":"cjk698hxz000dznzwm33d9q74","modified":1,"renderable":0},{"_id":"source/_posts/深入探讨正斜杠和反斜杠/slash.jpg","slug":"slash.jpg","post":"cjk698hya000nznzww6909mk6","modified":1,"renderable":0},{"_id":"source/_posts/Nginx 配置指南/nginx.png","post":"cjk698hxb0003znzwtd86aj18","slug":"nginx.png","modified":1,"renderable":1},{"_id":"source/_posts/使用code-printer生成一份炫酷的简历/code-printer.png","post":"cjk698hxq0009znzw7n0zspus","slug":"code-printer.png","modified":1,"renderable":1},{"_id":"source/_posts/坚持这件事儿/930753.jpg","post":"cjk698hy3000hznzwaef9ynsv","slug":"930753.jpg","modified":1,"renderable":1},{"_id":"source/_posts/开发环境备份/hello2018.jpg","post":"cjk698hy6000kznzw11c744h8","slug":"hello2018.jpg","modified":1,"renderable":1},{"_id":"source/_posts/基于RBAC的分权分域用户权限系统数据库设计/分权分域数据库设计.png","post":"cjk698hy7000lznzwgpp15ipj","slug":"分权分域数据库设计.png","modified":1,"renderable":1},{"_id":"source/_posts/谈一谈大文件上传——前台分片和后台合并/upload.png","post":"cjk698hyc000oznzwh4eo1k3y","slug":"upload.png","modified":1,"renderable":1},{"_id":"source/_posts/通过microtasks和macrotasks看JavaScript异步任务执行顺序/tasks.png","post":"cjk698hyd000qznzwzu02iqf6","slug":"tasks.png","modified":1,"renderable":1},{"_id":"source/_posts/那些优雅灵性的JS代码片段/codewars.png","post":"cjk698hyf000sznzwmtvt9r0z","slug":"codewars.png","modified":1,"renderable":1},{"_id":"source/_posts/一个简单的promise实现/Promise.prototype.then.png","post":"cjk698hxx000cznzwe7v96n1n","slug":"Promise.prototype.then.png","modified":1,"renderable":1},{"_id":"source/_posts/一个简单的promise实现/promise.png","post":"cjk698hxx000cznzwe7v96n1n","slug":"promise.png","modified":1,"renderable":1},{"_id":"source/_posts/仅用1行核心JS代码实现一个轻量级富文本编辑器/execCommand.png","post":"cjk698hy1000fznzwebi9n10o","slug":"execCommand.png","modified":1,"renderable":1},{"_id":"source/_posts/仅用1行核心JS代码实现一个轻量级富文本编辑器/zEditor.png","post":"cjk698hy1000fznzwebi9n10o","slug":"zEditor.png","modified":1,"renderable":1},{"_id":"source/_posts/3分钟搞懂CSS3-transform属性/skew.png","post":"cjk698hx60001znzwnvdh4rvr","slug":"skew.png","modified":1,"renderable":1},{"_id":"source/_posts/3分钟搞懂CSS3-transform属性/transform.png","post":"cjk698hx60001znzwnvdh4rvr","slug":"transform.png","modified":1,"renderable":1},{"_id":"source/_posts/3分钟搞懂CSS3-transform属性/transform转换.mm","post":"cjk698hx60001znzwnvdh4rvr","slug":"transform转换.mm","modified":1,"renderable":1},{"_id":"source/_posts/3分钟搞懂CSS3-transform属性/transform转换.png","slug":"transform转换.png","post":"cjk698hx60001znzwnvdh4rvr","modified":1,"renderable":0},{"_id":"source/_posts/深入探讨正斜杠和反斜杠/Unix.png","post":"cjk698hya000nznzww6909mk6","slug":"Unix.png","modified":1,"renderable":1},{"_id":"source/_posts/深入探讨正斜杠和反斜杠/slash.png","post":"cjk698hya000nznzww6909mk6","slug":"slash.png","modified":1,"renderable":1},{"_id":"source/_posts/深入探讨正斜杠和反斜杠/windows.png","post":"cjk698hya000nznzww6909mk6","slug":"windows.png","modified":1,"renderable":1},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/after.png","slug":"after.png","post":"cjk698hxn0008znzw52ki9j1z","modified":1,"renderable":0},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/background-cover.jpg","slug":"background-cover.jpg","post":"cjk698hxn0008znzw52ki9j1z","modified":1,"renderable":0},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/before.png","slug":"before.png","post":"cjk698hxn0008znzw52ki9j1z","modified":1,"renderable":0},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/bingcn.png","slug":"bingcn.png","post":"cjk698hxn0008znzw52ki9j1z","modified":1,"renderable":0},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/bingen.png","slug":"bingen.png","post":"cjk698hxn0008znzw52ki9j1z","modified":1,"renderable":0},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step2.png","post":"cjk698hxn0008znzw52ki9j1z","slug":"step2.png","modified":1,"renderable":1},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step3.png","post":"cjk698hxn0008znzw52ki9j1z","slug":"step3.png","modified":1,"renderable":1},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step4.png","post":"cjk698hxn0008znzw52ki9j1z","slug":"step4.png","modified":1,"renderable":1},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step5.png","post":"cjk698hxn0008znzw52ki9j1z","slug":"step5.png","modified":1,"renderable":1},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step6-1.png","post":"cjk698hxn0008znzw52ki9j1z","slug":"step6-1.png","modified":1,"renderable":1},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/step6-2.png","post":"cjk698hxn0008znzw52ki9j1z","slug":"step6-2.png","modified":1,"renderable":1},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/wallpaper.jpg","slug":"wallpaper.jpg","post":"cjk698hxn0008znzw52ki9j1z","modified":1,"renderable":0},{"_id":"source/_posts/【Node.js线上部署小项目】让自己的博客每次打开都有不同的封面/xhr.png","post":"cjk698hxn0008znzw52ki9j1z","slug":"xhr.png","modified":1,"renderable":1},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/1.gif","slug":"1.gif","post":"cjk698hxz000dznzwm33d9q74","modified":1,"renderable":0},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/10.gif","slug":"10.gif","post":"cjk698hxz000dznzwm33d9q74","modified":1,"renderable":0},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/11.png","post":"cjk698hxz000dznzwm33d9q74","slug":"11.png","modified":1,"renderable":1},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/12.png","post":"cjk698hxz000dznzwm33d9q74","slug":"12.png","modified":1,"renderable":1},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/2.gif","slug":"2.gif","post":"cjk698hxz000dznzwm33d9q74","modified":1,"renderable":0},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/3.gif","slug":"3.gif","post":"cjk698hxz000dznzwm33d9q74","modified":1,"renderable":0},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/4.2.png","post":"cjk698hxz000dznzwm33d9q74","slug":"4.2.png","modified":1,"renderable":1},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/4.gif","slug":"4.gif","post":"cjk698hxz000dznzwm33d9q74","modified":1,"renderable":0},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/5.gif","slug":"5.gif","post":"cjk698hxz000dznzwm33d9q74","modified":1,"renderable":0},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/6.gif","slug":"6.gif","post":"cjk698hxz000dznzwm33d9q74","modified":1,"renderable":0},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/7.gif","slug":"7.gif","post":"cjk698hxz000dznzwm33d9q74","modified":1,"renderable":0},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/8.gif","slug":"8.gif","post":"cjk698hxz000dznzwm33d9q74","modified":1,"renderable":0},{"_id":"source/_posts/【自译】Chrome浏览器开发者工具的12个有趣技巧——希望已经掌握/9.png","post":"cjk698hxz000dznzwm33d9q74","slug":"9.png","modified":1,"renderable":1}],"PostCategory":[],"PostTag":[{"post_id":"cjk698hx60001znzwnvdh4rvr","tag_id":"cjk698hxg0005znzw33q6lmvr","_id":"cjk698hxx000bznzwurgsuhw3"},{"post_id":"cjk698hxb0003znzwtd86aj18","tag_id":"cjk698hxs000aznzweiv7kxw3","_id":"cjk698hy2000gznzwjq6gog62"},{"post_id":"cjk698hy1000fznzwebi9n10o","tag_id":"cjk698hy0000eznzwpjzn5bu2","_id":"cjk698hy5000jznzwx8he1v0m"},{"post_id":"cjk698hxi0006znzwfynehrwo","tag_id":"cjk698hy0000eznzwpjzn5bu2","_id":"cjk698hyf000rznzwgk7f5pgy"},{"post_id":"cjk698hxi0006znzwfynehrwo","tag_id":"cjk698hxs000aznzweiv7kxw3","_id":"cjk698hyh000tznzwoidcee5y"},{"post_id":"cjk698hxi0006znzwfynehrwo","tag_id":"cjk698hy9000mznzwmr1pyqxp","_id":"cjk698hyh000vznzwqve8dz2f"},{"post_id":"cjk698hyc000oznzwh4eo1k3y","tag_id":"cjk698hy9000mznzwmr1pyqxp","_id":"cjk698hyh000wznzwvh58247l"},{"post_id":"cjk698hyd000qznzwzu02iqf6","tag_id":"cjk698hy0000eznzwpjzn5bu2","_id":"cjk698hyi000yznzwq59tfucn"},{"post_id":"cjk698hxn0008znzw52ki9j1z","tag_id":"cjk698hy9000mznzwmr1pyqxp","_id":"cjk698hyi000zznzwnvy5316t"},{"post_id":"cjk698hyf000sznzwmtvt9r0z","tag_id":"cjk698hy0000eznzwpjzn5bu2","_id":"cjk698hyi0011znzwcassoci7"},{"post_id":"cjk698hxq0009znzw7n0zspus","tag_id":"cjk698hxg0005znzw33q6lmvr","_id":"cjk698hyi0012znzwhsdetx6p"},{"post_id":"cjk698hxq0009znzw7n0zspus","tag_id":"cjk698hy0000eznzwpjzn5bu2","_id":"cjk698hyj0014znzw54gp07aq"},{"post_id":"cjk698hxx000cznzwe7v96n1n","tag_id":"cjk698hy0000eznzwpjzn5bu2","_id":"cjk698hyj0015znzwzzcqgus7"},{"post_id":"cjk698hxz000dznzwm33d9q74","tag_id":"cjk698hyi0010znzwhg52cyp3","_id":"cjk698hyj0017znzwacyp9nmz"},{"post_id":"cjk698hy3000hznzwaef9ynsv","tag_id":"cjk698hyi0013znzwu2u556p5","_id":"cjk698hyj0018znzwhl9mcmac"},{"post_id":"cjk698hy6000kznzw11c744h8","tag_id":"cjk698hyj0016znzwif8xorxd","_id":"cjk698hyk001aznzww84kshfs"},{"post_id":"cjk698hy7000lznzwgpp15ipj","tag_id":"cjk698hyj0019znzwv99plhse","_id":"cjk698hyl001dznzwps5430di"},{"post_id":"cjk698hy7000lznzwgpp15ipj","tag_id":"cjk698hyl001bznzwbmimq1f2","_id":"cjk698hyl001eznzw4dwi734m"},{"post_id":"cjk698hya000nznzww6909mk6","tag_id":"cjk698hyj0016znzwif8xorxd","_id":"cjk698hyl001fznzwibhw7kyw"}],"Tag":[{"name":"CSS","_id":"cjk698hxg0005znzw33q6lmvr"},{"name":"Nginx","_id":"cjk698hxs000aznzweiv7kxw3"},{"name":"JavaScript","_id":"cjk698hy0000eznzwpjzn5bu2"},{"name":"Node.js","_id":"cjk698hy9000mznzwmr1pyqxp"},{"name":"外文翻译","_id":"cjk698hyi0010znzwhg52cyp3"},{"name":"随笔","_id":"cjk698hyi0013znzwu2u556p5"},{"name":"拾遗","_id":"cjk698hyj0016znzwif8xorxd"},{"name":"mysql","_id":"cjk698hyj0019znzwv99plhse"},{"name":"技术杂谈","_id":"cjk698hyl001bznzwbmimq1f2"}]}}